<!DOCTYPE html>
<html lang="en-us"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">

    <title>DQN - Jupyter Notebook</title>
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="DQN%20-%20Jupyter%20Notebook_files/jquery-ui.css" type="text/css">
    <link rel="stylesheet" href="DQN%20-%20Jupyter%20Notebook_files/jquery.css" type="text/css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    


<script type="text/javascript" src="DQN%20-%20Jupyter%20Notebook_files/MathJax.js" charset="utf-8"></script>

<script type="text/javascript">
// MathJax disabled, set as null to distinguish from *missing* MathJax,
// where it will be undefined, and should prompt a dialog later.
window.mathjax_url = "/static/components/MathJax/MathJax.js";
</script>

<link rel="stylesheet" href="DQN%20-%20Jupyter%20Notebook_files/bootstrap-tour.css" type="text/css">
<link rel="stylesheet" href="DQN%20-%20Jupyter%20Notebook_files/codemirror.css">


    <link rel="stylesheet" href="DQN%20-%20Jupyter%20Notebook_files/style.css" type="text/css">
    

<link rel="stylesheet" href="DQN%20-%20Jupyter%20Notebook_files/override.css" type="text/css">
<link rel="stylesheet" href="" id="kernel-css" type="text/css">


    <link rel="stylesheet" href="DQN%20-%20Jupyter%20Notebook_files/custom.css" type="text/css">
    <script src="DQN%20-%20Jupyter%20Notebook_files/promise.js" type="text/javascript" charset="utf-8"></script>
    <script src="DQN%20-%20Jupyter%20Notebook_files/react.js" type="text/javascript"></script>
    <script src="DQN%20-%20Jupyter%20Notebook_files/react-dom.html" type="text/javascript"></script>
    <script src="DQN%20-%20Jupyter%20Notebook_files/index.js" type="text/javascript"></script>
    <script src="DQN%20-%20Jupyter%20Notebook_files/require.js" type="text/javascript" charset="utf-8"></script>
    <script>
      require.config({
          
          urlArgs: "v=20191026175740",
          
          baseUrl: '/static/',
          paths: {
            'auth/js/main': 'auth/js/main.min',
            custom : '/custom',
            nbextensions : '/nbextensions',
            kernelspecs : '/kernelspecs',
            underscore : 'components/underscore/underscore-min',
            backbone : 'components/backbone/backbone-min',
            jed: 'components/jed/jed',
            jquery: 'components/jquery/jquery.min',
            json: 'components/requirejs-plugins/src/json',
            text: 'components/requirejs-text/text',
            bootstrap: 'components/bootstrap/dist/js/bootstrap.min',
            bootstraptour: 'components/bootstrap-tour/build/js/bootstrap-tour.min',
            'jquery-ui': 'components/jquery-ui/jquery-ui.min',
            moment: 'components/moment/min/moment-with-locales',
            codemirror: 'components/codemirror',
            termjs: 'components/xterm.js/xterm',
            typeahead: 'components/jquery-typeahead/dist/jquery.typeahead.min',
          },
          map: { // for backward compatibility
              "*": {
                  "jqueryui": "jquery-ui",
              }
          },
          shim: {
            typeahead: {
              deps: ["jquery"],
              exports: "typeahead"
            },
            underscore: {
              exports: '_'
            },
            backbone: {
              deps: ["underscore", "jquery"],
              exports: "Backbone"
            },
            bootstrap: {
              deps: ["jquery"],
              exports: "bootstrap"
            },
            bootstraptour: {
              deps: ["bootstrap"],
              exports: "Tour"
            },
            "jquery-ui": {
              deps: ["jquery"],
              exports: "$"
            }
          },
          waitSeconds: 30,
      });

      require.config({
          map: {
              '*':{
                'contents': 'services/contents',
              }
          }
      });

      // error-catching custom.js shim.
      define("custom", function (require, exports, module) {
          try {
              var custom = require('custom/custom');
              console.debug('loaded custom.js');
              return custom;
          } catch (e) {
              console.error("error loading custom.js", e);
              return {};
          }
      })

    document.nbjs_translations = {"domain": "nbjs", "locale_data": {"nbjs": {"": {"domain": "nbjs"}}}};
    document.documentElement.lang = navigator.language.toLowerCase();
    </script>

    
    

<script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="services/contents" src="DQN%20-%20Jupyter%20Notebook_files/contents.js"></script><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1px; bottom: 2px; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="custom/custom" src="DQN%20-%20Jupyter%20Notebook_files/custom.js"></script><style type="text/css">div.MathJax_MathML {text-align: center; margin: .75em 0px; display: block!important}
.MathJax_MathML {font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
span.MathJax_MathML {display: inline!important}
.MathJax_mmlExBox {display: block!important; overflow: hidden; height: 1px; width: 60ex; min-height: 0; max-height: none; padding: 0; border: 0; margin: 0}
[class="MJX-tex-oldstyle"] {font-family: MathJax_Caligraphic, MathJax_Caligraphic-WEB}
[class="MJX-tex-oldstyle-bold"] {font-family: MathJax_Caligraphic, MathJax_Caligraphic-WEB; font-weight: bold}
[class="MJX-tex-caligraphic"] {font-family: MathJax_Caligraphic, MathJax_Caligraphic-WEB}
[class="MJX-tex-caligraphic-bold"] {font-family: MathJax_Caligraphic, MathJax_Caligraphic-WEB; font-weight: bold}
@font-face /*1*/ {font-family: MathJax_Caligraphic-WEB; src: url('http://localhost:8888/static/components/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf')}
@font-face /*2*/ {font-family: MathJax_Caligraphic-WEB; font-weight: bold; src: url('http://localhost:8888/static/components/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Bold.otf')}
[mathvariant="double-struck"] {font-family: MathJax_AMS, MathJax_AMS-WEB}
[mathvariant="script"] {font-family: MathJax_Script, MathJax_Script-WEB}
[mathvariant="fraktur"] {font-family: MathJax_Fraktur, MathJax_Fraktur-WEB}
[mathvariant="bold-script"] {font-family: MathJax_Script, MathJax_Caligraphic-WEB; font-weight: bold}
[mathvariant="bold-fraktur"] {font-family: MathJax_Fraktur, MathJax_Fraktur-WEB; font-weight: bold}
[mathvariant="monospace"] {font-family: monospace}
[mathvariant="sans-serif"] {font-family: sans-serif}
[mathvariant="bold-sans-serif"] {font-family: sans-serif; font-weight: bold}
[mathvariant="sans-serif-italic"] {font-family: sans-serif; font-style: italic}
[mathvariant="sans-serif-bold-italic"] {font-family: sans-serif; font-style: italic; font-weight: bold}
@font-face /*3*/ {font-family: MathJax_AMS-WEB; src: url('http://localhost:8888/static/components/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_AMS-Regular.otf')}
@font-face /*4*/ {font-family: MathJax_Script-WEB; src: url('http://localhost:8888/static/components/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Script-Regular.otf')}
@font-face /*5*/ {font-family: MathJax_Fraktur-WEB; src: url('http://localhost:8888/static/components/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Fraktur-Regular.otf')}
@font-face /*6*/ {font-family: MathJax_Fraktur-WEB; font-weight: bold; src: url('http://localhost:8888/static/components/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Fraktur-Bold.otf')}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover, .MJXp-munder {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > *, .MJXp-munder > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">.MathJax_Display {text-align: center; margin: 0; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none; box-sizing: content-box}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_test {font-style: normal; font-weight: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow: hidden; height: 1px}
.MathJax_test.mjx-test-display {display: table!important}
.MathJax_test.mjx-test-inline {display: inline!important; margin-right: -1px}
.MathJax_test.mjx-test-default {display: block!important; clear: both}
.MathJax_ex_box {display: inline-block!important; position: absolute; overflow: hidden; min-height: 0; max-height: none; padding: 0; border: 0; margin: 0; width: 1px; height: 60ex}
.MathJax_em_box {display: inline-block!important; position: absolute; overflow: hidden; min-height: 0; max-height: none; padding: 0; border: 0; margin: 0; width: 1px; height: 60em}
.mjx-test-inline .MathJax_left_box {display: inline-block; width: 0; float: left}
.mjx-test-inline .MathJax_right_box {display: inline-block; width: 0; float: right}
.mjx-test-display .MathJax_right_box {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Blank; src: url('about:blank')}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="nbextensions/jupyter-js-widgets/extension" src="DQN%20-%20Jupyter%20Notebook_files/extension.js"></script><style type="text/css">/*
 * Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/* Override the correction for the prompt area in https://github.com/jupyter/notebook/blob/dd41d9fd5c4f698bd7468612d877828a7eeb0e7a/IPython/html/static/notebook/less/outputarea.less#L110 */
.jupyter-widgets-output-area div.output_subarea {
    max-width: 100%;
}

/* Work-around for the bug fixed in https://github.com/jupyter/notebook/pull/2961 */
.jupyter-widgets-output-area > .out_prompt_overlay {
    display: none;
}
</style><link id="favicon" type="image/x-icon" rel="shortcut icon" href="http://localhost:8888/static/base/images/favicon-notebook.ico"><style type="text/css">/*-----------------------------------------------------------------------------
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/


.p-Widget {
  box-sizing: border-box;
  position: relative;
  overflow: hidden;
  cursor: default;
}


.p-Widget.p-mod-hidden {
  display: none !important;
}
</style><style type="text/css">/*-----------------------------------------------------------------------------
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/


.p-CommandPalette {
  display: flex;
  flex-direction: column;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}


.p-CommandPalette-search {
  flex: 0 0 auto;
}


.p-CommandPalette-content {
  flex: 1 1 auto;
  margin: 0;
  padding: 0;
  min-height: 0;
  overflow: auto;
  list-style-type: none;
}


.p-CommandPalette-header {
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}


.p-CommandPalette-item {
  display: flex;
  flex-direction: row;
}


.p-CommandPalette-itemIcon {
  flex: 0 0 auto;
}


.p-CommandPalette-itemContent {
  flex: 1 1 auto;
  overflow: hidden;
}


.p-CommandPalette-itemShortcut {
  flex: 0 0 auto;
}


.p-CommandPalette-itemLabel {
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}
</style><style type="text/css">/*-----------------------------------------------------------------------------
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/


.p-DockPanel {
  z-index: 0;
}


.p-DockPanel-widget {
  z-index: 0;
}


.p-DockPanel-tabBar {
  z-index: 1;
}


.p-DockPanel-handle {
  z-index: 2;
}


.p-DockPanel-handle.p-mod-hidden {
  display: none !important;
}


.p-DockPanel-handle:after {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  content: '';
}


.p-DockPanel-handle[data-orientation='horizontal'] {
  cursor: ew-resize;
}


.p-DockPanel-handle[data-orientation='vertical'] {
  cursor: ns-resize;
}


.p-DockPanel-handle[data-orientation='horizontal']:after {
  left: 50%;
  min-width: 8px;
  transform: translateX(-50%);
}


.p-DockPanel-handle[data-orientation='vertical']:after {
  top: 50%;
  min-height: 8px;
  transform: translateY(-50%);
}


.p-DockPanel-overlay {
  z-index: 3;
  box-sizing: border-box;
  pointer-events: none;
}


.p-DockPanel-overlay.p-mod-hidden {
  display: none !important;
}
</style><style type="text/css">/*-----------------------------------------------------------------------------
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/


.p-Menu {
  z-index: 10000;
  position: absolute;
  white-space: nowrap;
  overflow-x: hidden;
  overflow-y: auto;
  outline: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}


.p-Menu-content {
  margin: 0;
  padding: 0;
  display: table;
  list-style-type: none;
}


.p-Menu-item {
  display: table-row;
}


.p-Menu-item.p-mod-hidden,
.p-Menu-item.p-mod-collapsed {
  display: none !important;
}


.p-Menu-itemIcon,
.p-Menu-itemSubmenuIcon {
  display: table-cell;
  text-align: center;
}


.p-Menu-itemLabel {
  display: table-cell;
  text-align: left;
}


.p-Menu-itemShortcut {
  display: table-cell;
  text-align: right;
}
</style><style type="text/css">/*-----------------------------------------------------------------------------
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/


.p-MenuBar {
  outline: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}


.p-MenuBar-content {
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: row;
  list-style-type: none;
}


.p-MenuBar-item {
  box-sizing: border-box;
}


.p-MenuBar-itemIcon,
.p-MenuBar-itemLabel {
  display: inline-block;
}
</style><style type="text/css">/*-----------------------------------------------------------------------------
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/


.p-ScrollBar {
  display: flex;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}


.p-ScrollBar[data-orientation='horizontal'] {
  flex-direction: row;
}


.p-ScrollBar[data-orientation='vertical'] {
  flex-direction: column;
}


.p-ScrollBar-button {
  box-sizing: border-box;
  flex: 0 0 auto;
}


.p-ScrollBar-track {
  box-sizing: border-box;
  position: relative;
  overflow: hidden;
  flex: 1 1 auto;
}


.p-ScrollBar-thumb {
  box-sizing: border-box;
  position: absolute;
}
</style><style type="text/css">/*-----------------------------------------------------------------------------
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/


.p-SplitPanel-child {
  z-index: 0;
}


.p-SplitPanel-handle {
  z-index: 1;
}


.p-SplitPanel-handle.p-mod-hidden {
  display: none !important;
}


.p-SplitPanel-handle:after {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  content: '';
}


.p-SplitPanel[data-orientation='horizontal'] > .p-SplitPanel-handle {
  cursor: ew-resize;
}


.p-SplitPanel[data-orientation='vertical'] > .p-SplitPanel-handle {
  cursor: ns-resize;
}


.p-SplitPanel[data-orientation='horizontal'] > .p-SplitPanel-handle:after {
  left: 50%;
  min-width: 8px;
  transform: translateX(-50%);
}


.p-SplitPanel[data-orientation='vertical'] > .p-SplitPanel-handle:after {
  top: 50%;
  min-height: 8px;
  transform: translateY(-50%);
}
</style><style type="text/css">/*-----------------------------------------------------------------------------
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/


.p-TabBar {
  display: flex;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}


.p-TabBar[data-orientation='horizontal'] {
  flex-direction: row;
}


.p-TabBar[data-orientation='vertical'] {
  flex-direction: column;
}


.p-TabBar-content {
  margin: 0;
  padding: 0;
  display: flex;
  flex: 1 1 auto;
  list-style-type: none;
}


.p-TabBar[data-orientation='horizontal'] > .p-TabBar-content {
  flex-direction: row;
}


.p-TabBar[data-orientation='vertical'] > .p-TabBar-content {
  flex-direction: column;
}


.p-TabBar-tab {
  display: flex;
  flex-direction: row;
  box-sizing: border-box;
  overflow: hidden;
}


.p-TabBar-tabIcon,
.p-TabBar-tabCloseIcon {
  flex: 0 0 auto;
}


.p-TabBar-tabLabel {
  flex: 1 1 auto;
  overflow: hidden;
  white-space: nowrap;
}


.p-TabBar-tab.p-mod-hidden {
  display: none !important;
}


.p-TabBar.p-mod-dragging .p-TabBar-tab {
  position: relative;
}


.p-TabBar.p-mod-dragging[data-orientation='horizontal'] .p-TabBar-tab {
  left: 0;
  transition: left 150ms ease;
}


.p-TabBar.p-mod-dragging[data-orientation='vertical'] .p-TabBar-tab {
  top: 0;
  transition: top 150ms ease;
}


.p-TabBar.p-mod-dragging .p-TabBar-tab.p-mod-dragging {
  transition: none;
}
</style><style type="text/css">/*-----------------------------------------------------------------------------
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/


.p-TabPanel-tabBar {
  z-index: 1;
}


.p-TabPanel-stackedPanel {
  z-index: 0;
}
</style><style type="text/css">/*-----------------------------------------------------------------------------
| Copyright (c) 2014-2017, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/
</style><style type="text/css">/* Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

 .jupyter-widgets-disconnected::before {
    content: "\f127"; /* chain-broken */
    display: inline-block;
    font: normal normal normal 14px/1 FontAwesome;
    font-size: inherit;
    text-rendering: auto;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    color: #d9534f;
    padding: 3px;
    align-self: flex-start;
}
</style><style type="text/css">/**
 * The material design colors are adapted from google-material-color v1.2.6
 * https://github.com/danlevan/google-material-color
 * https://github.com/danlevan/google-material-color/blob/f67ca5f4028b2f1b34862f64b0ca67323f91b088/dist/palette.var.css
 *
 * The license for the material design color CSS variables is as follows (see
 * https://github.com/danlevan/google-material-color/blob/f67ca5f4028b2f1b34862f64b0ca67323f91b088/LICENSE)
 *
 * The MIT License (MIT)
 *
 * Copyright (c) 2014 Dan Le Van
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
:root {
  --md-red-50: #FFEBEE;
  --md-red-100: #FFCDD2;
  --md-red-200: #EF9A9A;
  --md-red-300: #E57373;
  --md-red-400: #EF5350;
  --md-red-500: #F44336;
  --md-red-600: #E53935;
  --md-red-700: #D32F2F;
  --md-red-800: #C62828;
  --md-red-900: #B71C1C;
  --md-red-A100: #FF8A80;
  --md-red-A200: #FF5252;
  --md-red-A400: #FF1744;
  --md-red-A700: #D50000;

  --md-pink-50: #FCE4EC;
  --md-pink-100: #F8BBD0;
  --md-pink-200: #F48FB1;
  --md-pink-300: #F06292;
  --md-pink-400: #EC407A;
  --md-pink-500: #E91E63;
  --md-pink-600: #D81B60;
  --md-pink-700: #C2185B;
  --md-pink-800: #AD1457;
  --md-pink-900: #880E4F;
  --md-pink-A100: #FF80AB;
  --md-pink-A200: #FF4081;
  --md-pink-A400: #F50057;
  --md-pink-A700: #C51162;

  --md-purple-50: #F3E5F5;
  --md-purple-100: #E1BEE7;
  --md-purple-200: #CE93D8;
  --md-purple-300: #BA68C8;
  --md-purple-400: #AB47BC;
  --md-purple-500: #9C27B0;
  --md-purple-600: #8E24AA;
  --md-purple-700: #7B1FA2;
  --md-purple-800: #6A1B9A;
  --md-purple-900: #4A148C;
  --md-purple-A100: #EA80FC;
  --md-purple-A200: #E040FB;
  --md-purple-A400: #D500F9;
  --md-purple-A700: #AA00FF;

  --md-deep-purple-50: #EDE7F6;
  --md-deep-purple-100: #D1C4E9;
  --md-deep-purple-200: #B39DDB;
  --md-deep-purple-300: #9575CD;
  --md-deep-purple-400: #7E57C2;
  --md-deep-purple-500: #673AB7;
  --md-deep-purple-600: #5E35B1;
  --md-deep-purple-700: #512DA8;
  --md-deep-purple-800: #4527A0;
  --md-deep-purple-900: #311B92;
  --md-deep-purple-A100: #B388FF;
  --md-deep-purple-A200: #7C4DFF;
  --md-deep-purple-A400: #651FFF;
  --md-deep-purple-A700: #6200EA;

  --md-indigo-50: #E8EAF6;
  --md-indigo-100: #C5CAE9;
  --md-indigo-200: #9FA8DA;
  --md-indigo-300: #7986CB;
  --md-indigo-400: #5C6BC0;
  --md-indigo-500: #3F51B5;
  --md-indigo-600: #3949AB;
  --md-indigo-700: #303F9F;
  --md-indigo-800: #283593;
  --md-indigo-900: #1A237E;
  --md-indigo-A100: #8C9EFF;
  --md-indigo-A200: #536DFE;
  --md-indigo-A400: #3D5AFE;
  --md-indigo-A700: #304FFE;

  --md-blue-50: #E3F2FD;
  --md-blue-100: #BBDEFB;
  --md-blue-200: #90CAF9;
  --md-blue-300: #64B5F6;
  --md-blue-400: #42A5F5;
  --md-blue-500: #2196F3;
  --md-blue-600: #1E88E5;
  --md-blue-700: #1976D2;
  --md-blue-800: #1565C0;
  --md-blue-900: #0D47A1;
  --md-blue-A100: #82B1FF;
  --md-blue-A200: #448AFF;
  --md-blue-A400: #2979FF;
  --md-blue-A700: #2962FF;

  --md-light-blue-50: #E1F5FE;
  --md-light-blue-100: #B3E5FC;
  --md-light-blue-200: #81D4FA;
  --md-light-blue-300: #4FC3F7;
  --md-light-blue-400: #29B6F6;
  --md-light-blue-500: #03A9F4;
  --md-light-blue-600: #039BE5;
  --md-light-blue-700: #0288D1;
  --md-light-blue-800: #0277BD;
  --md-light-blue-900: #01579B;
  --md-light-blue-A100: #80D8FF;
  --md-light-blue-A200: #40C4FF;
  --md-light-blue-A400: #00B0FF;
  --md-light-blue-A700: #0091EA;

  --md-cyan-50: #E0F7FA;
  --md-cyan-100: #B2EBF2;
  --md-cyan-200: #80DEEA;
  --md-cyan-300: #4DD0E1;
  --md-cyan-400: #26C6DA;
  --md-cyan-500: #00BCD4;
  --md-cyan-600: #00ACC1;
  --md-cyan-700: #0097A7;
  --md-cyan-800: #00838F;
  --md-cyan-900: #006064;
  --md-cyan-A100: #84FFFF;
  --md-cyan-A200: #18FFFF;
  --md-cyan-A400: #00E5FF;
  --md-cyan-A700: #00B8D4;

  --md-teal-50: #E0F2F1;
  --md-teal-100: #B2DFDB;
  --md-teal-200: #80CBC4;
  --md-teal-300: #4DB6AC;
  --md-teal-400: #26A69A;
  --md-teal-500: #009688;
  --md-teal-600: #00897B;
  --md-teal-700: #00796B;
  --md-teal-800: #00695C;
  --md-teal-900: #004D40;
  --md-teal-A100: #A7FFEB;
  --md-teal-A200: #64FFDA;
  --md-teal-A400: #1DE9B6;
  --md-teal-A700: #00BFA5;

  --md-green-50: #E8F5E9;
  --md-green-100: #C8E6C9;
  --md-green-200: #A5D6A7;
  --md-green-300: #81C784;
  --md-green-400: #66BB6A;
  --md-green-500: #4CAF50;
  --md-green-600: #43A047;
  --md-green-700: #388E3C;
  --md-green-800: #2E7D32;
  --md-green-900: #1B5E20;
  --md-green-A100: #B9F6CA;
  --md-green-A200: #69F0AE;
  --md-green-A400: #00E676;
  --md-green-A700: #00C853;

  --md-light-green-50: #F1F8E9;
  --md-light-green-100: #DCEDC8;
  --md-light-green-200: #C5E1A5;
  --md-light-green-300: #AED581;
  --md-light-green-400: #9CCC65;
  --md-light-green-500: #8BC34A;
  --md-light-green-600: #7CB342;
  --md-light-green-700: #689F38;
  --md-light-green-800: #558B2F;
  --md-light-green-900: #33691E;
  --md-light-green-A100: #CCFF90;
  --md-light-green-A200: #B2FF59;
  --md-light-green-A400: #76FF03;
  --md-light-green-A700: #64DD17;

  --md-lime-50: #F9FBE7;
  --md-lime-100: #F0F4C3;
  --md-lime-200: #E6EE9C;
  --md-lime-300: #DCE775;
  --md-lime-400: #D4E157;
  --md-lime-500: #CDDC39;
  --md-lime-600: #C0CA33;
  --md-lime-700: #AFB42B;
  --md-lime-800: #9E9D24;
  --md-lime-900: #827717;
  --md-lime-A100: #F4FF81;
  --md-lime-A200: #EEFF41;
  --md-lime-A400: #C6FF00;
  --md-lime-A700: #AEEA00;

  --md-yellow-50: #FFFDE7;
  --md-yellow-100: #FFF9C4;
  --md-yellow-200: #FFF59D;
  --md-yellow-300: #FFF176;
  --md-yellow-400: #FFEE58;
  --md-yellow-500: #FFEB3B;
  --md-yellow-600: #FDD835;
  --md-yellow-700: #FBC02D;
  --md-yellow-800: #F9A825;
  --md-yellow-900: #F57F17;
  --md-yellow-A100: #FFFF8D;
  --md-yellow-A200: #FFFF00;
  --md-yellow-A400: #FFEA00;
  --md-yellow-A700: #FFD600;

  --md-amber-50: #FFF8E1;
  --md-amber-100: #FFECB3;
  --md-amber-200: #FFE082;
  --md-amber-300: #FFD54F;
  --md-amber-400: #FFCA28;
  --md-amber-500: #FFC107;
  --md-amber-600: #FFB300;
  --md-amber-700: #FFA000;
  --md-amber-800: #FF8F00;
  --md-amber-900: #FF6F00;
  --md-amber-A100: #FFE57F;
  --md-amber-A200: #FFD740;
  --md-amber-A400: #FFC400;
  --md-amber-A700: #FFAB00;

  --md-orange-50: #FFF3E0;
  --md-orange-100: #FFE0B2;
  --md-orange-200: #FFCC80;
  --md-orange-300: #FFB74D;
  --md-orange-400: #FFA726;
  --md-orange-500: #FF9800;
  --md-orange-600: #FB8C00;
  --md-orange-700: #F57C00;
  --md-orange-800: #EF6C00;
  --md-orange-900: #E65100;
  --md-orange-A100: #FFD180;
  --md-orange-A200: #FFAB40;
  --md-orange-A400: #FF9100;
  --md-orange-A700: #FF6D00;

  --md-deep-orange-50: #FBE9E7;
  --md-deep-orange-100: #FFCCBC;
  --md-deep-orange-200: #FFAB91;
  --md-deep-orange-300: #FF8A65;
  --md-deep-orange-400: #FF7043;
  --md-deep-orange-500: #FF5722;
  --md-deep-orange-600: #F4511E;
  --md-deep-orange-700: #E64A19;
  --md-deep-orange-800: #D84315;
  --md-deep-orange-900: #BF360C;
  --md-deep-orange-A100: #FF9E80;
  --md-deep-orange-A200: #FF6E40;
  --md-deep-orange-A400: #FF3D00;
  --md-deep-orange-A700: #DD2C00;

  --md-brown-50: #EFEBE9;
  --md-brown-100: #D7CCC8;
  --md-brown-200: #BCAAA4;
  --md-brown-300: #A1887F;
  --md-brown-400: #8D6E63;
  --md-brown-500: #795548;
  --md-brown-600: #6D4C41;
  --md-brown-700: #5D4037;
  --md-brown-800: #4E342E;
  --md-brown-900: #3E2723;

  --md-grey-50: #FAFAFA;
  --md-grey-100: #F5F5F5;
  --md-grey-200: #EEEEEE;
  --md-grey-300: #E0E0E0;
  --md-grey-400: #BDBDBD;
  --md-grey-500: #9E9E9E;
  --md-grey-600: #757575;
  --md-grey-700: #616161;
  --md-grey-800: #424242;
  --md-grey-900: #212121;

  --md-blue-grey-50: #ECEFF1;
  --md-blue-grey-100: #CFD8DC;
  --md-blue-grey-200: #B0BEC5;
  --md-blue-grey-300: #90A4AE;
  --md-blue-grey-400: #78909C;
  --md-blue-grey-500: #607D8B;
  --md-blue-grey-600: #546E7A;
  --md-blue-grey-700: #455A64;
  --md-blue-grey-800: #37474F;
  --md-blue-grey-900: #263238;
}</style><style type="text/css">/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*
This file is copied from the JupyterLab project to define default styling for
when the widget styling is compiled down to eliminate CSS variables. We make one
change - we comment out the font import below.
*/

/*
The following CSS variables define the main, public API for styling JupyterLab.
These variables should be used by all plugins wherever possible. In other
words, plugins should not define custom colors, sizes, etc unless absolutely
necessary. This enables users to change the visual theme of JupyterLab
by changing these variables.

Many variables appear in an ordered sequence (0,1,2,3). These sequences
are designed to work well together, so for example, `--jp-border-color1` should
be used with `--jp-layout-color1`. The numbers have the following meanings:

* 0: super-primary, reserved for special emphasis
* 1: primary, most important under normal situations
* 2: secondary, next most important under normal situations
* 3: tertiary, next most important under normal situations

Throughout JupyterLab, we are mostly following principles from Google's
Material Design when selecting colors. We are not, however, following
all of MD as it is not optimized for dense, information rich UIs.
*/


/*
 * Optional monospace font for input/output prompt.
 */
 /* Commented out in ipywidgets since we don't need it. */
/* @import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); */

/*
 * Added for compabitility with output area
 */
:root {
  --jp-icon-search: none;
  --jp-ui-select-caret: none;
}


:root {

  /* Borders

  The following variables, specify the visual styling of borders in JupyterLab.
   */

  --jp-border-width: 1px;
  --jp-border-color0: var(--md-grey-700);
  --jp-border-color1: var(--md-grey-500);
  --jp-border-color2: var(--md-grey-300);
  --jp-border-color3: var(--md-grey-100);

  /* UI Fonts

  The UI font CSS variables are used for the typography all of the JupyterLab
  user interface elements that are not directly user generated content.
  */

  --jp-ui-font-scale-factor: 1.2;
  --jp-ui-font-size0: calc(var(--jp-ui-font-size1)/var(--jp-ui-font-scale-factor));
  --jp-ui-font-size1: 13px; /* Base font size */
  --jp-ui-font-size2: calc(var(--jp-ui-font-size1)*var(--jp-ui-font-scale-factor));
  --jp-ui-font-size3: calc(var(--jp-ui-font-size2)*var(--jp-ui-font-scale-factor));
  --jp-ui-icon-font-size: 14px; /* Ensures px perfect FontAwesome icons */
  --jp-ui-font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;

  /* Use these font colors against the corresponding main layout colors.
     In a light theme, these go from dark to light.
  */

  --jp-ui-font-color0: rgba(0,0,0,1.0);
  --jp-ui-font-color1: rgba(0,0,0,0.8);
  --jp-ui-font-color2: rgba(0,0,0,0.5);
  --jp-ui-font-color3: rgba(0,0,0,0.3);

  /* Use these against the brand/accent/warn/error colors.
     These will typically go from light to darker, in both a dark and light theme
   */

  --jp-inverse-ui-font-color0: rgba(255,255,255,1);
  --jp-inverse-ui-font-color1: rgba(255,255,255,1.0);
  --jp-inverse-ui-font-color2: rgba(255,255,255,0.7);
  --jp-inverse-ui-font-color3: rgba(255,255,255,0.5);

  /* Content Fonts

  Content font variables are used for typography of user generated content.
  */

  --jp-content-font-size: 13px;
  --jp-content-line-height: 1.5;
  --jp-content-font-color0: black;
  --jp-content-font-color1: black;
  --jp-content-font-color2: var(--md-grey-700);
  --jp-content-font-color3: var(--md-grey-500);

  --jp-ui-font-scale-factor: 1.2;
  --jp-ui-font-size0: calc(var(--jp-ui-font-size1)/var(--jp-ui-font-scale-factor));
  --jp-ui-font-size1: 13px; /* Base font size */
  --jp-ui-font-size2: calc(var(--jp-ui-font-size1)*var(--jp-ui-font-scale-factor));
  --jp-ui-font-size3: calc(var(--jp-ui-font-size2)*var(--jp-ui-font-scale-factor));

  --jp-code-font-size: 13px;
  --jp-code-line-height: 1.307;
  --jp-code-padding: 5px;
  --jp-code-font-family: monospace;


  /* Layout

  The following are the main layout colors use in JupyterLab. In a light
  theme these would go from light to dark.
  */

  --jp-layout-color0: white;
  --jp-layout-color1: white;
  --jp-layout-color2: var(--md-grey-200);
  --jp-layout-color3: var(--md-grey-400);

  /* Brand/accent */

  --jp-brand-color0: var(--md-blue-700);
  --jp-brand-color1: var(--md-blue-500);
  --jp-brand-color2: var(--md-blue-300);
  --jp-brand-color3: var(--md-blue-100);

  --jp-accent-color0: var(--md-green-700);
  --jp-accent-color1: var(--md-green-500);
  --jp-accent-color2: var(--md-green-300);
  --jp-accent-color3: var(--md-green-100);

  /* State colors (warn, error, success, info) */

  --jp-warn-color0: var(--md-orange-700);
  --jp-warn-color1: var(--md-orange-500);
  --jp-warn-color2: var(--md-orange-300);
  --jp-warn-color3: var(--md-orange-100);

  --jp-error-color0: var(--md-red-700);
  --jp-error-color1: var(--md-red-500);
  --jp-error-color2: var(--md-red-300);
  --jp-error-color3: var(--md-red-100);

  --jp-success-color0: var(--md-green-700);
  --jp-success-color1: var(--md-green-500);
  --jp-success-color2: var(--md-green-300);
  --jp-success-color3: var(--md-green-100);

  --jp-info-color0: var(--md-cyan-700);
  --jp-info-color1: var(--md-cyan-500);
  --jp-info-color2: var(--md-cyan-300);
  --jp-info-color3: var(--md-cyan-100);

  /* Cell specific styles */

  --jp-cell-padding: 5px;
  --jp-cell-editor-background: #f7f7f7;
  --jp-cell-editor-border-color: #cfcfcf;
  --jp-cell-editor-background-edit: var(--jp-ui-layout-color1);
  --jp-cell-editor-border-color-edit: var(--jp-brand-color1);
  --jp-cell-prompt-width: 100px;
  --jp-cell-prompt-font-family: 'Roboto Mono', monospace;
  --jp-cell-prompt-letter-spacing: 0px;
  --jp-cell-prompt-opacity: 1.0;
  --jp-cell-prompt-opacity-not-active: 0.4;
  --jp-cell-prompt-font-color-not-active: var(--md-grey-700);
  /* A custom blend of MD grey and blue 600
   * See https://meyerweb.com/eric/tools/color-blend/#546E7A:1E88E5:5:hex */
  --jp-cell-inprompt-font-color: #307FC1;
  /* A custom blend of MD grey and orange 600
   * https://meyerweb.com/eric/tools/color-blend/#546E7A:F4511E:5:hex */
  --jp-cell-outprompt-font-color: #BF5B3D;

  /* Notebook specific styles */

  --jp-notebook-padding: 10px;
  --jp-notebook-scroll-padding: 100px;

  /* Console specific styles */

  --jp-console-background: var(--md-grey-100);

  /* Toolbar specific styles */

  --jp-toolbar-border-color: var(--md-grey-400);
  --jp-toolbar-micro-height: 8px;
  --jp-toolbar-background: var(--jp-layout-color0);
  --jp-toolbar-box-shadow: 0px 0px 2px 0px rgba(0,0,0,0.24);
  --jp-toolbar-header-margin: 4px 4px 0px 4px;
  --jp-toolbar-active-background: var(--md-grey-300);
}
</style><style type="text/css">/* This file has code derived from PhosphorJS CSS files, as noted below. The license for this PhosphorJS code is:

Copyright (c) 2014-2017, PhosphorJS Contributors
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:

* Redistributions of source code must retain the above copyright notice, this
  list of conditions and the following disclaimer.

* Redistributions in binary form must reproduce the above copyright notice,
  this list of conditions and the following disclaimer in the documentation
  and/or other materials provided with the distribution.

* Neither the name of the copyright holder nor the names of its
  contributors may be used to endorse or promote products derived from
  this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

*/

/*
 * The following section is derived from https://github.com/phosphorjs/phosphor/blob/23b9d075ebc5b73ab148b6ebfc20af97f85714c4/packages/widgets/style/tabbar.css 
 * We've scoped the rules so that they are consistent with exactly our code.
 */

.jupyter-widgets.widget-tab > .p-TabBar {
  display: flex;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}


.jupyter-widgets.widget-tab > .p-TabBar[data-orientation='horizontal'] {
  flex-direction: row;
}


.jupyter-widgets.widget-tab > .p-TabBar[data-orientation='vertical'] {
  flex-direction: column;
}


.jupyter-widgets.widget-tab > .p-TabBar > .p-TabBar-content {
  margin: 0;
  padding: 0;
  display: flex;
  flex: 1 1 auto;
  list-style-type: none;
}


.jupyter-widgets.widget-tab > .p-TabBar[data-orientation='horizontal'] > .p-TabBar-content {
  flex-direction: row;
}


.jupyter-widgets.widget-tab > .p-TabBar[data-orientation='vertical'] > .p-TabBar-content {
  flex-direction: column;
}


.jupyter-widgets.widget-tab > .p-TabBar .p-TabBar-tab {
  display: flex;
  flex-direction: row;
  box-sizing: border-box;
  overflow: hidden;
}


.jupyter-widgets.widget-tab > .p-TabBar .p-TabBar-tabIcon,
.jupyter-widgets.widget-tab > .p-TabBar .p-TabBar-tabCloseIcon {
  flex: 0 0 auto;
}


.jupyter-widgets.widget-tab > .p-TabBar .p-TabBar-tabLabel {
  flex: 1 1 auto;
  overflow: hidden;
  white-space: nowrap;
}


.jupyter-widgets.widget-tab > .p-TabBar .p-TabBar-tab.p-mod-hidden {
  display: none !important;
}


.jupyter-widgets.widget-tab > .p-TabBar.p-mod-dragging .p-TabBar-tab {
  position: relative;
}


.jupyter-widgets.widget-tab > .p-TabBar.p-mod-dragging[data-orientation='horizontal'] .p-TabBar-tab {
  left: 0;
  transition: left 150ms ease;
}


.jupyter-widgets.widget-tab > .p-TabBar.p-mod-dragging[data-orientation='vertical'] .p-TabBar-tab {
  top: 0;
  transition: top 150ms ease;
}


.jupyter-widgets.widget-tab > .p-TabBar.p-mod-dragging .p-TabBar-tab.p-mod-dragging {
  transition: none;
}

/* End tabbar.css */
</style><style type="text/css">/* Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/*
 * We assume that the CSS variables in
 * https://github.com/jupyterlab/jupyterlab/blob/master/src/default-theme/variables.css
 * have been defined.
 */

:root {
    --jp-widgets-color: var(--jp-content-font-color1);
    --jp-widgets-label-color: var(--jp-widgets-color);
    --jp-widgets-readout-color: var(--jp-widgets-color);
    --jp-widgets-font-size: var(--jp-ui-font-size1);
    --jp-widgets-margin: 2px;
    --jp-widgets-inline-height: 28px;
    --jp-widgets-inline-width: 300px;
    --jp-widgets-inline-width-short: calc(var(--jp-widgets-inline-width) / 2 - var(--jp-widgets-margin));
    --jp-widgets-inline-width-tiny: calc(var(--jp-widgets-inline-width-short) / 2 - var(--jp-widgets-margin));
    --jp-widgets-inline-margin: 4px; /* margin between inline elements */
    --jp-widgets-inline-label-width: 80px;
    --jp-widgets-border-width: var(--jp-border-width);
    --jp-widgets-vertical-height: 200px;
    --jp-widgets-horizontal-tab-height: 24px;
    --jp-widgets-horizontal-tab-width: 144px;
    --jp-widgets-horizontal-tab-top-border: 2px;
    --jp-widgets-progress-thickness: 20px;
    --jp-widgets-container-padding: 15px;
    --jp-widgets-input-padding: 4px;
    --jp-widgets-radio-item-height-adjustment: 8px;
    --jp-widgets-radio-item-height: calc(var(--jp-widgets-inline-height) - var(--jp-widgets-radio-item-height-adjustment));
    --jp-widgets-slider-track-thickness: 4px;
    --jp-widgets-slider-border-width: var(--jp-widgets-border-width);
    --jp-widgets-slider-handle-size: 16px;
    --jp-widgets-slider-handle-border-color: var(--jp-border-color1);
    --jp-widgets-slider-handle-background-color: var(--jp-layout-color1);
    --jp-widgets-slider-active-handle-color: var(--jp-brand-color1);
    --jp-widgets-menu-item-height: 24px;
    --jp-widgets-dropdown-arrow: url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE5LjIuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCAxOCAxOCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMTggMTg7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbDpub25lO30KPC9zdHlsZT4KPHBhdGggZD0iTTUuMiw1LjlMOSw5LjdsMy44LTMuOGwxLjIsMS4ybC00LjksNWwtNC45LTVMNS4yLDUuOXoiLz4KPHBhdGggY2xhc3M9InN0MCIgZD0iTTAtMC42aDE4djE4SDBWLTAuNnoiLz4KPC9zdmc+Cg");
    --jp-widgets-input-color: var(--jp-ui-font-color1);
    --jp-widgets-input-background-color: var(--jp-layout-color1);
    --jp-widgets-input-border-color: var(--jp-border-color1);
    --jp-widgets-input-focus-border-color: var(--jp-brand-color2);
    --jp-widgets-input-border-width: var(--jp-widgets-border-width);
    --jp-widgets-disabled-opacity: 0.6;

    /* From Material Design Lite */
    --md-shadow-key-umbra-opacity: 0.2;
    --md-shadow-key-penumbra-opacity: 0.14;
    --md-shadow-ambient-shadow-opacity: 0.12;
}

.jupyter-widgets {
    margin: var(--jp-widgets-margin);
    box-sizing: border-box;
    color: var(--jp-widgets-color);
    overflow: visible;
}

.jupyter-widgets.jupyter-widgets-disconnected::before {
    line-height: var(--jp-widgets-inline-height);
    height: var(--jp-widgets-inline-height);
}

.jp-Output-result > .jupyter-widgets {
    margin-left: 0;
    margin-right: 0;
}

/* vbox and hbox */

.widget-inline-hbox {
    /* Horizontal widgets */
    box-sizing: border-box;
    display: flex;
    flex-direction: row;
    align-items: baseline;
}

.widget-inline-vbox {
    /* Vertical Widgets */
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.widget-box {
    box-sizing: border-box;
    display: flex;
    margin: 0;
    overflow: auto;
}

.widget-gridbox {
    box-sizing: border-box;
    display: grid;
    margin: 0;
    overflow: auto;
}

.widget-hbox {
    flex-direction: row;
}

.widget-vbox {
    flex-direction: column;
}

/* General Button Styling */

.jupyter-button {
    padding-left: 10px;
    padding-right: 10px;
    padding-top: 0px;
    padding-bottom: 0px;
    display: inline-block;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    text-align: center;
    font-size: var(--jp-widgets-font-size);
    cursor: pointer;

    height: var(--jp-widgets-inline-height);
    border: 0px solid;
    line-height: var(--jp-widgets-inline-height);
    box-shadow: none;

    color: var(--jp-ui-font-color1);
    background-color: var(--jp-layout-color2);
    border-color: var(--jp-border-color2);
    border: none;
    user-select: none;
}

.jupyter-button i.fa {
    margin-right: var(--jp-widgets-inline-margin);
    pointer-events: none;
}

.jupyter-button:empty:before {
    content: "\200b"; /* zero-width space */
}

.jupyter-widgets.jupyter-button:disabled {
    opacity: var(--jp-widgets-disabled-opacity);
}

.jupyter-button i.fa.center {
    margin-right: 0;
}

.jupyter-button:hover:enabled, .jupyter-button:focus:enabled {
    /* MD Lite 2dp shadow */
    box-shadow: 0 2px 2px 0 rgba(0, 0, 0, var(--md-shadow-key-penumbra-opacity)),
                0 3px 1px -2px rgba(0, 0, 0, var(--md-shadow-key-umbra-opacity)),
                0 1px 5px 0 rgba(0, 0, 0, var(--md-shadow-ambient-shadow-opacity));
}

.jupyter-button:active, .jupyter-button.mod-active {
    /* MD Lite 4dp shadow */
    box-shadow: 0 4px 5px 0 rgba(0, 0, 0, var(--md-shadow-key-penumbra-opacity)),
                0 1px 10px 0 rgba(0, 0, 0, var(--md-shadow-ambient-shadow-opacity)),
                0 2px 4px -1px rgba(0, 0, 0, var(--md-shadow-key-umbra-opacity));
    color: var(--jp-ui-font-color1);
    background-color: var(--jp-layout-color3);
}

.jupyter-button:focus:enabled {
    outline: 1px solid var(--jp-widgets-input-focus-border-color);
}

/* Button "Primary" Styling */

.jupyter-button.mod-primary {
    color: var(--jp-inverse-ui-font-color1);
    background-color: var(--jp-brand-color1);
}

.jupyter-button.mod-primary.mod-active {
    color: var(--jp-inverse-ui-font-color0);
    background-color: var(--jp-brand-color0);
}

.jupyter-button.mod-primary:active {
    color: var(--jp-inverse-ui-font-color0);
    background-color: var(--jp-brand-color0);
}

/* Button "Success" Styling */

.jupyter-button.mod-success {
    color: var(--jp-inverse-ui-font-color1);
    background-color: var(--jp-success-color1);
}

.jupyter-button.mod-success.mod-active {
    color: var(--jp-inverse-ui-font-color0);
    background-color: var(--jp-success-color0);
 }

.jupyter-button.mod-success:active {
    color: var(--jp-inverse-ui-font-color0);
    background-color: var(--jp-success-color0);
 }

 /* Button "Info" Styling */

.jupyter-button.mod-info {
    color: var(--jp-inverse-ui-font-color1);
    background-color: var(--jp-info-color1);
}

.jupyter-button.mod-info.mod-active {
    color: var(--jp-inverse-ui-font-color0);
    background-color: var(--jp-info-color0);
}

.jupyter-button.mod-info:active {
    color: var(--jp-inverse-ui-font-color0);
    background-color: var(--jp-info-color0);
}

/* Button "Warning" Styling */

.jupyter-button.mod-warning {
    color: var(--jp-inverse-ui-font-color1);
    background-color: var(--jp-warn-color1);
}

.jupyter-button.mod-warning.mod-active {
    color: var(--jp-inverse-ui-font-color0);
    background-color: var(--jp-warn-color0);
}

.jupyter-button.mod-warning:active {
    color: var(--jp-inverse-ui-font-color0);
    background-color: var(--jp-warn-color0);
}

/* Button "Danger" Styling */

.jupyter-button.mod-danger {
    color: var(--jp-inverse-ui-font-color1);
    background-color: var(--jp-error-color1);
}

.jupyter-button.mod-danger.mod-active {
    color: var(--jp-inverse-ui-font-color0);
    background-color: var(--jp-error-color0);
}

.jupyter-button.mod-danger:active {
    color: var(--jp-inverse-ui-font-color0);
    background-color: var(--jp-error-color0);
}

/* Widget Button, Widget Toggle Button, Widget Upload */

.widget-button, .widget-toggle-button, .widget-upload {
    width: var(--jp-widgets-inline-width-short);
}

/* Widget Label Styling */

/* Override Bootstrap label css */
.jupyter-widgets label {
    margin-bottom: initial;
}

.widget-label-basic {
    /* Basic Label */
    color: var(--jp-widgets-label-color);
    font-size: var(--jp-widgets-font-size);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    line-height: var(--jp-widgets-inline-height);
}

.widget-label {
    /* Label */
    color: var(--jp-widgets-label-color);
    font-size: var(--jp-widgets-font-size);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    line-height: var(--jp-widgets-inline-height);
}

.widget-inline-hbox .widget-label {
    /* Horizontal Widget Label */
    color: var(--jp-widgets-label-color);
    text-align: right;
    margin-right: calc( var(--jp-widgets-inline-margin) * 2 );
    width: var(--jp-widgets-inline-label-width);
    flex-shrink: 0;
}

.widget-inline-vbox .widget-label {
    /* Vertical Widget Label */
    color: var(--jp-widgets-label-color);
    text-align: center;
    line-height: var(--jp-widgets-inline-height);
}

/* Widget Readout Styling */

.widget-readout {
    color: var(--jp-widgets-readout-color);
    font-size: var(--jp-widgets-font-size);
    height: var(--jp-widgets-inline-height);
    line-height: var(--jp-widgets-inline-height);
    overflow: hidden;
    white-space: nowrap;
    text-align: center;
}

.widget-readout.overflow {
    /* Overflowing Readout */

    /* From Material Design Lite
        shadow-key-umbra-opacity: 0.2;
        shadow-key-penumbra-opacity: 0.14;
        shadow-ambient-shadow-opacity: 0.12;
     */
    -webkit-box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.2),
                        0 3px 1px -2px rgba(0, 0, 0, 0.14),
                        0 1px 5px 0 rgba(0, 0, 0, 0.12);

    -moz-box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.2),
                     0 3px 1px -2px rgba(0, 0, 0, 0.14),
                     0 1px 5px 0 rgba(0, 0, 0, 0.12);

    box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.2),
                0 3px 1px -2px rgba(0, 0, 0, 0.14),
                0 1px 5px 0 rgba(0, 0, 0, 0.12);
}

.widget-inline-hbox .widget-readout {
    /* Horizontal Readout */
    text-align: center;
    max-width: var(--jp-widgets-inline-width-short);
    min-width: var(--jp-widgets-inline-width-tiny);
    margin-left: var(--jp-widgets-inline-margin);
}

.widget-inline-vbox .widget-readout {
    /* Vertical Readout */
    margin-top: var(--jp-widgets-inline-margin);
    /* as wide as the widget */
    width: inherit;
}

/* Widget Checkbox Styling */

.widget-checkbox {
    width: var(--jp-widgets-inline-width);
    height: var(--jp-widgets-inline-height);
    line-height: var(--jp-widgets-inline-height);
}

.widget-checkbox input[type="checkbox"] {
    margin: 0px calc( var(--jp-widgets-inline-margin) * 2 ) 0px 0px;
    line-height: var(--jp-widgets-inline-height);
    font-size: large;
    flex-grow: 1;
    flex-shrink: 0;
    align-self: center;
}

/* Widget Valid Styling */

.widget-valid {
    height: var(--jp-widgets-inline-height);
    line-height: var(--jp-widgets-inline-height);
    width: var(--jp-widgets-inline-width-short);
    font-size: var(--jp-widgets-font-size);
}

.widget-valid i:before {
    line-height: var(--jp-widgets-inline-height);
    margin-right: var(--jp-widgets-inline-margin);
    margin-left: var(--jp-widgets-inline-margin);

    /* from the fa class in FontAwesome: https://github.com/FortAwesome/Font-Awesome/blob/49100c7c3a7b58d50baa71efef11af41a66b03d3/css/font-awesome.css#L14 */
    display: inline-block;
    font: normal normal normal 14px/1 FontAwesome;
    font-size: inherit;
    text-rendering: auto;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

.widget-valid.mod-valid i:before {
    content: "\f00c";
    color: green;
}

.widget-valid.mod-invalid i:before {
    content: "\f00d";
    color: red;
}

.widget-valid.mod-valid .widget-valid-readout {
    display: none;
}

/* Widget Text and TextArea Stying */

.widget-textarea, .widget-text {
    width: var(--jp-widgets-inline-width);
}

.widget-text input[type="text"], .widget-text input[type="number"]{
    height: var(--jp-widgets-inline-height);
    line-height: var(--jp-widgets-inline-height);
}

.widget-text input[type="text"]:disabled, .widget-text input[type="number"]:disabled, .widget-textarea textarea:disabled {
    opacity: var(--jp-widgets-disabled-opacity);
}

.widget-text input[type="text"], .widget-text input[type="number"], .widget-textarea textarea {
    box-sizing: border-box;
    border: var(--jp-widgets-input-border-width) solid var(--jp-widgets-input-border-color);
    background-color: var(--jp-widgets-input-background-color);
    color: var(--jp-widgets-input-color);
    font-size: var(--jp-widgets-font-size);
    flex-grow: 1;
    min-width: 0; /* This makes it possible for the flexbox to shrink this input */
    flex-shrink: 1;
    outline: none !important;
}
    
.widget-text input[type="text"], .widget-textarea textarea {
    padding: var(--jp-widgets-input-padding) calc( var(--jp-widgets-input-padding) *  2);
}

.widget-text input[type="number"] {
    padding: var(--jp-widgets-input-padding) 0 var(--jp-widgets-input-padding) calc(var(--jp-widgets-input-padding) *  2);
}

.widget-textarea textarea {
    height: inherit;
    width: inherit;
}

.widget-text input:focus, .widget-textarea textarea:focus {
    border-color: var(--jp-widgets-input-focus-border-color);
}

/* Widget Slider */

.widget-slider .ui-slider {
    /* Slider Track */
    border: var(--jp-widgets-slider-border-width) solid var(--jp-layout-color3);
    background: var(--jp-layout-color3);
    box-sizing: border-box;
    position: relative;
    border-radius: 0px;
}

.widget-slider .ui-slider .ui-slider-handle {
    /* Slider Handle */
    outline: none !important; /* focused slider handles are colored - see below */
    position: absolute;
    background-color: var(--jp-widgets-slider-handle-background-color);
    border: var(--jp-widgets-slider-border-width) solid var(--jp-widgets-slider-handle-border-color);
    box-sizing: border-box;
    z-index: 1;
    background-image: none; /* Override jquery-ui */
}

/* Override jquery-ui */
.widget-slider .ui-slider .ui-slider-handle:hover, .widget-slider .ui-slider .ui-slider-handle:focus {
    background-color: var(--jp-widgets-slider-active-handle-color);
    border: var(--jp-widgets-slider-border-width) solid var(--jp-widgets-slider-active-handle-color);
}

.widget-slider .ui-slider .ui-slider-handle:active {
    background-color: var(--jp-widgets-slider-active-handle-color);
    border-color: var(--jp-widgets-slider-active-handle-color);
    z-index: 2;
    transform: scale(1.2);
}

.widget-slider  .ui-slider .ui-slider-range {
    /* Interval between the two specified value of a double slider */
    position: absolute;
    background: var(--jp-widgets-slider-active-handle-color);
    z-index: 0;
}

/* Shapes of Slider Handles */

.widget-hslider .ui-slider .ui-slider-handle {
    width: var(--jp-widgets-slider-handle-size);
    height: var(--jp-widgets-slider-handle-size);
    margin-top: calc((var(--jp-widgets-slider-track-thickness) - var(--jp-widgets-slider-handle-size)) / 2 - var(--jp-widgets-slider-border-width));
    margin-left: calc(var(--jp-widgets-slider-handle-size) / -2 + var(--jp-widgets-slider-border-width));
    border-radius: 50%;
    top: 0;
}

.widget-vslider .ui-slider .ui-slider-handle {
    width: var(--jp-widgets-slider-handle-size);
    height: var(--jp-widgets-slider-handle-size);
    margin-bottom: calc(var(--jp-widgets-slider-handle-size) / -2 + var(--jp-widgets-slider-border-width));
    margin-left: calc((var(--jp-widgets-slider-track-thickness) - var(--jp-widgets-slider-handle-size)) / 2 - var(--jp-widgets-slider-border-width));
    border-radius: 50%;
    left: 0;
}

.widget-hslider .ui-slider .ui-slider-range {
    height: calc( var(--jp-widgets-slider-track-thickness) * 2 );
    margin-top: calc((var(--jp-widgets-slider-track-thickness) - var(--jp-widgets-slider-track-thickness) * 2 ) / 2 - var(--jp-widgets-slider-border-width));
}

.widget-vslider .ui-slider .ui-slider-range {
    width: calc( var(--jp-widgets-slider-track-thickness) * 2 );
    margin-left: calc((var(--jp-widgets-slider-track-thickness) - var(--jp-widgets-slider-track-thickness) * 2 ) / 2 - var(--jp-widgets-slider-border-width));
}

/* Horizontal Slider */

.widget-hslider {
    width: var(--jp-widgets-inline-width);
    height: var(--jp-widgets-inline-height);
    line-height: var(--jp-widgets-inline-height);

    /* Override the align-items baseline. This way, the description and readout
    still seem to align their baseline properly, and we don't have to have
    align-self: stretch in the .slider-container. */
    align-items: center;
}

.widgets-slider .slider-container {
    overflow: visible;
}

.widget-hslider .slider-container {
    height: var(--jp-widgets-inline-height);
    margin-left: calc(var(--jp-widgets-slider-handle-size) / 2 - 2 * var(--jp-widgets-slider-border-width));
    margin-right: calc(var(--jp-widgets-slider-handle-size) / 2 - 2 * var(--jp-widgets-slider-border-width));
    flex: 1 1 var(--jp-widgets-inline-width-short);
}

.widget-hslider .ui-slider {
    /* Inner, invisible slide div */
    height: var(--jp-widgets-slider-track-thickness);
    margin-top: calc((var(--jp-widgets-inline-height) - var(--jp-widgets-slider-track-thickness)) / 2);
    width: 100%;
}

/* Vertical Slider */

.widget-vbox .widget-label {
    height: var(--jp-widgets-inline-height);
    line-height: var(--jp-widgets-inline-height);
}

.widget-vslider {
    /* Vertical Slider */
    height: var(--jp-widgets-vertical-height);
    width: var(--jp-widgets-inline-width-tiny);
}

.widget-vslider .slider-container {
    flex: 1 1 var(--jp-widgets-inline-width-short);
    margin-left: auto;
    margin-right: auto;
    margin-bottom: calc(var(--jp-widgets-slider-handle-size) / 2 - 2 * var(--jp-widgets-slider-border-width));
    margin-top: calc(var(--jp-widgets-slider-handle-size) / 2 - 2 * var(--jp-widgets-slider-border-width));
    display: flex;
    flex-direction: column;
}

.widget-vslider .ui-slider-vertical {
    /* Inner, invisible slide div */
    width: var(--jp-widgets-slider-track-thickness);
    flex-grow: 1;
    margin-left: auto;
    margin-right: auto;
}

/* Widget Progress Styling */

.progress-bar {
    -webkit-transition: none;
    -moz-transition: none;
    -ms-transition: none;
    -o-transition: none;
    transition: none;
}

.progress-bar {
    height: var(--jp-widgets-inline-height);
}

.progress-bar {
    background-color: var(--jp-brand-color1);
}

.progress-bar-success {
    background-color: var(--jp-success-color1);
}

.progress-bar-info {
    background-color: var(--jp-info-color1);
}

.progress-bar-warning {
    background-color: var(--jp-warn-color1);
}

.progress-bar-danger {
    background-color: var(--jp-error-color1);
}

.progress {
    background-color: var(--jp-layout-color2);
    border: none;
    box-shadow: none;
}

/* Horisontal Progress */

.widget-hprogress {
    /* Progress Bar */
    height: var(--jp-widgets-inline-height);
    line-height: var(--jp-widgets-inline-height);
    width: var(--jp-widgets-inline-width);
    align-items: center;

}

.widget-hprogress .progress {
    flex-grow: 1;
    margin-top: var(--jp-widgets-input-padding);
    margin-bottom: var(--jp-widgets-input-padding);
    align-self: stretch;
    /* Override bootstrap style */
    height: initial;
}

/* Vertical Progress */

.widget-vprogress {
    height: var(--jp-widgets-vertical-height);
    width: var(--jp-widgets-inline-width-tiny);
}

.widget-vprogress .progress {
    flex-grow: 1;
    width: var(--jp-widgets-progress-thickness);
    margin-left: auto;
    margin-right: auto;
    margin-bottom: 0;
}

/* Select Widget Styling */

.widget-dropdown {
    height: var(--jp-widgets-inline-height);
    width: var(--jp-widgets-inline-width);
    line-height: var(--jp-widgets-inline-height);
}

.widget-dropdown > select {
    padding-right: 20px;
    border: var(--jp-widgets-input-border-width) solid var(--jp-widgets-input-border-color);
    border-radius: 0;
    height: inherit;
    flex: 1 1 var(--jp-widgets-inline-width-short);
    min-width: 0; /* This makes it possible for the flexbox to shrink this input */
    box-sizing: border-box;
    outline: none !important;
    box-shadow: none;
    background-color: var(--jp-widgets-input-background-color);
    color: var(--jp-widgets-input-color);
    font-size: var(--jp-widgets-font-size);
    vertical-align: top;
    padding-left: calc( var(--jp-widgets-input-padding) * 2);
	appearance: none;
	-webkit-appearance: none;
	-moz-appearance: none;
    background-repeat: no-repeat;
	background-size: 20px;
	background-position: right center;
    background-image: var(--jp-widgets-dropdown-arrow);
}
.widget-dropdown > select:focus {
    border-color: var(--jp-widgets-input-focus-border-color);
}

.widget-dropdown > select:disabled {
    opacity: var(--jp-widgets-disabled-opacity);
}

/* To disable the dotted border in Firefox around select controls.
   See http://stackoverflow.com/a/18853002 */
.widget-dropdown > select:-moz-focusring {
    color: transparent;
    text-shadow: 0 0 0 #000;
}

/* Select and SelectMultiple */

.widget-select {
    width: var(--jp-widgets-inline-width);
    line-height: var(--jp-widgets-inline-height);

    /* Because Firefox defines the baseline of a select as the bottom of the
    control, we align the entire control to the top and add padding to the
    select to get an approximate first line baseline alignment. */
    align-items: flex-start;
}

.widget-select > select {
    border: var(--jp-widgets-input-border-width) solid var(--jp-widgets-input-border-color);
    background-color: var(--jp-widgets-input-background-color);
    color: var(--jp-widgets-input-color);
    font-size: var(--jp-widgets-font-size);
    flex: 1 1 var(--jp-widgets-inline-width-short);
    outline: none !important;
    overflow: auto;
    height: inherit;

    /* Because Firefox defines the baseline of a select as the bottom of the
    control, we align the entire control to the top and add padding to the
    select to get an approximate first line baseline alignment. */
    padding-top: 5px;
}

.widget-select > select:focus {
    border-color: var(--jp-widgets-input-focus-border-color);
}

.wiget-select > select > option {
    padding-left: var(--jp-widgets-input-padding);
    line-height: var(--jp-widgets-inline-height);
    /* line-height doesn't work on some browsers for select options */
    padding-top: calc(var(--jp-widgets-inline-height)-var(--jp-widgets-font-size)/2);
    padding-bottom: calc(var(--jp-widgets-inline-height)-var(--jp-widgets-font-size)/2);
}



/* Toggle Buttons Styling */

.widget-toggle-buttons {
    line-height: var(--jp-widgets-inline-height);
}

.widget-toggle-buttons .widget-toggle-button {
    margin-left: var(--jp-widgets-margin);
    margin-right: var(--jp-widgets-margin);
}

.widget-toggle-buttons .jupyter-button:disabled {
    opacity: var(--jp-widgets-disabled-opacity);
}

/* Radio Buttons Styling */

.widget-radio {
    width: var(--jp-widgets-inline-width);
    line-height: var(--jp-widgets-inline-height);
}

.widget-radio-box {
    display: flex;
    flex-direction: column;
    align-items: stretch;
    box-sizing: border-box;
    flex-grow: 1;
    margin-bottom: var(--jp-widgets-radio-item-height-adjustment);
}

.widget-radio-box label {
    height: var(--jp-widgets-radio-item-height);
    line-height: var(--jp-widgets-radio-item-height);
    font-size: var(--jp-widgets-font-size);
}

.widget-radio-box input {
    height: var(--jp-widgets-radio-item-height);
    line-height: var(--jp-widgets-radio-item-height);
    margin: 0 calc( var(--jp-widgets-input-padding) * 2 ) 0 1px;
    float: left;
}

/* Color Picker Styling */

.widget-colorpicker {
    width: var(--jp-widgets-inline-width);
    height: var(--jp-widgets-inline-height);
    line-height: var(--jp-widgets-inline-height);
}

.widget-colorpicker > .widget-colorpicker-input {
    flex-grow: 1;
    flex-shrink: 1;
    min-width: var(--jp-widgets-inline-width-tiny);
}

.widget-colorpicker input[type="color"] {
    width: var(--jp-widgets-inline-height);
    height: var(--jp-widgets-inline-height);
    padding: 0 2px; /* make the color square actually square on Chrome on OS X */
    background: var(--jp-widgets-input-background-color);
    color: var(--jp-widgets-input-color);
    border: var(--jp-widgets-input-border-width) solid var(--jp-widgets-input-border-color);
    border-left: none;
    flex-grow: 0;
    flex-shrink: 0;
    box-sizing: border-box;
    align-self: stretch;
    outline: none !important;
}

.widget-colorpicker.concise input[type="color"] {
    border-left: var(--jp-widgets-input-border-width) solid var(--jp-widgets-input-border-color);
}

.widget-colorpicker input[type="color"]:focus, .widget-colorpicker input[type="text"]:focus {
    border-color: var(--jp-widgets-input-focus-border-color);
}

.widget-colorpicker input[type="text"] {
    flex-grow: 1;
    outline: none !important;
    height: var(--jp-widgets-inline-height);
    line-height: var(--jp-widgets-inline-height);
    background: var(--jp-widgets-input-background-color);
    color: var(--jp-widgets-input-color);
    border: var(--jp-widgets-input-border-width) solid var(--jp-widgets-input-border-color);
    font-size: var(--jp-widgets-font-size);
    padding: var(--jp-widgets-input-padding) calc( var(--jp-widgets-input-padding) *  2 );
    min-width: 0; /* This makes it possible for the flexbox to shrink this input */
    flex-shrink: 1;
    box-sizing: border-box;
}

.widget-colorpicker input[type="text"]:disabled {
    opacity: var(--jp-widgets-disabled-opacity);
}

/* Date Picker Styling */

.widget-datepicker {
    width: var(--jp-widgets-inline-width);
    height: var(--jp-widgets-inline-height);
    line-height: var(--jp-widgets-inline-height);
}

.widget-datepicker input[type="date"] {
    flex-grow: 1;
    flex-shrink: 1;
    min-width: 0; /* This makes it possible for the flexbox to shrink this input */
    outline: none !important;
    height: var(--jp-widgets-inline-height);
    border: var(--jp-widgets-input-border-width) solid var(--jp-widgets-input-border-color);
    background-color: var(--jp-widgets-input-background-color);
    color: var(--jp-widgets-input-color);
    font-size: var(--jp-widgets-font-size);
    padding: var(--jp-widgets-input-padding) calc( var(--jp-widgets-input-padding) *  2 );
    box-sizing: border-box;
}

.widget-datepicker input[type="date"]:focus {
    border-color: var(--jp-widgets-input-focus-border-color);
}

.widget-datepicker input[type="date"]:invalid {
    border-color: var(--jp-warn-color1);
}

.widget-datepicker input[type="date"]:disabled {
    opacity: var(--jp-widgets-disabled-opacity);
}

/* Play Widget */

.widget-play {
    width: var(--jp-widgets-inline-width-short);
    display: flex;
    align-items: stretch;
}

.widget-play .jupyter-button {
    flex-grow: 1;
    height: auto;
}

.widget-play .jupyter-button:disabled {
    opacity: var(--jp-widgets-disabled-opacity);
}

/* Tab Widget */

.jupyter-widgets.widget-tab {
    display: flex;
    flex-direction: column;
}

.jupyter-widgets.widget-tab > .p-TabBar {
    /* Necessary so that a tab can be shifted down to overlay the border of the box below. */
    overflow-x: visible;
    overflow-y: visible;
}

.jupyter-widgets.widget-tab > .p-TabBar > .p-TabBar-content {
    /* Make sure that the tab grows from bottom up */
    align-items: flex-end;
    min-width: 0;
    min-height: 0;
}

.jupyter-widgets.widget-tab > .widget-tab-contents {
    width: 100%;
    box-sizing: border-box;
    margin: 0;
    background: var(--jp-layout-color1);
    color: var(--jp-ui-font-color1);
    border: var(--jp-border-width) solid var(--jp-border-color1);
    padding: var(--jp-widgets-container-padding);
    flex-grow: 1;
    overflow: auto;
}

.jupyter-widgets.widget-tab > .p-TabBar {
    font: var(--jp-widgets-font-size) Helvetica, Arial, sans-serif;
    min-height: calc(var(--jp-widgets-horizontal-tab-height) + var(--jp-border-width));
}

.jupyter-widgets.widget-tab > .p-TabBar .p-TabBar-tab {
    flex: 0 1 var(--jp-widgets-horizontal-tab-width);
    min-width: 35px;
    min-height: calc(var(--jp-widgets-horizontal-tab-height) + var(--jp-border-width));
    line-height: var(--jp-widgets-horizontal-tab-height);
    margin-left: calc(-1 * var(--jp-border-width));
    padding: 0px 10px;
    background: var(--jp-layout-color2);
    color: var(--jp-ui-font-color2);
    border: var(--jp-border-width) solid var(--jp-border-color1);
    border-bottom: none;
    position: relative;
}

.jupyter-widgets.widget-tab > .p-TabBar .p-TabBar-tab.p-mod-current {
    color: var(--jp-ui-font-color0);
    /* We want the background to match the tab content background */
    background: var(--jp-layout-color1);
    min-height: calc(var(--jp-widgets-horizontal-tab-height) + 2 * var(--jp-border-width));
    transform: translateY(var(--jp-border-width));
    overflow: visible;
}

.jupyter-widgets.widget-tab > .p-TabBar .p-TabBar-tab.p-mod-current:before {
    position: absolute;
    top: calc(-1 * var(--jp-border-width));
    left: calc(-1 * var(--jp-border-width));
    content: '';
    height: var(--jp-widgets-horizontal-tab-top-border);
    width: calc(100% + 2 * var(--jp-border-width));
    background: var(--jp-brand-color1);
}

.jupyter-widgets.widget-tab > .p-TabBar .p-TabBar-tab:first-child {
    margin-left: 0;
}

.jupyter-widgets.widget-tab > .p-TabBar .p-TabBar-tab:hover:not(.p-mod-current) {
    background: var(--jp-layout-color1);
    color: var(--jp-ui-font-color1);
}

.jupyter-widgets.widget-tab > .p-TabBar .p-mod-closable > .p-TabBar-tabCloseIcon {
    margin-left: 4px;
}

.jupyter-widgets.widget-tab > .p-TabBar .p-mod-closable > .p-TabBar-tabCloseIcon:before {
    font-family: FontAwesome;
    content: '\f00d'; /* close */
}

.jupyter-widgets.widget-tab > .p-TabBar .p-TabBar-tabIcon,
.jupyter-widgets.widget-tab > .p-TabBar .p-TabBar-tabLabel,
.jupyter-widgets.widget-tab > .p-TabBar .p-TabBar-tabCloseIcon {
    line-height: var(--jp-widgets-horizontal-tab-height);
}

/* Accordion Widget */

.p-Collapse {
    display: flex;
    flex-direction: column;
    align-items: stretch;
}

.p-Collapse-header {
    padding: var(--jp-widgets-input-padding);
    cursor: pointer;
    color: var(--jp-ui-font-color2);
    background-color: var(--jp-layout-color2);
    border: var(--jp-widgets-border-width) solid var(--jp-border-color1);
    padding: calc(var(--jp-widgets-container-padding) * 2 / 3) var(--jp-widgets-container-padding);
    font-weight: bold;
}

.p-Collapse-header:hover {
    background-color: var(--jp-layout-color1);
    color: var(--jp-ui-font-color1);
}

.p-Collapse-open > .p-Collapse-header {
    background-color: var(--jp-layout-color1);
    color: var(--jp-ui-font-color0);
    cursor: default;
    border-bottom: none;
}

.p-Collapse .p-Collapse-header::before {
    content: '\f0da\00A0';  /* caret-right, non-breaking space */
    display: inline-block;
    font: normal normal normal 14px/1 FontAwesome;
    font-size: inherit;
    text-rendering: auto;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

.p-Collapse-open > .p-Collapse-header::before {
    content: '\f0d7\00A0'; /* caret-down, non-breaking space */
}

.p-Collapse-contents {
    padding: var(--jp-widgets-container-padding);
    background-color: var(--jp-layout-color1);
    color: var(--jp-ui-font-color1);
    border-left: var(--jp-widgets-border-width) solid var(--jp-border-color1);
    border-right: var(--jp-widgets-border-width) solid var(--jp-border-color1);
    border-bottom: var(--jp-widgets-border-width) solid var(--jp-border-color1);
    overflow: auto;
}

.p-Accordion {
    display: flex;
    flex-direction: column;
    align-items: stretch;
}

.p-Accordion .p-Collapse {
    margin-bottom: 0;
}

.p-Accordion .p-Collapse + .p-Collapse {
    margin-top: 4px;
}



/* HTML widget */

.widget-html, .widget-htmlmath {
    font-size: var(--jp-widgets-font-size);
}

.widget-html > .widget-html-content, .widget-htmlmath > .widget-html-content {
    /* Fill out the area in the HTML widget */
    align-self: stretch;
    flex-grow: 1;
    flex-shrink: 1;
    /* Makes sure the baseline is still aligned with other elements */
    line-height: var(--jp-widgets-inline-height);
    /* Make it possible to have absolutely-positioned elements in the html */
    position: relative;
}


/* Image widget  */

.widget-image {
    max-width: 100%;
    height: auto;
}
</style><style type="text/css">/* Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */
</style><style type="text/css">@font-face {font-family: STIXMathJax_Main; src: url('http://localhost:8888/static/components/MathJax/fonts/HTML-CSS/STIX-Web/woff/STIXMathJax_Main-Italic.woff?V=2.7.5') format('woff'), url('http://localhost:8888/static/components/MathJax/fonts/HTML-CSS/STIX-Web/otf/STIXMathJax_Main-Italic.otf?V=2.7.5') format('opentype'); font-style: italic}
</style><style type="text/css">@font-face {font-family: STIXMathJax_Normal; src: url('http://localhost:8888/static/components/MathJax/fonts/HTML-CSS/STIX-Web/woff/STIXMathJax_Normal-Italic.woff?V=2.7.5') format('woff'), url('http://localhost:8888/static/components/MathJax/fonts/HTML-CSS/STIX-Web/otf/STIXMathJax_Normal-Italic.otf?V=2.7.5') format('opentype'); font-style: italic}
</style><style type="text/css">@font-face {font-family: STIXMathJax_Main; src: url('http://localhost:8888/static/components/MathJax/fonts/HTML-CSS/STIX-Web/woff/STIXMathJax_Main-Regular.woff?V=2.7.5') format('woff'), url('http://localhost:8888/static/components/MathJax/fonts/HTML-CSS/STIX-Web/otf/STIXMathJax_Main-Regular.otf?V=2.7.5') format('opentype')}
</style><style type="text/css">@font-face {font-family: STIXMathJax_Size1; src: url('http://localhost:8888/static/components/MathJax/fonts/HTML-CSS/STIX-Web/woff/STIXMathJax_Size1-Regular.woff?V=2.7.5') format('woff'), url('http://localhost:8888/static/components/MathJax/fonts/HTML-CSS/STIX-Web/otf/STIXMathJax_Size1-Regular.otf?V=2.7.5') format('opentype')}
</style><style type="text/css">@font-face {font-family: STIXMathJax_Variants; src: url('http://localhost:8888/static/components/MathJax/fonts/HTML-CSS/STIX-Web/woff/STIXMathJax_Variants-Regular.woff?V=2.7.5') format('woff'), url('http://localhost:8888/static/components/MathJax/fonts/HTML-CSS/STIX-Web/otf/STIXMathJax_Variants-Regular.otf?V=2.7.5') format('opentype')}
</style><style type="text/css">@font-face {font-family: STIXMathJax_Variants; src: url('http://localhost:8888/static/components/MathJax/fonts/HTML-CSS/STIX-Web/woff/STIXMathJax_Variants-Italic.woff?V=2.7.5') format('woff'), url('http://localhost:8888/static/components/MathJax/fonts/HTML-CSS/STIX-Web/otf/STIXMathJax_Variants-Italic.otf?V=2.7.5') format('opentype'); font-style: italic}
</style><style type="text/css">@font-face {font-family: STIXMathJax_Size4; src: url('http://localhost:8888/static/components/MathJax/fonts/HTML-CSS/STIX-Web/woff/STIXMathJax_Size4-Regular.woff?V=2.7.5') format('woff'), url('http://localhost:8888/static/components/MathJax/fonts/HTML-CSS/STIX-Web/otf/STIXMathJax_Size4-Regular.otf?V=2.7.5') format('opentype')}
</style><style type="text/css">@font-face {font-family: STIXMathJax_Size2; src: url('http://localhost:8888/static/components/MathJax/fonts/HTML-CSS/STIX-Web/woff/STIXMathJax_Size2-Regular.woff?V=2.7.5') format('woff'), url('http://localhost:8888/static/components/MathJax/fonts/HTML-CSS/STIX-Web/otf/STIXMathJax_Size2-Regular.otf?V=2.7.5') format('opentype')}
</style></head>

<body class="notebook_app command_mode" data-jupyter-api-token="a797e630f3938eccbe70c6d7a514f6b1c13ec4db9bb527bb" data-base-url="/" data-ws-url="" data-notebook-name="DQN.ipynb" data-notebook-path="Deep-Q-Learning-master/DQN.ipynb" dir="ltr"><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px none; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"></div></div><div id="MathJax_Message" style="display: none;"></div>

<noscript>
    <div id='noscript'>
      Jupyter Notebook requires JavaScript.<br>
      Please enable it to proceed. 
  </div>
</noscript>

<div id="header" role="navigation" aria-label="Top Menu" style="display: block;">
  <div id="header-container" class="container">
  <div id="ipython_notebook" class="nav navbar-brand"><a href="http://localhost:8888/tree?token=a797e630f3938eccbe70c6d7a514f6b1c13ec4db9bb527bb" title="dashboard">
      <img src="DQN%20-%20Jupyter%20Notebook_files/logo.png" alt="Jupyter Notebook">
  </a></div>

  


<span id="save_widget" class="save_widget">
    <span id="notebook_name" class="filename">DQN</span>
    <span class="checkpoint_status" title="Thu, Oct 24, 2019 9:25 PM">Last Checkpoint: Last Thursday at 9:25 PM</span>
    <span class="autosave_status">(autosaved)</span>
</span>


  

<span id="kernel_logo_widget">
  
  <img class="current_kernel_logo" alt="Current Kernel Logo" src="DQN%20-%20Jupyter%20Notebook_files/logo-64x64.png" title="Python 3" style="display: inline;">
  
</span>


  
  
  
  

    <span id="login_widget">
      
        <button id="logout" class="btn btn-sm navbar-btn">Logout</button>
      
    </span>

  

  
  
  </div>
  <div class="header-bar"></div>

  
<div id="menubar-container" class="container">
<div id="menubar">
    <div id="menus" class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
            <button type="button" class="btn btn-default navbar-btn navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <i class="fa fa-bars"></i>
              <span class="navbar-text">Menu</span>
            </button>
            <p id="kernel_indicator" class="navbar-text indicator_area">
              <span class="kernel_indicator_name">Python 3</span>
              <i id="kernel_indicator_icon" class="kernel_idle_icon" title="Kernel Idle"></i>
            </p>
            <i id="readonly-indicator" class="navbar-text" title="This notebook is read-only" style="display: none;">
                <span class="fa-stack">
                    <i class="fa fa-save fa-stack-1x"></i>
                    <i class="fa fa-ban fa-stack-2x text-danger"></i>
                </span>
            </i>
            <i id="modal_indicator" class="navbar-text modal_indicator" title="Command Mode"></i>
            <span id="notification_area"><div id="notification_kernel" class="notification_widget btn btn-xs navbar-btn undefined info" style="display: none;"><span></span></div><div id="notification_notebook" class="notification_widget btn btn-xs navbar-btn" style="display: none;"><span></span></div><div id="notification_trusted" class="notification_widget btn btn-xs navbar-btn" style="cursor: help;" disabled="disabled"><span title="Javascript enabled for notebook display">Trusted</span></div><div id="notification_widgets" class="notification_widget btn btn-xs navbar-btn" style="display: none;"><span></span></div></span>
            <div class="navbar-collapse collapse">
              <ul class="nav navbar-nav">
                <li class="dropdown"><a href="#" id="filelink" aria-haspopup="true" aria-controls="file_menu class=" dropdown-toggle"="" data-toggle="dropdown">File</a>
                    <ul id="file_menu" class="dropdown-menu" role="menu" aria-labelledby="filelink">
                        <li id="new_notebook" class="dropdown-submenu" role="none">
                            <a href="#" role="menuitem">New Notebook<span class="sr-only">Toggle Dropdown</span></a>
                            <ul class="dropdown-menu" id="menu-new-notebook-submenu"><li id="new-notebook-submenu-python3"><a href="#">Python 3</a></li></ul>
                        </li>
                        <li id="open_notebook" role="none" title="Opens a new window with the Dashboard view">
                            <a href="#" role="menuitem">Open...</a></li>
                        <!-- <hr/> -->
                        <li class="divider" role="none"></li>
                        <li id="copy_notebook" role="none" title="Open a copy of this notebook's contents and start a new kernel">
                            <a href="#" role="menuitem">Make a Copy...</a></li>
                        <li id="save_notebook_as" role="none" title="Save a copy of the notebook's contents and start a new kernel">
                            <a href="#" role="menuitem">Save as...</a></li>
                        <li id="rename_notebook" role="none"><a href="#" role="menuitem">Rename...</a></li>
                        <li id="save_checkpoint" role="none"><a href="#" role="menuitem">Save and Checkpoint</a></li>
                        <!-- <hr/> -->
                        <li class="divider" role="none"></li>
                        <li id="restore_checkpoint" class="dropdown-submenu" role="none"><a href="#" role="menuitem">Revert to Checkpoint<span class="sr-only">Toggle Dropdown</span></a>
                          <ul class="dropdown-menu"><li><a href="#">Thursday, October 24, 2019 9:25 PM</a></li></ul>
                        </li>
                        <li class="divider" role="none"></li>
                        <li id="print_preview" role="none"><a href="#" role="menuitem">Print Preview</a></li>
                        <li class="dropdown-submenu" role="none"><a href="#" role="menuitem">Download as<span class="sr-only">Toggle Dropdown</span></a>
                            <ul id="download_menu" class="dropdown-menu">
                                
                                <li id="download_asciidoc">
                                    <a href="#">asciidoc (.asciidoc)</a>
                                </li>
                                
                                <li id="download_html">
                                    <a href="#">html (.html)</a>
                                </li>
                                
                                <li id="download_latex">
                                    <a href="#">latex (.tex)</a>
                                </li>
                                
                                <li id="download_markdown">
                                    <a href="#">markdown (.md)</a>
                                </li>
                                
                                <li id="download_notebook">
                                    <a href="#">notebook (.ipynb)</a>
                                </li>
                                
                                <li id="download_pdf">
                                    <a href="#">pdf (.pdf)</a>
                                </li>
                                
                                <li id="download_rst">
                                    <a href="#">rst (.rst)</a>
                                </li>
                                
                                <li id="download_script">
                                    <a href="#">Python (.py)</a>
                                </li>
                                
                                <li id="download_slides">
                                    <a href="#">slides (.slides.html)</a>
                                </li>
                                
                            </ul>
                        </li>
                        <li class="dropdown-submenu hidden" role="none"><a href="#" role="menuitem">Deploy as</a>
                            <ul id="deploy_menu" class="dropdown-menu"></ul>
                        </li>
                        <li class="divider" role="none"></li>
                        <li id="trust_notebook" role="none" title="Trust the output of this notebook" class="disabled">
                            <a href="#" role="menuitem">Trusted Notebook</a></li>
                        <li class="divider" role="none"></li>
                        <li id="close_and_halt" role="none" title="Shutdown this notebook's kernel, and close this window">
                            <a href="#" role="menuitem">Close and Halt</a></li>
                    </ul>
                </li>

                <li class="dropdown"><a href="#" class="dropdown-toggle" id="editlink" data-toggle="dropdown" aria-haspopup="true" aria-controls="edit_menu">Edit</a>
                    <ul id="edit_menu" class="dropdown-menu" role="menu" aria-labelledby="editlink">
                        <li id="cut_cell" role="none"><a href="#" role="menuitem">Cut Cells</a></li>
                        <li id="copy_cell" role="none"><a href="#" role="menuitem">Copy Cells</a></li>
                        <li id="paste_cell_above" class="disabled" role="none"><a href="#" role="menuitem" aria-disabled="true">Paste Cells Above</a></li>
                        <li id="paste_cell_below" class="disabled" role="none"><a href="#" role="menuitem" aria-disabled="true">Paste Cells Below</a></li>
                        <li id="paste_cell_replace" class="disabled" role="none"><a href="#" role="menuitem" aria-disabled="true">Paste Cells &amp; Replace</a></li>
                        <li id="delete_cell" role="none"><a href="#" role="menuitem">Delete Cells</a></li>
                        <li id="undelete_cell" class="disabled" role="none"><a href="#" role="menuitem" aria-disabled="true">Undo Delete Cells</a></li>
                        <li class="divider" role="none"></li>
                        <li id="split_cell" role="none"><a href="#" role="menuitem">Split Cell</a></li>
                        <li id="merge_cell_above" role="none"><a href="#" role="menuitem">Merge Cell Above</a></li>
                        <li id="merge_cell_below" role="none"><a href="#" role="menuitem">Merge Cell Below</a></li>
                        <li class="divider" role="none"></li>
                        <li id="move_cell_up" role="none"><a href="#" role="menuitem">Move Cell Up</a></li>
                        <li id="move_cell_down" role="none"><a href="#" role="menuitem">Move Cell Down</a></li>
                        <li class="divider" role="none"></li>
                        <li id="edit_nb_metadata" role="none"><a href="#" role="menuitem">Edit Notebook Metadata</a></li>
                        <li class="divider" role="none"></li>
                        <li id="find_and_replace" role="none"><a href="#" role="menuitem"> Find and Replace </a></li>
                        <li class="divider" role="none"></li>
                        <li id="cut_cell_attachments" role="none"><a href="#" role="menuitem">Cut Cell Attachments</a></li>
                        <li id="copy_cell_attachments" role="none"><a href="#" role="menuitem">Copy Cell Attachments</a></li>
                        <li id="paste_cell_attachments" class="disabled" role="none"><a href="#" role="menuitem" aria-disabled="true">Paste Cell Attachments</a></li>
                        <li class="divider" role="none"></li>
                        <li id="insert_image" class="disabled" role="none"><a href="#" role="menuitem" aria-disabled="true">  Insert Image </a></li>
                    </ul>
                </li>
                <li class="dropdown"><a href="#" class="dropdown-toggle" id="viewlink" data-toggle="dropdown" aria-haspopup="true" aria-controls="view_menu">View</a>
                    <ul id="view_menu" class="dropdown-menu" role="menu" aria-labelledby="viewlink">
                        <li id="toggle_header" role="none" title="Show/Hide the logo and notebook title (above menu bar)">
                            <a href="#" role="menuitem">Toggle Header</a>
                        </li>
                        <li id="toggle_toolbar" role="none" title="Show/Hide the action icons (below menu bar)">
                            <a href="#" role="menuitem">Toggle Toolbar</a>
                        </li>
                        <li id="toggle_line_numbers" role="none" title="Show/Hide line numbers in cells">
                            <a href="#" role="menuitem">Toggle Line Numbers</a>
                        </li>
                        <li id="menu-cell-toolbar" class="dropdown-submenu" role="none">
                            <a href="#" role="menuitem">Cell Toolbar</a>
                            <ul class="dropdown-menu" id="menu-cell-toolbar-submenu"><li data-name="None"><a href="#">None</a></li><li data-name="Edit%20Metadata"><a href="#">Edit Metadata</a></li><li data-name="Raw%20Cell%20Format"><a href="#">Raw Cell Format</a></li><li data-name="Slideshow"><a href="#">Slideshow</a></li><li data-name="Attachments"><a href="#">Attachments</a></li><li data-name="Tags"><a href="#">Tags</a></li></ul>
                        </li>
                    </ul>
                </li>
                <li class="dropdown"><a href="#" class="dropdown-toggle" id="insertlink" data-toggle="dropdown" aria-haspopup="true" aria-controls="insert_menu">Insert</a>
                    <ul id="insert_menu" class="dropdown-menu" role="menu" aria-labelledby="insertlink">
                        <li id="insert_cell_above" role="none" title="Insert an empty Code cell above the currently active cell">
                            <a href="#" role="menuitem">Insert Cell Above</a></li>
                        <li id="insert_cell_below" role="none" title="Insert an empty Code cell below the currently active cell">
                            <a href="#" role="menuitem">Insert Cell Below</a></li>
                    </ul>
                </li>
                <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Cell</a>
                    <ul id="cell_menu" class="dropdown-menu">
                        <li id="run_cell" title="Run this cell, and move cursor to the next one">
                            <a href="#">Run Cells</a></li>
                        <li id="run_cell_select_below" title="Run this cell, select below">
                            <a href="#">Run Cells and Select Below</a></li>
                        <li id="run_cell_insert_below" title="Run this cell, insert below">
                            <a href="#">Run Cells and Insert Below</a></li>
                        <li id="run_all_cells" title="Run all cells in the notebook">
                            <a href="#">Run All</a></li>
                        <li id="run_all_cells_above" title="Run all cells above (but not including) this cell">
                            <a href="#">Run All Above</a></li>
                        <li id="run_all_cells_below" title="Run this cell and all cells below it">
                            <a href="#">Run All Below</a></li>
                        <li class="divider"></li>
                        <li id="change_cell_type" class="dropdown-submenu" title="All cells in the notebook have a cell type. By default, new cells are created as 'Code' cells">
                            <a href="#">Cell Type</a>
                            <ul class="dropdown-menu">
                              <li id="to_code" title="Contents will be sent to the kernel for execution, and output will display in the footer of cell">
                                  <a href="#">Code</a></li>
                              <li id="to_markdown" title="Contents will be rendered as HTML and serve as explanatory text">
                                  <a href="#">Markdown</a></li>
                              <li id="to_raw" title="Contents will pass through nbconvert unmodified">
                                  <a href="#">Raw NBConvert</a></li>
                            </ul>
                        </li>
                        <li class="divider"></li>
                        <li id="current_outputs" class="dropdown-submenu"><a href="#">Current Outputs</a>
                            <ul class="dropdown-menu">
                                <li id="toggle_current_output" title="Hide/Show the output of the current cell">
                                    <a href="#">Toggle</a>
                                </li>
                                <li id="toggle_current_output_scroll" title="Scroll the output of the current cell">
                                    <a href="#">Toggle Scrolling</a>
                                </li>
                                <li id="clear_current_output" title="Clear the output of the current cell">
                                    <a href="#">Clear</a>
                                </li>
                            </ul>
                        </li>
                        <li id="all_outputs" class="dropdown-submenu"><a href="#">All Output</a>
                            <ul class="dropdown-menu">
                                <li id="toggle_all_output" title="Hide/Show the output of all cells">
                                    <a href="#">Toggle</a>
                                </li>
                                <li id="toggle_all_output_scroll" title="Scroll the output of all cells">
                                    <a href="#">Toggle Scrolling</a>
                                </li>
                                <li id="clear_all_output" title="Clear the output of all cells">
                                    <a href="#">Clear</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Kernel</a>
                    <ul id="kernel_menu" class="dropdown-menu">
                        <li id="int_kernel" title="Send Keyboard Interrupt (CTRL-C) to the Kernel">
                            <a href="#">Interrupt</a>
                        </li>
                        <li id="restart_kernel" title="Restart the Kernel">
                            <a href="#">Restart</a>
                        </li>
                        <li id="restart_clear_output" title="Restart the Kernel and clear all output">
                            <a href="#">Restart &amp; Clear Output</a>
                        </li>
                        <li id="restart_run_all" title="Restart the Kernel and re-run the notebook">
                            <a href="#">Restart &amp; Run All</a>
                        </li>
                        <li id="reconnect_kernel" title="Reconnect to the Kernel">
                            <a href="#">Reconnect</a>
                        </li>
                        <li id="shutdown_kernel" title="Shutdown the Kernel">
                            <a href="#">Shutdown</a>
                        </li>
                        <li class="divider"></li>
                        <li id="menu-change-kernel" class="dropdown-submenu">
                            <a href="#">Change kernel</a>
                            <ul class="dropdown-menu" id="menu-change-kernel-submenu"><li id="kernel-submenu-python3"><a href="#">Python 3</a></li></ul>
                        </li>
                    </ul>
                </li>
                <li class="dropdown"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Widgets</a><ul id="widget-submenu" class="dropdown-menu"><li title="Save the notebook with the widget state information for static rendering"><a href="#">Save Notebook Widget State</a></li><li title="Clear the widget state information from the notebook"><a href="#">Clear Notebook Widget State</a></li><ul class="divider"></ul><li title="Download the widget state as a JSON file"><a href="#">Download Widget State</a></li><li title="Embed interactive widgets"><a href="#">Embed Widgets</a></li></ul></li><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Help</a>
                    <ul id="help_menu" class="dropdown-menu">
                        
                        <li id="notebook_tour" title="A quick tour of the notebook user interface"><a href="#">User Interface Tour</a></li>
                        <li id="keyboard_shortcuts" title="Opens a tooltip with all keyboard shortcuts"><a href="#">Keyboard Shortcuts</a></li>
                        <li id="edit_keyboard_shortcuts" title="Opens a dialog allowing you to edit Keyboard shortcuts"><a href="#">Edit Keyboard Shortcuts</a></li>
                        <li class="divider"></li>
                        

						
                        
                            
                                <li><a rel="noreferrer" href="http://nbviewer.jupyter.org/github/ipython/ipython/blob/3.x/examples/Notebook/Index.ipynb" target="_blank" title="Opens in a new window">
                                
                                    <i class="fa fa-external-link menu-icon pull-right"></i>
                                

                                Notebook Help
                                </a></li>
                            
                                <li><a rel="noreferrer" href="https://help.github.com/articles/markdown-basics/" target="_blank" title="Opens in a new window">
                                
                                    <i class="fa fa-external-link menu-icon pull-right"></i>
                                

                                Markdown
                                </a></li>
                            
                            
                        
                        <li id="kernel-help-links" class="divider"></li><li><a target="_blank" title="Opens in a new window" href="https://docs.python.org/3.7?v=20191026175740"><i class="fa fa-external-link menu-icon pull-right"></i><span>Python Reference</span></a></li><li><a target="_blank" title="Opens in a new window" href="https://ipython.org/documentation.html?v=20191026175740"><i class="fa fa-external-link menu-icon pull-right"></i><span>IPython Reference</span></a></li><li><a target="_blank" title="Opens in a new window" href="https://docs.scipy.org/doc/numpy/reference/?v=20191026175740"><i class="fa fa-external-link menu-icon pull-right"></i><span>NumPy Reference</span></a></li><li><a target="_blank" title="Opens in a new window" href="https://docs.scipy.org/doc/scipy/reference/?v=20191026175740"><i class="fa fa-external-link menu-icon pull-right"></i><span>SciPy Reference</span></a></li><li><a target="_blank" title="Opens in a new window" href="https://matplotlib.org/contents.html?v=20191026175740"><i class="fa fa-external-link menu-icon pull-right"></i><span>Matplotlib Reference</span></a></li><li><a target="_blank" title="Opens in a new window" href="http://docs.sympy.org/latest/index.html?v=20191026175740"><i class="fa fa-external-link menu-icon pull-right"></i><span>SymPy Reference</span></a></li><li><a target="_blank" title="Opens in a new window" href="https://pandas.pydata.org/pandas-docs/stable/?v=20191026175740"><i class="fa fa-external-link menu-icon pull-right"></i><span>pandas Reference</span></a></li><li class="divider"></li>
                        <li title="About Jupyter Notebook"><a id="notebook_about" href="#">About</a></li>
                        
                    </ul>
                </li>
              </ul>
            </div>
        </div>
    </div>
</div>

<div id="maintoolbar" class="navbar">
  <div class="toolbar-inner navbar-inner navbar-nobg">
    <div id="maintoolbar-container" class="container toolbar"><div class="btn-group" id="save-notbook"><button class="btn btn-default" title="Save and Checkpoint" data-jupyter-action="jupyter-notebook:save-notebook"><i class="fa-save fa"></i></button></div><div class="btn-group" id="insert_above_below"><button class="btn btn-default" title="insert cell below" data-jupyter-action="jupyter-notebook:insert-cell-below"><i class="fa-plus fa"></i></button></div><div class="btn-group" id="cut_copy_paste"><button class="btn btn-default" title="cut selected cells" data-jupyter-action="jupyter-notebook:cut-cell"><i class="fa-cut fa"></i></button><button class="btn btn-default" title="copy selected cells" data-jupyter-action="jupyter-notebook:copy-cell"><i class="fa-copy fa"></i></button><button class="btn btn-default" title="paste cells below" data-jupyter-action="jupyter-notebook:paste-cell-below"><i class="fa-paste fa"></i></button></div><div class="btn-group" id="move_up_down"><button class="btn btn-default" title="move selected cells up" data-jupyter-action="jupyter-notebook:move-cell-up"><i class="fa-arrow-up fa"></i></button><button class="btn btn-default" title="move selected cells down" data-jupyter-action="jupyter-notebook:move-cell-down"><i class="fa-arrow-down fa"></i></button></div><div class="btn-group" id="run_int"><button class="btn btn-default" title="Run" data-jupyter-action="jupyter-notebook:run-cell-and-select-next"><i class="fa-step-forward fa"></i><span class="toolbar-btn-label">Run</span></button><button class="btn btn-default" title="interrupt the kernel" data-jupyter-action="jupyter-notebook:interrupt-kernel"><i class="fa-stop fa"></i></button><button class="btn btn-default" title="restart the kernel (with dialog)" data-jupyter-action="jupyter-notebook:confirm-restart-kernel"><i class="fa-repeat fa"></i></button><button class="btn btn-default" title="restart the kernel, then re-run the whole notebook (with dialog)" data-jupyter-action="jupyter-notebook:confirm-restart-kernel-and-run-all-cells"><i class="fa-forward fa"></i></button></div><select id="cell_type" aria-label="combobox, select cell type" role="combobox" class="form-control select-xs"><option value="code">Code</option><option value="markdown" selected="selected">Markdown</option><option value="raw">Raw NBConvert</option><option value="heading">Heading</option><option value="multiselect" disabled="disabled" style="display: none;">-</option></select><div class="btn-group" id="cmd_palette"><button class="btn btn-default" title="open the command palette" data-jupyter-action="jupyter-notebook:show-command-palette"><i class="fa-keyboard-o fa"></i></button></div></div>
  </div>
</div>
</div>

<div class="lower-header-bar"></div>

</div>

<div id="site" style="display: block; height: 800.867px;">


<div id="ipython-main-app">
    <div id="notebook_panel">
        <div id="notebook" tabindex="-1"><div class="container" id="notebook-container"><div class="cell code_cell rendered unselected" tabindex="2"><div class="input"><div class="prompt_container"><div class="prompt input_prompt"><bdi>In</bdi>&nbsp;[&nbsp;]:</div><div class="run_this_cell" title="Run this cell"><i class="fa-step-forward fa"></i></div></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit code here"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.60001px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 608.6px; margin-bottom: -12px; border-right-width: 18px; min-height: 96px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">TRAIN</span> <span class="cm-operator">=</span> <span class="cm-keyword">False</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">ENV_NAME</span> <span class="cm-operator">=</span> <span class="cm-string">'BreakoutDeterministic-v4'</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-comment">#ENV_NAME = 'PongDeterministic-v4'  </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-comment"># You can increase the learning rate to 0.00025 in Pong for quicker results</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 96px;"></div><div class="CodeMirror-gutters" style="display: none; height: 114px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output"></div><div class="output"></div><div style="display: none;" class="btn btn-default output_collapsed" title="click to expand output">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit Markup Text here"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.60004px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -12px; border-right-width: 18px; min-height: 33px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 21.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-header cm-header-1"># Deep Q-Learning</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 33px;"></div><div class="CodeMirror-gutters" style="display: none; height: 51px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><h1 id="Deep-Q-Learning">Deep Q-Learning<a class="anchor-link" href="#Deep-Q-Learning">¶</a></h1>
</div></div></div><div class="cell text_cell rendered selected" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit Markup Text here"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.60004px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -12px; border-right-width: 18px; min-height: 2944px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Read the introduction to this notebook <span class="cm-link">[here]</span><span class="cm-string cm-url">(https://medium.com/@fabiograetz/tutorial-double-deep-q-learning-with-dueling-network-architectures-4c1b3fb7f756)</span>...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">... or dive right in :)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">The notebook is best viewed in jupyter since github fails to show some <span class="cm-delimit cm-delimit-open">$</span><span class="cm-tag">\LaTeX</span><span class="cm-delimit cm-delimit-close">$</span> formulas properly.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-header cm-header-2">## Contents</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable-2">1. Reinforcement Learning </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable-2">2. Q-Learning</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable-2">3. Dueling Networks</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable-2">4. Exploration-exploitation trade-off</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable-2">5. Replay memory</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable-2">6. Target network and parameter update</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable-2">7. Double Q-Learning</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable-2">8. Putting everything together: DQN</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable-2">9. Train it yourself</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable-2">10. Use a trained network</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-header cm-header-2">## 1. Reinforcement Learning</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">In supervised learning a neural network, for instance, learns a function that maps an input to a corresponding output/target on the basis of a large amount of labeled training data consisting of example input-output pairs: Simply put, if you train a neural network to classify, for example, cats and dogs, you repeatedly show the network pictures of cats or dogs, compare the network's prediction to the label and slightly adapt the network's parameters until the neural net is able to classify what animal is shown in a picture.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Now, let's say you let a child play a computer game it has never played before. In the case of <span class="cm-link">[Breakout]</span><span class="cm-string cm-url">(https://www.youtube.com/watch?v=TmPfTpjtdgg)</span> the player sees the pixel screen as input and has to decide whether to move left or right. You could certainly show the child many times in which situations it has to press left and in which situations right in order to win the game (supervised learning) but surely the child would become bored quickly and would try to push you aside, wanting to try the game itself. And the child would learn to play the game quickly without being told how to do so simply by evaluating which actions lead to an increased score. In reinforcement learning we try to make a computer learn in this exact same way, by letting it explore the environment and occasionally giving it a reward when the score increases. </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">However, in comparison to supervised learning, this poses a problem. On p. 1 of <span class="cm-link">[Mnih et al. 2013]</span><span class="cm-string cm-url">(https://arxiv.org/abs/1312.5602)</span> the authors say:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-quote cm-quote-1">&gt;RL algorithms </span><span class="cm-link cm-quote cm-quote-1">[...]</span><span class="cm-quote cm-quote-1"> must be able to learn from a scalar reward signal that is frequently sparse </span><span class="cm-link cm-quote cm-quote-1">[...]</span><span class="cm-quote cm-quote-1"> and delayed. The delay between actions and resulting rewards, which can be thousands of timesteps long, seems particularly daunting when compared to the direct association between inputs and targets found in supervised learning.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">What do the authors mean with with "sparse <span class="cm-link">[...]</span> and delayed"? </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Imagine you walk through a maze trying to find treasures. You get a reward once you find gold. Now imagine you encounter a fork in the path. Which way do you take? As opposed to supervised learning, at the fork the agent does not get any immediate feedback/reward for taking the right path but only later once it finds any gold. Yet it might have been crucial to take for example the left way at the fork. This is what the authors mean with <span class="cm-em">*delayed*</span>. The problem is met by discounting future rewards with a factor <span class="cm-delimit cm-delimit-open">$</span><span class="cm-tag">\gamma</span><span class="cm-delimit cm-delimit-close">$</span> (between 0 and 1). </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-link">[Sutton and Barto 2018]</span><span class="cm-string cm-url">(https://drive.google.com/file/d/1xeUDVGWGUUv1-ccUMAZHJLej2C7aAFWY/view)</span> write on page 55:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-quote cm-quote-1">&gt;The additional concept that we need is that of discounting. According to this approach,</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-quote cm-quote-1">the agent tries to select actions so that the sum of the discounted rewards it receives over</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-quote cm-quote-1">the future is maximized. In particular, it chooses </span><span class="cm-delimit cm-delimit-open">$</span>A_t<span class="cm-delimit cm-delimit-close">$</span><span class="cm-quote cm-quote-1"> to maximize the </span><span class="cm-em cm-quote cm-quote-1">*expected discounted</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-em cm-quote cm-quote-1">return*</span><span class="cm-quote cm-quote-1">:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">The discounted return <span class="cm-delimit cm-delimit-open">$</span>G_t<span class="cm-delimit cm-delimit-close">$</span> is calculated as follows<span class="cm-trailing-space-a"> </span><span class="cm-trailing-space-new-line"> </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">\begin{align}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">G_{t} &amp;= R_{t+1} + \gamma R_{t+2} + \gamma^2 R_{t+3} + ... \\</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">&amp;=R_{t+1} + \gamma \bigl(R_{t+2} + \gamma R_{t+3} + ...\bigr)\\</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">&amp;= R_{t+1} + \gamma G_{t+1}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">\end{align}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">where <span class="cm-delimit cm-delimit-open">$</span>R_t<span class="cm-delimit cm-delimit-close">$</span> is the reward the agent received at time <span class="cm-delimit cm-delimit-open">$</span>t<span class="cm-delimit cm-delimit-close">$</span>.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">The authors furthermore explain:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-quote cm-quote-1">&gt;a reward received </span><span class="cm-delimit cm-delimit-open">$</span>k<span class="cm-delimit cm-delimit-close">$</span><span class="cm-quote cm-quote-1"> time steps in the future is worth only </span><span class="cm-delimit cm-delimit-open">$</span><span class="cm-tag">\gamma</span>^<span class="cm-bracket">{</span>k−1<span class="cm-bracket">}</span><span class="cm-delimit cm-delimit-close">$</span><span class="cm-quote cm-quote-1"> times what it would be worth if it were received immediately.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">and</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-quote cm-quote-1">&gt;As </span><span class="cm-delimit cm-delimit-open">$</span><span class="cm-tag">\gamma</span><span class="cm-delimit cm-delimit-close">$</span><span class="cm-quote cm-quote-1"> approaches 1, the return objective takes future rewards into account more strongly; the agent becomes more farsighted.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Let us look at a very simple example where there is just one reward not equal to 0 (calculate from right to left):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">time <span class="cm-delimit cm-delimit-open">$</span>t<span class="cm-delimit cm-delimit-close">$</span> |  0| 1 | 2|3|4|</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">:---| --- | ---| ---|---|---|</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">reward sequence <span class="cm-delimit cm-delimit-open">$</span>R_t<span class="cm-delimit cm-delimit-close">$</span>|  | 0 | 0 | 0 | 1 |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">discounted returns <span class="cm-delimit cm-delimit-open">$</span>G_t<span class="cm-delimit cm-delimit-close">$</span>| <span class="cm-delimit cm-delimit-open">$</span><span class="cm-tag">\gamma</span>^3<span class="cm-delimit cm-delimit-close">$</span> | <span class="cm-delimit cm-delimit-open">$</span><span class="cm-tag">\gamma</span>^2<span class="cm-delimit cm-delimit-close">$</span> | <span class="cm-delimit cm-delimit-open">$</span><span class="cm-tag">\gamma</span><span class="cm-delimit cm-delimit-close">$</span> | 1 | 0 |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">for <span class="cm-delimit cm-delimit-open">$</span><span class="cm-tag">\gamma</span>=0.9<span class="cm-delimit cm-delimit-close">$</span>|0.729 | 0.81 | 0.9| 1 |0|</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Minor detail: In this example there is no reward at <span class="cm-delimit cm-delimit-open">$</span>t=0<span class="cm-delimit cm-delimit-close">$</span> because the first reward <span class="cm-delimit cm-delimit-open">$</span>R_1<span class="cm-delimit cm-delimit-close">$</span> is a result of action <span class="cm-delimit cm-delimit-open">$</span>a_0<span class="cm-delimit cm-delimit-close">$</span> taken in state <span class="cm-delimit cm-delimit-open">$</span>s_0<span class="cm-delimit cm-delimit-close">$</span> and the reward is always associated with the next state in Sutton and Barto. Some articles associate the reward <span class="cm-delimit cm-delimit-open">$</span>R_i<span class="cm-delimit cm-delimit-close">$</span> with the state <span class="cm-delimit cm-delimit-open">$</span>s_i<span class="cm-delimit cm-delimit-close">$</span> and action <span class="cm-delimit cm-delimit-open">$</span>a_i<span class="cm-delimit cm-delimit-close">$</span> that caused the reward. In that case the definition of the discounted return changes to <span class="cm-delimit cm-delimit-open">$</span>G_t=R_<span class="cm-bracket">{</span>t<span class="cm-bracket">}</span> + <span class="cm-tag">\gamma</span> G_<span class="cm-bracket">{</span>t+1<span class="cm-bracket">}</span><span class="cm-delimit cm-delimit-close">$</span>, in the table the 1's would all be in the same column and there would be a reward equal to 0 at <span class="cm-delimit cm-delimit-open">$</span>t=0<span class="cm-delimit cm-delimit-close">$</span> but not at <span class="cm-delimit cm-delimit-open">$</span>t=4<span class="cm-delimit cm-delimit-close">$</span> .</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Simply put, by discounting returns, future rewards increase past or current returns and the closer <span class="cm-delimit cm-delimit-open">$</span><span class="cm-tag">\gamma</span><span class="cm-delimit cm-delimit-close">$</span> is to 1, the farther the agent can <span class="cm-em">*see*</span> into the future. </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">And <span class="cm-em">*sparse*</span>?</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">In our fictive maze example, the rewards are the sparser, the less gold you find. For an agent, a game is more difficult to learn, the sparser the reward is. <span class="cm-link">[Pong]</span><span class="cm-string cm-url">(https://gym.openai.com/envs/Pong-v0/)</span> is one of the games DQN can learn fastest because the score changes quite often. <span class="cm-link">[Montezuma's Revenge]</span><span class="cm-string cm-url">(https://gym.openai.com/envs/MontezumaRevenge-v0/)</span>, on the other hand, has very sparse rewards and DQN (at least without some additional tricks) is not able to learn the game at all.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-header cm-header-2">## 2. Q-Learning</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">So how does Q-Learning work? If the agent (regardless if trained or still untrained) is shown a state <span class="cm-delimit cm-delimit-open">$</span>s<span class="cm-delimit cm-delimit-close">$</span> of the game, it has to decide which action <span class="cm-delimit cm-delimit-open">$</span>a<span class="cm-delimit cm-delimit-close">$</span> to perform (for example move paddle left or right in breakout). How does it do that? On page 2 <span class="cm-link">[Mnih et al. 2013]</span><span class="cm-string cm-url">(https://arxiv.org/abs/1312.5602)</span> define the so-called <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-Function:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-quote cm-quote-1">&gt;We define the optimal action-value function </span><span class="cm-delimit cm-delimit-open">$</span>Q^∗(s, a)<span class="cm-delimit cm-delimit-close">$</span><span class="cm-quote cm-quote-1"> as the maximum expected return achievable by following any strategy, after seeing some sequence </span><span class="cm-delimit cm-delimit-open">$</span>s<span class="cm-delimit cm-delimit-close">$</span><span class="cm-quote cm-quote-1"> and then taking some action </span><span class="cm-delimit cm-delimit-open">$</span>a<span class="cm-delimit cm-delimit-close">$</span><span class="cm-quote cm-quote-1"> </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">This means that given a state of the game <span class="cm-delimit cm-delimit-open">$</span>s<span class="cm-delimit cm-delimit-close">$</span> (for now please consider <span class="cm-em">*sequences*</span> as states of the game), <span class="cm-delimit cm-delimit-open">$</span>Q^*(s,a)<span class="cm-delimit cm-delimit-close">$</span> is the best (discounted) total return the agent can achieve if it performs action <span class="cm-delimit cm-delimit-open">$</span>a<span class="cm-delimit cm-delimit-close">$</span> in the current state <span class="cm-delimit cm-delimit-open">$</span>s<span class="cm-delimit cm-delimit-close">$</span>. So how does it choose which action to perform assuming we already know <span class="cm-delimit cm-delimit-open">$</span>Q^*(s,a)<span class="cm-delimit cm-delimit-close">$</span>? One obvious strategy would be to always choose the action with the maximum value of <span class="cm-delimit cm-delimit-open">$</span>Q^*<span class="cm-delimit cm-delimit-close">$</span> (we will see later, why this is slightly problematic). But first of all, we need to find this magical function <span class="cm-delimit cm-delimit-open">$</span>Q^*<span class="cm-delimit cm-delimit-close">$</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Let's say we are in state <span class="cm-delimit cm-delimit-open">$</span>s<span class="cm-delimit cm-delimit-close">$</span>, decide to perform action <span class="cm-delimit cm-delimit-open">$</span>a<span class="cm-delimit cm-delimit-close">$</span> and arrive in the next state <span class="cm-delimit cm-delimit-open">$</span>s'<span class="cm-delimit cm-delimit-close">$</span>. If we assume that in state <span class="cm-delimit cm-delimit-open">$</span>s'<span class="cm-delimit cm-delimit-close">$</span> the <span class="cm-delimit cm-delimit-open">$</span>Q^*<span class="cm-delimit cm-delimit-close">$</span>-values for all possible actions <span class="cm-delimit cm-delimit-open">$</span>a'<span class="cm-delimit cm-delimit-close">$</span> were already known, then the <span class="cm-delimit cm-delimit-open">$</span>Q^*<span class="cm-delimit cm-delimit-close">$</span>-value in state <span class="cm-delimit cm-delimit-open">$</span>s<span class="cm-delimit cm-delimit-close">$</span> for action <span class="cm-delimit cm-delimit-open">$</span>a<span class="cm-delimit cm-delimit-close">$</span> (action-value in <span class="cm-delimit cm-delimit-open">$</span>s<span class="cm-delimit cm-delimit-close">$</span> for action <span class="cm-delimit cm-delimit-open">$</span>a<span class="cm-delimit cm-delimit-close">$</span>) would be the reward <span class="cm-delimit cm-delimit-open">$</span>r<span class="cm-delimit cm-delimit-close">$</span> we got for performing action <span class="cm-delimit cm-delimit-open">$</span>a<span class="cm-delimit cm-delimit-close">$</span> plus the discounted maximum future return in <span class="cm-delimit cm-delimit-open">$</span>s'<span class="cm-delimit cm-delimit-close">$</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">\begin{equation}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Q^<span class="cm-em">*(s,a) = r + \gamma \textrm{max}\left( Q^*</span>(s',a') \right)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">\end{equation}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Less formal but more intuitive:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">If we were at a certain fork in the maze (state <span class="cm-delimit cm-delimit-open">$</span>s<span class="cm-delimit cm-delimit-close">$</span>) and want to know how good it was to choose the left path (perform action <span class="cm-delimit cm-delimit-open">$</span>a<span class="cm-delimit cm-delimit-close">$</span>), we add the gold we found after going left (reward we received for performing action <span class="cm-delimit cm-delimit-open">$</span>a<span class="cm-delimit cm-delimit-close">$</span>) and the amount of gold we expect to find down the road (maximum future discounted return). If you have to choose between finding a golden coin immediately after going left at a fork but nothing else down the road or finding nothing immediatley after going right but a treasure down the road, well, the right path is worth more/has a higher action-value.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">This is the so-called <span class="cm-strong">**Bellman equation**</span>. Deep Q-Learning uses a neural network to find an approximation <span class="cm-delimit cm-delimit-open">$</span>Q(s,a,<span class="cm-tag">\theta</span>)<span class="cm-delimit cm-delimit-close">$</span> of <span class="cm-delimit cm-delimit-open">$</span>Q^*(s,a)<span class="cm-delimit cm-delimit-close">$</span>. <span class="cm-delimit cm-delimit-open">$</span><span class="cm-tag">\theta</span><span class="cm-delimit cm-delimit-close">$</span> are the parameters of the neural network. We will discuss later, how exactly the parameters of the network are updated. Now, I will explain to you, how the neural network maps a state <span class="cm-delimit cm-delimit-open">$</span>s<span class="cm-delimit cm-delimit-close">$</span> to <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-values for the possible actions <span class="cm-delimit cm-delimit-open">$</span>a<span class="cm-delimit cm-delimit-close">$</span>.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Earlier I mentioned, that I regard a <span class="cm-em">*sequence*</span> as a <span class="cm-em">*state*</span>. What did I mean with that? Imagine you have a pin-sharp image of a flying soccer ball. Can you tell in which direction it moves? No, you cannot, but you could if there was some kind of motion blur in the picture or if you had several images taken quickly one after another showing the ball in a slightly different position every time. The same problem occurs in Atari games. From a single frame of the game <span class="cm-link">[Pong]</span><span class="cm-string cm-url">(https://gym.openai.com/envs/Pong-v0/)</span>, the agent can not discern in which direction the ball moves. DeepMind met this problem by stacking several consecutive frames and considering this sequence a state that is passed to the neural network. From such a sequence the agent is able to detect the direction and speed of movement because the ball is in a different position in each frame.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-quote cm-quote-1">&gt;Since the agent only observes images of the current screen </span><span class="cm-link cm-quote cm-quote-1">[...]</span><span class="cm-quote cm-quote-1"> it is impossible to fully understand the current situation from only the current screen </span><span class="cm-delimit cm-delimit-open">$</span>x_t<span class="cm-delimit cm-delimit-close">$</span><span class="cm-quote cm-quote-1">. We therefore consider sequences of actions and observations, </span><span class="cm-delimit cm-delimit-open">$</span>s_t = x_1, a_1, x_2, ..., a_<span class="cm-bracket">{</span>t−1<span class="cm-bracket">}</span>, x_t<span class="cm-delimit cm-delimit-close">$</span><span class="cm-quote cm-quote-1">, and learn game strategies that depend upon these sequences. All sequences in the emulator are assumed to terminate in a finite number of time-steps. This formalism gives rise to a large but finite Markov decision process (MDP) in which each sequence is a distinct state. (</span><span class="cm-link cm-quote cm-quote-1">[page 2 of Mnih et al. 2013]</span><span class="cm-string cm-url cm-quote cm-quote-1">(https://arxiv.org/abs/1312.5602)</span><span class="cm-quote cm-quote-1">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">You should defenitely understand what a <span class="cm-link">[Markov decision process]</span><span class="cm-string cm-url">(https://en.wikipedia.org/wiki/Markov_decision_process)</span> and a <span class="cm-link">[Markov chain</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-link">]</span><span class="cm-string cm-url">(https://en.wikipedia.org/wiki/Markov_chain)</span> is, they are fundamental to reinforcement learning. </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">On page 5 of <span class="cm-link">[Mnih et al. 2013]</span><span class="cm-string cm-url">(https://arxiv.org/abs/1312.5602)</span> the authors explain the preprocessing of the frames:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-quote cm-quote-1">&gt;Working directly with raw Atari frames, which are 210 × 160 pixel images with a 128 color palette, can be computationally demanding, so we apply a basic preprocessing step aimed at reducing the input dimensionality. The raw frames are preprocessed by first converting their RGB representation to gray-scale and down-sampling it to a 110×84 image. The final input representation is obtained by cropping an 84 × 84 region of the image that roughly captures the playing area. The final cropping stage is only required because we use the GPU implementation of 2D convolutions from </span><span class="cm-link cm-quote cm-quote-1">[...]</span><span class="cm-quote cm-quote-1">, which expects square inputs. For the experiments in this paper, the function </span><span class="cm-delimit cm-delimit-open">$</span><span class="cm-tag">\phi</span><span class="cm-delimit cm-delimit-close">$</span><span class="cm-quote cm-quote-1"> </span><span class="cm-link cm-quote cm-quote-1">[...]</span><span class="cm-quote cm-quote-1"> applies this preprocessing to the last 4 frames of a history and stacks them to produce the input to the </span><span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span><span class="cm-quote cm-quote-1">-function.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">So let us start by looking at how the preprocessing can be implemented. I used <span class="cm-comment">`gym`</span> from OpenAi to provide the environment. A frame returned by the environment has the shape <span class="cm-comment">`(210,160,3)`</span> where the 3 stands for the RGB color channels. Such a frame is passed to the Functor<span class="cm-comment">`FrameProcessor`</span> which transforms it to a <span class="cm-comment">`(84,84,1)`</span> frame, where the 1 indicates that instead of three RGB channels there is one grayscale channel. </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 2944px;"></div><div class="CodeMirror-gutters" style="display: none; height: 2962px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><p>Read the introduction to this notebook <a href="https://medium.com/@fabiograetz/tutorial-double-deep-q-learning-with-dueling-network-architectures-4c1b3fb7f756" target="_blank">here</a>...</p>
<p>... or dive right in :)</p>
<p>The notebook is best viewed in jupyter since github fails to show some <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mspace width=&quot;-.325em&quot; /&gt;&lt;mpadded height=&quot;+.21em&quot; depth=&quot;-.21em&quot; voffset=&quot;+.21em&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mstyle displaystyle=&quot;false&quot; scriptlevel=&quot;1&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;/mstyle&gt;&lt;/mrow&gt;&lt;/mpadded&gt;&lt;mspace width=&quot;-.17em&quot; /&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;mspace width=&quot;-.14em&quot; /&gt;&lt;mpadded height=&quot;-.5ex&quot; depth=&quot;+.5ex&quot; voffset=&quot;-.5ex&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;/mrow&gt;&lt;/mpadded&gt;&lt;mspace width=&quot;-.115em&quot; /&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 3.466em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.597em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.457em, 1002.6em, 2.731em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="mi" id="MathJax-Span-3" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐿</span><span class="mspace" id="MathJax-Span-4" style="height: 0em; vertical-align: 0em; margin-left: -0.366em;"></span><span class="mpadded" id="MathJax-Span-5"><span style="display: inline-block; position: relative; width: 0.507em; height: 0px;"><span style="position: absolute; clip: rect(3.37em, 1000.48em, 4.167em, -1000em); top: -4.241em; left: 0em;"><span class="mrow" id="MathJax-Span-6"><span class="texatom" id="MathJax-Span-7"><span class="mrow" id="MathJax-Span-8"><span class="mstyle" id="MathJax-Span-9"><span class="mrow" id="MathJax-Span-10"><span class="texatom" id="MathJax-Span-11"><span class="mrow" id="MathJax-Span-12"><span class="mi" id="MathJax-Span-13" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝐴</span></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mspace" id="MathJax-Span-14" style="height: 0em; vertical-align: 0em; margin-left: -0.191em;"></span><span class="mi" id="MathJax-Span-15" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑇<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.12em;"></span></span><span class="mspace" id="MathJax-Span-16" style="height: 0em; vertical-align: 0em; margin-left: -0.158em;"></span><span class="mpadded" id="MathJax-Span-17"><span style="display: inline-block; position: relative; width: 0.734em; height: 0px;"><span style="position: absolute; clip: rect(3.189em, 1000.73em, 4.167em, -1000em); top: -3.762em; left: 0em;"><span class="mrow" id="MathJax-Span-18"><span class="texatom" id="MathJax-Span-19"><span class="mrow" id="MathJax-Span-20"><span class="mi" id="MathJax-Span-21" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐸<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mspace" id="MathJax-Span-22" style="height: 0em; vertical-align: 0em; margin-left: -0.129em;"></span><span class="mi" id="MathJax-Span-23" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑋<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.391em; border-left: 0px solid; width: 0px; height: 1.397em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>L</mi><mspace width="-.325em"></mspace><mpadded height="+.21em" depth="-.21em" voffset="+.21em"><mrow class="MJX-TeXAtom-ORD"><mstyle displaystyle="false" scriptlevel="1"><mrow class="MJX-TeXAtom-ORD"><mi>A</mi></mrow></mstyle></mrow></mpadded><mspace width="-.17em"></mspace><mi>T</mi><mspace width="-.14em"></mspace><mpadded height="-.5ex" depth="+.5ex" voffset="-.5ex"><mrow class="MJX-TeXAtom-ORD"><mi>E</mi></mrow></mpadded><mspace width="-.115em"></mspace><mi>X</mi></math></span></span><script type="math/tex" id="MathJax-Element-1">\LaTeX</script> formulas properly.</p>
<h2 id="Contents">Contents<a class="anchor-link" href="#Contents">¶</a></h2>
<ol>
<li>Reinforcement Learning </li>
<li>Q-Learning</li>
<li>Dueling Networks</li>
<li>Exploration-exploitation trade-off</li>
<li>Replay memory</li>
<li>Target network and parameter update</li>
<li>Double Q-Learning</li>
<li>Putting everything together: DQN</li>
<li>Train it yourself</li>
<li>Use a trained network</li>
</ol>
<h2 id="1.-Reinforcement-Learning">1. Reinforcement Learning<a class="anchor-link" href="#1.-Reinforcement-Learning">¶</a></h2>
<p>In supervised learning a neural network, for instance, learns a 
function that maps an input to a corresponding output/target on the 
basis of a large amount of labeled training data consisting of example 
input-output pairs: Simply put, if you train a neural network to 
classify, for example, cats and dogs, you repeatedly show the network 
pictures of cats or dogs, compare the network's prediction to the label 
and slightly adapt the network's parameters until the neural net is able
 to classify what animal is shown in a picture.</p>
<p>Now, let's say you let a child play a computer game it has never played before. In the case of <a href="https://www.youtube.com/watch?v=TmPfTpjtdgg" target="_blank">Breakout</a>
 the player sees the pixel screen as input and has to decide whether to 
move left or right. You could certainly show the child many times in 
which situations it has to press left and in which situations right in 
order to win the game (supervised learning) but surely the child would 
become bored quickly and would try to push you aside, wanting to try the
 game itself. And the child would learn to play the game quickly without
 being told how to do so simply by evaluating which actions lead to an 
increased score. In reinforcement learning we try to make a computer 
learn in this exact same way, by letting it explore the environment and 
occasionally giving it a reward when the score increases. </p>
<p>However, in comparison to supervised learning, this poses a problem. On p. 1 of <a href="https://arxiv.org/abs/1312.5602" target="_blank">Mnih et al. 2013</a> the authors say:</p>
<blockquote>
<p>RL algorithms [...] must be able to learn from a scalar reward signal
 that is frequently sparse [...] and delayed. The delay between actions 
and resulting rewards, which can be thousands of timesteps long, seems 
particularly daunting when compared to the direct association between 
inputs and targets found in supervised learning.</p>
</blockquote>
<p>What do the authors mean with with "sparse [...] and delayed"? </p>
<p>Imagine you walk through a maze trying to find treasures. You get a 
reward once you find gold. Now imagine you encounter a fork in the path.
 Which way do you take? As opposed to supervised learning, at the fork 
the agent does not get any immediate feedback/reward for taking the 
right path but only later once it finds any gold. Yet it might have been
 crucial to take for example the left way at the fork. This is what the 
authors mean with <em>delayed</em>. The problem is met by discounting future rewards with a factor <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B3;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-24" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.49em, 2.676em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-25"><span class="mi" id="MathJax-Span-26" style="font-family: STIXMathJax_Normal; font-style: italic;">𝛾<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.03em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.318em; border-left: 0px solid; width: 0px; height: 0.972em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>γ</mi></math></span></span><script type="math/tex" id="MathJax-Element-2">\gamma</script> (between 0 and 1). </p>
<p><a href="https://drive.google.com/file/d/1xeUDVGWGUUv1-ccUMAZHJLej2C7aAFWY/view" target="_blank">Sutton and Barto 2018</a> write on page 55:</p>
<blockquote>
<p>The additional concept that we need is that of discounting. According to this approach,
the agent tries to select actions so that the sum of the discounted rewards it receives over
the future is maximized. In particular, it chooses <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-27" style="width: 1.356em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.028em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.281em, 1001.03em, 2.429em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-28"><span class="msubsup" id="MathJax-Span-29"><span style="display: inline-block; position: relative; width: 1.013em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.69em, 4.167em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-30" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐴</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.717em;"><span class="mi" id="MathJax-Span-31" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑡</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.278em; border-left: 0px solid; width: 0px; height: 1.23em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>A</mi><mi>t</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-3">A_t</script> to maximize the <em>expected discounted
return</em>:</p>
</blockquote>
<p>The discounted return <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-32" style="width: 1.356em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.028em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.28em, 1001.03em, 2.429em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-33"><span class="msubsup" id="MathJax-Span-34"><span style="display: inline-block; position: relative; width: 1.03em; height: 0px;"><span style="position: absolute; clip: rect(3.174em, 1000.73em, 4.179em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-35" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐺</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.734em;"><span class="mi" id="MathJax-Span-36" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑡</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.278em; border-left: 0px solid; width: 0px; height: 1.231em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>G</mi><mi>t</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-4">G_t</script> is calculated as follows  </p>
<p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable columnalign=&quot;right left right left right left right left right left right left&quot; rowspacing=&quot;3pt&quot; columnspacing=&quot;0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em&quot; displaystyle=&quot;true&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B3;&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B3;&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B3;&lt;/mi&gt;&lt;mstyle scriptlevel=&quot;0&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-OPEN&quot;&gt;&lt;mo maxsize=&quot;1.2em&quot; minsize=&quot;1.2em&quot;&gt;(&lt;/mo&gt;&lt;/mrow&gt;&lt;/mstyle&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B3;&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mstyle scriptlevel=&quot;0&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-CLOSE&quot;&gt;&lt;mo maxsize=&quot;1.2em&quot; minsize=&quot;1.2em&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mstyle&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B3;&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-37" style="width: 19.321em; display: inline-block;"><span style="display: inline-block; position: relative; width: 14.61em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(-0.36em, 1014.46em, 4.081em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-38"><span class="mtable" id="MathJax-Span-39"><span style="display: inline-block; position: relative; width: 14.277em; height: 0px; margin-right: 0.167em; margin-left: 0.167em;"><span style="position: absolute; clip: rect(2.46em, 1001.03em, 6.478em, -1000em); top: -4.708em; left: 0em;"><span style="display: inline-block; position: relative; width: 1.03em; height: 0px;"><span style="position: absolute; clip: rect(3.174em, 1001.03em, 4.323em, -1000em); top: -5.422em; right: 0em;"><span class="mtd" id="MathJax-Span-40"><span class="mrow" id="MathJax-Span-41"><span class="msubsup" id="MathJax-Span-42"><span style="display: inline-block; position: relative; width: 1.03em; height: 0px;"><span style="position: absolute; clip: rect(3.174em, 1000.73em, 4.179em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-43" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐺</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.734em;"><span class="texatom" id="MathJax-Span-44"><span class="mrow" id="MathJax-Span-45"><span class="mi" id="MathJax-Span-46" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑡</span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; clip: rect(3.842em, 1000em, 4.167em, -1000em); top: -3.959em; right: 0em;"><span class="mtd" id="MathJax-Span-82"><span class="mrow" id="MathJax-Span-83"></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; clip: rect(3.842em, 1000em, 4.167em, -1000em); top: -2.396em; right: 0em;"><span class="mtd" id="MathJax-Span-127"><span class="mrow" id="MathJax-Span-128"></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.708em;"></span></span><span style="position: absolute; clip: rect(2.616em, 1013.09em, 7.044em, -1000em); top: -5.087em; left: 1.03em;"><span style="display: inline-block; position: relative; width: 13.246em; height: 0px;"><span style="position: absolute; clip: rect(2.951em, 1012.45em, 4.354em, -1000em); top: -5.422em; left: 0em;"><span class="mtd" id="MathJax-Span-47"><span class="mrow" id="MathJax-Span-48"><span class="mi" id="MathJax-Span-49"></span><span class="mo" id="MathJax-Span-50" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="msubsup" id="MathJax-Span-51" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 1.874em; height: 0px;"><span style="position: absolute; clip: rect(3.189em, 1000.73em, 4.167em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-52" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑅</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.74em;"><span class="texatom" id="MathJax-Span-53"><span class="mrow" id="MathJax-Span-54"><span class="mi" id="MathJax-Span-55" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑡</span><span class="mo" id="MathJax-Span-56" style="font-size: 70.7%; font-family: STIXMathJax_Main;">+</span><span class="mn" id="MathJax-Span-57" style="font-size: 70.7%; font-family: STIXMathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-58" style="font-family: STIXMathJax_Main; padding-left: 0.25em;">+</span><span class="mi" id="MathJax-Span-59" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.25em;">𝛾<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.03em;"></span></span><span class="msubsup" id="MathJax-Span-60"><span style="display: inline-block; position: relative; width: 1.874em; height: 0px;"><span style="position: absolute; clip: rect(3.189em, 1000.73em, 4.167em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-61" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑅</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.74em;"><span class="texatom" id="MathJax-Span-62"><span class="mrow" id="MathJax-Span-63"><span class="mi" id="MathJax-Span-64" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑡</span><span class="mo" id="MathJax-Span-65" style="font-size: 70.7%; font-family: STIXMathJax_Main;">+</span><span class="mn" id="MathJax-Span-66" style="font-size: 70.7%; font-family: STIXMathJax_Main;">2</span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-67" style="font-family: STIXMathJax_Main; padding-left: 0.25em;">+</span><span class="msubsup" id="MathJax-Span-68" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.946em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.46em, 4.354em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-69" style="font-family: STIXMathJax_Normal; font-style: italic;">𝛾<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.03em;"></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.417em; left: 0.517em;"><span class="mn" id="MathJax-Span-70" style="font-size: 70.7%; font-family: STIXMathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-71"><span style="display: inline-block; position: relative; width: 1.874em; height: 0px;"><span style="position: absolute; clip: rect(3.189em, 1000.73em, 4.167em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-72" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑅</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.74em;"><span class="texatom" id="MathJax-Span-73"><span class="mrow" id="MathJax-Span-74"><span class="mi" id="MathJax-Span-75" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑡</span><span class="mo" id="MathJax-Span-76" style="font-size: 70.7%; font-family: STIXMathJax_Main;">+</span><span class="mn" id="MathJax-Span-77" style="font-size: 70.7%; font-family: STIXMathJax_Main;">3</span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-78" style="font-family: STIXMathJax_Main;">+</span><span class="mo" id="MathJax-Span-79" style="font-family: STIXMathJax_Main;">.</span><span class="mo" id="MathJax-Span-80" style="font-family: STIXMathJax_Main; padding-left: 0.188em;">.</span><span class="mo" id="MathJax-Span-81" style="font-family: STIXMathJax_Main; padding-left: 0.188em;">.</span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; clip: rect(2.917em, 1013.09em, 4.592em, -1000em); top: -3.959em; left: 0em;"><span class="mtd" id="MathJax-Span-84"><span class="mrow" id="MathJax-Span-85"><span class="mi" id="MathJax-Span-86"></span><span class="mo" id="MathJax-Span-87" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="msubsup" id="MathJax-Span-88" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 1.874em; height: 0px;"><span style="position: absolute; clip: rect(3.189em, 1000.73em, 4.167em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-89" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑅</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.74em;"><span class="texatom" id="MathJax-Span-90"><span class="mrow" id="MathJax-Span-91"><span class="mi" id="MathJax-Span-92" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑡</span><span class="mo" id="MathJax-Span-93" style="font-size: 70.7%; font-family: STIXMathJax_Main;">+</span><span class="mn" id="MathJax-Span-94" style="font-size: 70.7%; font-family: STIXMathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-95" style="font-family: STIXMathJax_Main; padding-left: 0.25em;">+</span><span class="mi" id="MathJax-Span-96" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.25em;">𝛾<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.03em;"></span></span><span class="mstyle" id="MathJax-Span-97"><span class="mrow" id="MathJax-Span-98"><span class="texatom" id="MathJax-Span-99"><span class="mrow" id="MathJax-Span-100"><span class="mo" id="MathJax-Span-101" style="vertical-align: -0.245em;"><span><span style="font-size: 109.8%; font-family: STIXMathJax_Size1;">(</span></span></span></span></span></span></span><span class="msubsup" id="MathJax-Span-102"><span style="display: inline-block; position: relative; width: 1.874em; height: 0px;"><span style="position: absolute; clip: rect(3.189em, 1000.73em, 4.167em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-103" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑅</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.74em;"><span class="texatom" id="MathJax-Span-104"><span class="mrow" id="MathJax-Span-105"><span class="mi" id="MathJax-Span-106" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑡</span><span class="mo" id="MathJax-Span-107" style="font-size: 70.7%; font-family: STIXMathJax_Main;">+</span><span class="mn" id="MathJax-Span-108" style="font-size: 70.7%; font-family: STIXMathJax_Main;">2</span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-109" style="font-family: STIXMathJax_Main; padding-left: 0.25em;">+</span><span class="mi" id="MathJax-Span-110" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.25em;">𝛾<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.03em;"></span></span><span class="msubsup" id="MathJax-Span-111"><span style="display: inline-block; position: relative; width: 1.874em; height: 0px;"><span style="position: absolute; clip: rect(3.189em, 1000.73em, 4.167em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-112" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑅</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.74em;"><span class="texatom" id="MathJax-Span-113"><span class="mrow" id="MathJax-Span-114"><span class="mi" id="MathJax-Span-115" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑡</span><span class="mo" id="MathJax-Span-116" style="font-size: 70.7%; font-family: STIXMathJax_Main;">+</span><span class="mn" id="MathJax-Span-117" style="font-size: 70.7%; font-family: STIXMathJax_Main;">3</span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-118" style="font-family: STIXMathJax_Main;">+</span><span class="mo" id="MathJax-Span-119" style="font-family: STIXMathJax_Main;">.</span><span class="mo" id="MathJax-Span-120" style="font-family: STIXMathJax_Main; padding-left: 0.188em;">.</span><span class="mo" id="MathJax-Span-121" style="font-family: STIXMathJax_Main; padding-left: 0.188em;">.</span><span class="mstyle" id="MathJax-Span-122" style="padding-left: 0.188em;"><span class="mrow" id="MathJax-Span-123"><span class="texatom" id="MathJax-Span-124"><span class="mrow" id="MathJax-Span-125"><span class="mo" id="MathJax-Span-126" style="vertical-align: -0.245em;"><span><span style="font-size: 109.8%; font-family: STIXMathJax_Size1;">)</span></span></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; clip: rect(3.174em, 1006.7em, 4.354em, -1000em); top: -2.396em; left: 0em;"><span class="mtd" id="MathJax-Span-129"><span class="mrow" id="MathJax-Span-130"><span class="mi" id="MathJax-Span-131"></span><span class="mo" id="MathJax-Span-132" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="msubsup" id="MathJax-Span-133" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 1.874em; height: 0px;"><span style="position: absolute; clip: rect(3.189em, 1000.73em, 4.167em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-134" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑅</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.74em;"><span class="texatom" id="MathJax-Span-135"><span class="mrow" id="MathJax-Span-136"><span class="mi" id="MathJax-Span-137" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑡</span><span class="mo" id="MathJax-Span-138" style="font-size: 70.7%; font-family: STIXMathJax_Main;">+</span><span class="mn" id="MathJax-Span-139" style="font-size: 70.7%; font-family: STIXMathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-140" style="font-family: STIXMathJax_Main; padding-left: 0.25em;">+</span><span class="mi" id="MathJax-Span-141" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.25em;">𝛾<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.03em;"></span></span><span class="msubsup" id="MathJax-Span-142"><span style="display: inline-block; position: relative; width: 1.868em; height: 0px;"><span style="position: absolute; clip: rect(3.174em, 1000.73em, 4.179em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-143" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐺</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.734em;"><span class="texatom" id="MathJax-Span-144"><span class="mrow" id="MathJax-Span-145"><span class="mi" id="MathJax-Span-146" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑡</span><span class="mo" id="MathJax-Span-147" style="font-size: 70.7%; font-family: STIXMathJax_Main;">+</span><span class="mn" id="MathJax-Span-148" style="font-size: 70.7%; font-family: STIXMathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span><span style="display: inline-block; width: 0px; height: 5.087em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -2.458em; border-left: 0px solid; width: 0px; height: 5.577em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable columnalign="right left right left right left right left right left right left" rowspacing="3pt" columnspacing="0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em" displaystyle="true"><mtr><mtd><msub><mi>G</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi></mrow></msub></mtd><mtd><mi></mi><mo>=</mo><msub><mi>R</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>γ</mi><msub><mi>R</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>+</mo><mn>2</mn></mrow></msub><mo>+</mo><msup><mi>γ</mi><mn>2</mn></msup><msub><mi>R</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>+</mo><mn>3</mn></mrow></msub><mo>+</mo><mo>.</mo><mo>.</mo><mo>.</mo></mtd></mtr><mtr><mtd></mtd><mtd><mi></mi><mo>=</mo><msub><mi>R</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>γ</mi><mstyle scriptlevel="0"><mrow class="MJX-TeXAtom-OPEN"><mo maxsize="1.2em" minsize="1.2em">(</mo></mrow></mstyle><msub><mi>R</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>+</mo><mn>2</mn></mrow></msub><mo>+</mo><mi>γ</mi><msub><mi>R</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>+</mo><mn>3</mn></mrow></msub><mo>+</mo><mo>.</mo><mo>.</mo><mo>.</mo><mstyle scriptlevel="0"><mrow class="MJX-TeXAtom-CLOSE"><mo maxsize="1.2em" minsize="1.2em">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd></mtd><mtd><mi></mi><mo>=</mo><msub><mi>R</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>γ</mi><msub><mi>G</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub></mtd></mtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-5">\begin{align}
G_{t} &= R_{t+1} + \gamma R_{t+2} + \gamma^2 R_{t+3} + ... \\
&=R_{t+1} + \gamma \bigl(R_{t+2} + \gamma R_{t+3} + ...\bigr)\\
&= R_{t+1} + \gamma G_{t+1}
\end{align}</script></p>
<p>where <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-149" style="width: 1.356em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.028em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.295em, 1001.03em, 2.429em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-150"><span class="msubsup" id="MathJax-Span-151"><span style="display: inline-block; position: relative; width: 1.036em; height: 0px;"><span style="position: absolute; clip: rect(3.189em, 1000.73em, 4.167em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-152" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑅</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.74em;"><span class="mi" id="MathJax-Span-153" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑡</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.278em; border-left: 0px solid; width: 0px; height: 1.211em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>R</mi><mi>t</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-6">R_t</script> is the reward the agent received at time <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-154" style="width: 0.436em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.325em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.598em, 1000.3em, 2.498em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-155"><span class="mi" id="MathJax-Span-156" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑡</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.083em; border-left: 0px solid; width: 0px; height: 0.903em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-7">t</script>.</p>
<p>The authors furthermore explain:</p>
<blockquote>
<p>a reward received <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-157" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.541em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.497em, 1000.53em, 2.5em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-158"><span class="mi" id="MathJax-Span-159" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑘</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 1.039em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-8">k</script> time steps in the future is worth only <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B3;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-160" style="width: 2.438em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.84em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.107em, 1001.84em, 2.46em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-161"><span class="msubsup" id="MathJax-Span-162"><span style="display: inline-block; position: relative; width: 1.813em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.46em, 4.354em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-163" style="font-family: STIXMathJax_Normal; font-style: italic;">𝛾<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.03em;"></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.367em; left: 0.517em;"><span class="texatom" id="MathJax-Span-164"><span class="mrow" id="MathJax-Span-165"><span class="mi" id="MathJax-Span-166" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑘</span><span class="mo" id="MathJax-Span-167" style="font-size: 70.7%; font-family: STIXMathJax_Main;">−</span><span class="mn" id="MathJax-Span-168" style="font-size: 70.7%; font-family: STIXMathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.318em; border-left: 0px solid; width: 0px; height: 1.5em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>γ</mi><mrow class="MJX-TeXAtom-ORD"><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-9">\gamma^{k−1}</script> times what it would be worth if it were received immediately.</p>
</blockquote>
<p>and</p>
<blockquote>
<p>As <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B3;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-169" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.49em, 2.676em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-170"><span class="mi" id="MathJax-Span-171" style="font-family: STIXMathJax_Normal; font-style: italic;">𝛾<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.03em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.318em; border-left: 0px solid; width: 0px; height: 0.972em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>γ</mi></math></span></span><script type="math/tex" id="MathJax-Element-10">\gamma</script> approaches 1, the return objective takes future rewards into account more strongly; the agent becomes more farsighted.</p>
</blockquote>
<p>Let us look at a very simple example where there is just one reward not equal to 0 (calculate from right to left):</p>
<table>
<thead>
<tr>
<th style="text-align: left">time <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-172" style="width: 0.435em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.309em; height: 0px; font-size: 135%;"><span style="position: absolute; clip: rect(1.593em, 1000.28em, 2.54em, -1000em); top: -2.346em; left: 0em;"><span class="mrow" id="MathJax-Span-173"><span class="mi" id="MathJax-Span-174" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑡</span></span><span style="display: inline-block; width: 0px; height: 2.346em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.095em; border-left: 0px solid; width: 0px; height: 0.944em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-11">t</script></th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
</tr>
</thead>
<tbody><tr>
<td style="text-align: left">reward sequence <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-175" style="width: 1.423em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.049em; height: 0px; font-size: 135%;"><span style="position: absolute; clip: rect(1.322em, 1001.05em, 2.502em, -1000em); top: -2.16em; left: 0em;"><span class="mrow" id="MathJax-Span-176"><span class="msubsup" id="MathJax-Span-177"><span style="display: inline-block; position: relative; width: 1.036em; height: 0px;"><span style="position: absolute; clip: rect(3.174em, 1000.73em, 4.198em, -1000em); top: -4.012em; left: 0em;"><span class="mi" id="MathJax-Span-178" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑅</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.74em;"><span class="mi" id="MathJax-Span-179" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑡</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.16em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.294em; border-left: 0px solid; width: 0px; height: 1.259em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>R</mi><mi>t</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-12">R_t</script></td>
<td></td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td style="text-align: left">discounted returns <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-180" style="width: 1.423em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.049em; height: 0px; font-size: 135%;"><span style="position: absolute; clip: rect(1.307em, 1001.05em, 2.502em, -1000em); top: -2.16em; left: 0em;"><span class="mrow" id="MathJax-Span-181"><span class="msubsup" id="MathJax-Span-182"><span style="display: inline-block; position: relative; width: 1.03em; height: 0px;"><span style="position: absolute; clip: rect(3.159em, 1000.73em, 4.21em, -1000em); top: -4.012em; left: 0em;"><span class="mi" id="MathJax-Span-183" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐺</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.734em;"><span class="mi" id="MathJax-Span-184" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑡</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.16em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.294em; border-left: 0px solid; width: 0px; height: 1.28em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>G</mi><mi>t</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-13">G_t</script></td>
<td><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B3;&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-185" style="width: 1.299em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.926em; height: 0px; font-size: 135%;"><span style="position: absolute; clip: rect(1.134em, 1000.93em, 2.533em, -1000em); top: -2.16em; left: 0em;"><span class="mrow" id="MathJax-Span-186"><span class="msubsup" id="MathJax-Span-187"><span style="display: inline-block; position: relative; width: 0.946em; height: 0px;"><span style="position: absolute; clip: rect(3.386em, 1000.46em, 4.385em, -1000em); top: -4.012em; left: 0em;"><span class="mi" id="MathJax-Span-188" style="font-family: STIXMathJax_Normal; font-style: italic;">𝛾<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.03em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -4.375em; left: 0.517em;"><span class="mn" id="MathJax-Span-189" style="font-size: 70.7%; font-family: STIXMathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.16em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.336em; border-left: 0px solid; width: 0px; height: 1.554em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>γ</mi><mn>3</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-14">\gamma^3</script></td>
<td><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B3;&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-190" style="width: 1.299em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.926em; height: 0px; font-size: 135%;"><span style="position: absolute; clip: rect(1.134em, 1000.93em, 2.533em, -1000em); top: -2.16em; left: 0em;"><span class="mrow" id="MathJax-Span-191"><span class="msubsup" id="MathJax-Span-192"><span style="display: inline-block; position: relative; width: 0.946em; height: 0px;"><span style="position: absolute; clip: rect(3.386em, 1000.46em, 4.385em, -1000em); top: -4.012em; left: 0em;"><span class="mi" id="MathJax-Span-193" style="font-family: STIXMathJax_Normal; font-style: italic;">𝛾<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.03em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -4.375em; left: 0.517em;"><span class="mn" id="MathJax-Span-194" style="font-size: 70.7%; font-family: STIXMathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.16em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.336em; border-left: 0px solid; width: 0px; height: 1.554em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>γ</mi><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-15">\gamma^2</script></td>
<td><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B3;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-195" style="width: 0.62em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.432em; height: 0px; font-size: 135%;"><span style="position: absolute; clip: rect(1.719em, 1000.43em, 2.718em, -1000em); top: -2.346em; left: 0em;"><span class="mrow" id="MathJax-Span-196"><span class="mi" id="MathJax-Span-197" style="font-family: STIXMathJax_Normal; font-style: italic;">𝛾<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.03em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.346em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.336em; border-left: 0px solid; width: 0px; height: 1.014em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>γ</mi></math></span></span><script type="math/tex" id="MathJax-Element-16">\gamma</script></td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td style="text-align: left">for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-17-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B3;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0.9&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-198" style="width: 4.077em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.025em; height: 0px; font-size: 135%;"><span style="position: absolute; clip: rect(1.67em, 1002.98em, 2.903em, -1000em); top: -2.531em; left: 0em;"><span class="mrow" id="MathJax-Span-199"><span class="mi" id="MathJax-Span-200" style="font-family: STIXMathJax_Normal; font-style: italic;">𝛾<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.03em;"></span></span><span class="mo" id="MathJax-Span-201" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mn" id="MathJax-Span-202" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">0.9</span></span><span style="display: inline-block; width: 0px; height: 2.531em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.336em; border-left: 0px solid; width: 0px; height: 1.332em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>γ</mi><mo>=</mo><mn>0.9</mn></math></span></span><script type="math/tex" id="MathJax-Element-17">\gamma=0.9</script></td>
<td>0.729</td>
<td>0.81</td>
<td>0.9</td>
<td>1</td>
<td>0</td>
</tr>
</tbody></table>
<p>Minor detail: In this example there is no reward at <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-18-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-203" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.165em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1002.14em, 2.666em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-204"><span class="mi" id="MathJax-Span-205" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑡</span><span class="mo" id="MathJax-Span-206" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mn" id="MathJax-Span-207" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.09em; border-left: 0px solid; width: 0px; height: 1.054em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mo>=</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-18">t=0</script> because the first reward <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-19-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-208" style="width: 1.572em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.19em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.295em, 1001.19em, 2.423em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-209"><span class="msubsup" id="MathJax-Span-210"><span style="display: inline-block; position: relative; width: 1.169em; height: 0px;"><span style="position: absolute; clip: rect(3.189em, 1000.73em, 4.167em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-211" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑅</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.74em;"><span class="mn" id="MathJax-Span-212" style="font-size: 70.7%; font-family: STIXMathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.269em; border-left: 0px solid; width: 0px; height: 1.203em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>R</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-19">R_1</script> is a result of action <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-20-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-213" style="width: 1.247em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.92em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.507em, 1000.92em, 2.433em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-214"><span class="msubsup" id="MathJax-Span-215"><span style="display: inline-block; position: relative; width: 0.931em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.47em, 4.177em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-216" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.502em;"><span class="mn" id="MathJax-Span-217" style="font-size: 70.7%; font-family: STIXMathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.936em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>a</mi><mn>0</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-20">a_0</script> taken in state <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-21-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-218" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.866em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.507em, 1000.87em, 2.433em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-219"><span class="msubsup" id="MathJax-Span-220"><span style="display: inline-block; position: relative; width: 0.869em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.39em, 4.178em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-221" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.44em;"><span class="mn" id="MathJax-Span-222" style="font-size: 70.7%; font-family: STIXMathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.936em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>s</mi><mn>0</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-21">s_0</script> and the reward is always associated with the next state in Sutton and Barto. Some articles associate the reward <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-22-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-223" style="width: 1.356em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.028em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.295em, 1001.03em, 2.431em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-224"><span class="msubsup" id="MathJax-Span-225"><span style="display: inline-block; position: relative; width: 1.035em; height: 0px;"><span style="position: absolute; clip: rect(3.189em, 1000.73em, 4.167em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-226" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑅</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.74em;"><span class="mi" id="MathJax-Span-227" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑖</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.28em; border-left: 0px solid; width: 0px; height: 1.213em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>R</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-22">R_i</script> with the state <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-23-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-228" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.507em, 1000.76em, 2.431em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-229"><span class="msubsup" id="MathJax-Span-230"><span style="display: inline-block; position: relative; width: 0.735em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.39em, 4.178em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-231" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.44em;"><span class="mi" id="MathJax-Span-232" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑖</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.28em; border-left: 0px solid; width: 0px; height: 0.933em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>s</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-23">s_i</script> and action <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-24-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-233" style="width: 1.085em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.812em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.507em, 1000.81em, 2.431em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-234"><span class="msubsup" id="MathJax-Span-235"><span style="display: inline-block; position: relative; width: 0.797em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.47em, 4.177em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-236" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.502em;"><span class="mi" id="MathJax-Span-237" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑖</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.28em; border-left: 0px solid; width: 0px; height: 0.933em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>a</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-24">a_i</script> that caused the reward. In that case the definition of the discounted return changes to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-25-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B3;&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-238" style="width: 9.148em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.926em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.659em, 1006.93em, 2.839em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-239"><span class="msubsup" id="MathJax-Span-240"><span style="display: inline-block; position: relative; width: 1.03em; height: 0px;"><span style="position: absolute; clip: rect(3.174em, 1000.73em, 4.179em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-241" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐺</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.734em;"><span class="mi" id="MathJax-Span-242" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑡</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-243" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="msubsup" id="MathJax-Span-244" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 1.036em; height: 0px;"><span style="position: absolute; clip: rect(3.189em, 1000.73em, 4.167em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-245" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑅</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.74em;"><span class="texatom" id="MathJax-Span-246"><span class="mrow" id="MathJax-Span-247"><span class="mi" id="MathJax-Span-248" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑡</span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-249" style="font-family: STIXMathJax_Main; padding-left: 0.25em;">+</span><span class="mi" id="MathJax-Span-250" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.25em;">𝛾<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.03em;"></span></span><span class="msubsup" id="MathJax-Span-251"><span style="display: inline-block; position: relative; width: 1.868em; height: 0px;"><span style="position: absolute; clip: rect(3.174em, 1000.73em, 4.179em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-252" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐺</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.734em;"><span class="texatom" id="MathJax-Span-253"><span class="mrow" id="MathJax-Span-254"><span class="mi" id="MathJax-Span-255" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑡</span><span class="mo" id="MathJax-Span-256" style="font-size: 70.7%; font-family: STIXMathJax_Main;">+</span><span class="mn" id="MathJax-Span-257" style="font-size: 70.7%; font-family: STIXMathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.318em; border-left: 0px solid; width: 0px; height: 1.271em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>G</mi><mi>t</mi></msub><mo>=</mo><msub><mi>R</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi></mrow></msub><mo>+</mo><mi>γ</mi><msub><mi>G</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-25">G_t=R_{t} + \gamma G_{t+1}</script>, in the table the 1's would all be in the same column and there would be a reward equal to 0 at <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-26-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-258" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.165em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1002.14em, 2.666em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-259"><span class="mi" id="MathJax-Span-260" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑡</span><span class="mo" id="MathJax-Span-261" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mn" id="MathJax-Span-262" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.09em; border-left: 0px solid; width: 0px; height: 1.054em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mo>=</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-26">t=0</script> but not at <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-27-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;4&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-263" style="width: 2.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.165em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1002.14em, 2.661em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-264"><span class="mi" id="MathJax-Span-265" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑡</span><span class="mo" id="MathJax-Span-266" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mn" id="MathJax-Span-267" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">4</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.083em; border-left: 0px solid; width: 0px; height: 1.047em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mo>=</mo><mn>4</mn></math></span></span><script type="math/tex" id="MathJax-Element-27">t=4</script> .</p>
<p>Simply put, by discounting returns, future rewards increase past or current returns and the closer <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-28-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B3;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-268" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.49em, 2.676em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-269"><span class="mi" id="MathJax-Span-270" style="font-family: STIXMathJax_Normal; font-style: italic;">𝛾<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.03em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.318em; border-left: 0px solid; width: 0px; height: 0.972em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>γ</mi></math></span></span><script type="math/tex" id="MathJax-Element-28">\gamma</script> is to 1, the farther the agent can <em>see</em> into the future. </p>
<p>And <em>sparse</em>?
In our fictive maze example, the rewards are the sparser, the less gold 
you find. For an agent, a game is more difficult to learn, the sparser 
the reward is. <a href="https://gym.openai.com/envs/Pong-v0/" target="_blank">Pong</a> is one of the games DQN can learn fastest because the score changes quite often. <a href="https://gym.openai.com/envs/MontezumaRevenge-v0/" target="_blank">Montezuma's Revenge</a>,
 on the other hand, has very sparse rewards and DQN (at least without 
some additional tricks) is not able to learn the game at all.</p>
<h2 id="2.-Q-Learning">2. Q-Learning<a class="anchor-link" href="#2.-Q-Learning">¶</a></h2>
<p>So how does Q-Learning work? If the agent (regardless if trained or still untrained) is shown a state <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-29-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-271" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.433em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.38em, 2.5em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-272"><span class="mi" id="MathJax-Span-273" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 0.739em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-29">s</script> of the game, it has to decide which action <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-30-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-274" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.46em, 2.499em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-275"><span class="mi" id="MathJax-Span-276" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.085em; border-left: 0px solid; width: 0px; height: 0.738em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-30">a</script> to perform (for example move paddle left or right in breakout). How does it do that? On page 2 <a href="https://arxiv.org/abs/1312.5602" target="_blank">Mnih et al. 2013</a> define the so-called <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-31-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-277" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-278"><span class="mi" id="MathJax-Span-279" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-31">Q</script>-Function:</p>
<blockquote>
<p>We define the optimal action-value function <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-32-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-280" style="width: 4.332em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.247em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.631em, 1003.2em, 2.829em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-281"><span class="msubsup" id="MathJax-Span-282"><span style="display: inline-block; position: relative; width: 1.226em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-283" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.367em; left: 0.781em;"><span class="mo" id="MathJax-Span-284" style="font-size: 70.7%; font-family: STIXMathJax_Main;">∗</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-285" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-286" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-287" style="font-family: STIXMathJax_Main;">,</span><span class="mi" id="MathJax-Span-288" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.188em;">𝑎</span><span class="mo" id="MathJax-Span-289" style="font-family: STIXMathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.305em; border-left: 0px solid; width: 0px; height: 1.295em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>Q</mi><mo>∗</mo></msup><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-32">Q^∗(s, a)</script> as the maximum expected return achievable by following any strategy, after seeing some sequence <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-33-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-290" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.433em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.38em, 2.5em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-291"><span class="mi" id="MathJax-Span-292" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 0.739em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-33">s</script> and then taking some action <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-34-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-293" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.46em, 2.499em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-294"><span class="mi" id="MathJax-Span-295" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.085em; border-left: 0px solid; width: 0px; height: 0.738em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-34">a</script> </p>
</blockquote>
<p>This means that given a state of the game <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-35-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-296" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.433em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.38em, 2.5em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-297"><span class="mi" id="MathJax-Span-298" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 0.739em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-35">s</script> (for now please consider <em>sequences</em> as states of the game), <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-36-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-299" style="width: 4.332em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.247em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.631em, 1003.2em, 2.829em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-300"><span class="msubsup" id="MathJax-Span-301"><span style="display: inline-block; position: relative; width: 1.226em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-302" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.367em; left: 0.781em;"><span class="mo" id="MathJax-Span-303" style="font-size: 70.7%; font-family: STIXMathJax_Main;">∗</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-304" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-305" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-306" style="font-family: STIXMathJax_Main;">,</span><span class="mi" id="MathJax-Span-307" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.188em;">𝑎</span><span class="mo" id="MathJax-Span-308" style="font-family: STIXMathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.305em; border-left: 0px solid; width: 0px; height: 1.295em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>Q</mi><mo>∗</mo></msup><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-36">Q^*(s,a)</script> is the best (discounted) total return the agent can achieve if it performs action <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-37-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-309" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.46em, 2.499em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-310"><span class="mi" id="MathJax-Span-311" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.085em; border-left: 0px solid; width: 0px; height: 0.738em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-37">a</script> in the current state <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-38-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-312" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.433em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.38em, 2.5em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-313"><span class="mi" id="MathJax-Span-314" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 0.739em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-38">s</script>. So how does it choose which action to perform assuming we already know <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-39-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-315" style="width: 4.332em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.247em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.631em, 1003.2em, 2.829em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-316"><span class="msubsup" id="MathJax-Span-317"><span style="display: inline-block; position: relative; width: 1.226em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-318" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.367em; left: 0.781em;"><span class="mo" id="MathJax-Span-319" style="font-size: 70.7%; font-family: STIXMathJax_Main;">∗</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-320" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-321" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-322" style="font-family: STIXMathJax_Main;">,</span><span class="mi" id="MathJax-Span-323" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.188em;">𝑎</span><span class="mo" id="MathJax-Span-324" style="font-family: STIXMathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.305em; border-left: 0px solid; width: 0px; height: 1.295em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>Q</mi><mo>∗</mo></msup><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-39">Q^*(s,a)</script>? One obvious strategy would be to always choose the action with the maximum value of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-40-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-325" style="width: 1.68em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.245em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.252em, 1001.25em, 2.425em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-326"><span class="msubsup" id="MathJax-Span-327"><span style="display: inline-block; position: relative; width: 1.226em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-328" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.367em; left: 0.781em;"><span class="mo" id="MathJax-Span-329" style="font-size: 70.7%; font-family: STIXMathJax_Main;">∗</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.262em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>Q</mi><mo>∗</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-40">Q^*</script> (we will see later, why this is slightly problematic). But first of all, we need to find this magical function <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-41-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-330" style="width: 1.68em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.245em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.252em, 1001.25em, 2.425em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-331"><span class="msubsup" id="MathJax-Span-332"><span style="display: inline-block; position: relative; width: 1.226em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-333" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.367em; left: 0.781em;"><span class="mo" id="MathJax-Span-334" style="font-size: 70.7%; font-family: STIXMathJax_Main;">∗</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.262em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>Q</mi><mo>∗</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-41">Q^*</script>:</p>
<p>Let's say we are in state <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-42-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-335" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.433em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.38em, 2.5em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-336"><span class="mi" id="MathJax-Span-337" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 0.739em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-42">s</script>, decide to perform action <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-43-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-338" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.46em, 2.499em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-339"><span class="mi" id="MathJax-Span-340" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.085em; border-left: 0px solid; width: 0px; height: 0.738em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-43">a</script> and arrive in the next state <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-44-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-341" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.186em, 1000.76em, 2.284em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-342"><span class="msup" id="MathJax-Span-343"><span style="display: inline-block; position: relative; width: 0.755em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.39em, 4.178em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-344" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.367em; left: 0.44em;"><span class="mo" id="MathJax-Span-345" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 1.164em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>s</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-44">s'</script>. If we assume that in state <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-45-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-346" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.186em, 1000.76em, 2.284em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-347"><span class="msup" id="MathJax-Span-348"><span style="display: inline-block; position: relative; width: 0.755em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.39em, 4.178em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-349" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.367em; left: 0.44em;"><span class="mo" id="MathJax-Span-350" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 1.164em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>s</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-45">s'</script> the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-46-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-351" style="width: 1.68em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.245em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.252em, 1001.25em, 2.425em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-352"><span class="msubsup" id="MathJax-Span-353"><span style="display: inline-block; position: relative; width: 1.226em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-354" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.367em; left: 0.781em;"><span class="mo" id="MathJax-Span-355" style="font-size: 70.7%; font-family: STIXMathJax_Main;">∗</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.262em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>Q</mi><mo>∗</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-46">Q^*</script>-values for all possible actions <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-47-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-356" style="width: 1.085em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.812em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.186em, 1000.81em, 2.283em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-357"><span class="msup" id="MathJax-Span-358"><span style="display: inline-block; position: relative; width: 0.817em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.47em, 4.177em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-359" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.367em; left: 0.502em;"><span class="mo" id="MathJax-Span-360" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.085em; border-left: 0px solid; width: 0px; height: 1.162em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>a</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-47">a'</script> were already known, then the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-48-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-361" style="width: 1.68em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.245em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.252em, 1001.25em, 2.425em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-362"><span class="msubsup" id="MathJax-Span-363"><span style="display: inline-block; position: relative; width: 1.226em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-364" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.367em; left: 0.781em;"><span class="mo" id="MathJax-Span-365" style="font-size: 70.7%; font-family: STIXMathJax_Main;">∗</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.262em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>Q</mi><mo>∗</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-48">Q^*</script>-value in state <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-49-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-366" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.433em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.38em, 2.5em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-367"><span class="mi" id="MathJax-Span-368" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 0.739em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-49">s</script> for action <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-50-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-369" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.46em, 2.499em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-370"><span class="mi" id="MathJax-Span-371" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.085em; border-left: 0px solid; width: 0px; height: 0.738em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-50">a</script> (action-value in <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-51-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-372" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.433em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.38em, 2.5em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-373"><span class="mi" id="MathJax-Span-374" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 0.739em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-51">s</script> for action <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-52-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-375" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.46em, 2.499em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-376"><span class="mi" id="MathJax-Span-377" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.085em; border-left: 0px solid; width: 0px; height: 0.738em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-52">a</script>) would be the reward <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-53-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-378" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.433em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.42em, 2.489em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-379"><span class="mi" id="MathJax-Span-380" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑟</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.071em; border-left: 0px solid; width: 0px; height: 0.725em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi></math></span></span><script type="math/tex" id="MathJax-Element-53">r</script> we got for performing action <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-54-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-381" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.46em, 2.499em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-382"><span class="mi" id="MathJax-Span-383" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.085em; border-left: 0px solid; width: 0px; height: 0.738em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-54">a</script> plus the discounted maximum future return in <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-55-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-384" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.186em, 1000.76em, 2.284em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-385"><span class="msup" id="MathJax-Span-386"><span style="display: inline-block; position: relative; width: 0.755em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.39em, 4.178em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-387" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.367em; left: 0.44em;"><span class="mo" id="MathJax-Span-388" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 1.164em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>s</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-55">s'</script>:</p>
<p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-56-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msup&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B3;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mtext&gt;max&lt;/mtext&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-389" style="width: 17.752em; display: inline-block;"><span style="display: inline-block; position: relative; width: 13.42em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(3.085em, 1013.28em, 4.64em, -1000em); top: -4.113em; left: 0em;"><span class="mrow" id="MathJax-Span-390"><span class="msubsup" id="MathJax-Span-391"><span style="display: inline-block; position: relative; width: 1.226em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-392" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.417em; left: 0.781em;"><span class="mo" id="MathJax-Span-393" style="font-size: 70.7%; font-family: STIXMathJax_Main;">∗</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-394" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-395" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-396" style="font-family: STIXMathJax_Main;">,</span><span class="mi" id="MathJax-Span-397" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.188em;">𝑎</span><span class="mo" id="MathJax-Span-398" style="font-family: STIXMathJax_Main;">)</span><span class="mo" id="MathJax-Span-399" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-400" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.313em;">𝑟</span><span class="mo" id="MathJax-Span-401" style="font-family: STIXMathJax_Main; padding-left: 0.25em;">+</span><span class="mi" id="MathJax-Span-402" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.25em;">𝛾<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.03em;"></span></span><span class="texatom" id="MathJax-Span-403"><span class="mrow" id="MathJax-Span-404"><span class="mtext" id="MathJax-Span-405" style="font-family: STIXMathJax_Main;">max</span></span></span><span class="mrow" id="MathJax-Span-406" style="padding-left: 0.188em;"><span class="mo" id="MathJax-Span-407" style="vertical-align: -0.201em;"><span style="font-family: STIXMathJax_Size1;">(</span></span><span class="msubsup" id="MathJax-Span-408"><span style="display: inline-block; position: relative; width: 1.226em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-409" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.417em; left: 0.781em;"><span class="mo" id="MathJax-Span-410" style="font-size: 70.7%; font-family: STIXMathJax_Main;">∗</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-411" style="font-family: STIXMathJax_Main;">(</span><span class="msup" id="MathJax-Span-412"><span style="display: inline-block; position: relative; width: 0.755em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.39em, 4.178em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-413" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.417em; left: 0.44em;"><span class="mo" id="MathJax-Span-414" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-415" style="font-family: STIXMathJax_Main;">,</span><span class="msup" id="MathJax-Span-416" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.817em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.47em, 4.177em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-417" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.417em; left: 0.502em;"><span class="mo" id="MathJax-Span-418" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-419" style="font-family: STIXMathJax_Main;">)</span><span class="mo" id="MathJax-Span-420" style="vertical-align: -0.201em;"><span style="font-family: STIXMathJax_Size1;">)</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.553em; border-left: 0px solid; width: 0px; height: 1.766em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msup><mi>Q</mi><mo>∗</mo></msup><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>=</mo><mi>r</mi><mo>+</mo><mi>γ</mi><mrow class="MJX-TeXAtom-ORD"><mtext>max</mtext></mrow><mrow><mo>(</mo><msup><mi>Q</mi><mo>∗</mo></msup><mo stretchy="false">(</mo><msup><mi>s</mi><mo>′</mo></msup><mo>,</mo><msup><mi>a</mi><mo>′</mo></msup><mo stretchy="false">)</mo><mo>)</mo></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-56">\begin{equation}
Q^*(s,a) = r + \gamma \textrm{max}\left( Q^*(s',a') \right)
\end{equation}</script></p>
<p>Less formal but more intuitive:
If we were at a certain fork in the maze (state <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-57-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-421" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.433em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.38em, 2.5em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-422"><span class="mi" id="MathJax-Span-423" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 0.739em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-57">s</script>) and want to know how good it was to choose the left path (perform action <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-58-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-424" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.46em, 2.499em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-425"><span class="mi" id="MathJax-Span-426" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.085em; border-left: 0px solid; width: 0px; height: 0.738em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-58">a</script>), we add the gold we found after going left (reward we received for performing action <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-59-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-427" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.46em, 2.499em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-428"><span class="mi" id="MathJax-Span-429" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.085em; border-left: 0px solid; width: 0px; height: 0.738em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-59">a</script>)
 and the amount of gold we expect to find down the road (maximum future 
discounted return). If you have to choose between finding a golden coin 
immediately after going left at a fork but nothing else down the road or
 finding nothing immediatley after going right but a treasure down the 
road, well, the right path is worth more/has a higher action-value.</p>
<p>This is the so-called <strong>Bellman equation</strong>. Deep Q-Learning uses a neural network to find an approximation <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-60-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-430" style="width: 4.927em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.734em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1003.69em, 2.829em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-431"><span class="mi" id="MathJax-Span-432" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span class="mo" id="MathJax-Span-433" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-434" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-435" style="font-family: STIXMathJax_Main;">,</span><span class="mi" id="MathJax-Span-436" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.188em;">𝑎</span><span class="mo" id="MathJax-Span-437" style="font-family: STIXMathJax_Main;">,</span><span class="mi" id="MathJax-Span-438" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.188em;">𝜃</span><span class="mo" id="MathJax-Span-439" style="font-family: STIXMathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.305em; border-left: 0px solid; width: 0px; height: 1.269em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>θ</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-60">Q(s,a,\theta)</script> of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-61-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-440" style="width: 4.332em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.247em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.631em, 1003.2em, 2.829em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-441"><span class="msubsup" id="MathJax-Span-442"><span style="display: inline-block; position: relative; width: 1.226em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-443" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.367em; left: 0.781em;"><span class="mo" id="MathJax-Span-444" style="font-size: 70.7%; font-family: STIXMathJax_Main;">∗</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-445" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-446" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-447" style="font-family: STIXMathJax_Main;">,</span><span class="mi" id="MathJax-Span-448" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.188em;">𝑎</span><span class="mo" id="MathJax-Span-449" style="font-family: STIXMathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.305em; border-left: 0px solid; width: 0px; height: 1.295em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>Q</mi><mo>∗</mo></msup><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-61">Q^*(s,a)</script>. <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-62-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-450" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.497em, 1000.48em, 2.5em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-451"><span class="mi" id="MathJax-Span-452" style="font-family: STIXMathJax_Normal; font-style: italic;">𝜃</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 1.039em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-62">\theta</script>
 are the parameters of the neural network. We will discuss later, how 
exactly the parameters of the network are updated. Now, I will explain 
to you, how the neural network maps a state <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-63-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-453" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.433em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.38em, 2.5em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-454"><span class="mi" id="MathJax-Span-455" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 0.739em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-63">s</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-64-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-456" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-457"><span class="mi" id="MathJax-Span-458" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-64">Q</script>-values for the possible actions <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-65-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-459" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.46em, 2.499em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-460"><span class="mi" id="MathJax-Span-461" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.085em; border-left: 0px solid; width: 0px; height: 0.738em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-65">a</script>.</p>
<p>Earlier I mentioned, that I regard a <em>sequence</em> as a <em>state</em>.
 What did I mean with that? Imagine you have a pin-sharp image of a 
flying soccer ball. Can you tell in which direction it moves? No, you 
cannot, but you could if there was some kind of motion blur in the 
picture or if you had several images taken quickly one after another 
showing the ball in a slightly different position every time. The same 
problem occurs in Atari games. From a single frame of the game <a href="https://gym.openai.com/envs/Pong-v0/" target="_blank">Pong</a>,
 the agent can not discern in which direction the ball moves. DeepMind 
met this problem by stacking several consecutive frames and considering 
this sequence a state that is passed to the neural network. From such a 
sequence the agent is able to detect the direction and speed of movement
 because the ball is in a different position in each frame.</p>
<blockquote>
<p>Since the agent only observes images of the current screen [...] it 
is impossible to fully understand the current situation from only the 
current screen <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-66-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-462" style="width: 1.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.866em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.507em, 1000.87em, 2.429em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-463"><span class="msubsup" id="MathJax-Span-464"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.51em, 4.176em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-465" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.55em;"><span class="mi" id="MathJax-Span-466" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑡</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.278em; border-left: 0px solid; width: 0px; height: 0.931em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mi>t</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-66">x_t</script>. We therefore consider sequences of actions and observations, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-67-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-467" style="width: 14.667em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.093em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.886em, 1011.09em, 2.831em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-468"><span class="msubsup" id="MathJax-Span-469"><span style="display: inline-block; position: relative; width: 0.736em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.39em, 4.178em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-470" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.44em;"><span class="mi" id="MathJax-Span-471" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑡</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-472" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="msubsup" id="MathJax-Span-473" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 0.979em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.51em, 4.176em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-474" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.55em;"><span class="mn" id="MathJax-Span-475" style="font-size: 70.7%; font-family: STIXMathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-476" style="font-family: STIXMathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-477" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.931em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.47em, 4.177em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-478" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.502em;"><span class="mn" id="MathJax-Span-479" style="font-size: 70.7%; font-family: STIXMathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-480" style="font-family: STIXMathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-481" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.979em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.51em, 4.176em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-482" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.55em;"><span class="mn" id="MathJax-Span-483" style="font-size: 70.7%; font-family: STIXMathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-484" style="font-family: STIXMathJax_Main;">,</span><span class="mo" id="MathJax-Span-485" style="font-family: STIXMathJax_Main; padding-left: 0.188em;">.</span><span class="mo" id="MathJax-Span-486" style="font-family: STIXMathJax_Main; padding-left: 0.188em;">.</span><span class="mo" id="MathJax-Span-487" style="font-family: STIXMathJax_Main; padding-left: 0.188em;">.</span><span class="mo" id="MathJax-Span-488" style="font-family: STIXMathJax_Main; padding-left: 0.188em;">,</span><span class="msubsup" id="MathJax-Span-489" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.636em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.47em, 4.177em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-490" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.502em;"><span class="texatom" id="MathJax-Span-491"><span class="mrow" id="MathJax-Span-492"><span class="mi" id="MathJax-Span-493" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑡</span><span class="mo" id="MathJax-Span-494" style="font-size: 70.7%; font-family: STIXMathJax_Main;">−</span><span class="mn" id="MathJax-Span-495" style="font-size: 70.7%; font-family: STIXMathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-496" style="font-family: STIXMathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-497" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.51em, 4.176em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-498" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.55em;"><span class="mi" id="MathJax-Span-499" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑡</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.308em; border-left: 0px solid; width: 0px; height: 0.961em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>s</mi><mi>t</mi></msub><mo>=</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>a</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>x</mi><mi>t</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-67">s_t = x_1, a_1, x_2, ..., a_{t−1}, x_t</script>,
 and learn game strategies that depend upon these sequences. All 
sequences in the emulator are assumed to terminate in a finite number of
 time-steps. This formalism gives rise to a large but finite Markov 
decision process (MDP) in which each sequence is a distinct state. (<a href="https://arxiv.org/abs/1312.5602" target="_blank">page 2 of Mnih et al. 2013</a>)</p>
</blockquote>
<p>You should defenitely understand what a <a href="https://en.wikipedia.org/wiki/Markov_decision_process" target="_blank">Markov decision process</a> and a <a href="https://en.wikipedia.org/wiki/Markov_chain" target="_blank">Markov chain
</a> is, they are fundamental to reinforcement learning. </p>
<p>On page 5 of <a href="https://arxiv.org/abs/1312.5602" target="_blank">Mnih et al. 2013</a> the authors explain the preprocessing of the frames:</p>
<blockquote>
<p>Working directly with raw Atari frames, which are 210 × 160 pixel 
images with a 128 color palette, can be computationally demanding, so we
 apply a basic preprocessing step aimed at reducing the input 
dimensionality. The raw frames are preprocessed by first converting 
their RGB representation to gray-scale and down-sampling it to a 110×84 
image. The final input representation is obtained by cropping an 84 × 84
 region of the image that roughly captures the playing area. The final 
cropping stage is only required because we use the GPU implementation of
 2D convolutions from [...], which expects square inputs. For the 
experiments in this paper, the function <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-68-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-500" style="width: 0.869em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.649em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.497em, 1000.62em, 2.672em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-501"><span class="mi" id="MathJax-Span-502" style="font-family: STIXMathJax_Normal; font-style: italic;">𝜙</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.313em; border-left: 0px solid; width: 0px; height: 1.266em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ϕ</mi></math></span></span><script type="math/tex" id="MathJax-Element-68">\phi</script> [...] applies this preprocessing to the last 4 frames of a history and stacks them to produce the input to the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-69-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-503" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-504"><span class="mi" id="MathJax-Span-505" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-69">Q</script>-function.</p>
</blockquote>
<p>So let us start by looking at how the preprocessing can be implemented. I used <code>gym</code> from OpenAi to provide the environment. A frame returned by the environment has the shape <code>(210,160,3)</code> where the 3 stands for the RGB color channels. Such a frame is passed to the Functor<code>FrameProcessor</code> which transforms it to a <code>(84,84,1)</code> frame, where the 1 indicates that instead of three RGB channels there is one grayscale channel. </p>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt_container"><div class="prompt input_prompt"><bdi>In</bdi>&nbsp;[&nbsp;]:</div><div class="run_this_cell" title="Run this cell"><i class="fa-step-forward fa"></i></div></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit code here"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59985px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 672.6px; margin-bottom: -12px; border-right-width: 18px; min-height: 198px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">Implementation of DeepMind's Deep Q-Learning by Fabio M. Graetz, 2018</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">If you have questions or suggestions, write me a mail fabiograetzatgooglemaildotcom</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-keyword">import</span> <span class="cm-variable">os</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-keyword">import</span> <span class="cm-variable">random</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-keyword">import</span> <span class="cm-variable">gym</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-keyword">import</span> <span class="cm-variable">tensorflow</span> <span class="cm-keyword">as</span> <span class="cm-variable">tf</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-keyword">import</span> <span class="cm-variable">numpy</span> <span class="cm-keyword">as</span> <span class="cm-variable">np</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-keyword">import</span> <span class="cm-variable">imageio</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-keyword">from</span> <span class="cm-variable">skimage</span>.<span class="cm-property">transform</span> <span class="cm-keyword">import</span> <span class="cm-variable">resize</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 198px;"></div><div class="CodeMirror-gutters" style="display: none; height: 216px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output"></div><div class="output"></div><div style="display: none;" class="btn btn-default output_collapsed" title="click to expand output">. . .</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt_container"><div class="prompt input_prompt"><bdi>In</bdi>&nbsp;[&nbsp;]:</div><div class="run_this_cell" title="Run this cell"><i class="fa-step-forward fa"></i></div></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit code here"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.6001px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 760.6px; margin-bottom: -12px; border-right-width: 18px; min-height: 453px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-keyword">class</span> <span class="cm-def">FrameProcessor</span>(<span class="cm-builtin">object</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-string">"""Resizes and converts RGB Atari frames to grayscale"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-keyword">def</span> <span class="cm-def">__init__</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">frame_height</span><span class="cm-operator">=</span><span class="cm-number">84</span>, <span class="cm-variable">frame_width</span><span class="cm-operator">=</span><span class="cm-number">84</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        Args:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            frame_height: Integer, Height of a frame of an Atari game</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            frame_width: Integer, Width of a frame of an Atari game</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        """</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">frame_height</span> <span class="cm-operator">=</span> <span class="cm-variable">frame_height</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">frame_width</span> <span class="cm-operator">=</span> <span class="cm-variable">frame_width</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">frame</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">placeholder</span>(<span class="cm-variable">shape</span><span class="cm-operator">=</span>[<span class="cm-number">210</span>, <span class="cm-number">160</span>, <span class="cm-number">3</span>], <span class="cm-variable">dtype</span><span class="cm-operator">=</span><span class="cm-variable">tf</span>.<span class="cm-property">uint8</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">processed</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">image</span>.<span class="cm-property">rgb_to_grayscale</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">frame</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">processed</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">image</span>.<span class="cm-property">crop_to_bounding_box</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">processed</span>, <span class="cm-number">34</span>, <span class="cm-number">0</span>, <span class="cm-number">160</span>, <span class="cm-number">160</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">processed</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">image</span>.<span class="cm-property">resize_images</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">processed</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                                [<span class="cm-variable-2">self</span>.<span class="cm-property">frame_height</span>, <span class="cm-variable-2">self</span>.<span class="cm-property">frame_width</span>], </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                                <span class="cm-variable">method</span><span class="cm-operator">=</span><span class="cm-variable">tf</span>.<span class="cm-property">image</span>.<span class="cm-property">ResizeMethod</span>.<span class="cm-property">NEAREST_NEIGHBOR</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-keyword">def</span> <span class="cm-def">__call__</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">session</span>, <span class="cm-variable">frame</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        Args:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            session: A Tensorflow session object</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            frame: A (210, 160, 3) frame of an Atari game in RGB</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        Returns:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            A processed (84, 84, 1) frame in grayscale</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        """</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">return</span> <span class="cm-variable">session</span>.<span class="cm-property">run</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">processed</span>, <span class="cm-variable">feed_dict</span><span class="cm-operator">=</span>{<span class="cm-variable-2">self</span>.<span class="cm-property">frame</span>:<span class="cm-variable">frame</span>})</span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 453px;"></div><div class="CodeMirror-gutters" style="display: none; height: 471px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output"></div><div class="output"></div><div style="display: none;" class="btn btn-default output_collapsed" title="click to expand output">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit Markup Text here"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.6001px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -12px; border-right-width: 18px; min-height: 1680px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 20px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-header cm-header-2">## 3. Dueling Networks</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Instead of the network architecture described in <span class="cm-link">[Mnih et al. 2013]</span><span class="cm-string cm-url">(https://arxiv.org/abs/1312.5602)</span> or <span class="cm-link">[Mnih et al. 2015]</span><span class="cm-string cm-url">(https://www.nature.com/articles/nature14236/)</span> I used the dueling network architecture described in <span class="cm-link">[Wang et al. 2016]</span><span class="cm-string cm-url">(https://arxiv.org/abs/1511.06581)</span>.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-image cm-image-marker">!</span><span class="cm-image cm-image-alt-text cm-link">[]</span><span class="cm-string cm-url">(pictures/dueling.png "Figure 1 in Wang et al. 2016")</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Both the <span class="cm-link">[Mnih et al. 2015]</span><span class="cm-string cm-url">(https://www.nature.com/articles/nature14236/)</span> and the <span class="cm-link">[Wang et al. 2016]</span><span class="cm-string cm-url">(https://arxiv.org/abs/1511.06581)</span> dueling architecture have the same low-level convolutional structure:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-quote cm-quote-1">&gt;The first convolutional layer has 32 8x8 filters with stride 4, the second 64 4x4 filters with stride 2, and the third and final convolutional layer consists 64 3x3 filters with stride 1.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">In the normal DQN architecture (top network in the figure) the <span class="cm-em">*final hidden layer is fully-connected and consists of 512 rectifier units. The output layer is a fully-connected linear layer with a single output for each valid action.*</span> (see page 6 of <span class="cm-link">[Mnih et al. 2015]</span><span class="cm-string cm-url">(https://www.nature.com/articles/nature14236/)</span>) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">These outputs are the predicted <span class="cm-delimit cm-delimit-open">$</span>Q(s,a;<span class="cm-tag">\theta</span>)<span class="cm-delimit cm-delimit-close">$</span>-values for action <span class="cm-delimit cm-delimit-open">$</span>a<span class="cm-delimit cm-delimit-close">$</span> in state <span class="cm-delimit cm-delimit-open">$</span>s<span class="cm-delimit cm-delimit-close">$</span>.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Instead of directly predicting a single <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-value for each action, the dueling architecture splits the final convolutional layer into two streams that represent the value and advantage functions that predict a <span class="cm-em">*state value*</span> <span class="cm-delimit cm-delimit-open">$</span>V(s)<span class="cm-delimit cm-delimit-close">$</span> that depends only on the state, and <span class="cm-em">*action advantages*</span> <span class="cm-delimit cm-delimit-open">$</span>A(s,a)<span class="cm-delimit cm-delimit-close">$</span> that depend on the state and the respective action. On page 2 of <span class="cm-link">[Wang et al. 2016]</span><span class="cm-string cm-url">(https://arxiv.org/abs/1511.06581)</span> the authors explain:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-quote cm-quote-1">&gt;Intuitively, the dueling architecture can learn which states are (or are not) valuable, without having to learn the effect of each action for each state. This is particularly useful in states where its actions do not affect the environment in any relevant way. </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-quote cm-quote-1">In the experiments, we demonstrate that the dueling architecture can more quickly identify the correct action during policy evaluation as redundant or similar actions are added to the learning problem. </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">The <span class="cm-em">*state value*</span> <span class="cm-delimit cm-delimit-open">$</span>V(s)<span class="cm-delimit cm-delimit-close">$</span> predicts <span class="cm-em">*how good it is to be in a certain state*</span> <span class="cm-delimit cm-delimit-open">$</span>s<span class="cm-delimit cm-delimit-close">$</span> and the <span class="cm-em">*action advantage*</span> <span class="cm-delimit cm-delimit-open">$</span>A(s,a)<span class="cm-delimit cm-delimit-close">$</span> predicts <span class="cm-em">*how good it is to perform action </span><span class="cm-delimit cm-delimit-open">$</span>a<span class="cm-delimit cm-delimit-close">$</span><span class="cm-em"> in state </span><span class="cm-delimit cm-delimit-open">$</span>s<span class="cm-delimit cm-delimit-close">$</span><span class="cm-em">*</span>.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">I suggest you take a look at figure 2 in <span class="cm-link">[Wang et al. 2016]</span><span class="cm-string cm-url">(https://arxiv.org/abs/1511.06581)</span> to better understand what the value- and advantage-stream learn to look at.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Next, we have to combine the value and advantage stream into <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-values <span class="cm-delimit cm-delimit-open">$</span>Q(s,a)<span class="cm-delimit cm-delimit-close">$</span>. This is done the following way (equation 9 in <span class="cm-link">[Wang et al. 2016]</span><span class="cm-string cm-url">(https://arxiv.org/abs/1511.06581)</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">\begin{equation}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Q(s,a) = V(s) + \left(A(s,a) - \frac 1{| \mathcal A |}\sum_{a'}A(s, a')\right)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">\end{equation}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Why so complicated instead of just adding <span class="cm-delimit cm-delimit-open">$</span>V(s)<span class="cm-delimit cm-delimit-close">$</span> and <span class="cm-delimit cm-delimit-open">$</span>A(s,a)<span class="cm-delimit cm-delimit-close">$</span>? Let's assume <span class="cm-delimit cm-delimit-open">$</span>Q(s,a) = V(s) + A(s,a)<span class="cm-delimit cm-delimit-close">$</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"> The Q function measures the value of choosing a particular action when in a particular state. The value function <span class="cm-delimit cm-delimit-open">$</span>V<span class="cm-delimit cm-delimit-close">$</span>, which is the expected value of <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span> over all possible actions, <span class="cm-delimit cm-delimit-open">$</span>V = E(Q)<span class="cm-delimit cm-delimit-close">$</span>, measures how good it is to be in this particular state. </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">If you combine <span class="cm-delimit cm-delimit-open">$</span>E(Q) = V<span class="cm-delimit cm-delimit-close">$</span> and <span class="cm-delimit cm-delimit-open">$</span>Q = V + A<span class="cm-delimit cm-delimit-close">$</span>, you find <span class="cm-delimit cm-delimit-open">$</span>E(Q) = E(V) + E(A)<span class="cm-delimit cm-delimit-close">$</span>. But <span class="cm-delimit cm-delimit-open">$</span>V<span class="cm-delimit cm-delimit-close">$</span> does not depend on any action, which means <span class="cm-delimit cm-delimit-open">$</span>E(V)=V<span class="cm-delimit cm-delimit-close">$</span>, <span class="cm-delimit cm-delimit-open">$</span>E(Q) = V + E(A) = V<span class="cm-delimit cm-delimit-close">$</span> and thus <span class="cm-delimit cm-delimit-open">$</span>E(A)=0<span class="cm-delimit cm-delimit-close">$</span>. The expected value of the advantage <span class="cm-delimit cm-delimit-open">$</span>A(s,a')<span class="cm-delimit cm-delimit-close">$</span> over all possible actions <span class="cm-delimit cm-delimit-open">$</span>a'<span class="cm-delimit cm-delimit-close">$</span> has to be zero. The expected value of the expression in parentheses is zero because we subtract the mean of the advantages from every advantage:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">\begin{equation}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">E\left(A(s,a) - \frac 1{| \mathcal A |}\sum_{a'}A(s, a')\right) = E\Bigl(A - E(A)\Bigr) = E(A)- E(E(A)) = E(A) - E(A) = 0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">\end{equation}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">In the cell below you find the code that implements this architecture in tensorflow. Some things to keep in mind: You should normalize the input pixel values to <span class="cm-link">[0,1]</span> by dividing the input with 0xFF=255. The reason for this is, that the pixel values of the frames, the environment returns, are uint8 which can store values in the range <span class="cm-link">[0,255]</span>. </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-strong">**Furthermore, make sure you initialize the weights properly! </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-strong">The DQN uses the Relu activation function and the right initializer is </span><span class="cm-strong cm-link">[He et al. 2015 equation 10]</span><span class="cm-string cm-url">(https://arxiv.org/pdf/1502.01852v1.pdf)</span><span class="cm-strong"> (</span><span class="cm-strong cm-link">[click here for a detailed explanation]</span><span class="cm-string cm-url">(https://www.youtube.com/watch?v=s2coXdufOzE&amp;t=157s )</span><span class="cm-strong">).</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-strong">In tensorflow use </span><span class="cm-strong cm-comment">`tf.variance_scaling_initializer`</span><span class="cm-strong"> </span><span class="cm-strong cm-link">[(documentation)]</span><span class="cm-string cm-url">(https://www.tensorflow.org/api_docs/python/tf/variance_scaling_initializer)</span><span class="cm-strong"> with </span><span class="cm-strong cm-comment">`scale = 2`</span><span class="cm-strong">.**</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">DeepMind used an implementation of the RMSProp optimizer that is different to the one in tensorflow (see page 23, eq 40 in <span class="cm-link">[Graves 2014]</span><span class="cm-string cm-url">(https://arxiv.org/pdf/1308.0850v5.pdf)</span>). Before implementing it myself, I tried the Adam optimizer which gave promising results without much hyperparameter-search. Adam was not invented when <span class="cm-link">[Mnih et al. 2013]</span><span class="cm-string cm-url">(https://arxiv.org/abs/1312.5602)</span> was published, so one could argue that they might have used it instead of RMSProp if it had been invented earlier. On the other hand, the authors of this <span class="cm-link">[blog post]</span><span class="cm-string cm-url">(https://blog.paperspace.com/intro-to-optimization-momentum-rmsprop-adam/)</span> compare <span class="cm-em">*Momentum, RMSProp and Adam*</span> and argue:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-quote cm-quote-1">&gt;Out of the above three, you may find momentum to be the most prevalent, despite Adam looking the most promising on paper. Empirical results have shown that all these algorithms can converge to different optimal local minima given the same loss. However, SGD with momentum seems to find more flatter minima than Adam, while adaptive methods tend to converge quickly towards sharper minima. Flatter minima generalize better than sharper ones.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Maybe some of these differences might be mitigated by the use of <span class="cm-em">*AdamW*</span>, which I described <span class="cm-link">[in this blog post]</span><span class="cm-string cm-url">(https://medium.com/@fabiograetz/why-adamw-matters-736223f31b5d)</span> (irrelevant for DQN since no regularization is used). For now, I stick with Adam and if I find some time in the future, I might come back to this since it might be well worth spending some time on playing with different optimizers and implementing the version of RMSProp used by DeepMind. </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-em">*Edit*</span>: In a later DeepMind paper called "Rainbow: Combining Improvements in Deep Reinforcement Learning" by <span class="cm-link">[Hessel et al. 2017]</span><span class="cm-string cm-url">(https://arxiv.org/abs/1710.02298)</span> RMSProp was substituted for Adam with a learning rate of 0.0000625 (see Table 1). This learning rate is close to what I found working well for Breakout (0.00001) before reading Hessel et al. 2017.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">If you compare the dueling architecture described above to the network implemented in the next cell, you will find a small difference. Instead of two hidden fully connected layers with 512 rectifier units for each, the value and the advantage stream, I ended up adding a fourth convolutional layer with 1024 filters. The output has the shape (1, 1, 1024) and is then split into two streams with shapes (1, 1, 512). This architecture is suggested <span class="cm-link">[here]</span><span class="cm-string cm-url">(https://github.com/awjuliani/DeepRL-Agents/blob/master/Double-Dueling-DQN.ipynb)</span> and after performing some tests on the environment Pong, which is comparably easy to learn for a DQN agent, I find that this small adjustment lets the reward increase slightly earlier and higher.</span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 1680px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1698px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><h2 id="3.-Dueling-Networks">3. Dueling Networks<a class="anchor-link" href="#3.-Dueling-Networks">¶</a></h2>
<p>Instead of the network architecture described in <a href="https://arxiv.org/abs/1312.5602" target="_blank">Mnih et al. 2013</a> or <a href="https://www.nature.com/articles/nature14236/" target="_blank">Mnih et al. 2015</a> I used the dueling network architecture described in <a href="https://arxiv.org/abs/1511.06581" target="_blank">Wang et al. 2016</a>.</p>
<p><img src="DQN%20-%20Jupyter%20Notebook_files/dueling.png" alt="" title="Figure 1 in Wang et al. 2016"></p>
<p>Both the <a href="https://www.nature.com/articles/nature14236/" target="_blank">Mnih et al. 2015</a> and the <a href="https://arxiv.org/abs/1511.06581" target="_blank">Wang et al. 2016</a> dueling architecture have the same low-level convolutional structure:</p>
<blockquote>
<p>The first convolutional layer has 32 8x8 filters with stride 4, the 
second 64 4x4 filters with stride 2, and the third and final 
convolutional layer consists 64 3x3 filters with stride 1.</p>
</blockquote>
<p>In the normal DQN architecture (top network in the figure) the <em>final
 hidden layer is fully-connected and consists of 512 rectifier units. 
The output layer is a fully-connected linear layer with a single output 
for each valid action.</em> (see page 6 of <a href="https://www.nature.com/articles/nature14236/" target="_blank">Mnih et al. 2015</a>) </p>
<p>These outputs are the predicted <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-70-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-506" style="width: 4.927em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.734em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1003.69em, 2.829em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-507"><span class="mi" id="MathJax-Span-508" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span class="mo" id="MathJax-Span-509" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-510" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-511" style="font-family: STIXMathJax_Main;">,</span><span class="mi" id="MathJax-Span-512" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.188em;">𝑎</span><span class="mo" id="MathJax-Span-513" style="font-family: STIXMathJax_Main;">;</span><span class="mi" id="MathJax-Span-514" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.188em;">𝜃</span><span class="mo" id="MathJax-Span-515" style="font-family: STIXMathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.305em; border-left: 0px solid; width: 0px; height: 1.269em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mo>;</mo><mi>θ</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-70">Q(s,a;\theta)</script>-values for action <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-71-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-516" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.46em, 2.499em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-517"><span class="mi" id="MathJax-Span-518" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.085em; border-left: 0px solid; width: 0px; height: 0.738em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-71">a</script> in state <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-72-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-519" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.433em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.38em, 2.5em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-520"><span class="mi" id="MathJax-Span-521" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 0.739em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-72">s</script>.</p>
<p>Instead of directly predicting a single <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-73-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-522" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-523"><span class="mi" id="MathJax-Span-524" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-73">Q</script>-value
 for each action, the dueling architecture splits the final 
convolutional layer into two streams that represent the value and 
advantage functions that predict a <em>state value</em> <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-74-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-525" style="width: 2.438em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.84em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1001.79em, 2.829em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-526"><span class="mi" id="MathJax-Span-527" style="font-family: STIXMathJax_Normal; font-style: italic; text-rendering: optimizelegibility;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.185em;"></span></span><span class="mo" id="MathJax-Span-528" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-529" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-530" style="font-family: STIXMathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.305em; border-left: 0px solid; width: 0px; height: 1.269em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>V</mi><mo stretchy="false">(</mo><mi>s</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-74">V(s)</script> that depends only on the state, and <em>action advantages</em> <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-75-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-531" style="width: 3.574em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.706em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1002.66em, 2.829em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-532"><span class="mi" id="MathJax-Span-533" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐴</span><span class="mo" id="MathJax-Span-534" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-535" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-536" style="font-family: STIXMathJax_Main;">,</span><span class="mi" id="MathJax-Span-537" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.188em;">𝑎</span><span class="mo" id="MathJax-Span-538" style="font-family: STIXMathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.305em; border-left: 0px solid; width: 0px; height: 1.269em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-75">A(s,a)</script> that depend on the state and the respective action. On page 2 of <a href="https://arxiv.org/abs/1511.06581" target="_blank">Wang et al. 2016</a> the authors explain:</p>
<blockquote>
<p>Intuitively, the dueling architecture can learn which states are (or 
are not) valuable, without having to learn the effect of each action for
 each state. This is particularly useful in states where its actions do 
not affect the environment in any relevant way. 
In the experiments, we demonstrate that the dueling architecture can 
more quickly identify the correct action during policy evaluation as 
redundant or similar actions are added to the learning problem. </p>
</blockquote>
<p>The <em>state value</em> <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-76-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-539" style="width: 2.438em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.84em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1001.79em, 2.829em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-540"><span class="mi" id="MathJax-Span-541" style="font-family: STIXMathJax_Normal; font-style: italic; text-rendering: optimizelegibility;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.185em;"></span></span><span class="mo" id="MathJax-Span-542" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-543" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-544" style="font-family: STIXMathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.305em; border-left: 0px solid; width: 0px; height: 1.269em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>V</mi><mo stretchy="false">(</mo><mi>s</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-76">V(s)</script> predicts <em>how good it is to be in a certain state</em> <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-77-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-545" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.433em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.38em, 2.5em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-546"><span class="mi" id="MathJax-Span-547" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 0.739em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-77">s</script> and the <em>action advantage</em> <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-78-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-548" style="width: 3.574em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.706em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1002.66em, 2.829em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-549"><span class="mi" id="MathJax-Span-550" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐴</span><span class="mo" id="MathJax-Span-551" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-552" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-553" style="font-family: STIXMathJax_Main;">,</span><span class="mi" id="MathJax-Span-554" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.188em;">𝑎</span><span class="mo" id="MathJax-Span-555" style="font-family: STIXMathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.305em; border-left: 0px solid; width: 0px; height: 1.269em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-78">A(s,a)</script> predicts <em>how good it is to perform action <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-79-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-556" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.46em, 2.499em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-557"><span class="mi" id="MathJax-Span-558" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.085em; border-left: 0px solid; width: 0px; height: 0.738em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-79">a</script> in state <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-80-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-559" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.433em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.38em, 2.5em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-560"><span class="mi" id="MathJax-Span-561" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 0.739em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-80">s</script></em>.
I suggest you take a look at figure 2 in <a href="https://arxiv.org/abs/1511.06581" target="_blank">Wang et al. 2016</a> to better understand what the value- and advantage-stream learn to look at.</p>
<p>Next, we have to combine the value and advantage stream into <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-81-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-562" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-563"><span class="mi" id="MathJax-Span-564" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-81">Q</script>-values <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-82-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-565" style="width: 3.682em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.76em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1002.71em, 2.829em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-566"><span class="mi" id="MathJax-Span-567" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span class="mo" id="MathJax-Span-568" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-569" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-570" style="font-family: STIXMathJax_Main;">,</span><span class="mi" id="MathJax-Span-571" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.188em;">𝑎</span><span class="mo" id="MathJax-Span-572" style="font-family: STIXMathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.305em; border-left: 0px solid; width: 0px; height: 1.269em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-82">Q(s,a)</script>. This is done the following way (equation 9 in <a href="https://arxiv.org/abs/1511.06581" target="_blank">Wang et al. 2016</a>):</p>
<p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-83-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-573" style="width: 25.544em; display: inline-block;"><span style="display: inline-block; position: relative; width: 19.318em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(2.163em, 1019.19em, 5.584em, -1000em); top: -4.113em; left: 0em;"><span class="mrow" id="MathJax-Span-574"><span class="mi" id="MathJax-Span-575" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span class="mo" id="MathJax-Span-576" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-577" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-578" style="font-family: STIXMathJax_Main;">,</span><span class="mi" id="MathJax-Span-579" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.188em;">𝑎</span><span class="mo" id="MathJax-Span-580" style="font-family: STIXMathJax_Main;">)</span><span class="mo" id="MathJax-Span-581" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-582" style="font-family: STIXMathJax_Normal; font-style: italic; text-rendering: optimizelegibility; padding-left: 0.313em;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.185em;"></span></span><span class="mo" id="MathJax-Span-583" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-584" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-585" style="font-family: STIXMathJax_Main;">)</span><span class="mo" id="MathJax-Span-586" style="font-family: STIXMathJax_Main; padding-left: 0.25em;">+</span><span class="mrow" id="MathJax-Span-587" style="padding-left: 0.25em;"><span class="mo" id="MathJax-Span-588" style="vertical-align: -0.778em;"><span style="font-family: STIXMathJax_Size4;">(</span></span><span class="mi" id="MathJax-Span-589" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐴</span><span class="mo" id="MathJax-Span-590" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-591" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-592" style="font-family: STIXMathJax_Main;">,</span><span class="mi" id="MathJax-Span-593" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.188em;">𝑎</span><span class="mo" id="MathJax-Span-594" style="font-family: STIXMathJax_Main;">)</span><span class="mo" id="MathJax-Span-595" style="font-family: STIXMathJax_Main; padding-left: 0.25em;">−</span><span class="mfrac" id="MathJax-Span-596" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 1.612em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.166em, 1000.39em, 4.167em, -1000em); top: -4.681em; left: 50%; margin-left: -0.25em;"><span class="mn" id="MathJax-Span-597" style="font-family: STIXMathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; clip: rect(3.152em, 1001.37em, 4.356em, -1000em); top: -3.318em; left: 50%; margin-left: -0.746em;"><span class="mrow" id="MathJax-Span-598"><span class="texatom" id="MathJax-Span-599"><span class="mrow" id="MathJax-Span-600"><span class="mo" id="MathJax-Span-601" style="font-family: STIXMathJax_Variants;">|</span></span></span><span class="texatom" id="MathJax-Span-602"><span class="mrow" id="MathJax-Span-603"><span class="mi" id="MathJax-Span-604" style="font-family: STIXMathJax_Variants; font-style: italic;"></span></span></span><span class="texatom" id="MathJax-Span-605"><span class="mrow" id="MathJax-Span-606"><span class="mo" id="MathJax-Span-607" style="font-family: STIXMathJax_Variants;">|</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; clip: rect(0.852em, 1001.61em, 1.245em, -1000em); top: -1.302em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.612em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.082em;"></span></span></span></span><span class="munderover" id="MathJax-Span-608" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.292em; height: 0px;"><span style="position: absolute; clip: rect(2.867em, 1001.2em, 4.642em, -1000em); top: -4.004em; left: 0em;"><span class="mo" id="MathJax-Span-609" style="font-family: STIXMathJax_Size1; vertical-align: -0.524em;">∑</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; clip: rect(3.303em, 1000.58em, 4.274em, -1000em); top: -2.803em; left: 0.357em;"><span class="texatom" id="MathJax-Span-610"><span class="mrow" id="MathJax-Span-611"><span class="msup" id="MathJax-Span-612"><span style="display: inline-block; position: relative; width: 0.578em; height: 0px;"><span style="position: absolute; clip: rect(3.53em, 1000.33em, 4.174em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-613" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.261em; left: 0.355em;"><span class="mo" id="MathJax-Span-614" style="font-size: 50%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mi" id="MathJax-Span-615" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.188em;">𝐴</span><span class="mo" id="MathJax-Span-616" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-617" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-618" style="font-family: STIXMathJax_Main;">,</span><span class="msup" id="MathJax-Span-619" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.817em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.47em, 4.177em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-620" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.417em; left: 0.502em;"><span class="mo" id="MathJax-Span-621" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-622" style="font-family: STIXMathJax_Main;">)</span><span class="mo" id="MathJax-Span-623" style="vertical-align: -0.778em;"><span style="font-family: STIXMathJax_Size4;">)</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.799em; border-left: 0px solid; width: 0px; height: 4.23em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>Q</mi><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>=</mo><mi>V</mi><mo stretchy="false">(</mo><mi>s</mi><mo stretchy="false">)</mo><mo>+</mo><mrow><mo>(</mo><mi>A</mi><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>−</mo><mfrac><mn>1</mn><mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">A</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow></mrow></mfrac><munder><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><msup><mi>a</mi><mo>′</mo></msup></mrow></munder><mi>A</mi><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><msup><mi>a</mi><mo>′</mo></msup><mo stretchy="false">)</mo><mo>)</mo></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-83">\begin{equation}
Q(s,a) = V(s) + \left(A(s,a) - \frac 1{| \mathcal A |}\sum_{a'}A(s, a')\right)
\end{equation}</script></p>
<p>Why so complicated instead of just adding <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-84-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-624" style="width: 2.438em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.84em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1001.79em, 2.829em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-625"><span class="mi" id="MathJax-Span-626" style="font-family: STIXMathJax_Normal; font-style: italic; text-rendering: optimizelegibility;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.185em;"></span></span><span class="mo" id="MathJax-Span-627" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-628" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-629" style="font-family: STIXMathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.305em; border-left: 0px solid; width: 0px; height: 1.269em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>V</mi><mo stretchy="false">(</mo><mi>s</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-84">V(s)</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-85-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-630" style="width: 3.574em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.706em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1002.66em, 2.829em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-631"><span class="mi" id="MathJax-Span-632" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐴</span><span class="mo" id="MathJax-Span-633" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-634" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-635" style="font-family: STIXMathJax_Main;">,</span><span class="mi" id="MathJax-Span-636" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.188em;">𝑎</span><span class="mo" id="MathJax-Span-637" style="font-family: STIXMathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.305em; border-left: 0px solid; width: 0px; height: 1.269em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-85">A(s,a)</script>? Let's assume <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-86-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-638" style="width: 13.098em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.903em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1009.86em, 2.829em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-639"><span class="mi" id="MathJax-Span-640" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span class="mo" id="MathJax-Span-641" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-642" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-643" style="font-family: STIXMathJax_Main;">,</span><span class="mi" id="MathJax-Span-644" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.188em;">𝑎</span><span class="mo" id="MathJax-Span-645" style="font-family: STIXMathJax_Main;">)</span><span class="mo" id="MathJax-Span-646" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-647" style="font-family: STIXMathJax_Normal; font-style: italic; text-rendering: optimizelegibility; padding-left: 0.313em;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.185em;"></span></span><span class="mo" id="MathJax-Span-648" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-649" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-650" style="font-family: STIXMathJax_Main;">)</span><span class="mo" id="MathJax-Span-651" style="font-family: STIXMathJax_Main; padding-left: 0.25em;">+</span><span class="mi" id="MathJax-Span-652" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.25em;">𝐴</span><span class="mo" id="MathJax-Span-653" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-654" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-655" style="font-family: STIXMathJax_Main;">,</span><span class="mi" id="MathJax-Span-656" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.188em;">𝑎</span><span class="mo" id="MathJax-Span-657" style="font-family: STIXMathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.305em; border-left: 0px solid; width: 0px; height: 1.269em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>=</mo><mi>V</mi><mo stretchy="false">(</mo><mi>s</mi><mo stretchy="false">)</mo><mo>+</mo><mi>A</mi><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-86">Q(s,a) = V(s) + A(s,a)</script>:</p>
<p> The Q function measures the value of choosing a particular action when in a particular state. The value function <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-87-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-658" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.512em, 1000.76em, 2.505em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-659"><span class="mi" id="MathJax-Span-660" style="font-family: STIXMathJax_Normal; font-style: italic; text-rendering: optimizelegibility;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.185em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.093em; border-left: 0px solid; width: 0px; height: 1.026em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>V</mi></math></span></span><script type="math/tex" id="MathJax-Element-87">V</script>, which is the expected value of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-88-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-661" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-662"><span class="mi" id="MathJax-Span-663" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-88">Q</script> over all possible actions, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-89-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-664" style="width: 5.576em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.221em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1004.17em, 2.829em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-665"><span class="mi" id="MathJax-Span-666" style="font-family: STIXMathJax_Normal; font-style: italic; text-rendering: optimizelegibility;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.185em;"></span></span><span class="mo" id="MathJax-Span-667" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-668" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.313em;">𝐸<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.02em;"></span></span><span class="mo" id="MathJax-Span-669" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-670" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span class="mo" id="MathJax-Span-671" style="font-family: STIXMathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.305em; border-left: 0px solid; width: 0px; height: 1.269em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>V</mi><mo>=</mo><mi>E</mi><mo stretchy="false">(</mo><mi>Q</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-89">V = E(Q)</script>, measures how good it is to be in this particular state. </p>
<p>If you combine <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-90-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-672" style="width: 5.576em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.221em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1004.22em, 2.829em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-673"><span class="mi" id="MathJax-Span-674" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐸<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.02em;"></span></span><span class="mo" id="MathJax-Span-675" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-676" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span class="mo" id="MathJax-Span-677" style="font-family: STIXMathJax_Main;">)</span><span class="mo" id="MathJax-Span-678" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-679" style="font-family: STIXMathJax_Normal; font-style: italic; text-rendering: optimizelegibility; padding-left: 0.313em;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.185em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.305em; border-left: 0px solid; width: 0px; height: 1.269em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>E</mi><mo stretchy="false">(</mo><mi>Q</mi><mo stretchy="false">)</mo><mo>=</mo><mi>V</mi></math></span></span><script type="math/tex" id="MathJax-Element-90">E(Q) = V</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-91-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-680" style="width: 6.28em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.762em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.66em, 1004.73em, 2.804em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-681"><span class="mi" id="MathJax-Span-682" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span class="mo" id="MathJax-Span-683" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-684" style="font-family: STIXMathJax_Normal; font-style: italic; text-rendering: optimizelegibility; padding-left: 0.313em;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.185em;"></span></span><span class="mo" id="MathJax-Span-685" style="font-family: STIXMathJax_Main; padding-left: 0.25em;">+</span><span class="mi" id="MathJax-Span-686" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.25em;">𝐴</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi><mo>=</mo><mi>V</mi><mo>+</mo><mi>A</mi></math></span></span><script type="math/tex" id="MathJax-Element-91">Q = V + A</script>, you find <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-92-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-687" style="width: 11.745em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.874em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1008.83em, 2.829em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-688"><span class="mi" id="MathJax-Span-689" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐸<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.02em;"></span></span><span class="mo" id="MathJax-Span-690" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-691" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span class="mo" id="MathJax-Span-692" style="font-family: STIXMathJax_Main;">)</span><span class="mo" id="MathJax-Span-693" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-694" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.313em;">𝐸<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.02em;"></span></span><span class="mo" id="MathJax-Span-695" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-696" style="font-family: STIXMathJax_Normal; font-style: italic; text-rendering: optimizelegibility;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.185em;"></span></span><span class="mo" id="MathJax-Span-697" style="font-family: STIXMathJax_Main;">)</span><span class="mo" id="MathJax-Span-698" style="font-family: STIXMathJax_Main; padding-left: 0.25em;">+</span><span class="mi" id="MathJax-Span-699" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.25em;">𝐸<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.02em;"></span></span><span class="mo" id="MathJax-Span-700" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-701" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐴</span><span class="mo" id="MathJax-Span-702" style="font-family: STIXMathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.305em; border-left: 0px solid; width: 0px; height: 1.269em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>E</mi><mo stretchy="false">(</mo><mi>Q</mi><mo stretchy="false">)</mo><mo>=</mo><mi>E</mi><mo stretchy="false">(</mo><mi>V</mi><mo stretchy="false">)</mo><mo>+</mo><mi>E</mi><mo stretchy="false">(</mo><mi>A</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-92">E(Q) = E(V) + E(A)</script>. But <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-93-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-703" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.512em, 1000.76em, 2.505em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-704"><span class="mi" id="MathJax-Span-705" style="font-family: STIXMathJax_Normal; font-style: italic; text-rendering: optimizelegibility;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.185em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.093em; border-left: 0px solid; width: 0px; height: 1.026em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>V</mi></math></span></span><script type="math/tex" id="MathJax-Element-93">V</script> does not depend on any action, which means <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-94-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-706" style="width: 5.685em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.275em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1004.28em, 2.829em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-707"><span class="mi" id="MathJax-Span-708" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐸<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.02em;"></span></span><span class="mo" id="MathJax-Span-709" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-710" style="font-family: STIXMathJax_Normal; font-style: italic; text-rendering: optimizelegibility;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.185em;"></span></span><span class="mo" id="MathJax-Span-711" style="font-family: STIXMathJax_Main;">)</span><span class="mo" id="MathJax-Span-712" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-713" style="font-family: STIXMathJax_Normal; font-style: italic; text-rendering: optimizelegibility; padding-left: 0.313em;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.185em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.305em; border-left: 0px solid; width: 0px; height: 1.269em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>E</mi><mo stretchy="false">(</mo><mi>V</mi><mo stretchy="false">)</mo><mo>=</mo><mi>V</mi></math></span></span><script type="math/tex" id="MathJax-Element-94">E(V)=V</script>, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-95-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-714" style="width: 12.719em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.632em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1009.63em, 2.829em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-715"><span class="mi" id="MathJax-Span-716" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐸<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.02em;"></span></span><span class="mo" id="MathJax-Span-717" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-718" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span class="mo" id="MathJax-Span-719" style="font-family: STIXMathJax_Main;">)</span><span class="mo" id="MathJax-Span-720" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-721" style="font-family: STIXMathJax_Normal; font-style: italic; text-rendering: optimizelegibility; padding-left: 0.313em;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.185em;"></span></span><span class="mo" id="MathJax-Span-722" style="font-family: STIXMathJax_Main; padding-left: 0.25em;">+</span><span class="mi" id="MathJax-Span-723" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.25em;">𝐸<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.02em;"></span></span><span class="mo" id="MathJax-Span-724" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-725" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐴</span><span class="mo" id="MathJax-Span-726" style="font-family: STIXMathJax_Main;">)</span><span class="mo" id="MathJax-Span-727" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-728" style="font-family: STIXMathJax_Normal; font-style: italic; text-rendering: optimizelegibility; padding-left: 0.313em;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.185em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.305em; border-left: 0px solid; width: 0px; height: 1.269em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>E</mi><mo stretchy="false">(</mo><mi>Q</mi><mo stretchy="false">)</mo><mo>=</mo><mi>V</mi><mo>+</mo><mi>E</mi><mo stretchy="false">(</mo><mi>A</mi><mo stretchy="false">)</mo><mo>=</mo><mi>V</mi></math></span></span><script type="math/tex" id="MathJax-Element-95">E(Q) = V + E(A) = V</script> and thus <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-96-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-729" style="width: 5.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.896em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1003.87em, 2.829em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-730"><span class="mi" id="MathJax-Span-731" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐸<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.02em;"></span></span><span class="mo" id="MathJax-Span-732" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-733" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐴</span><span class="mo" id="MathJax-Span-734" style="font-family: STIXMathJax_Main;">)</span><span class="mo" id="MathJax-Span-735" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mn" id="MathJax-Span-736" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.305em; border-left: 0px solid; width: 0px; height: 1.269em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>E</mi><mo stretchy="false">(</mo><mi>A</mi><mo stretchy="false">)</mo><mo>=</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-96">E(A)=0</script>. The expected value of the advantage <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-97-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-737" style="width: 4.115em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.084em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.564em, 1003.04em, 2.829em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-738"><span class="mi" id="MathJax-Span-739" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐴</span><span class="mo" id="MathJax-Span-740" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-741" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-742" style="font-family: STIXMathJax_Main;">,</span><span class="msup" id="MathJax-Span-743" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.817em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.47em, 4.177em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-744" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.367em; left: 0.502em;"><span class="mo" id="MathJax-Span-745" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-746" style="font-family: STIXMathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.305em; border-left: 0px solid; width: 0px; height: 1.383em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><msup><mi>a</mi><mo>′</mo></msup><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-97">A(s,a')</script> over all possible actions <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-98-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-747" style="width: 1.085em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.812em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.186em, 1000.81em, 2.283em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-748"><span class="msup" id="MathJax-Span-749"><span style="display: inline-block; position: relative; width: 0.817em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.47em, 4.177em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-750" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.367em; left: 0.502em;"><span class="mo" id="MathJax-Span-751" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.085em; border-left: 0px solid; width: 0px; height: 1.162em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>a</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-98">a'</script>
 has to be zero. The expected value of the expression in parentheses is 
zero because we subtract the mean of the advantages from every 
advantage:</p>
<p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-99-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mstyle scriptlevel=&quot;0&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-OPEN&quot;&gt;&lt;mo maxsize=&quot;1.623em&quot; minsize=&quot;1.623em&quot;&gt;(&lt;/mo&gt;&lt;/mrow&gt;&lt;/mstyle&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mstyle scriptlevel=&quot;0&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-CLOSE&quot;&gt;&lt;mo maxsize=&quot;1.623em&quot; minsize=&quot;1.623em&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mstyle&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-752" style="width: 48.65em; display: inline-block;"><span style="display: inline-block; position: relative; width: 36.851em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(2.542em, 1036.83em, 5.962em, -1000em); top: -4.491em; left: 0em;"><span class="mrow" id="MathJax-Span-753"><span class="mi" id="MathJax-Span-754" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐸<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.02em;"></span></span><span class="mrow" id="MathJax-Span-755" style="padding-left: 0.188em;"><span class="mo" id="MathJax-Span-756" style="vertical-align: -0.778em;"><span style="font-family: STIXMathJax_Size4;">(</span></span><span class="mi" id="MathJax-Span-757" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐴</span><span class="mo" id="MathJax-Span-758" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-759" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-760" style="font-family: STIXMathJax_Main;">,</span><span class="mi" id="MathJax-Span-761" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.188em;">𝑎</span><span class="mo" id="MathJax-Span-762" style="font-family: STIXMathJax_Main;">)</span><span class="mo" id="MathJax-Span-763" style="font-family: STIXMathJax_Main; padding-left: 0.25em;">−</span><span class="mfrac" id="MathJax-Span-764" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 1.612em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.166em, 1000.39em, 4.167em, -1000em); top: -4.681em; left: 50%; margin-left: -0.25em;"><span class="mn" id="MathJax-Span-765" style="font-family: STIXMathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; clip: rect(3.152em, 1001.37em, 4.356em, -1000em); top: -3.318em; left: 50%; margin-left: -0.746em;"><span class="mrow" id="MathJax-Span-766"><span class="texatom" id="MathJax-Span-767"><span class="mrow" id="MathJax-Span-768"><span class="mo" id="MathJax-Span-769" style="font-family: STIXMathJax_Variants;">|</span></span></span><span class="texatom" id="MathJax-Span-770"><span class="mrow" id="MathJax-Span-771"><span class="mi" id="MathJax-Span-772" style="font-family: STIXMathJax_Variants; font-style: italic;"></span></span></span><span class="texatom" id="MathJax-Span-773"><span class="mrow" id="MathJax-Span-774"><span class="mo" id="MathJax-Span-775" style="font-family: STIXMathJax_Variants;">|</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; clip: rect(0.852em, 1001.61em, 1.245em, -1000em); top: -1.302em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.612em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.082em;"></span></span></span></span><span class="munderover" id="MathJax-Span-776" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.292em; height: 0px;"><span style="position: absolute; clip: rect(2.867em, 1001.2em, 4.642em, -1000em); top: -4.004em; left: 0em;"><span class="mo" id="MathJax-Span-777" style="font-family: STIXMathJax_Size1; vertical-align: -0.524em;">∑</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; clip: rect(3.303em, 1000.58em, 4.274em, -1000em); top: -2.803em; left: 0.357em;"><span class="texatom" id="MathJax-Span-778"><span class="mrow" id="MathJax-Span-779"><span class="msup" id="MathJax-Span-780"><span style="display: inline-block; position: relative; width: 0.578em; height: 0px;"><span style="position: absolute; clip: rect(3.53em, 1000.33em, 4.174em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-781" style="font-size: 70.7%; font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.261em; left: 0.355em;"><span class="mo" id="MathJax-Span-782" style="font-size: 50%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mi" id="MathJax-Span-783" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.188em;">𝐴</span><span class="mo" id="MathJax-Span-784" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-785" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-786" style="font-family: STIXMathJax_Main;">,</span><span class="msup" id="MathJax-Span-787" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.817em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.47em, 4.177em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-788" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.417em; left: 0.502em;"><span class="mo" id="MathJax-Span-789" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-790" style="font-family: STIXMathJax_Main;">)</span><span class="mo" id="MathJax-Span-791" style="vertical-align: -0.778em;"><span style="font-family: STIXMathJax_Size4;">)</span></span></span><span class="mo" id="MathJax-Span-792" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-793" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.313em;">𝐸<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.02em;"></span></span><span class="mstyle" id="MathJax-Span-794" style=""><span class="mrow" id="MathJax-Span-795"><span class="texatom" id="MathJax-Span-796" style=""><span class="mrow" id="MathJax-Span-797"><span class="mo" id="MathJax-Span-798" style="vertical-align: -0.393em;"><span style="font-family: STIXMathJax_Size2;">(</span></span></span></span></span></span><span class="mi" id="MathJax-Span-799" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐴</span><span class="mo" id="MathJax-Span-800" style="font-family: STIXMathJax_Main; padding-left: 0.25em;">−</span><span class="mi" id="MathJax-Span-801" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.25em;">𝐸<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.02em;"></span></span><span class="mo" id="MathJax-Span-802" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-803" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐴</span><span class="mo" id="MathJax-Span-804" style="font-family: STIXMathJax_Main;">)</span><span class="mstyle" id="MathJax-Span-805" style=""><span class="mrow" id="MathJax-Span-806"><span class="texatom" id="MathJax-Span-807" style=""><span class="mrow" id="MathJax-Span-808"><span class="mo" id="MathJax-Span-809" style="vertical-align: -0.393em;"><span style="font-family: STIXMathJax_Size2;">)</span></span></span></span></span></span><span class="mo" id="MathJax-Span-810" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-811" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.313em;">𝐸<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.02em;"></span></span><span class="mo" id="MathJax-Span-812" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-813" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐴</span><span class="mo" id="MathJax-Span-814" style="font-family: STIXMathJax_Main;">)</span><span class="mo" id="MathJax-Span-815" style="font-family: STIXMathJax_Main; padding-left: 0.25em;">−</span><span class="mi" id="MathJax-Span-816" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.25em;">𝐸<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.02em;"></span></span><span class="mo" id="MathJax-Span-817" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-818" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐸<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.02em;"></span></span><span class="mo" id="MathJax-Span-819" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-820" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐴</span><span class="mo" id="MathJax-Span-821" style="font-family: STIXMathJax_Main;">)</span><span class="mo" id="MathJax-Span-822" style="font-family: STIXMathJax_Main;">)</span><span class="mo" id="MathJax-Span-823" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-824" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.313em;">𝐸<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.02em;"></span></span><span class="mo" id="MathJax-Span-825" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-826" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐴</span><span class="mo" id="MathJax-Span-827" style="font-family: STIXMathJax_Main;">)</span><span class="mo" id="MathJax-Span-828" style="font-family: STIXMathJax_Main; padding-left: 0.25em;">−</span><span class="mi" id="MathJax-Span-829" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.25em;">𝐸<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.02em;"></span></span><span class="mo" id="MathJax-Span-830" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-831" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐴</span><span class="mo" id="MathJax-Span-832" style="font-family: STIXMathJax_Main;">)</span><span class="mo" id="MathJax-Span-833" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mn" id="MathJax-Span-834" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">0</span></span><span style="display: inline-block; width: 0px; height: 4.491em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.799em; border-left: 0px solid; width: 0px; height: 4.23em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>E</mi><mrow><mo>(</mo><mi>A</mi><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>−</mo><mfrac><mn>1</mn><mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">A</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow></mrow></mfrac><munder><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><msup><mi>a</mi><mo>′</mo></msup></mrow></munder><mi>A</mi><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><msup><mi>a</mi><mo>′</mo></msup><mo stretchy="false">)</mo><mo>)</mo></mrow><mo>=</mo><mi>E</mi><mstyle scriptlevel="0"><mrow class="MJX-TeXAtom-OPEN"><mo maxsize="1.623em" minsize="1.623em">(</mo></mrow></mstyle><mi>A</mi><mo>−</mo><mi>E</mi><mo stretchy="false">(</mo><mi>A</mi><mo stretchy="false">)</mo><mstyle scriptlevel="0"><mrow class="MJX-TeXAtom-CLOSE"><mo maxsize="1.623em" minsize="1.623em">)</mo></mrow></mstyle><mo>=</mo><mi>E</mi><mo stretchy="false">(</mo><mi>A</mi><mo stretchy="false">)</mo><mo>−</mo><mi>E</mi><mo stretchy="false">(</mo><mi>E</mi><mo stretchy="false">(</mo><mi>A</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>=</mo><mi>E</mi><mo stretchy="false">(</mo><mi>A</mi><mo stretchy="false">)</mo><mo>−</mo><mi>E</mi><mo stretchy="false">(</mo><mi>A</mi><mo stretchy="false">)</mo><mo>=</mo><mn>0</mn></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-99">\begin{equation}
E\left(A(s,a) - \frac 1{| \mathcal A |}\sum_{a'}A(s, a')\right) = E\Bigl(A - E(A)\Bigr) = E(A)- E(E(A)) = E(A) - E(A) = 0
\end{equation}</script></p>
<p>In the cell below you find the code that implements this architecture
 in tensorflow. Some things to keep in mind: You should normalize the 
input pixel values to [0,1] by dividing the input with 0xFF=255. The 
reason for this is, that the pixel values of the frames, the environment
 returns, are uint8 which can store values in the range [0,255]. </p>
<p><strong>Furthermore, make sure you initialize the weights properly! 
The DQN uses the Relu activation function and the right initializer is <a href="https://arxiv.org/pdf/1502.01852v1.pdf" target="_blank">He et al. 2015 equation 10</a> (<a href="https://www.youtube.com/watch?v=s2coXdufOzE&amp;t=157s" target="_blank">click here for a detailed explanation</a>).
In tensorflow use <code>tf.variance_scaling_initializer</code> <a href="https://www.tensorflow.org/api_docs/python/tf/variance_scaling_initializer" target="_blank">(documentation)</a> with <code>scale = 2</code>.</strong></p>
<p>DeepMind used an implementation of the RMSProp optimizer that is different to the one in tensorflow (see page 23, eq 40 in <a href="https://arxiv.org/pdf/1308.0850v5.pdf" target="_blank">Graves 2014</a>).
 Before implementing it myself, I tried the Adam optimizer which gave 
promising results without much hyperparameter-search. Adam was not 
invented when <a href="https://arxiv.org/abs/1312.5602" target="_blank">Mnih et al. 2013</a>
 was published, so one could argue that they might have used it instead 
of RMSProp if it had been invented earlier. On the other hand, the 
authors of this <a href="https://blog.paperspace.com/intro-to-optimization-momentum-rmsprop-adam/" target="_blank">blog post</a> compare <em>Momentum, RMSProp and Adam</em> and argue:</p>
<blockquote>
<p>Out of the above three, you may find momentum to be the most 
prevalent, despite Adam looking the most promising on paper. Empirical 
results have shown that all these algorithms can converge to different 
optimal local minima given the same loss. However, SGD with momentum 
seems to find more flatter minima than Adam, while adaptive methods tend
 to converge quickly towards sharper minima. Flatter minima generalize 
better than sharper ones.</p>
</blockquote>
<p>Maybe some of these differences might be mitigated by the use of <em>AdamW</em>, which I described <a href="https://medium.com/@fabiograetz/why-adamw-matters-736223f31b5d" target="_blank">in this blog post</a>
 (irrelevant for DQN since no regularization is used). For now, I stick 
with Adam and if I find some time in the future, I might come back to 
this since it might be well worth spending some time on playing with 
different optimizers and implementing the version of RMSProp used by 
DeepMind. </p>
<p><em>Edit</em>: In a later DeepMind paper called "Rainbow: Combining Improvements in Deep Reinforcement Learning" by <a href="https://arxiv.org/abs/1710.02298" target="_blank">Hessel et al. 2017</a>
 RMSProp was substituted for Adam with a learning rate of 0.0000625 (see
 Table 1). This learning rate is close to what I found working well for 
Breakout (0.00001) before reading Hessel et al. 2017.</p>
<p>If you compare the dueling architecture described above to the 
network implemented in the next cell, you will find a small difference. 
Instead of two hidden fully connected layers with 512 rectifier units 
for each, the value and the advantage stream, I ended up adding a fourth
 convolutional layer with 1024 filters. The output has the shape (1, 1, 
1024) and is then split into two streams with shapes (1, 1, 512). This 
architecture is suggested <a href="https://github.com/awjuliani/DeepRL-Agents/blob/master/Double-Dueling-DQN.ipynb" target="_blank">here</a>
 and after performing some tests on the environment Pong, which is 
comparably easy to learn for a DQN agent, I find that this small 
adjustment lets the reward increase slightly earlier and higher.</p>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt_container"><div class="prompt input_prompt"><bdi>In</bdi>&nbsp;[&nbsp;]:</div><div class="run_this_cell" title="Run this cell"><i class="fa-step-forward fa"></i></div></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit code here"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.6001px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 12px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true" style="display: block; right: 0px; left: 0px;"><div style="height: 100%; min-height: 1px; width: 1009px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true" style="height: 12px; width: 12px;"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 1008.6px; margin-bottom: -12px; border-right-width: 18px; min-height: 1320px; padding-right: 0px; padding-bottom: 12px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-keyword">class</span> <span class="cm-def">DQN</span>(<span class="cm-builtin">object</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-string">"""Implements a Deep Q Network"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-comment"># pylint: disable=too-many-instance-attributes</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-keyword">def</span> <span class="cm-def">__init__</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">n_actions</span>, <span class="cm-variable">hidden</span><span class="cm-operator">=</span><span class="cm-number">1024</span>, <span class="cm-variable">learning_rate</span><span class="cm-operator">=</span><span class="cm-number">0.00001</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                 <span class="cm-variable">frame_height</span><span class="cm-operator">=</span><span class="cm-number">84</span>, <span class="cm-variable">frame_width</span><span class="cm-operator">=</span><span class="cm-number">84</span>, <span class="cm-variable">agent_history_length</span><span class="cm-operator">=</span><span class="cm-number">4</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        Args:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            n_actions: Integer, number of possible actions</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            hidden: Integer, Number of filters in the final convolutional layer. </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">                    This is different from the DeepMind implementation</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            learning_rate: Float, Learning rate for the Adam optimizer</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            frame_height: Integer, Height of a frame of an Atari game</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            frame_width: Integer, Width of a frame of an Atari game</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            agent_history_length: Integer, Number of frames stacked together to create a state</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        """</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">n_actions</span> <span class="cm-operator">=</span> <span class="cm-variable">n_actions</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">hidden</span> <span class="cm-operator">=</span> <span class="cm-variable">hidden</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">learning_rate</span> <span class="cm-operator">=</span> <span class="cm-variable">learning_rate</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">frame_height</span> <span class="cm-operator">=</span> <span class="cm-variable">frame_height</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">frame_width</span> <span class="cm-operator">=</span> <span class="cm-variable">frame_width</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">agent_history_length</span> <span class="cm-operator">=</span> <span class="cm-variable">agent_history_length</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">input</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">placeholder</span>(<span class="cm-variable">shape</span><span class="cm-operator">=</span>[<span class="cm-keyword">None</span>, <span class="cm-variable-2">self</span>.<span class="cm-property">frame_height</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                           <span class="cm-variable-2">self</span>.<span class="cm-property">frame_width</span>, <span class="cm-variable-2">self</span>.<span class="cm-property">agent_history_length</span>], </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                    <span class="cm-variable">dtype</span><span class="cm-operator">=</span><span class="cm-variable">tf</span>.<span class="cm-property">float32</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-comment"># Normalizing the input</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">inputscaled</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">input</span><span class="cm-operator">/</span><span class="cm-number">255</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-comment"># Convolutional layers</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">conv1</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">layers</span>.<span class="cm-property">conv2d</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">inputs</span><span class="cm-operator">=</span><span class="cm-variable-2">self</span>.<span class="cm-property">inputscaled</span>, <span class="cm-variable">filters</span><span class="cm-operator">=</span><span class="cm-number">32</span>, <span class="cm-variable">kernel_size</span><span class="cm-operator">=</span>[<span class="cm-number">8</span>, <span class="cm-number">8</span>], <span class="cm-variable">strides</span><span class="cm-operator">=</span><span class="cm-number">4</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">kernel_initializer</span><span class="cm-operator">=</span><span class="cm-variable">tf</span>.<span class="cm-property">variance_scaling_initializer</span>(<span class="cm-variable">scale</span><span class="cm-operator">=</span><span class="cm-number">2</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">padding</span><span class="cm-operator">=</span><span class="cm-string">"valid"</span>, <span class="cm-variable">activation</span><span class="cm-operator">=</span><span class="cm-variable">tf</span>.<span class="cm-property">nn</span>.<span class="cm-property">relu</span>, <span class="cm-variable">use_bias</span><span class="cm-operator">=</span><span class="cm-keyword">False</span>, <span class="cm-variable">name</span><span class="cm-operator">=</span><span class="cm-string">'conv1'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">conv2</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">layers</span>.<span class="cm-property">conv2d</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">inputs</span><span class="cm-operator">=</span><span class="cm-variable-2">self</span>.<span class="cm-property">conv1</span>, <span class="cm-variable">filters</span><span class="cm-operator">=</span><span class="cm-number">64</span>, <span class="cm-variable">kernel_size</span><span class="cm-operator">=</span>[<span class="cm-number">4</span>, <span class="cm-number">4</span>], <span class="cm-variable">strides</span><span class="cm-operator">=</span><span class="cm-number">2</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">kernel_initializer</span><span class="cm-operator">=</span><span class="cm-variable">tf</span>.<span class="cm-property">variance_scaling_initializer</span>(<span class="cm-variable">scale</span><span class="cm-operator">=</span><span class="cm-number">2</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">padding</span><span class="cm-operator">=</span><span class="cm-string">"valid"</span>, <span class="cm-variable">activation</span><span class="cm-operator">=</span><span class="cm-variable">tf</span>.<span class="cm-property">nn</span>.<span class="cm-property">relu</span>, <span class="cm-variable">use_bias</span><span class="cm-operator">=</span><span class="cm-keyword">False</span>, <span class="cm-variable">name</span><span class="cm-operator">=</span><span class="cm-string">'conv2'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">conv3</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">layers</span>.<span class="cm-property">conv2d</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">inputs</span><span class="cm-operator">=</span><span class="cm-variable-2">self</span>.<span class="cm-property">conv2</span>, <span class="cm-variable">filters</span><span class="cm-operator">=</span><span class="cm-number">64</span>, <span class="cm-variable">kernel_size</span><span class="cm-operator">=</span>[<span class="cm-number">3</span>, <span class="cm-number">3</span>], <span class="cm-variable">strides</span><span class="cm-operator">=</span><span class="cm-number">1</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">kernel_initializer</span><span class="cm-operator">=</span><span class="cm-variable">tf</span>.<span class="cm-property">variance_scaling_initializer</span>(<span class="cm-variable">scale</span><span class="cm-operator">=</span><span class="cm-number">2</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">padding</span><span class="cm-operator">=</span><span class="cm-string">"valid"</span>, <span class="cm-variable">activation</span><span class="cm-operator">=</span><span class="cm-variable">tf</span>.<span class="cm-property">nn</span>.<span class="cm-property">relu</span>, <span class="cm-variable">use_bias</span><span class="cm-operator">=</span><span class="cm-keyword">False</span>, <span class="cm-variable">name</span><span class="cm-operator">=</span><span class="cm-string">'conv3'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">conv4</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">layers</span>.<span class="cm-property">conv2d</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">inputs</span><span class="cm-operator">=</span><span class="cm-variable-2">self</span>.<span class="cm-property">conv3</span>, <span class="cm-variable">filters</span><span class="cm-operator">=</span><span class="cm-variable">hidden</span>, <span class="cm-variable">kernel_size</span><span class="cm-operator">=</span>[<span class="cm-number">7</span>, <span class="cm-number">7</span>], <span class="cm-variable">strides</span><span class="cm-operator">=</span><span class="cm-number">1</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">kernel_initializer</span><span class="cm-operator">=</span><span class="cm-variable">tf</span>.<span class="cm-property">variance_scaling_initializer</span>(<span class="cm-variable">scale</span><span class="cm-operator">=</span><span class="cm-number">2</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">padding</span><span class="cm-operator">=</span><span class="cm-string">"valid"</span>, <span class="cm-variable">activation</span><span class="cm-operator">=</span><span class="cm-variable">tf</span>.<span class="cm-property">nn</span>.<span class="cm-property">relu</span>, <span class="cm-variable">use_bias</span><span class="cm-operator">=</span><span class="cm-keyword">False</span>, <span class="cm-variable">name</span><span class="cm-operator">=</span><span class="cm-string">'conv4'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-comment"># Splitting into value and advantage stream</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">valuestream</span>, <span class="cm-variable-2">self</span>.<span class="cm-property">advantagestream</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">split</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">conv4</span>, <span class="cm-number">2</span>, <span class="cm-number">3</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">valuestream</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">layers</span>.<span class="cm-property">flatten</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">valuestream</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">advantagestream</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">layers</span>.<span class="cm-property">flatten</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">advantagestream</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">advantage</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">layers</span>.<span class="cm-property">dense</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">inputs</span><span class="cm-operator">=</span><span class="cm-variable-2">self</span>.<span class="cm-property">advantagestream</span>, <span class="cm-variable">units</span><span class="cm-operator">=</span><span class="cm-variable-2">self</span>.<span class="cm-property">n_actions</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">kernel_initializer</span><span class="cm-operator">=</span><span class="cm-variable">tf</span>.<span class="cm-property">variance_scaling_initializer</span>(<span class="cm-variable">scale</span><span class="cm-operator">=</span><span class="cm-number">2</span>), <span class="cm-variable">name</span><span class="cm-operator">=</span><span class="cm-string">"advantage"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">value</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">layers</span>.<span class="cm-property">dense</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">inputs</span><span class="cm-operator">=</span><span class="cm-variable-2">self</span>.<span class="cm-property">valuestream</span>, <span class="cm-variable">units</span><span class="cm-operator">=</span><span class="cm-number">1</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">kernel_initializer</span><span class="cm-operator">=</span><span class="cm-variable">tf</span>.<span class="cm-property">variance_scaling_initializer</span>(<span class="cm-variable">scale</span><span class="cm-operator">=</span><span class="cm-number">2</span>), <span class="cm-variable">name</span><span class="cm-operator">=</span><span class="cm-string">'value'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-comment"># Combining value and advantage into Q-values as described above</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">q_values</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">value</span> <span class="cm-operator">+</span> <span class="cm-variable">tf</span>.<span class="cm-property">subtract</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">advantage</span>, <span class="cm-variable">tf</span>.<span class="cm-property">reduce_mean</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">advantage</span>, <span class="cm-variable">axis</span><span class="cm-operator">=</span><span class="cm-number">1</span>, <span class="cm-variable">keepdims</span><span class="cm-operator">=</span><span class="cm-keyword">True</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">best_action</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">argmax</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">q_values</span>, <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-comment"># The next lines perform the parameter update. This will be explained in detail later.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-comment"># targetQ according to Bellman equation: </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-comment"># Q = r + gamma*max Q', calculated in the function learn()</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">target_q</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">placeholder</span>(<span class="cm-variable">shape</span><span class="cm-operator">=</span>[<span class="cm-keyword">None</span>], <span class="cm-variable">dtype</span><span class="cm-operator">=</span><span class="cm-variable">tf</span>.<span class="cm-property">float32</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-comment"># Action that was performed</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">action</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">placeholder</span>(<span class="cm-variable">shape</span><span class="cm-operator">=</span>[<span class="cm-keyword">None</span>], <span class="cm-variable">dtype</span><span class="cm-operator">=</span><span class="cm-variable">tf</span>.<span class="cm-property">int32</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-comment"># Q value of the action that was performed</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">Q</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">reduce_sum</span>(<span class="cm-variable">tf</span>.<span class="cm-property">multiply</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">q_values</span>, <span class="cm-variable">tf</span>.<span class="cm-property">one_hot</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">action</span>, <span class="cm-variable-2">self</span>.<span class="cm-property">n_actions</span>, <span class="cm-variable">dtype</span><span class="cm-operator">=</span><span class="cm-variable">tf</span>.<span class="cm-property">float32</span>)), <span class="cm-variable">axis</span><span class="cm-operator">=</span><span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-comment"># Parameter updates</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">loss</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">reduce_mean</span>(<span class="cm-variable">tf</span>.<span class="cm-property">losses</span>.<span class="cm-property">huber_loss</span>(<span class="cm-variable">labels</span><span class="cm-operator">=</span><span class="cm-variable-2">self</span>.<span class="cm-property">target_q</span>, <span class="cm-variable">predictions</span><span class="cm-operator">=</span><span class="cm-variable-2">self</span>.<span class="cm-property">Q</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">optimizer</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">train</span>.<span class="cm-property">AdamOptimizer</span>(<span class="cm-variable">learning_rate</span><span class="cm-operator">=</span><span class="cm-variable-2">self</span>.<span class="cm-property">learning_rate</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">update</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">optimizer</span>.<span class="cm-property">minimize</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">loss</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 12px solid transparent; top: 1320px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1350px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output"></div><div class="output"></div><div style="display: none;" class="btn btn-default output_collapsed" title="click to expand output">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit Markup Text here"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.6001px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -12px; border-right-width: 18px; min-height: 453px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation">One other interesting thing to notice: DeepMind uses the quadratic cost function with error clipping (see page 7 of <span class="cm-link">[Mnih et al. 2015]</span><span class="cm-string cm-url">(https://www.nature.com/articles/nature14236/)</span>).</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-quote cm-quote-1">&gt;We also found it helpful to clip the error term from the update </span><span class="cm-link cm-quote cm-quote-1">[...]</span><span class="cm-quote cm-quote-1"> to be between -1 and 1. Because the absolute value loss function |x| has a derivative of -1 for all negative values of x and a derivative of 1 for all positive values of x, clipping the squared error to be between -1 and 1 corresponds to using an absolute value loss function for errors outside of the (-1,1) interval. This form of error clipping further improved the stability of the algorithm.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Why does this improve the stability of the algorithm?</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-quote cm-quote-1">&gt;In deep networks or recurrent neural networks, error gradients can accumulate during an update and result in very large gradients. These in turn result in large updates to the network weights, and in turn, an unstable network. At an extreme, the values of weights can become so large as to overflow and result in NaN values. </span><span class="cm-link cm-quote cm-quote-1">[Source]</span><span class="cm-string cm-url cm-quote cm-quote-1">(https://machinelearningmastery.com/exploding-gradients-in-neural-networks/)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">This so-called exploding gradient problem can, to some extent, be avoided by clipping the gradients to a certain threshold value, if they exceed it: * If the true gradient is larger than a critical value <span class="cm-delimit cm-delimit-open">$</span>x<span class="cm-delimit cm-delimit-close">$</span>, just assume it is <span class="cm-delimit cm-delimit-open">$</span>x<span class="cm-delimit cm-delimit-close">$</span>.* Observe that the derivate of the green curve does not increase (or decrease) for <span class="cm-delimit cm-delimit-open">$</span>x&gt;1<span class="cm-delimit cm-delimit-close">$</span> (or <span class="cm-delimit cm-delimit-open">$</span>x&lt;-1<span class="cm-delimit cm-delimit-close">$</span>).</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Error clipping can be easily implemented in tensorflow by using the Huber loss function <span class="cm-comment">`tf.losses.huber_loss`</span>.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-image cm-image-marker">!</span><span class="cm-image cm-image-alt-text cm-link">[]</span><span class="cm-string cm-url">(pictures/huber.png)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Sidenote: If you are interested in creating high quality plots for publications in the eps format (vector) using LaTeX for labels, annotations or even formulas, check the gnuplot scripts in the pictures folder.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 453px;"></div><div class="CodeMirror-gutters" style="display: none; height: 471px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><p>One other interesting thing to notice: DeepMind uses the quadratic cost function with error clipping (see page 7 of <a href="https://www.nature.com/articles/nature14236/" target="_blank">Mnih et al. 2015</a>).</p>
<blockquote>
<p>We also found it helpful to clip the error term from the update [...]
 to be between -1 and 1. Because the absolute value loss function |x| 
has a derivative of -1 for all negative values of x and a derivative of 1
 for all positive values of x, clipping the squared error to be between 
-1 and 1 corresponds to using an absolute value loss function for errors
 outside of the (-1,1) interval. This form of error clipping further 
improved the stability of the algorithm.</p>
</blockquote>
<p>Why does this improve the stability of the algorithm?</p>
<blockquote>
<p>In deep networks or recurrent neural networks, error gradients can 
accumulate during an update and result in very large gradients. These in
 turn result in large updates to the network weights, and in turn, an 
unstable network. At an extreme, the values of weights can become so 
large as to overflow and result in NaN values. <a href="https://machinelearningmastery.com/exploding-gradients-in-neural-networks/" target="_blank">Source</a></p>
</blockquote>
<p>This so-called exploding gradient problem can, to some extent, be 
avoided by clipping the gradients to a certain threshold value, if they 
exceed it: * If the true gradient is larger than a critical value <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-100-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-835" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.541em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.5em, 2.498em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-836"><span class="mi" id="MathJax-Span-837" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑥</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.083em; border-left: 0px solid; width: 0px; height: 0.737em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-100">x</script>, just assume it is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-101-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-838" style="width: 0.76em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.541em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.5em, 2.498em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-839"><span class="mi" id="MathJax-Span-840" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑥</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.083em; border-left: 0px solid; width: 0px; height: 0.737em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-101">x</script>.* Observe that the derivate of the green curve does not increase (or decrease) for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-102-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;gt;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-841" style="width: 3.141em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.381em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1002.28em, 2.676em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-842"><span class="mi" id="MathJax-Span-843" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑥</span><span class="mo" id="MathJax-Span-844" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">&gt;</span><span class="mn" id="MathJax-Span-845" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.103em; border-left: 0px solid; width: 0px; height: 1.067em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>&gt;</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-102">x>1</script> (or <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-103-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-846" style="width: 4.115em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.084em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1002.98em, 2.693em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-847"><span class="mi" id="MathJax-Span-848" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑥</span><span class="mo" id="MathJax-Span-849" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">&lt;</span><span class="mo" id="MathJax-Span-850" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">−</span><span class="mn" id="MathJax-Span-851" style="font-family: STIXMathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.126em; border-left: 0px solid; width: 0px; height: 1.089em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>&lt;</mo><mo>−</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-103">x<-1</script>).
Error clipping can be easily implemented in tensorflow by using the Huber loss function <code>tf.losses.huber_loss</code>.</p>
<p><img src="DQN%20-%20Jupyter%20Notebook_files/huber.png" alt=""></p>
<p>Sidenote: If you are interested in creating high quality plots for 
publications in the eps format (vector) using LaTeX for labels, 
annotations or even formulas, check the gnuplot scripts in the pictures 
folder.</p>
</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit Markup Text here"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.6001px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -12px; border-right-width: 18px; min-height: 354px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 20px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-header cm-header-2">## 4. Exploration-exploitation trade-off</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">If you look at the code in the previous cell, you will find, that we are now able to predict the action, the network considers best (<span class="cm-comment">`self.best_action`</span>) by taking the argument of the maximum <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-value. But initially, the agent does not know how to play the game. If we always exploit and never explore by always choosing the action with the highest <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-value (greedy), the agent will stick to the first strategy it discovers that returns a small reward. It can then not continue exploring the environment and can not continue to learn. The <span class="cm-delimit cm-delimit-open">$</span><span class="cm-tag">\epsilon</span><span class="cm-delimit cm-delimit-close">$</span>-greedy algorithm offers a simple solution for that problem: Simply put, we usually choose the action the networks deems best but with a probability of <span class="cm-delimit cm-delimit-open">$</span><span class="cm-tag">\epsilon</span><span class="cm-delimit cm-delimit-close">$</span> we choose a random action. <span class="cm-delimit cm-delimit-open">$</span><span class="cm-tag">\epsilon</span><span class="cm-delimit cm-delimit-close">$</span> is a function of the number of frames the agent has seen. For the first 50000 frames the agent only explores (<span class="cm-delimit cm-delimit-open">$</span><span class="cm-tag">\epsilon</span>=1<span class="cm-delimit cm-delimit-close">$</span>). Over the following 1 million frames, <span class="cm-delimit cm-delimit-open">$</span><span class="cm-tag">\epsilon</span><span class="cm-delimit cm-delimit-close">$</span> is linearly decreased to 0.1, meaning that the agent starts exploiting more and more. DeepMind then keeps <span class="cm-delimit cm-delimit-open">$</span><span class="cm-tag">\epsilon</span>=0.1<span class="cm-delimit cm-delimit-close">$</span>, however, we chose to decrease it to <span class="cm-delimit cm-delimit-open">$</span><span class="cm-tag">\epsilon</span>=0.01<span class="cm-delimit cm-delimit-close">$</span> over the remaining frames as suggested by the <span class="cm-link">[OpenAi Baselines for DQN]</span><span class="cm-string cm-url">(https://blog.openai.com/openai-baselines-dqn/)</span> (in the plot the maximum number of frames is 2 million for demonstration purposes).</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-image cm-image-marker">!</span><span class="cm-image cm-image-alt-text cm-link">[]</span><span class="cm-string cm-url">(pictures/epsilon.png "See the gnuplot script in the pictures folder to find out how to quickly create this plot")</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">The method <span class="cm-comment">`get_action`</span> in the cell below implements this behaviour: It first calculates <span class="cm-delimit cm-delimit-open">$</span><span class="cm-tag">\epsilon</span><span class="cm-delimit cm-delimit-close">$</span> from the number of the current frame and then either returns a random action (with probability <span class="cm-delimit cm-delimit-open">$</span><span class="cm-tag">\epsilon</span><span class="cm-delimit cm-delimit-close">$</span>) or the action the DQN deems best. The variables in the constructor are the slopes and intercepts for the decrease of <span class="cm-delimit cm-delimit-open">$</span><span class="cm-tag">\epsilon</span><span class="cm-delimit cm-delimit-close">$</span> shown in the plot above.</span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 354px;"></div><div class="CodeMirror-gutters" style="display: none; height: 372px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><h2 id="4.-Exploration-exploitation-trade-off">4. Exploration-exploitation trade-off<a class="anchor-link" href="#4.-Exploration-exploitation-trade-off">¶</a></h2>
<p>If you look at the code in the previous cell, you will find, that we 
are now able to predict the action, the network considers best (<code>self.best_action</code>) by taking the argument of the maximum <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-104-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-852" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-853"><span class="mi" id="MathJax-Span-854" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-104">Q</script>-value.
 But initially, the agent does not know how to play the game. If we 
always exploit and never explore by always choosing the action with the 
highest <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-105-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-855" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-856"><span class="mi" id="MathJax-Span-857" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-105">Q</script>-value
 (greedy), the agent will stick to the first strategy it discovers that 
returns a small reward. It can then not continue exploring the 
environment and can not continue to learn. The <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-106-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03F5;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-858" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.433em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.43em, 2.5em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-859"><span class="mi" id="MathJax-Span-860" style="font-family: STIXMathJax_Normal; font-style: italic;">𝜖</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 0.739em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ϵ</mi></math></span></span><script type="math/tex" id="MathJax-Element-106">\epsilon</script>-greedy
 algorithm offers a simple solution for that problem: Simply put, we 
usually choose the action the networks deems best but with a probability
 of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-107-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03F5;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-861" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.433em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.43em, 2.5em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-862"><span class="mi" id="MathJax-Span-863" style="font-family: STIXMathJax_Normal; font-style: italic;">𝜖</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 0.739em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ϵ</mi></math></span></span><script type="math/tex" id="MathJax-Element-107">\epsilon</script> we choose a random action. <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-108-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03F5;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-864" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.433em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.43em, 2.5em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-865"><span class="mi" id="MathJax-Span-866" style="font-family: STIXMathJax_Normal; font-style: italic;">𝜖</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 0.739em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ϵ</mi></math></span></span><script type="math/tex" id="MathJax-Element-108">\epsilon</script> is a function of the number of frames the agent has seen. For the first 50000 frames the agent only explores (<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-109-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03F5;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-867" style="width: 3.033em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.273em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1002.17em, 2.663em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-868"><span class="mi" id="MathJax-Span-869" style="font-family: STIXMathJax_Normal; font-style: italic;">𝜖</span><span class="mo" id="MathJax-Span-870" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mn" id="MathJax-Span-871" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 1.05em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ϵ</mi><mo>=</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-109">\epsilon=1</script>). Over the following 1 million frames, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-110-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03F5;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-872" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.433em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.43em, 2.5em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-873"><span class="mi" id="MathJax-Span-874" style="font-family: STIXMathJax_Normal; font-style: italic;">𝜖</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 0.739em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ϵ</mi></math></span></span><script type="math/tex" id="MathJax-Element-110">\epsilon</script> is linearly decreased to 0.1, meaning that the agent starts exploiting more and more. DeepMind then keeps <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-111-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03F5;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0.1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-875" style="width: 4.007em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.03em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1002.92em, 2.666em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-876"><span class="mi" id="MathJax-Span-877" style="font-family: STIXMathJax_Normal; font-style: italic;">𝜖</span><span class="mo" id="MathJax-Span-878" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mn" id="MathJax-Span-879" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">0.1</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.09em; border-left: 0px solid; width: 0px; height: 1.054em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ϵ</mi><mo>=</mo><mn>0.1</mn></math></span></span><script type="math/tex" id="MathJax-Element-111">\epsilon=0.1</script>, however, we chose to decrease it to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-112-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03F5;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0.01&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-880" style="width: 4.656em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.517em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1003.41em, 2.666em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-881"><span class="mi" id="MathJax-Span-882" style="font-family: STIXMathJax_Normal; font-style: italic;">𝜖</span><span class="mo" id="MathJax-Span-883" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mn" id="MathJax-Span-884" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">0.01</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.09em; border-left: 0px solid; width: 0px; height: 1.054em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ϵ</mi><mo>=</mo><mn>0.01</mn></math></span></span><script type="math/tex" id="MathJax-Element-112">\epsilon=0.01</script> over the remaining frames as suggested by the <a href="https://blog.openai.com/openai-baselines-dqn/" target="_blank">OpenAi Baselines for DQN</a> (in the plot the maximum number of frames is 2 million for demonstration purposes).</p>
<p><img src="DQN%20-%20Jupyter%20Notebook_files/epsilon.png" alt="" title="See the gnuplot script in the pictures folder to find out how to quickly create this plot"></p>
<p>The method <code>get_action</code> in the cell below implements this behaviour: It first calculates <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-113-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03F5;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-885" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.433em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.43em, 2.5em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-886"><span class="mi" id="MathJax-Span-887" style="font-family: STIXMathJax_Normal; font-style: italic;">𝜖</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 0.739em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ϵ</mi></math></span></span><script type="math/tex" id="MathJax-Element-113">\epsilon</script> from the number of the current frame and then either returns a random action (with probability <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-114-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03F5;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-888" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.433em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.43em, 2.5em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-889"><span class="mi" id="MathJax-Span-890" style="font-family: STIXMathJax_Normal; font-style: italic;">𝜖</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 0.739em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ϵ</mi></math></span></span><script type="math/tex" id="MathJax-Element-114">\epsilon</script>) or the action the DQN deems best. The variables in the constructor are the slopes and intercepts for the decrease of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-115-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03F5;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-891" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.433em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.43em, 2.5em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-892"><span class="mi" id="MathJax-Span-893" style="font-family: STIXMathJax_Normal; font-style: italic;">𝜖</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 0.739em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ϵ</mi></math></span></span><script type="math/tex" id="MathJax-Element-115">\epsilon</script> shown in the plot above.</p>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt_container"><div class="prompt input_prompt"><bdi>In</bdi>&nbsp;[&nbsp;]:</div><div class="run_this_cell" title="Run this cell"><i class="fa-step-forward fa"></i></div></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit code here"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.6001px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 12px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true" style="display: block; right: 0px; left: 0px;"><div style="height: 100%; min-height: 1px; width: 1137px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true" style="height: 12px; width: 12px;"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 1136.6px; margin-bottom: -12px; border-right-width: 18px; min-height: 1031px; padding-right: 0px; padding-bottom: 12px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-keyword">class</span> <span class="cm-def">ExplorationExploitationScheduler</span>(<span class="cm-builtin">object</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-string">"""Determines an action according to an epsilon greedy strategy with annealing epsilon"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-keyword">def</span> <span class="cm-def">__init__</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">DQN</span>, <span class="cm-variable">n_actions</span>, <span class="cm-variable">eps_initial</span><span class="cm-operator">=</span><span class="cm-number">1</span>, <span class="cm-variable">eps_final</span><span class="cm-operator">=</span><span class="cm-number">0.1</span>, <span class="cm-variable">eps_final_frame</span><span class="cm-operator">=</span><span class="cm-number">0.01</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                 <span class="cm-variable">eps_evaluation</span><span class="cm-operator">=</span><span class="cm-number">0.0</span>, <span class="cm-variable">eps_annealing_frames</span><span class="cm-operator">=</span><span class="cm-number">1000000</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                 <span class="cm-variable">replay_memory_start_size</span><span class="cm-operator">=</span><span class="cm-number">50000</span>, <span class="cm-variable">max_frames</span><span class="cm-operator">=</span><span class="cm-number">25000000</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        Args:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            DQN: A DQN object</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            n_actions: Integer, number of possible actions</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            eps_initial: Float, Exploration probability for the first </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">                replay_memory_start_size frames</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            eps_final: Float, Exploration probability after </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">                replay_memory_start_size + eps_annealing_frames frames</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            eps_final_frame: Float, Exploration probability after max_frames frames</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            eps_evaluation: Float, Exploration probability during evaluation</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            eps_annealing_frames: Int, Number of frames over which the </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">                exploration probabilty is annealed from eps_initial to eps_final</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            replay_memory_start_size: Integer, Number of frames during </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">                which the agent only explores</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            max_frames: Integer, Total number of frames shown to the agent</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        """</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">n_actions</span> <span class="cm-operator">=</span> <span class="cm-variable">n_actions</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">eps_initial</span> <span class="cm-operator">=</span> <span class="cm-variable">eps_initial</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">eps_final</span> <span class="cm-operator">=</span> <span class="cm-variable">eps_final</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">eps_final_frame</span> <span class="cm-operator">=</span> <span class="cm-variable">eps_final_frame</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">eps_evaluation</span> <span class="cm-operator">=</span> <span class="cm-variable">eps_evaluation</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">eps_annealing_frames</span> <span class="cm-operator">=</span> <span class="cm-variable">eps_annealing_frames</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">replay_memory_start_size</span> <span class="cm-operator">=</span> <span class="cm-variable">replay_memory_start_size</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">max_frames</span> <span class="cm-operator">=</span> <span class="cm-variable">max_frames</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-comment"># Slopes and intercepts for exploration decrease</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">slope</span> <span class="cm-operator">=</span> <span class="cm-operator">-</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">eps_initial</span> <span class="cm-operator">-</span> <span class="cm-variable-2">self</span>.<span class="cm-property">eps_final</span>)<span class="cm-operator">/</span><span class="cm-variable-2">self</span>.<span class="cm-property">eps_annealing_frames</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">intercept</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">eps_initial</span> <span class="cm-operator">-</span> <span class="cm-variable-2">self</span>.<span class="cm-property">slope</span><span class="cm-operator">*</span><span class="cm-variable-2">self</span>.<span class="cm-property">replay_memory_start_size</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">slope_2</span> <span class="cm-operator">=</span> <span class="cm-operator">-</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">eps_final</span> <span class="cm-operator">-</span> <span class="cm-variable-2">self</span>.<span class="cm-property">eps_final_frame</span>)<span class="cm-operator">/</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">max_frames</span> <span class="cm-operator">-</span> <span class="cm-variable-2">self</span>.<span class="cm-property">eps_annealing_frames</span> <span class="cm-operator">-</span> <span class="cm-variable-2">self</span>.<span class="cm-property">replay_memory_start_size</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">intercept_2</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">eps_final_frame</span> <span class="cm-operator">-</span> <span class="cm-variable-2">self</span>.<span class="cm-property">slope_2</span><span class="cm-operator">*</span><span class="cm-variable-2">self</span>.<span class="cm-property">max_frames</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">DQN</span> <span class="cm-operator">=</span> <span class="cm-variable">DQN</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-keyword">def</span> <span class="cm-def">get_action</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">session</span>, <span class="cm-variable">frame_number</span>, <span class="cm-variable">state</span>, <span class="cm-variable">evaluation</span><span class="cm-operator">=</span><span class="cm-keyword">False</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        Args:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            session: A tensorflow session object</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            frame_number: Integer, number of the current frame</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            state: A (84, 84, 4) sequence of frames of an Atari game in grayscale</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            evaluation: A boolean saying whether the agent is being evaluated</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        Returns:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            An integer between 0 and n_actions - 1 determining the action the agent perfoms next</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        """</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">if</span> <span class="cm-variable">evaluation</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">eps</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">eps_evaluation</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">elif</span> <span class="cm-variable">frame_number</span> <span class="cm-operator">&lt;</span> <span class="cm-variable-2">self</span>.<span class="cm-property">replay_memory_start_size</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">eps</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">eps_initial</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">elif</span> <span class="cm-variable">frame_number</span> <span class="cm-operator">&gt;=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">replay_memory_start_size</span> <span class="cm-keyword">and</span> <span class="cm-variable">frame_number</span> <span class="cm-operator">&lt;</span> <span class="cm-variable-2">self</span>.<span class="cm-property">replay_memory_start_size</span> <span class="cm-operator">+</span> <span class="cm-variable-2">self</span>.<span class="cm-property">eps_annealing_frames</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">eps</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">slope</span><span class="cm-operator">*</span><span class="cm-variable">frame_number</span> <span class="cm-operator">+</span> <span class="cm-variable-2">self</span>.<span class="cm-property">intercept</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">elif</span> <span class="cm-variable">frame_number</span> <span class="cm-operator">&gt;=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">replay_memory_start_size</span> <span class="cm-operator">+</span> <span class="cm-variable-2">self</span>.<span class="cm-property">eps_annealing_frames</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">eps</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">slope_2</span><span class="cm-operator">*</span><span class="cm-variable">frame_number</span> <span class="cm-operator">+</span> <span class="cm-variable-2">self</span>.<span class="cm-property">intercept_2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">if</span> <span class="cm-variable">np</span>.<span class="cm-property">random</span>.<span class="cm-property">rand</span>(<span class="cm-number">1</span>) <span class="cm-operator">&lt;</span> <span class="cm-variable">eps</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-keyword">return</span> <span class="cm-variable">np</span>.<span class="cm-property">random</span>.<span class="cm-property">randint</span>(<span class="cm-number">0</span>, <span class="cm-variable-2">self</span>.<span class="cm-property">n_actions</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">return</span> <span class="cm-variable">session</span>.<span class="cm-property">run</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">DQN</span>.<span class="cm-property">best_action</span>, <span class="cm-variable">feed_dict</span><span class="cm-operator">=</span>{<span class="cm-variable-2">self</span>.<span class="cm-property">DQN</span>.<span class="cm-property">input</span>:[<span class="cm-variable">state</span>]})[<span class="cm-number">0</span>]  </span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 12px solid transparent; top: 1031px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1061px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output"></div><div class="output"></div><div style="display: none;" class="btn btn-default output_collapsed" title="click to expand output">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit Markup Text here"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59961px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -12px; border-right-width: 18px; min-height: 1391px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation">We now know how the DQN predicts the best action and we have a simple answer to the exploration exploitation dilemma.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">So, what else do we need to make it work? Let's take a look at the algorithm presented on page 7 in <span class="cm-link">[Mnih et al. 2015]</span><span class="cm-string cm-url">(https://www.nature.com/articles/nature14236/)</span>.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-image cm-image-marker">!</span><span class="cm-image cm-image-alt-text cm-link">[]</span><span class="cm-string cm-url">(pictures/DQN.png)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Let us go through the algorithm step by step:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable-2">* We do not know yet what </span><span class="cm-em cm-variable-2">*replay memory*</span><span class="cm-variable-2"> D is.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable-2">* Action-value function Q is our DQN network, that we already implemented.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable-2">* We need to discuss why a second Q network called </span><span class="cm-em cm-variable-2">*target*</span><span class="cm-variable-2"> action-value function is needed.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable-2">* At the beginning of each episode a sequence is initalized. This is implemented by stacking four (grayscale) frames together as discussed above.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable-2">* We discussed how the action is selected (</span><span class="cm-delimit cm-delimit-open">$</span><span class="cm-tag">\epsilon</span><span class="cm-delimit cm-delimit-close">$</span><span class="cm-variable-2">-greedy).</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable-2">* When the action is performed, the environment returns the next frame and the reward for that action. </span><span class="cm-comment cm-variable-2">`gym`</span><span class="cm-variable-2"> additionaly returns a boolean called </span><span class="cm-comment cm-variable-2">`terminal`</span><span class="cm-variable-2"> that states whether the game is over and a dictionary containing the number of lives the agent has left (</span><span class="cm-comment cm-variable-2">`ale.lives`</span><span class="cm-variable-2">). </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable-2">* We do not know yet, what it means to store a transition in the replay memory D. A list </span><span class="cm-comment cm-variable-2">`[state, action, reward, terminal, new_state]`</span><span class="cm-variable-2"> is called transition. A </span><span class="cm-comment cm-variable-2">`state`</span><span class="cm-variable-2"> are four frames stacked together. </span><span class="cm-comment cm-variable-2">`new_state`</span><span class="cm-variable-2"> is produced by stacking the observed frame (after the action is performed) onto </span><span class="cm-comment cm-variable-2">`state`</span><span class="cm-variable-2"> and removing the oldest frame. You will see the implementation later. </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable-2">* We have to discuss, how a minibatch is retured from the replay memory and how the gradient descend step is performed.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable-2">* Finally we have to look at why and how the target Q network is reset to the main Q network.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Let's continue with the replay memory</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-header cm-header-2">## 5. Replay memory</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-quote cm-quote-1">&gt;Second, learning directly from consecutive samples is inefficient, due to the strong correlations between the samples; randomizing the samples breaks these correlations and therefore reduces the variance of the updates. Third, when learning on-policy the current parameters determine the next data sample that the parameters are trained on. For example, if the maximizing action is to move left then the training samples will be dominated by samples from the left-hand side; if the maximizing action then switches to the right then the training distribution will also switch. It is easy to see how unwanted feedback loops may arise and the parameters could get stuck in a poor local minimum, or even diverge catastrophically. (</span><span class="cm-link cm-quote cm-quote-1">[page 5 of Mnih et al. 2013]</span><span class="cm-string cm-url cm-quote cm-quote-1">(https://arxiv.org/abs/1312.5602)</span><span class="cm-quote cm-quote-1">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">This means that when we choose an action and perform a step to receive a reward, the network does not learn from this last step but rather adds the transition to the replay memory. It then draws a random minibatch from the replay memory to perform a gradient descent step.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">The replay memory stores the last one million transitions. Let's recall that a transition is <span class="cm-comment">`[state, action, reward, terminal, new_state]`</span>. We therefore need to store the last one million <span class="cm-comment">`state`</span>, <span class="cm-comment">`action`</span>, <span class="cm-comment">`reward`</span>, <span class="cm-comment">`terminal`</span> and <span class="cm-comment">`new_state`</span>. If you remember that <span class="cm-comment">`state`</span> and <span class="cm-comment">`new_state`</span> are four frames each, that would be eight million frames. However, since <span class="cm-comment">`new_state`</span> is created by stacking the newest frame on top of <span class="cm-comment">`state`</span> and deleting the oldest frame, <span class="cm-comment">`new_state`</span> and <span class="cm-comment">`state`</span> share three frames. Furthermore, <span class="cm-comment">`new_state`</span> of transition i will be <span class="cm-comment">`state`</span> of transition i+1. This means that it is sufficient to store the last one million frames (84<span class="cm-em">*84 pixels) as a (1 million, 84, 84) tensor and then slicing four frames out of this tensor when we need a </span><span class="cm-em cm-comment">`state`</span><span class="cm-em"> or </span><span class="cm-em cm-comment">`new_state`</span><span class="cm-em">. </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">With one million frames of 84 by 84 pixels that need to be stored in your computers memory, we need to consider in what datatype we store them. The environment returns frames with pixel values stored as <span class="cm-comment">`uint8`</span> which can have values ranging from 0 to 255. A <span class="cm-comment">`uint8`</span> needs 8 bits. The network expects a <span class="cm-comment">`tf.float32`</span> input with pixel values between 0 and 1 (which takes four times more space than a <span class="cm-comment">`uint8`</span>). Since we want to reduce the memory requirements, we store the frames in <span class="cm-comment">`uint8`</span> and divide them by 255 before passing them to the network.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">When implementing this version of replay memory, we looked at this <span class="cm-link">[code]</span><span class="cm-string cm-url">(https://github.com/tambetm/simple_dqn/blob/master/src/replay_memory.py)</span> and ended up implementing the replay memory with some adjustments that make the code more understandable.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Let's look at the <span class="cm-comment">`ReplayMemory`</span> class below. In the constructor, we pre-allocate the memory for the frames, the actions, the rewards, the terminal states and also for the states and new states of the minibatch. </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">In the <span class="cm-comment">`add_experience`</span> method the frames etc. are written into <span class="cm-comment">`self.frames`</span> at index <span class="cm-comment">`self.current`</span> which is then increased by 1. When <span class="cm-comment">`self.current`</span> reaches the size of the replay memory (one million), it is reset to zero to overwrite the oldest frames. The method <span class="cm-comment">`_get_state`</span> slices four frames out of <span class="cm-comment">`self.frames`</span> and returns them as a <span class="cm-comment">`state`</span>.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">To understand what the method <span class="cm-comment">`_get_valid_indices`</span> does, we need to understand what an invalid index is. We store all frames the agent sees in <span class="cm-comment">`self.frames`</span>. When a game terminates (<span class="cm-comment">`terminal=True`</span>) at index i, frame at index i belongs to a different episode than the frame at i+1. We want to avoid creating a <span class="cm-comment">`state`</span> with frames from two different episodes. The same thing can happen at the index <span class="cm-comment">`self.current`</span>. </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Finally we need to make sure that an index is not smaller than the number of frames stacked toghether to create a <span class="cm-comment">`state`</span> (<span class="cm-comment">`self.agent_history_length=4`</span>), so that a <span class="cm-comment">`state`</span> and <span class="cm-comment">`new_state`</span> can be sliced out of the array. </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">The method <span class="cm-comment">`_get_valid_indices`</span> finds 32 (size of minibatch) valid indices.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">The method <span class="cm-comment">`get_minibatch`</span> returns the transitions for those indices. Pay attention that we need to transpose <span class="cm-comment">`self.states`</span> and <span class="cm-comment">`self.new_states`</span> before returning them: the DQN expects an input of the dimension <span class="cm-comment">`[None,84,84,4]`</span> whereas <span class="cm-comment">`_get_state`</span> returns a <span class="cm-comment">`state`</span> of the dimension <span class="cm-comment">`[4,84,84]`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">We now know 1) why a replay memory greatly improves the stability of the algorithm, 2) how to store a transition in the replay memory and 3) how a minibatch is returned.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 1391px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1409px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><p>We now know how the DQN predicts the best action and we have a simple answer to the exploration exploitation dilemma.
So, what else do we need to make it work? Let's take a look at the algorithm presented on page 7 in <a href="https://www.nature.com/articles/nature14236/" target="_blank">Mnih et al. 2015</a>.</p>
<p><img src="DQN%20-%20Jupyter%20Notebook_files/DQN.png" alt=""></p>
<p>Let us go through the algorithm step by step:</p>
<ul>
<li>We do not know yet what <em>replay memory</em> D is.</li>
<li>Action-value function Q is our DQN network, that we already implemented.</li>
<li>We need to discuss why a second Q network called <em>target</em> action-value function is needed.</li>
<li>At the beginning of each episode a sequence is initalized. This is 
implemented by stacking four (grayscale) frames together as discussed 
above.</li>
<li>We discussed how the action is selected (<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-116-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03F5;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-894" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.433em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.43em, 2.5em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-895"><span class="mi" id="MathJax-Span-896" style="font-family: STIXMathJax_Normal; font-style: italic;">𝜖</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 0.739em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ϵ</mi></math></span></span><script type="math/tex" id="MathJax-Element-116">\epsilon</script>-greedy).</li>
<li>When the action is performed, the environment returns the next frame and the reward for that action. <code>gym</code> additionaly returns a boolean called <code>terminal</code> that states whether the game is over and a dictionary containing the number of lives the agent has left (<code>ale.lives</code>). </li>
<li>We do not know yet, what it means to store a transition in the replay memory D. A list <code>[state, action, reward, terminal, new_state]</code> is called transition. A <code>state</code> are four frames stacked together. <code>new_state</code> is produced by stacking the observed frame (after the action is performed) onto <code>state</code> and removing the oldest frame. You will see the implementation later. </li>
<li>We have to discuss, how a minibatch is retured from the replay memory and how the gradient descend step is performed.</li>
<li>Finally we have to look at why and how the target Q network is reset to the main Q network.</li>
</ul>
<p>Let's continue with the replay memory</p>
<h2 id="5.-Replay-memory">5. Replay memory<a class="anchor-link" href="#5.-Replay-memory">¶</a></h2>
<blockquote>
<p>Second, learning directly from consecutive samples is inefficient, 
due to the strong correlations between the samples; randomizing the 
samples breaks these correlations and therefore reduces the variance of 
the updates. Third, when learning on-policy the current parameters 
determine the next data sample that the parameters are trained on. For 
example, if the maximizing action is to move left then the training 
samples will be dominated by samples from the left-hand side; if the 
maximizing action then switches to the right then the training 
distribution will also switch. It is easy to see how unwanted feedback 
loops may arise and the parameters could get stuck in a poor local 
minimum, or even diverge catastrophically. (<a href="https://arxiv.org/abs/1312.5602" target="_blank">page 5 of Mnih et al. 2013</a>)</p>
</blockquote>
<p>This means that when we choose an action and perform a step to 
receive a reward, the network does not learn from this last step but 
rather adds the transition to the replay memory. It then draws a random 
minibatch from the replay memory to perform a gradient descent step.</p>
<p>The replay memory stores the last one million transitions. Let's recall that a transition is <code>[state, action, reward, terminal, new_state]</code>. We therefore need to store the last one million <code>state</code>, <code>action</code>, <code>reward</code>, <code>terminal</code> and <code>new_state</code>. If you remember that <code>state</code> and <code>new_state</code> are four frames each, that would be eight million frames. However, since <code>new_state</code> is created by stacking the newest frame on top of <code>state</code> and deleting the oldest frame, <code>new_state</code> and <code>state</code> share three frames. Furthermore, <code>new_state</code> of transition i will be <code>state</code>
 of transition i+1. This means that it is sufficient to store the last 
one million frames (84*84 pixels) as a (1 million, 84, 84) tensor and 
then slicing four frames out of this tensor when we need a <code>state</code> or <code>new_state</code>. </p>
<p>With one million frames of 84 by 84 pixels that need to be stored in 
your computers memory, we need to consider in what datatype we store 
them. The environment returns frames with pixel values stored as <code>uint8</code> which can have values ranging from 0 to 255. A <code>uint8</code> needs 8 bits. The network expects a <code>tf.float32</code> input with pixel values between 0 and 1 (which takes four times more space than a <code>uint8</code>). Since we want to reduce the memory requirements, we store the frames in <code>uint8</code> and divide them by 255 before passing them to the network.</p>
<p>When implementing this version of replay memory, we looked at this <a href="https://github.com/tambetm/simple_dqn/blob/master/src/replay_memory.py" target="_blank">code</a> and ended up implementing the replay memory with some adjustments that make the code more understandable.</p>
<p>Let's look at the <code>ReplayMemory</code> class below. In the 
constructor, we pre-allocate the memory for the frames, the actions, the
 rewards, the terminal states and also for the states and new states of 
the minibatch. </p>
<p>In the <code>add_experience</code> method the frames etc. are written into <code>self.frames</code> at index <code>self.current</code> which is then increased by 1. When <code>self.current</code> reaches the size of the replay memory (one million), it is reset to zero to overwrite the oldest frames. The method <code>_get_state</code> slices four frames out of <code>self.frames</code> and returns them as a <code>state</code>.</p>
<p>To understand what the method <code>_get_valid_indices</code> does, we need to understand what an invalid index is. We store all frames the agent sees in <code>self.frames</code>. When a game terminates (<code>terminal=True</code>) at index i, frame at index i belongs to a different episode than the frame at i+1. We want to avoid creating a <code>state</code> with frames from two different episodes. The same thing can happen at the index <code>self.current</code>. </p>
<p>Finally we need to make sure that an index is not smaller than the number of frames stacked toghether to create a <code>state</code> (<code>self.agent_history_length=4</code>), so that a <code>state</code> and <code>new_state</code> can be sliced out of the array. </p>
<p>The method <code>_get_valid_indices</code> finds 32 (size of minibatch) valid indices.
The method <code>get_minibatch</code> returns the transitions for those indices. Pay attention that we need to transpose <code>self.states</code> and <code>self.new_states</code> before returning them: the DQN expects an input of the dimension <code>[None,84,84,4]</code> whereas <code>_get_state</code> returns a <code>state</code> of the dimension <code>[4,84,84]</code></p>
<p>We now know 1) why a replay memory greatly improves the stability of 
the algorithm, 2) how to store a transition in the replay memory and 3) 
how a minibatch is returned.</p>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt_container"><div class="prompt input_prompt"><bdi>In</bdi>&nbsp;[&nbsp;]:</div><div class="run_this_cell" title="Run this cell"><i class="fa-step-forward fa"></i></div></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit code here"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.60059px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 12px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true" style="display: block; right: 0px; left: 0px;"><div style="height: 100%; min-height: 1px; width: 1609px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true" style="height: 12px; width: 12px;"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 1608.6px; margin-bottom: -12px; border-right-width: 18px; min-height: 1473px; padding-right: 0px; padding-bottom: 12px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-keyword">class</span> <span class="cm-def">ReplayMemory</span>(<span class="cm-builtin">object</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-string">"""Replay Memory that stores the last size=1,000,000 transitions"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-keyword">def</span> <span class="cm-def">__init__</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-number">1000000</span>, <span class="cm-variable">frame_height</span><span class="cm-operator">=</span><span class="cm-number">84</span>, <span class="cm-variable">frame_width</span><span class="cm-operator">=</span><span class="cm-number">84</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                 <span class="cm-variable">agent_history_length</span><span class="cm-operator">=</span><span class="cm-number">4</span>, <span class="cm-variable">batch_size</span><span class="cm-operator">=</span><span class="cm-number">32</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        Args:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            size: Integer, Number of stored transitions</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            frame_height: Integer, Height of a frame of an Atari game</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            frame_width: Integer, Width of a frame of an Atari game</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            agent_history_length: Integer, Number of frames stacked together to create a state</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            batch_size: Integer, Number if transitions returned in a minibatch</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        """</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">size</span> <span class="cm-operator">=</span> <span class="cm-variable">size</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">frame_height</span> <span class="cm-operator">=</span> <span class="cm-variable">frame_height</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">frame_width</span> <span class="cm-operator">=</span> <span class="cm-variable">frame_width</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">agent_history_length</span> <span class="cm-operator">=</span> <span class="cm-variable">agent_history_length</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">batch_size</span> <span class="cm-operator">=</span> <span class="cm-variable">batch_size</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">count</span> <span class="cm-operator">=</span> <span class="cm-number">0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">current</span> <span class="cm-operator">=</span> <span class="cm-number">0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-comment"># Pre-allocate memory</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">actions</span> <span class="cm-operator">=</span> <span class="cm-variable">np</span>.<span class="cm-property">empty</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">size</span>, <span class="cm-variable">dtype</span><span class="cm-operator">=</span><span class="cm-variable">np</span>.<span class="cm-property">int32</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">rewards</span> <span class="cm-operator">=</span> <span class="cm-variable">np</span>.<span class="cm-property">empty</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">size</span>, <span class="cm-variable">dtype</span><span class="cm-operator">=</span><span class="cm-variable">np</span>.<span class="cm-property">float32</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">frames</span> <span class="cm-operator">=</span> <span class="cm-variable">np</span>.<span class="cm-property">empty</span>((<span class="cm-variable-2">self</span>.<span class="cm-property">size</span>, <span class="cm-variable-2">self</span>.<span class="cm-property">frame_height</span>, <span class="cm-variable-2">self</span>.<span class="cm-property">frame_width</span>), <span class="cm-variable">dtype</span><span class="cm-operator">=</span><span class="cm-variable">np</span>.<span class="cm-property">uint8</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">terminal_flags</span> <span class="cm-operator">=</span> <span class="cm-variable">np</span>.<span class="cm-property">empty</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">size</span>, <span class="cm-variable">dtype</span><span class="cm-operator">=</span><span class="cm-variable">np</span>.<span class="cm-property">bool</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-comment"># Pre-allocate memory for the states and new_states in a minibatch</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">states</span> <span class="cm-operator">=</span> <span class="cm-variable">np</span>.<span class="cm-property">empty</span>((<span class="cm-variable-2">self</span>.<span class="cm-property">batch_size</span>, <span class="cm-variable-2">self</span>.<span class="cm-property">agent_history_length</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                <span class="cm-variable-2">self</span>.<span class="cm-property">frame_height</span>, <span class="cm-variable-2">self</span>.<span class="cm-property">frame_width</span>), <span class="cm-variable">dtype</span><span class="cm-operator">=</span><span class="cm-variable">np</span>.<span class="cm-property">uint8</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">new_states</span> <span class="cm-operator">=</span> <span class="cm-variable">np</span>.<span class="cm-property">empty</span>((<span class="cm-variable-2">self</span>.<span class="cm-property">batch_size</span>, <span class="cm-variable-2">self</span>.<span class="cm-property">agent_history_length</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                    <span class="cm-variable-2">self</span>.<span class="cm-property">frame_height</span>, <span class="cm-variable-2">self</span>.<span class="cm-property">frame_width</span>), <span class="cm-variable">dtype</span><span class="cm-operator">=</span><span class="cm-variable">np</span>.<span class="cm-property">uint8</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">indices</span> <span class="cm-operator">=</span> <span class="cm-variable">np</span>.<span class="cm-property">empty</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">batch_size</span>, <span class="cm-variable">dtype</span><span class="cm-operator">=</span><span class="cm-variable">np</span>.<span class="cm-property">int32</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-keyword">def</span> <span class="cm-def">add_experience</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">action</span>, <span class="cm-variable">frame</span>, <span class="cm-variable">reward</span>, <span class="cm-variable">terminal</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        Args:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            action: An integer between 0 and env.action_space.n - 1 </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">                determining the action the agent perfomed</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            frame: A (84, 84, 1) frame of an Atari game in grayscale</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            reward: A float determining the reward the agend received for performing an action</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            terminal: A bool stating whether the episode terminated</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        """</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">if</span> <span class="cm-variable">frame</span>.<span class="cm-property">shape</span> <span class="cm-operator">!=</span> (<span class="cm-variable-2">self</span>.<span class="cm-property">frame_height</span>, <span class="cm-variable-2">self</span>.<span class="cm-property">frame_width</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-keyword">raise</span> <span class="cm-variable">ValueError</span>(<span class="cm-string">'Dimension of frame is wrong!'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">actions</span>[<span class="cm-variable-2">self</span>.<span class="cm-property">current</span>] <span class="cm-operator">=</span> <span class="cm-variable">action</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">frames</span>[<span class="cm-variable-2">self</span>.<span class="cm-property">current</span>, ...] <span class="cm-operator">=</span> <span class="cm-variable">frame</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">rewards</span>[<span class="cm-variable-2">self</span>.<span class="cm-property">current</span>] <span class="cm-operator">=</span> <span class="cm-variable">reward</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">terminal_flags</span>[<span class="cm-variable-2">self</span>.<span class="cm-property">current</span>] <span class="cm-operator">=</span> <span class="cm-variable">terminal</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">count</span> <span class="cm-operator">=</span> <span class="cm-builtin">max</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">count</span>, <span class="cm-variable-2">self</span>.<span class="cm-property">current</span><span class="cm-operator">+</span><span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">current</span> <span class="cm-operator">=</span> (<span class="cm-variable-2">self</span>.<span class="cm-property">current</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">%</span> <span class="cm-variable-2">self</span>.<span class="cm-property">size</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">             </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-keyword">def</span> <span class="cm-def">_get_state</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">index</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">if</span> <span class="cm-variable-2">self</span>.<span class="cm-property">count</span> <span class="cm-keyword">is</span> <span class="cm-number">0</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-keyword">raise</span> <span class="cm-variable">ValueError</span>(<span class="cm-string">"The replay memory is empty!"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">if</span> <span class="cm-variable">index</span> <span class="cm-operator">&lt;</span> <span class="cm-variable-2">self</span>.<span class="cm-property">agent_history_length</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-keyword">raise</span> <span class="cm-variable">ValueError</span>(<span class="cm-string">"Index must be min 3"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">return</span> <span class="cm-variable-2">self</span>.<span class="cm-property">frames</span>[<span class="cm-variable">index</span><span class="cm-operator">-</span><span class="cm-variable-2">self</span>.<span class="cm-property">agent_history_length</span><span class="cm-operator">+</span><span class="cm-number">1</span>:<span class="cm-variable">index</span><span class="cm-operator">+</span><span class="cm-number">1</span>, ...]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-keyword">def</span> <span class="cm-def">_get_valid_indices</span>(<span class="cm-variable-2">self</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">for</span> <span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">batch_size</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-keyword">while</span> <span class="cm-keyword">True</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                <span class="cm-variable">index</span> <span class="cm-operator">=</span> <span class="cm-variable">random</span>.<span class="cm-property">randint</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">agent_history_length</span>, <span class="cm-variable-2">self</span>.<span class="cm-property">count</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                <span class="cm-keyword">if</span> <span class="cm-variable">index</span> <span class="cm-operator">&lt;</span> <span class="cm-variable-2">self</span>.<span class="cm-property">agent_history_length</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-keyword">continue</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                <span class="cm-keyword">if</span> <span class="cm-variable">index</span> <span class="cm-operator">&gt;=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">current</span> <span class="cm-keyword">and</span> <span class="cm-variable">index</span> <span class="cm-operator">-</span> <span class="cm-variable-2">self</span>.<span class="cm-property">agent_history_length</span> <span class="cm-operator">&lt;=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">current</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-keyword">continue</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                <span class="cm-keyword">if</span> <span class="cm-variable-2">self</span>.<span class="cm-property">terminal_flags</span>[<span class="cm-variable">index</span> <span class="cm-operator">-</span> <span class="cm-variable-2">self</span>.<span class="cm-property">agent_history_length</span>:<span class="cm-variable">index</span>].<span class="cm-property">any</span>():</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-keyword">continue</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                <span class="cm-keyword">break</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable-2">self</span>.<span class="cm-property">indices</span>[<span class="cm-variable">i</span>] <span class="cm-operator">=</span> <span class="cm-variable">index</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-keyword">def</span> <span class="cm-def">get_minibatch</span>(<span class="cm-variable-2">self</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        Returns a minibatch of self.batch_size = 32 transitions</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        """</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">if</span> <span class="cm-variable-2">self</span>.<span class="cm-property">count</span> <span class="cm-operator">&lt;</span> <span class="cm-variable-2">self</span>.<span class="cm-property">agent_history_length</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-keyword">raise</span> <span class="cm-variable">ValueError</span>(<span class="cm-string">'Not enough memories to get a minibatch'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">_get_valid_indices</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">for</span> <span class="cm-variable">i</span>, <span class="cm-variable">idx</span> <span class="cm-keyword">in</span> <span class="cm-builtin">enumerate</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">indices</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable-2">self</span>.<span class="cm-property">states</span>[<span class="cm-variable">i</span>] <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">_get_state</span>(<span class="cm-variable">idx</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable-2">self</span>.<span class="cm-property">new_states</span>[<span class="cm-variable">i</span>] <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">_get_state</span>(<span class="cm-variable">idx</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">return</span> <span class="cm-variable">np</span>.<span class="cm-property">transpose</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">states</span>, <span class="cm-variable">axes</span><span class="cm-operator">=</span>(<span class="cm-number">0</span>, <span class="cm-number">2</span>, <span class="cm-number">3</span>, <span class="cm-number">1</span>)), <span class="cm-variable-2">self</span>.<span class="cm-property">actions</span>[<span class="cm-variable-2">self</span>.<span class="cm-property">indices</span>], <span class="cm-variable-2">self</span>.<span class="cm-property">rewards</span>[<span class="cm-variable-2">self</span>.<span class="cm-property">indices</span>], <span class="cm-variable">np</span>.<span class="cm-property">transpose</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">new_states</span>, <span class="cm-variable">axes</span><span class="cm-operator">=</span>(<span class="cm-number">0</span>, <span class="cm-number">2</span>, <span class="cm-number">3</span>, <span class="cm-number">1</span>)), <span class="cm-variable-2">self</span>.<span class="cm-property">terminal_flags</span>[<span class="cm-variable-2">self</span>.<span class="cm-property">indices</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                </span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 12px solid transparent; top: 1473px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1503px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output"></div><div class="output"></div><div style="display: none;" class="btn btn-default output_collapsed" title="click to expand output">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit Markup Text here"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.60059px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -12px; border-right-width: 18px; min-height: 2159px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 20px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-header cm-header-2">## 6. Target network and parameter update</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Why do we need two networks, the action-value function and the <span class="cm-em">*target*</span> action-value function?</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Remember that prior to updating the network's parameters, we draw a minibatch with 32 transitions. For simplicity we consider one transition now. It consists of a <span class="cm-comment">`state`</span>, an <span class="cm-comment">`action`</span> that was performed in the <span class="cm-comment">`state`</span>, the received <span class="cm-comment">`reward`</span>, the <span class="cm-comment">`new_state`</span> and a bool saying whether the episode is over.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">We perform a gradient descent step:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">The main network looks at state and estimates the <span class="cm-delimit cm-delimit-open">$</span>Q_<span class="cm-tag">\text</span><span class="cm-bracket">{</span>prediction<span class="cm-bracket">}</span><span class="cm-delimit cm-delimit-close">$</span>-values that say how good each action is. However, we want the <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-values to follow the Bellman equation we introduced above. Therefore we calculate the <span class="cm-delimit cm-delimit-open">$</span>Q_<span class="cm-tag">\text</span><span class="cm-bracket">{</span>target<span class="cm-bracket">}</span><span class="cm-delimit cm-delimit-close">$</span>-values according to the Bellman equation (how we would like the <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-values to be) and then compare the estimates <span class="cm-delimit cm-delimit-open">$</span>Q_<span class="cm-tag">\text</span><span class="cm-bracket">{</span>prediction<span class="cm-bracket">}</span><span class="cm-delimit cm-delimit-close">$</span> to the targets <span class="cm-delimit cm-delimit-open">$</span>Q_<span class="cm-tag">\text</span><span class="cm-bracket">{</span>target<span class="cm-bracket">}</span><span class="cm-delimit cm-delimit-close">$</span>. Let's consider the quadratic loss function instead of the Huber loss function for simplicity:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">\begin{equation}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">L = \frac{1}{2}\left(Q_\text{prediction} - Q_\text{target}\right)^2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">\end{equation}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">This ensures that we regress the current <span class="cm-delimit cm-delimit-open">$</span>Q_<span class="cm-tag">\text</span><span class="cm-bracket">{</span>prediction<span class="cm-bracket">}</span><span class="cm-delimit cm-delimit-close">$</span>-values for <span class="cm-comment">`state`</span> towards the <span class="cm-delimit cm-delimit-open">$</span>Q_<span class="cm-tag">\text</span><span class="cm-bracket">{</span>target<span class="cm-bracket">}</span><span class="cm-delimit cm-delimit-close">$</span>-values given by the Bellman equation.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-delimit cm-delimit-open">$</span>Q_<span class="cm-tag">\text</span><span class="cm-bracket">{</span>prediction<span class="cm-bracket">}</span><span class="cm-delimit cm-delimit-close">$</span> is calculated in the <span class="cm-comment">`DQN`</span> class (<span class="cm-comment">`self.q_values`</span>). <span class="cm-delimit cm-delimit-open">$</span>Q_<span class="cm-tag">\text</span><span class="cm-bracket">{</span>prediction<span class="cm-bracket">}</span><span class="cm-delimit cm-delimit-close">$</span> depends on the current <span class="cm-comment">`state`</span> in the minibatch we drew and on the parameters <span class="cm-delimit cm-delimit-open">$</span><span class="cm-tag">\theta</span><span class="cm-delimit cm-delimit-close">$</span> of the network that estimates it.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">The <span class="cm-delimit cm-delimit-open">$</span>Q_<span class="cm-tag">\text</span><span class="cm-bracket">{</span>target<span class="cm-bracket">}</span><span class="cm-delimit cm-delimit-close">$</span> value is calculated according to the Bellman equation. It is the sum of the immediate reward <span class="cm-delimit cm-delimit-open">$</span>r<span class="cm-delimit cm-delimit-close">$</span> received for performing action <span class="cm-delimit cm-delimit-open">$</span>a<span class="cm-delimit cm-delimit-close">$</span> in state <span class="cm-delimit cm-delimit-open">$</span>s<span class="cm-delimit cm-delimit-close">$</span> (<span class="cm-comment">`action`</span> and <span class="cm-comment">`state`</span> from the minibatch) and the maximum <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-value over all possible actions <span class="cm-delimit cm-delimit-open">$</span>a'<span class="cm-delimit cm-delimit-close">$</span> in <span class="cm-delimit cm-delimit-open">$</span>s'<span class="cm-delimit cm-delimit-close">$</span> (<span class="cm-comment">`new_state`</span> from the minibatch):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">\begin{equation}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Q_\text{target}(s,a) = r + \gamma \textrm{max} \left(Q(s',a')\right)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">\end{equation}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">This is not done in the <span class="cm-comment">`DQN`</span> class but in the <span class="cm-comment">`learn`</span> method below. The calculated value is then passed to the placeholder called <span class="cm-comment">`self.target_q`</span> in the <span class="cm-comment">`DQN`</span> class. There, the loss function is defined and the gradient descent step is performed.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">So, now that we understand how the parameters are updated, why use two networks?</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">The problem is that both <span class="cm-delimit cm-delimit-open">$</span>Q_<span class="cm-tag">\text</span><span class="cm-bracket">{</span>prediction<span class="cm-bracket">}</span><span class="cm-delimit cm-delimit-close">$</span> and <span class="cm-delimit cm-delimit-open">$</span>Q_<span class="cm-tag">\text</span><span class="cm-bracket">{</span>target<span class="cm-bracket">}</span><span class="cm-delimit cm-delimit-close">$</span> depend on the same parameters <span class="cm-delimit cm-delimit-open">$</span><span class="cm-tag">\theta</span><span class="cm-delimit cm-delimit-close">$</span> if only one network is used. This can lead to instability when regressing <span class="cm-delimit cm-delimit-open">$</span>Q_<span class="cm-tag">\text</span><span class="cm-bracket">{</span>prediction<span class="cm-bracket">}</span><span class="cm-delimit cm-delimit-close">$</span> towards <span class="cm-delimit cm-delimit-open">$</span>Q_<span class="cm-tag">\text</span><span class="cm-bracket">{</span>target<span class="cm-bracket">}</span><span class="cm-delimit cm-delimit-close">$</span> because the "target is moving". We ensure a "fixed target" by introducing a second network with fixed and only occasionally updated parameters that estimates the target <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-values.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">On page 1 of <span class="cm-link">[Mnih et al. 2015]</span><span class="cm-string cm-url">(https://www.nature.com/articles/nature14236/)</span> the authors explain:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-quote cm-quote-1">&gt;Reinforcement learning is known to be unstable or even to diverge when a nonlinear function approximator such as a neural network is used to represent the action-value (also known as Q) function. This instability has several causes: the correlations present in the sequence of observations, the fact that small updates to Q may significantly change the policy and therefore change the data distribution, and the correlations between the action-values </span><span class="cm-link cm-quote cm-quote-1">[...]</span><span class="cm-quote cm-quote-1"> and the target values </span><span class="cm-link cm-quote cm-quote-1">[...]</span><span class="cm-quote cm-quote-1">.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-quote cm-quote-1">We address these instabilities with a novel variant of Q-learning, which uses two key ideas. First, we used a biologically inspired mechanism termed experience replay that randomizes over the data, thereby removing correlations in the observation sequence and smoothing over changes in the data distribution </span><span class="cm-link cm-quote cm-quote-1">[...]</span><span class="cm-quote cm-quote-1">. Second, we used an iterative update that adjusts the action-values (Q) towards target values that are only periodically updated, thereby reducing correlations with the target. </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Therefore they used one network to predict the <span class="cm-delimit cm-delimit-open">$</span>Q_<span class="cm-tag">\text</span><span class="cm-bracket">{</span>prediction<span class="cm-bracket">}</span><span class="cm-delimit cm-delimit-close">$</span>-value and the other fixed network to predict the <span class="cm-delimit cm-delimit-open">$</span>Q_<span class="cm-tag">\text</span><span class="cm-bracket">{</span>target<span class="cm-bracket">}</span><span class="cm-delimit cm-delimit-close">$</span>-value. The main network is optimized during the gradient descend step and every 10000 steps the main network's parameters are copied to the target network. Be aware that the network update frequency is measured in the number of chosen actions/frames seen (DeepMind code) and not the number of parameter updates which occur every four frames (<span class="cm-link">[Mnih et al. 2015]</span><span class="cm-string cm-url">(https://www.nature.com/articles/nature14236/)</span>).</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">There is one additional very powerful improvement called <span class="cm-em">*Double Q-Learning*</span>.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-header cm-header-2">## 7. Double Q-Learning</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">DQN has been observed to estimate unrealistically high <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-values. The reason for this is, that the Bellman equation <span class="cm-em">*includes a maximization step over estimated action values, which tends to prefer overestimated to underestimated values*</span> (see <span class="cm-link">[van Hasselt et al. 2016, page 1]</span><span class="cm-string cm-url">(http://www.aaai.org/ocs/index.php/AAAI/AAAI16/paper/download/12389/11847)</span>). </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">The authors explain:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-quote cm-quote-1">&gt;If all values would be uniformly higher then the relative action preferences are preserved and we would not expect the resulting policy to be any worse. </span><span class="cm-link cm-quote cm-quote-1">[...]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-quote cm-quote-1">If, however, the overestimations are not uniform and not concentrated at states about which we wish to learn more, then they might negatively affect the quality of the resulting policy. </span><span class="cm-link cm-quote cm-quote-1">[...]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-quote cm-quote-1">We then show that this algorithm not only yields more accurate value estimates, but leads to much higher scores on several games. This demonstrates that the overestimations of DQN were indeed leading to poorer policies and that it is beneficial to reduce them </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">The estimated <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-values are noisy. Assume that the true <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-value is 0 for all actions. But because of the noisy estimation, some <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-values might be slightly positive, others slightly negative. The max operation in the Bellman equation will however always chose the small positive values, despite the fact, that those actions are not truly better. The estimatation of <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-values is thus biased towards larger values. How do we fix this?</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Instead of estimating the <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-values in the next state <span class="cm-delimit cm-delimit-open">$</span>Q(s',a')<span class="cm-delimit cm-delimit-close">$</span> with only the target network, we use the main network to estimate which action is the best and then ask the target network how high the <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-value is for that action. This way, the main network will still prefer the action with the small positive <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-value but because of the noisy estimation, the target network will predict a small positive <span class="cm-strong">**or**</span> small negative <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-value for that action and on average, the predicted <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-values will be closer to 0.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Mathematically, the reason for the overestimation is, that the expectation of a maximum is greater than or equal to the maximum of an expectation <span class="cm-link">[van Hasselt 2013, Theorem 1]</span><span class="cm-string cm-url">(https://arxiv.org/abs/1302.7175)</span>.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">The Bellman equation changes from</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">\begin{align}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Q_\text{target}(s,a) &amp;= r + \gamma \textrm{max} Q(s',a';\theta_\text{target}) &amp;\text{Normal DQN}\\</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">\text{to}\qquad\qquad Q_\text{target}(s,a) &amp;= r + \gamma Q\left(s',a'=\text{argmax} Q(s',a';\theta_\text{main});\theta_\text{target}\right)&amp;\text{Double DQN}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">\end{align}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">The main network estimates which action <span class="cm-delimit cm-delimit-open">$</span>a'<span class="cm-delimit cm-delimit-close">$</span> (in the next state <span class="cm-delimit cm-delimit-open">$</span>s'<span class="cm-delimit cm-delimit-close">$</span>) is best (that is the <span class="cm-delimit cm-delimit-open">$</span><span class="cm-tag">\text</span><span class="cm-bracket">{</span>argmax<span class="cm-bracket">}</span> Q(s',a';<span class="cm-tag">\theta</span>_<span class="cm-tag">\text</span><span class="cm-bracket">{</span>main<span class="cm-bracket">}</span>)<span class="cm-delimit cm-delimit-close">$</span> part). The target network then estimates what the <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-value for that action is. This <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-value has to be discounted with <span class="cm-delimit cm-delimit-open">$</span><span class="cm-tag">\gamma</span><span class="cm-delimit cm-delimit-close">$</span> and is then added to the reward <span class="cm-delimit cm-delimit-open">$</span>r<span class="cm-delimit cm-delimit-close">$</span> the agent got for action <span class="cm-delimit cm-delimit-open">$</span>a<span class="cm-delimit cm-delimit-close">$</span> (not <span class="cm-delimit cm-delimit-open">$</span>a'<span class="cm-delimit cm-delimit-close">$</span>).</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">I know that this equation might look discouraging. So let's describe it again in words:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Normal DQN: Ask the target network for the highest <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-Value. If the noisy <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-values are for example <span class="cm-delimit cm-delimit-open">$</span>(0.1,-0.1)<span class="cm-delimit cm-delimit-close">$</span> for actions with index <span class="cm-delimit cm-delimit-open">$</span><span class="cm-atom">0</span><span class="cm-delimit cm-delimit-close">$</span> and <span class="cm-delimit cm-delimit-open">$</span><span class="cm-atom">1</span><span class="cm-delimit cm-delimit-close">$</span> respectively, the target <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-network will answer <span class="cm-delimit cm-delimit-open">$</span><span class="cm-atom">0.1</span><span class="cm-delimit cm-delimit-close">$</span>.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Double DQN: Ask the main network which action has the highest <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-value. If the noisy <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-values are for example <span class="cm-delimit cm-delimit-open">$</span>(0.1,-0.1)<span class="cm-delimit cm-delimit-close">$</span> for actions with index <span class="cm-delimit cm-delimit-open">$</span><span class="cm-atom">0</span><span class="cm-delimit cm-delimit-close">$</span> and <span class="cm-delimit cm-delimit-open">$</span><span class="cm-atom">1</span><span class="cm-delimit cm-delimit-close">$</span> respectively, the main network will answer that action with index <span class="cm-delimit cm-delimit-open">$</span><span class="cm-atom">0</span><span class="cm-delimit cm-delimit-close">$</span> has the highest <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-value. Then we ask the target network, which has a different noise, what the <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-value for the action with the chosen index (<span class="cm-delimit cm-delimit-open">$</span><span class="cm-atom">0</span><span class="cm-delimit cm-delimit-close">$</span> in this example) is. Let's assume the target network's noisy estimates are <span class="cm-delimit cm-delimit-open">$</span>(-0.05,0.3)<span class="cm-delimit cm-delimit-close">$</span> it will answer <span class="cm-delimit cm-delimit-open">$</span>-0.05<span class="cm-delimit cm-delimit-close">$</span>.<span class="cm-trailing-space-a"> </span><span class="cm-trailing-space-new-line"> </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">This solves the problem of overestimated <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-values because the two networks have different noise and the bias towards slightly larger noisy <span class="cm-delimit cm-delimit-open">$</span>Q<span class="cm-delimit cm-delimit-close">$</span>-values cancels.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">One more thing:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">If the game is over (<span class="cm-comment">`terminal=True`</span>) because the agend lost or won, there is no next state and the <span class="cm-delimit cm-delimit-open">$</span>Q_<span class="cm-tag">\text</span><span class="cm-bracket">{</span>target<span class="cm-bracket">}</span><span class="cm-delimit cm-delimit-close">$</span>-value is simply the reward <span class="cm-delimit cm-delimit-open">$</span>r<span class="cm-delimit cm-delimit-close">$</span>.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Look at the implementation in the cell below.</span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 2159px;"></div><div class="CodeMirror-gutters" style="display: none; height: 2177px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><h2 id="6.-Target-network-and-parameter-update">6. Target network and parameter update<a class="anchor-link" href="#6.-Target-network-and-parameter-update">¶</a></h2>
<p>Why do we need two networks, the action-value function and the <em>target</em> action-value function?</p>
<p>Remember that prior to updating the network's parameters, we draw a 
minibatch with 32 transitions. For simplicity we consider one transition
 now. It consists of a <code>state</code>, an <code>action</code> that was performed in the <code>state</code>, the received <code>reward</code>, the <code>new_state</code> and a bool saying whether the episode is over.</p>
<p>We perform a gradient descent step:
The main network looks at state and estimates the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-117-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mtext&gt;prediction&lt;/mtext&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-897" style="width: 4.927em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.734em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.281em, 1003.73em, 2.576em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-898"><span class="msubsup" id="MathJax-Span-899"><span style="display: inline-block; position: relative; width: 3.723em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-900" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.781em;"><span class="mtext" id="MathJax-Span-901" style="font-size: 70.7%; font-family: STIXMathJax_Main;">prediction</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.472em; border-left: 0px solid; width: 0px; height: 1.424em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>Q</mi><mtext>prediction</mtext></msub></math></span></span><script type="math/tex" id="MathJax-Element-117">Q_\text{prediction}</script>-values that say how good each action is. However, we want the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-118-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-902" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-903"><span class="mi" id="MathJax-Span-904" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-118">Q</script>-values to follow the Bellman equation we introduced above. Therefore we calculate the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-119-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mtext&gt;target&lt;/mtext&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-905" style="width: 3.304em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.489em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.281em, 1002.49em, 2.577em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-906"><span class="msubsup" id="MathJax-Span-907"><span style="display: inline-block; position: relative; width: 2.466em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-908" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.781em;"><span class="mtext" id="MathJax-Span-909" style="font-size: 70.7%; font-family: STIXMathJax_Main;">target</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.473em; border-left: 0px solid; width: 0px; height: 1.425em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>Q</mi><mtext>target</mtext></msub></math></span></span><script type="math/tex" id="MathJax-Element-119">Q_\text{target}</script>-values according to the Bellman equation (how we would like the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-120-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-910" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-911"><span class="mi" id="MathJax-Span-912" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-120">Q</script>-values to be) and then compare the estimates <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-121-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mtext&gt;prediction&lt;/mtext&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-913" style="width: 4.927em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.734em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.281em, 1003.73em, 2.576em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-914"><span class="msubsup" id="MathJax-Span-915"><span style="display: inline-block; position: relative; width: 3.723em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-916" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.781em;"><span class="mtext" id="MathJax-Span-917" style="font-size: 70.7%; font-family: STIXMathJax_Main;">prediction</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.472em; border-left: 0px solid; width: 0px; height: 1.424em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>Q</mi><mtext>prediction</mtext></msub></math></span></span><script type="math/tex" id="MathJax-Element-121">Q_\text{prediction}</script> to the targets <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-122-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mtext&gt;target&lt;/mtext&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-918" style="width: 3.304em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.489em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.281em, 1002.49em, 2.577em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-919"><span class="msubsup" id="MathJax-Span-920"><span style="display: inline-block; position: relative; width: 2.466em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-921" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.781em;"><span class="mtext" id="MathJax-Span-922" style="font-size: 70.7%; font-family: STIXMathJax_Main;">target</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.473em; border-left: 0px solid; width: 0px; height: 1.425em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>Q</mi><mtext>target</mtext></msub></math></span></span><script type="math/tex" id="MathJax-Element-122">Q_\text{target}</script>. Let's consider the quadratic loss function instead of the Huber loss function for simplicity:</p>
<p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-123-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/mfrac&gt;&lt;msup&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mtext&gt;prediction&lt;/mtext&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mtext&gt;target&lt;/mtext&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-923" style="width: 15.371em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.634em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(0.974em, 1011.63em, 3.337em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-924"><span class="mi" id="MathJax-Span-925" style="font-family: STIXMathJax_Normal; font-style: italic;">𝐿</span><span class="mo" id="MathJax-Span-926" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mfrac" id="MathJax-Span-927" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 0.62em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.166em, 1000.39em, 4.167em, -1000em); top: -4.681em; left: 50%; margin-left: -0.25em;"><span class="mn" id="MathJax-Span-928" style="font-family: STIXMathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; clip: rect(3.166em, 1000.47em, 4.167em, -1000em); top: -3.318em; left: 50%; margin-left: -0.25em;"><span class="mn" id="MathJax-Span-929" style="font-family: STIXMathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; clip: rect(0.852em, 1000.62em, 1.245em, -1000em); top: -1.302em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.62em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.082em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-930"><span style="display: inline-block; position: relative; width: 8.739em; height: 0px;"><span style="position: absolute; clip: rect(2.977em, 1008.17em, 4.532em, -1000em); top: -4.004em; left: 0em;"><span class="mrow" id="MathJax-Span-931"><span class="mo" id="MathJax-Span-932" style="vertical-align: -0.201em;"><span style="font-family: STIXMathJax_Size1;">(</span></span><span class="msubsup" id="MathJax-Span-933"><span style="display: inline-block; position: relative; width: 3.723em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-934" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.781em;"><span class="mtext" id="MathJax-Span-935" style="font-size: 70.7%; font-family: STIXMathJax_Main;">prediction</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-936" style="font-family: STIXMathJax_Main; padding-left: 0.25em;">−</span><span class="msubsup" id="MathJax-Span-937" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 2.466em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-938" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.781em;"><span class="mtext" id="MathJax-Span-939" style="font-size: 70.7%; font-family: STIXMathJax_Main;">target</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-940" style="vertical-align: -0.201em;"><span style="font-family: STIXMathJax_Size1;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.596em; left: 8.31em;"><span class="mn" id="MathJax-Span-941" style="font-size: 70.7%; font-family: STIXMathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.977em; border-left: 0px solid; width: 0px; height: 2.834em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>L</mi><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><msup><mrow><mo>(</mo><msub><mi>Q</mi><mtext>prediction</mtext></msub><mo>−</mo><msub><mi>Q</mi><mtext>target</mtext></msub><mo>)</mo></mrow><mn>2</mn></msup></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-123">\begin{equation}
L = \frac{1}{2}\left(Q_\text{prediction} - Q_\text{target}\right)^2
\end{equation}</script></p>
<p>This ensures that we regress the current <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-124-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mtext&gt;prediction&lt;/mtext&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-942" style="width: 4.927em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.734em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.281em, 1003.73em, 2.576em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-943"><span class="msubsup" id="MathJax-Span-944"><span style="display: inline-block; position: relative; width: 3.723em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-945" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.781em;"><span class="mtext" id="MathJax-Span-946" style="font-size: 70.7%; font-family: STIXMathJax_Main;">prediction</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.472em; border-left: 0px solid; width: 0px; height: 1.424em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>Q</mi><mtext>prediction</mtext></msub></math></span></span><script type="math/tex" id="MathJax-Element-124">Q_\text{prediction}</script>-values for <code>state</code> towards the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-125-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mtext&gt;target&lt;/mtext&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-947" style="width: 3.304em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.489em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.281em, 1002.49em, 2.577em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-948"><span class="msubsup" id="MathJax-Span-949"><span style="display: inline-block; position: relative; width: 2.466em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-950" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.781em;"><span class="mtext" id="MathJax-Span-951" style="font-size: 70.7%; font-family: STIXMathJax_Main;">target</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.473em; border-left: 0px solid; width: 0px; height: 1.425em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>Q</mi><mtext>target</mtext></msub></math></span></span><script type="math/tex" id="MathJax-Element-125">Q_\text{target}</script>-values given by the Bellman equation.</p>
<p><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-126-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mtext&gt;prediction&lt;/mtext&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-952" style="width: 4.927em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.734em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.281em, 1003.73em, 2.576em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-953"><span class="msubsup" id="MathJax-Span-954"><span style="display: inline-block; position: relative; width: 3.723em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-955" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.781em;"><span class="mtext" id="MathJax-Span-956" style="font-size: 70.7%; font-family: STIXMathJax_Main;">prediction</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.472em; border-left: 0px solid; width: 0px; height: 1.424em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>Q</mi><mtext>prediction</mtext></msub></math></span></span><script type="math/tex" id="MathJax-Element-126">Q_\text{prediction}</script> is calculated in the <code>DQN</code> class (<code>self.q_values</code>). <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-127-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mtext&gt;prediction&lt;/mtext&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-957" style="width: 4.927em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.734em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.281em, 1003.73em, 2.576em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-958"><span class="msubsup" id="MathJax-Span-959"><span style="display: inline-block; position: relative; width: 3.723em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-960" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.781em;"><span class="mtext" id="MathJax-Span-961" style="font-size: 70.7%; font-family: STIXMathJax_Main;">prediction</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.472em; border-left: 0px solid; width: 0px; height: 1.424em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>Q</mi><mtext>prediction</mtext></msub></math></span></span><script type="math/tex" id="MathJax-Element-127">Q_\text{prediction}</script> depends on the current <code>state</code> in the minibatch we drew and on the parameters <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-128-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-962" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.497em, 1000.48em, 2.5em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-963"><span class="mi" id="MathJax-Span-964" style="font-family: STIXMathJax_Normal; font-style: italic;">𝜃</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 1.039em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-128">\theta</script> of the network that estimates it.</p>
<p>The <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-129-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mtext&gt;target&lt;/mtext&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-965" style="width: 3.304em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.489em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.281em, 1002.49em, 2.577em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-966"><span class="msubsup" id="MathJax-Span-967"><span style="display: inline-block; position: relative; width: 2.466em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-968" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.781em;"><span class="mtext" id="MathJax-Span-969" style="font-size: 70.7%; font-family: STIXMathJax_Main;">target</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.473em; border-left: 0px solid; width: 0px; height: 1.425em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>Q</mi><mtext>target</mtext></msub></math></span></span><script type="math/tex" id="MathJax-Element-129">Q_\text{target}</script> value is calculated according to the Bellman equation. It is the sum of the immediate reward <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-130-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-970" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.433em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.42em, 2.489em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-971"><span class="mi" id="MathJax-Span-972" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑟</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.071em; border-left: 0px solid; width: 0px; height: 0.725em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi></math></span></span><script type="math/tex" id="MathJax-Element-130">r</script> received for performing action <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-131-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-973" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.46em, 2.499em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-974"><span class="mi" id="MathJax-Span-975" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.085em; border-left: 0px solid; width: 0px; height: 0.738em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-131">a</script> in state <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-132-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-976" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.433em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.38em, 2.5em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-977"><span class="mi" id="MathJax-Span-978" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 0.739em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-132">s</script> (<code>action</code> and <code>state</code> from the minibatch) and the maximum <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-133-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-979" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-980"><span class="mi" id="MathJax-Span-981" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-133">Q</script>-value over all possible actions <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-134-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-982" style="width: 1.085em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.812em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.186em, 1000.81em, 2.283em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-983"><span class="msup" id="MathJax-Span-984"><span style="display: inline-block; position: relative; width: 0.817em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.47em, 4.177em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-985" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.367em; left: 0.502em;"><span class="mo" id="MathJax-Span-986" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.085em; border-left: 0px solid; width: 0px; height: 1.162em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>a</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-134">a'</script> in <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-135-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-987" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.186em, 1000.76em, 2.284em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-988"><span class="msup" id="MathJax-Span-989"><span style="display: inline-block; position: relative; width: 0.755em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.39em, 4.178em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-990" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.367em; left: 0.44em;"><span class="mo" id="MathJax-Span-991" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 1.164em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>s</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-135">s'</script> (<code>new_state</code> from the minibatch):</p>
<p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-136-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mtext&gt;target&lt;/mtext&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B3;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mtext&gt;max&lt;/mtext&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-992" style="width: 18.726em; display: inline-block;"><span style="display: inline-block; position: relative; width: 14.177em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(3.085em, 1014.04em, 4.64em, -1000em); top: -4.113em; left: 0em;"><span class="mrow" id="MathJax-Span-993"><span class="msubsup" id="MathJax-Span-994"><span style="display: inline-block; position: relative; width: 2.466em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-995" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.781em;"><span class="mtext" id="MathJax-Span-996" style="font-size: 70.7%; font-family: STIXMathJax_Main;">target</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-997" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-998" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-999" style="font-family: STIXMathJax_Main;">,</span><span class="mi" id="MathJax-Span-1000" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.188em;">𝑎</span><span class="mo" id="MathJax-Span-1001" style="font-family: STIXMathJax_Main;">)</span><span class="mo" id="MathJax-Span-1002" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-1003" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.313em;">𝑟</span><span class="mo" id="MathJax-Span-1004" style="font-family: STIXMathJax_Main; padding-left: 0.25em;">+</span><span class="mi" id="MathJax-Span-1005" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.25em;">𝛾<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.03em;"></span></span><span class="texatom" id="MathJax-Span-1006"><span class="mrow" id="MathJax-Span-1007"><span class="mtext" id="MathJax-Span-1008" style="font-family: STIXMathJax_Main;">max</span></span></span><span class="mrow" id="MathJax-Span-1009" style="padding-left: 0.188em;"><span class="mo" id="MathJax-Span-1010" style="vertical-align: -0.201em;"><span style="font-family: STIXMathJax_Size1;">(</span></span><span class="mi" id="MathJax-Span-1011" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span class="mo" id="MathJax-Span-1012" style="font-family: STIXMathJax_Main;">(</span><span class="msup" id="MathJax-Span-1013"><span style="display: inline-block; position: relative; width: 0.755em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.39em, 4.178em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1014" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.417em; left: 0.44em;"><span class="mo" id="MathJax-Span-1015" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-1016" style="font-family: STIXMathJax_Main;">,</span><span class="msup" id="MathJax-Span-1017" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.817em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.47em, 4.177em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1018" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.417em; left: 0.502em;"><span class="mo" id="MathJax-Span-1019" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-1020" style="font-family: STIXMathJax_Main;">)</span><span class="mo" id="MathJax-Span-1021" style="vertical-align: -0.201em;"><span style="font-family: STIXMathJax_Size1;">)</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.113em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.553em; border-left: 0px solid; width: 0px; height: 1.766em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>Q</mi><mtext>target</mtext></msub><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>=</mo><mi>r</mi><mo>+</mo><mi>γ</mi><mrow class="MJX-TeXAtom-ORD"><mtext>max</mtext></mrow><mrow><mo>(</mo><mi>Q</mi><mo stretchy="false">(</mo><msup><mi>s</mi><mo>′</mo></msup><mo>,</mo><msup><mi>a</mi><mo>′</mo></msup><mo stretchy="false">)</mo><mo>)</mo></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-136">\begin{equation}
Q_\text{target}(s,a) = r + \gamma \textrm{max} \left(Q(s',a')\right)
\end{equation}</script></p>
<p>This is not done in the <code>DQN</code> class but in the <code>learn</code> method below. The calculated value is then passed to the placeholder called <code>self.target_q</code> in the <code>DQN</code> class. There, the loss function is defined and the gradient descent step is performed.</p>
<p>So, now that we understand how the parameters are updated, why use two networks?</p>
<p>The problem is that both <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-137-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mtext&gt;prediction&lt;/mtext&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1022" style="width: 4.927em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.734em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.281em, 1003.73em, 2.576em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-1023"><span class="msubsup" id="MathJax-Span-1024"><span style="display: inline-block; position: relative; width: 3.723em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1025" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.781em;"><span class="mtext" id="MathJax-Span-1026" style="font-size: 70.7%; font-family: STIXMathJax_Main;">prediction</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.472em; border-left: 0px solid; width: 0px; height: 1.424em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>Q</mi><mtext>prediction</mtext></msub></math></span></span><script type="math/tex" id="MathJax-Element-137">Q_\text{prediction}</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-138-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mtext&gt;target&lt;/mtext&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1027" style="width: 3.304em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.489em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.281em, 1002.49em, 2.577em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-1028"><span class="msubsup" id="MathJax-Span-1029"><span style="display: inline-block; position: relative; width: 2.466em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1030" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.781em;"><span class="mtext" id="MathJax-Span-1031" style="font-size: 70.7%; font-family: STIXMathJax_Main;">target</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.473em; border-left: 0px solid; width: 0px; height: 1.425em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>Q</mi><mtext>target</mtext></msub></math></span></span><script type="math/tex" id="MathJax-Element-138">Q_\text{target}</script> depend on the same parameters <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-139-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1032" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.497em, 1000.48em, 2.5em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1033"><span class="mi" id="MathJax-Span-1034" style="font-family: STIXMathJax_Normal; font-style: italic;">𝜃</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 1.039em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-139">\theta</script> if only one network is used. This can lead to instability when regressing <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-140-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mtext&gt;prediction&lt;/mtext&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1035" style="width: 4.927em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.734em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.281em, 1003.73em, 2.576em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-1036"><span class="msubsup" id="MathJax-Span-1037"><span style="display: inline-block; position: relative; width: 3.723em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1038" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.781em;"><span class="mtext" id="MathJax-Span-1039" style="font-size: 70.7%; font-family: STIXMathJax_Main;">prediction</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.472em; border-left: 0px solid; width: 0px; height: 1.424em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>Q</mi><mtext>prediction</mtext></msub></math></span></span><script type="math/tex" id="MathJax-Element-140">Q_\text{prediction}</script> towards <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-141-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mtext&gt;target&lt;/mtext&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1040" style="width: 3.304em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.489em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.281em, 1002.49em, 2.577em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-1041"><span class="msubsup" id="MathJax-Span-1042"><span style="display: inline-block; position: relative; width: 2.466em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1043" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.781em;"><span class="mtext" id="MathJax-Span-1044" style="font-size: 70.7%; font-family: STIXMathJax_Main;">target</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.473em; border-left: 0px solid; width: 0px; height: 1.425em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>Q</mi><mtext>target</mtext></msub></math></span></span><script type="math/tex" id="MathJax-Element-141">Q_\text{target}</script>
 because the "target is moving". We ensure a "fixed target" by 
introducing a second network with fixed and only occasionally updated 
parameters that estimates the target <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-142-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1045" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1046"><span class="mi" id="MathJax-Span-1047" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-142">Q</script>-values.</p>
<p>On page 1 of <a href="https://www.nature.com/articles/nature14236/" target="_blank">Mnih et al. 2015</a> the authors explain:</p>
<blockquote>
<p>Reinforcement learning is known to be unstable or even to diverge 
when a nonlinear function approximator such as a neural network is used 
to represent the action-value (also known as Q) function. This 
instability has several causes: the correlations present in the sequence
 of observations, the fact that small updates to Q may significantly 
change the policy and therefore change the data distribution, and the 
correlations between the action-values [...] and the target values 
[...].
We address these instabilities with a novel variant of Q-learning, which
 uses two key ideas. First, we used a biologically inspired mechanism 
termed experience replay that randomizes over the data, thereby removing
 correlations in the observation sequence and smoothing over changes in 
the data distribution [...]. Second, we used an iterative update that 
adjusts the action-values (Q) towards target values that are only 
periodically updated, thereby reducing correlations with the target. </p>
</blockquote>
<p>Therefore they used one network to predict the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-143-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mtext&gt;prediction&lt;/mtext&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1048" style="width: 4.927em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.734em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.281em, 1003.73em, 2.576em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-1049"><span class="msubsup" id="MathJax-Span-1050"><span style="display: inline-block; position: relative; width: 3.723em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1051" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.781em;"><span class="mtext" id="MathJax-Span-1052" style="font-size: 70.7%; font-family: STIXMathJax_Main;">prediction</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.472em; border-left: 0px solid; width: 0px; height: 1.424em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>Q</mi><mtext>prediction</mtext></msub></math></span></span><script type="math/tex" id="MathJax-Element-143">Q_\text{prediction}</script>-value and the other fixed network to predict the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-144-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mtext&gt;target&lt;/mtext&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1053" style="width: 3.304em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.489em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.281em, 1002.49em, 2.577em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-1054"><span class="msubsup" id="MathJax-Span-1055"><span style="display: inline-block; position: relative; width: 2.466em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1056" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.781em;"><span class="mtext" id="MathJax-Span-1057" style="font-size: 70.7%; font-family: STIXMathJax_Main;">target</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.473em; border-left: 0px solid; width: 0px; height: 1.425em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>Q</mi><mtext>target</mtext></msub></math></span></span><script type="math/tex" id="MathJax-Element-144">Q_\text{target}</script>-value.
 The main network is optimized during the gradient descend step and 
every 10000 steps the main network's parameters are copied to the target
 network. Be aware that the network update frequency is measured in the 
number of chosen actions/frames seen (DeepMind code) and not the number 
of parameter updates which occur every four frames (<a href="https://www.nature.com/articles/nature14236/" target="_blank">Mnih et al. 2015</a>).</p>
<p>There is one additional very powerful improvement called <em>Double Q-Learning</em>.</p>
<h2 id="7.-Double-Q-Learning">7. Double Q-Learning<a class="anchor-link" href="#7.-Double-Q-Learning">¶</a></h2>
<p>DQN has been observed to estimate unrealistically high <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-145-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1058" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1059"><span class="mi" id="MathJax-Span-1060" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-145">Q</script>-values. The reason for this is, that the Bellman equation <em>includes a maximization step over estimated action values, which tends to prefer overestimated to underestimated values</em> (see <a href="http://www.aaai.org/ocs/index.php/AAAI/AAAI16/paper/download/12389/11847" target="_blank">van Hasselt et al. 2016, page 1</a>). </p>
<p>The authors explain:</p>
<blockquote>
<p>If all values would be uniformly higher then the relative action 
preferences are preserved and we would not expect the resulting policy 
to be any worse. [...]
If, however, the overestimations are not uniform and not concentrated at
 states about which we wish to learn more, then they might negatively 
affect the quality of the resulting policy. [...]
We then show that this algorithm not only yields more accurate value 
estimates, but leads to much higher scores on several games. This 
demonstrates that the overestimations of DQN were indeed leading to 
poorer policies and that it is beneficial to reduce them </p>
</blockquote>
<p>The estimated <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-146-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1061" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1062"><span class="mi" id="MathJax-Span-1063" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-146">Q</script>-values are noisy. Assume that the true <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-147-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1064" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1065"><span class="mi" id="MathJax-Span-1066" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-147">Q</script>-value is 0 for all actions. But because of the noisy estimation, some <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-148-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1067" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1068"><span class="mi" id="MathJax-Span-1069" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-148">Q</script>-values
 might be slightly positive, others slightly negative. The max operation
 in the Bellman equation will however always chose the small positive 
values, despite the fact, that those actions are not truly better. The 
estimatation of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-149-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1070" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1071"><span class="mi" id="MathJax-Span-1072" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-149">Q</script>-values is thus biased towards larger values. How do we fix this?
Instead of estimating the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-150-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1073" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1074"><span class="mi" id="MathJax-Span-1075" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-150">Q</script>-values in the next state <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-151-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1076" style="width: 4.602em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.463em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.564em, 1003.42em, 2.829em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-1077"><span class="mi" id="MathJax-Span-1078" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span class="mo" id="MathJax-Span-1079" style="font-family: STIXMathJax_Main;">(</span><span class="msup" id="MathJax-Span-1080"><span style="display: inline-block; position: relative; width: 0.755em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.39em, 4.178em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1081" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.367em; left: 0.44em;"><span class="mo" id="MathJax-Span-1082" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-1083" style="font-family: STIXMathJax_Main;">,</span><span class="msup" id="MathJax-Span-1084" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.817em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.47em, 4.177em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1085" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.367em; left: 0.502em;"><span class="mo" id="MathJax-Span-1086" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-1087" style="font-family: STIXMathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.305em; border-left: 0px solid; width: 0px; height: 1.383em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi><mo stretchy="false">(</mo><msup><mi>s</mi><mo>′</mo></msup><mo>,</mo><msup><mi>a</mi><mo>′</mo></msup><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-151">Q(s',a')</script>
 with only the target network, we use the main network to estimate which
 action is the best and then ask the target network how high the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-152-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1088" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1089"><span class="mi" id="MathJax-Span-1090" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-152">Q</script>-value is for that action. This way, the main network will still prefer the action with the small positive <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-153-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1091" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1092"><span class="mi" id="MathJax-Span-1093" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-153">Q</script>-value but because of the noisy estimation, the target network will predict a small positive <strong>or</strong> small negative <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-154-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1094" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1095"><span class="mi" id="MathJax-Span-1096" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-154">Q</script>-value for that action and on average, the predicted <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-155-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1097" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1098"><span class="mi" id="MathJax-Span-1099" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-155">Q</script>-values will be closer to 0.</p>
<p>Mathematically, the reason for the overestimation is, that the 
expectation of a maximum is greater than or equal to the maximum of an 
expectation <a href="https://arxiv.org/abs/1302.7175" target="_blank">van Hasselt 2013, Theorem 1</a>.</p>
<p>The Bellman equation changes from</p>
<p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-156-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable columnalign=&quot;right left right left right left right left right left right left&quot; rowspacing=&quot;3pt&quot; columnspacing=&quot;0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em&quot; displaystyle=&quot;true&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mtext&gt;target&lt;/mtext&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B3;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mtext&gt;max&lt;/mtext&gt;&lt;/mrow&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mtext&gt;target&lt;/mtext&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mtext&gt;Normal DQN&lt;/mtext&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mtext&gt;to&lt;/mtext&gt;&lt;mspace width=&quot;2em&quot; /&gt;&lt;mspace width=&quot;2em&quot; /&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mtext&gt;target&lt;/mtext&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B3;&lt;/mi&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mtext&gt;argmax&lt;/mtext&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mtext&gt;main&lt;/mtext&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mtext&gt;target&lt;/mtext&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mtext&gt;Double DQN&lt;/mtext&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1100" style="width: 50.165em; display: inline-block;"><span style="display: inline-block; position: relative; width: 37.987em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(0.356em, 1037.97em, 3.365em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-1101"><span class="mtable" id="MathJax-Span-1102"><span style="display: inline-block; position: relative; width: 37.631em; height: 0px; margin-right: 0.167em; margin-left: 0.167em;"><span style="position: absolute; clip: rect(2.386em, 1009.74em, 5.198em, -1000em); top: -4.004em; left: 0em;"><span style="display: inline-block; position: relative; width: 9.79em; height: 0px;"><span style="position: absolute; clip: rect(3.166em, 1004.46em, 4.471em, -1000em); top: -4.784em; right: 0em;"><span class="mtd" id="MathJax-Span-1103"><span class="mrow" id="MathJax-Span-1104"><span class="msubsup" id="MathJax-Span-1105"><span style="display: inline-block; position: relative; width: 2.466em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1106" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.781em;"><span class="mtext" id="MathJax-Span-1107" style="font-size: 70.7%; font-family: STIXMathJax_Main;">target</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-1108" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-1109" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-1110" style="font-family: STIXMathJax_Main;">,</span><span class="mi" id="MathJax-Span-1111" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.188em;">𝑎</span><span class="mo" id="MathJax-Span-1112" style="font-family: STIXMathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; clip: rect(3.166em, 1009.74em, 4.471em, -1000em); top: -3.277em; right: 0em;"><span class="mtd" id="MathJax-Span-1140"><span class="mrow" id="MathJax-Span-1141"><span class="mtext" id="MathJax-Span-1142" style="font-family: STIXMathJax_Main;">to</span><span class="mspace" id="MathJax-Span-1143" style="height: 0em; vertical-align: 0em; width: 2.25em; display: inline-block; overflow: hidden;"></span><span class="mspace" id="MathJax-Span-1144" style="height: 0em; vertical-align: 0em; width: 2.25em; display: inline-block; overflow: hidden;"></span><span class="msubsup" id="MathJax-Span-1145"><span style="display: inline-block; position: relative; width: 2.466em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1146" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.781em;"><span class="mtext" id="MathJax-Span-1147" style="font-size: 70.7%; font-family: STIXMathJax_Main;">target</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-1148" style="font-family: STIXMathJax_Main;">(</span><span class="mi" id="MathJax-Span-1149" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span class="mo" id="MathJax-Span-1150" style="font-family: STIXMathJax_Main;">,</span><span class="mi" id="MathJax-Span-1151" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.188em;">𝑎</span><span class="mo" id="MathJax-Span-1152" style="font-family: STIXMathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; clip: rect(2.25em, 1019.98em, 5.259em, -1000em); top: -4.004em; left: 9.79em;"><span style="display: inline-block; position: relative; width: 20.12em; height: 0px;"><span style="position: absolute; clip: rect(3.03em, 1011.13em, 4.471em, -1000em); top: -4.784em; left: 0em;"><span class="mtd" id="MathJax-Span-1113"><span class="mrow" id="MathJax-Span-1114"><span class="mi" id="MathJax-Span-1115"></span><span class="mo" id="MathJax-Span-1116" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-1117" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.313em;">𝑟</span><span class="mo" id="MathJax-Span-1118" style="font-family: STIXMathJax_Main; padding-left: 0.25em;">+</span><span class="mi" id="MathJax-Span-1119" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.25em;">𝛾<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.03em;"></span></span><span class="texatom" id="MathJax-Span-1120"><span class="mrow" id="MathJax-Span-1121"><span class="mtext" id="MathJax-Span-1122" style="font-family: STIXMathJax_Main;">max</span></span></span><span class="mi" id="MathJax-Span-1123" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span class="mo" id="MathJax-Span-1124" style="font-family: STIXMathJax_Main;">(</span><span class="msup" id="MathJax-Span-1125"><span style="display: inline-block; position: relative; width: 0.755em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.39em, 4.178em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1126" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.417em; left: 0.44em;"><span class="mo" id="MathJax-Span-1127" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-1128" style="font-family: STIXMathJax_Main;">,</span><span class="msup" id="MathJax-Span-1129" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.817em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.47em, 4.177em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1130" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.417em; left: 0.502em;"><span class="mo" id="MathJax-Span-1131" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-1132" style="font-family: STIXMathJax_Main;">;</span><span class="msubsup" id="MathJax-Span-1133" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 2.169em; height: 0px;"><span style="position: absolute; clip: rect(3.174em, 1000.47em, 4.178em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1134" style="font-family: STIXMathJax_Normal; font-style: italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.484em;"><span class="mtext" id="MathJax-Span-1135" style="font-size: 70.7%; font-family: STIXMathJax_Main;">target</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-1136" style="font-family: STIXMathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; clip: rect(2.977em, 1019.98em, 4.532em, -1000em); top: -3.277em; left: 0em;"><span class="mtd" id="MathJax-Span-1153"><span class="mrow" id="MathJax-Span-1154"><span class="mi" id="MathJax-Span-1155"></span><span class="mo" id="MathJax-Span-1156" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-1157" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.313em;">𝑟</span><span class="mo" id="MathJax-Span-1158" style="font-family: STIXMathJax_Main; padding-left: 0.25em;">+</span><span class="mi" id="MathJax-Span-1159" style="font-family: STIXMathJax_Normal; font-style: italic; padding-left: 0.25em;">𝛾<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.03em;"></span></span><span class="mi" id="MathJax-Span-1160" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span class="mrow" id="MathJax-Span-1161" style="padding-left: 0.188em;"><span class="mo" id="MathJax-Span-1162" style="vertical-align: -0.201em;"><span style="font-family: STIXMathJax_Size1;">(</span></span><span class="msup" id="MathJax-Span-1163"><span style="display: inline-block; position: relative; width: 0.755em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.39em, 4.178em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1164" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.417em; left: 0.44em;"><span class="mo" id="MathJax-Span-1165" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-1166" style="font-family: STIXMathJax_Main;">,</span><span class="msup" id="MathJax-Span-1167" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.817em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.47em, 4.177em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1168" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.417em; left: 0.502em;"><span class="mo" id="MathJax-Span-1169" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-1170" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">=</span><span class="mtext" id="MathJax-Span-1171" style="font-family: STIXMathJax_Main; padding-left: 0.313em;">argmax</span><span class="mi" id="MathJax-Span-1172" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span class="mo" id="MathJax-Span-1173" style="font-family: STIXMathJax_Main;">(</span><span class="msup" id="MathJax-Span-1174"><span style="display: inline-block; position: relative; width: 0.755em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.39em, 4.178em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1175" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.417em; left: 0.44em;"><span class="mo" id="MathJax-Span-1176" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-1177" style="font-family: STIXMathJax_Main;">,</span><span class="msup" id="MathJax-Span-1178" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.817em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.47em, 4.177em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1179" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.417em; left: 0.502em;"><span class="mo" id="MathJax-Span-1180" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-1181" style="font-family: STIXMathJax_Main;">;</span><span class="msubsup" id="MathJax-Span-1182" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.973em; height: 0px;"><span style="position: absolute; clip: rect(3.174em, 1000.47em, 4.178em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1183" style="font-family: STIXMathJax_Normal; font-style: italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.484em;"><span class="mtext" id="MathJax-Span-1184" style="font-size: 70.7%; font-family: STIXMathJax_Main;">main</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-1185" style="font-family: STIXMathJax_Main;">)</span><span class="mo" id="MathJax-Span-1186" style="font-family: STIXMathJax_Main;">;</span><span class="msubsup" id="MathJax-Span-1187" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 2.169em; height: 0px;"><span style="position: absolute; clip: rect(3.174em, 1000.47em, 4.178em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1188" style="font-family: STIXMathJax_Normal; font-style: italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.484em;"><span class="mtext" id="MathJax-Span-1189" style="font-size: 70.7%; font-family: STIXMathJax_Main;">target</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-1190" style="vertical-align: -0.201em;"><span style="font-family: STIXMathJax_Size1;">)</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; clip: rect(2.379em, 1005.46em, 5.071em, -1000em); top: -4.004em; left: 32.16em;"><span style="display: inline-block; position: relative; width: 5.471em; height: 0px;"><span style="position: absolute; clip: rect(3.159em, 1005.46em, 4.344em, -1000em); top: -4.784em; right: 0em;"><span class="mtd" id="MathJax-Span-1137"><span class="mrow" id="MathJax-Span-1138"><span class="mtext" id="MathJax-Span-1139" style="font-family: STIXMathJax_Main;">Normal DQN</span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; clip: rect(3.159em, 1005.35em, 4.344em, -1000em); top: -3.277em; right: 0em;"><span class="mtd" id="MathJax-Span-1191"><span class="mrow" id="MathJax-Span-1192"><span class="mtext" id="MathJax-Span-1193" style="font-family: STIXMathJax_Main;">Double DQN</span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.513em; border-left: 0px solid; width: 0px; height: 3.686em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable columnalign="right left right left right left right left right left right left" rowspacing="3pt" columnspacing="0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em" displaystyle="true"><mtr><mtd><msub><mi>Q</mi><mtext>target</mtext></msub><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mo stretchy="false">)</mo></mtd><mtd><mi></mi><mo>=</mo><mi>r</mi><mo>+</mo><mi>γ</mi><mrow class="MJX-TeXAtom-ORD"><mtext>max</mtext></mrow><mi>Q</mi><mo stretchy="false">(</mo><msup><mi>s</mi><mo>′</mo></msup><mo>,</mo><msup><mi>a</mi><mo>′</mo></msup><mo>;</mo><msub><mi>θ</mi><mtext>target</mtext></msub><mo stretchy="false">)</mo></mtd><mtd><mtext>Normal DQN</mtext></mtd></mtr><mtr><mtd><mtext>to</mtext><mspace width="2em"></mspace><mspace width="2em"></mspace><msub><mi>Q</mi><mtext>target</mtext></msub><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mo stretchy="false">)</mo></mtd><mtd><mi></mi><mo>=</mo><mi>r</mi><mo>+</mo><mi>γ</mi><mi>Q</mi><mrow><mo>(</mo><msup><mi>s</mi><mo>′</mo></msup><mo>,</mo><msup><mi>a</mi><mo>′</mo></msup><mo>=</mo><mtext>argmax</mtext><mi>Q</mi><mo stretchy="false">(</mo><msup><mi>s</mi><mo>′</mo></msup><mo>,</mo><msup><mi>a</mi><mo>′</mo></msup><mo>;</mo><msub><mi>θ</mi><mtext>main</mtext></msub><mo stretchy="false">)</mo><mo>;</mo><msub><mi>θ</mi><mtext>target</mtext></msub><mo>)</mo></mrow></mtd><mtd><mtext>Double DQN</mtext></mtd></mtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-156">\begin{align}
Q_\text{target}(s,a) &= r + \gamma \textrm{max} Q(s',a';\theta_\text{target}) &\text{Normal DQN}\\
\text{to}\qquad\qquad Q_\text{target}(s,a) &= r + \gamma Q\left(s',a'=\text{argmax} Q(s',a';\theta_\text{main});\theta_\text{target}\right)&\text{Double DQN}
\end{align}</script></p>
<p>The main network estimates which action <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-157-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1194" style="width: 1.085em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.812em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.186em, 1000.81em, 2.283em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-1195"><span class="msup" id="MathJax-Span-1196"><span style="display: inline-block; position: relative; width: 0.817em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.47em, 4.177em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1197" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.367em; left: 0.502em;"><span class="mo" id="MathJax-Span-1198" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.085em; border-left: 0px solid; width: 0px; height: 1.162em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>a</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-157">a'</script> (in the next state <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-158-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1199" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.186em, 1000.76em, 2.284em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-1200"><span class="msup" id="MathJax-Span-1201"><span style="display: inline-block; position: relative; width: 0.755em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.39em, 4.178em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1202" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.367em; left: 0.44em;"><span class="mo" id="MathJax-Span-1203" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.086em; border-left: 0px solid; width: 0px; height: 1.164em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>s</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-158">s'</script>) is best (that is the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-159-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mtext&gt;argmax&lt;/mtext&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mtext&gt;main&lt;/mtext&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1204" style="width: 11.583em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.766em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.564em, 1008.72em, 2.87em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-1205"><span class="mtext" id="MathJax-Span-1206" style="font-family: STIXMathJax_Main;">argmax</span><span class="mi" id="MathJax-Span-1207" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span class="mo" id="MathJax-Span-1208" style="font-family: STIXMathJax_Main;">(</span><span class="msup" id="MathJax-Span-1209"><span style="display: inline-block; position: relative; width: 0.755em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.39em, 4.178em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1210" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑠</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.367em; left: 0.44em;"><span class="mo" id="MathJax-Span-1211" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-1212" style="font-family: STIXMathJax_Main;">,</span><span class="msup" id="MathJax-Span-1213" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.817em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.47em, 4.177em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1214" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.367em; left: 0.502em;"><span class="mo" id="MathJax-Span-1215" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-1216" style="font-family: STIXMathJax_Main;">;</span><span class="msubsup" id="MathJax-Span-1217" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.973em; height: 0px;"><span style="position: absolute; clip: rect(3.174em, 1000.47em, 4.178em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1218" style="font-family: STIXMathJax_Normal; font-style: italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.484em;"><span class="mtext" id="MathJax-Span-1219" style="font-size: 70.7%; font-family: STIXMathJax_Main;">main</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mo" id="MathJax-Span-1220" style="font-family: STIXMathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.359em; border-left: 0px solid; width: 0px; height: 1.437em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>argmax</mtext><mi>Q</mi><mo stretchy="false">(</mo><msup><mi>s</mi><mo>′</mo></msup><mo>,</mo><msup><mi>a</mi><mo>′</mo></msup><mo>;</mo><msub><mi>θ</mi><mtext>main</mtext></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-159">\text{argmax} Q(s',a';\theta_\text{main})</script> part). The target network then estimates what the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-160-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1221" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1222"><span class="mi" id="MathJax-Span-1223" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-160">Q</script>-value for that action is. This <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-161-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1224" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1225"><span class="mi" id="MathJax-Span-1226" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-161">Q</script>-value has to be discounted with <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-162-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B3;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1227" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.49em, 2.676em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1228"><span class="mi" id="MathJax-Span-1229" style="font-family: STIXMathJax_Normal; font-style: italic;">𝛾<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.03em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.318em; border-left: 0px solid; width: 0px; height: 0.972em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>γ</mi></math></span></span><script type="math/tex" id="MathJax-Element-162">\gamma</script> and is then added to the reward <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-163-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1230" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.433em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.42em, 2.489em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1231"><span class="mi" id="MathJax-Span-1232" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑟</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.071em; border-left: 0px solid; width: 0px; height: 0.725em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi></math></span></span><script type="math/tex" id="MathJax-Element-163">r</script> the agent got for action <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-164-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1233" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.46em, 2.499em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1234"><span class="mi" id="MathJax-Span-1235" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.085em; border-left: 0px solid; width: 0px; height: 0.738em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-164">a</script> (not <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-165-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1236" style="width: 1.085em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.812em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.186em, 1000.81em, 2.283em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-1237"><span class="msup" id="MathJax-Span-1238"><span style="display: inline-block; position: relative; width: 0.817em; height: 0px;"><span style="position: absolute; clip: rect(3.401em, 1000.47em, 4.177em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1239" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑎</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -4.367em; left: 0.502em;"><span class="mo" id="MathJax-Span-1240" style="font-size: 70.7%; font-family: STIXMathJax_Variants;">′</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.085em; border-left: 0px solid; width: 0px; height: 1.162em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>a</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-165">a'</script>).</p>
<p>I know that this equation might look discouraging. So let's describe it again in words:</p>
<p>Normal DQN: Ask the target network for the highest <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-166-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1241" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1242"><span class="mi" id="MathJax-Span-1243" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-166">Q</script>-Value. If the noisy <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-167-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1244" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1245"><span class="mi" id="MathJax-Span-1246" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-167">Q</script>-values are for example <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-168-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;0.1&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;0.1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1247" style="width: 5.685em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.275em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1004.23em, 2.829em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-1248"><span class="mo" id="MathJax-Span-1249" style="font-family: STIXMathJax_Main;">(</span><span class="mn" id="MathJax-Span-1250" style="font-family: STIXMathJax_Main;">0.1</span><span class="mo" id="MathJax-Span-1251" style="font-family: STIXMathJax_Main;">,</span><span class="mo" id="MathJax-Span-1252" style="font-family: STIXMathJax_Main; padding-left: 0.188em;">−</span><span class="mn" id="MathJax-Span-1253" style="font-family: STIXMathJax_Main;">0.1</span><span class="mo" id="MathJax-Span-1254" style="font-family: STIXMathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.305em; border-left: 0px solid; width: 0px; height: 1.269em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mn>0.1</mn><mo>,</mo><mo>−</mo><mn>0.1</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-168">(0.1,-0.1)</script> for actions with index <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-169-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1255" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1000.46em, 2.666em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-1256"><span class="mn" id="MathJax-Span-1257" style="font-family: STIXMathJax_Main;">0</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.09em; border-left: 0px solid; width: 0px; height: 1.054em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-169">0</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-170-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1258" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1000.38em, 2.652em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-1259"><span class="mn" id="MathJax-Span-1260" style="font-family: STIXMathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.071em; border-left: 0px solid; width: 0px; height: 1.035em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-170">1</script> respectively, the target <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-171-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1261" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1262"><span class="mi" id="MathJax-Span-1263" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-171">Q</script>-network will answer <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-172-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;0.1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1264" style="width: 1.68em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.245em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1001.14em, 2.666em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-1265"><span class="mn" id="MathJax-Span-1266" style="font-family: STIXMathJax_Main;">0.1</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.09em; border-left: 0px solid; width: 0px; height: 1.054em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0.1</mn></math></span></span><script type="math/tex" id="MathJax-Element-172">0.1</script>.</p>
<p>Double DQN: Ask the main network which action has the highest <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-173-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1267" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1268"><span class="mi" id="MathJax-Span-1269" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-173">Q</script>-value. If the noisy <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-174-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1270" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1271"><span class="mi" id="MathJax-Span-1272" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-174">Q</script>-values are for example <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-175-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;0.1&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;0.1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1273" style="width: 5.685em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.275em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1004.23em, 2.829em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-1274"><span class="mo" id="MathJax-Span-1275" style="font-family: STIXMathJax_Main;">(</span><span class="mn" id="MathJax-Span-1276" style="font-family: STIXMathJax_Main;">0.1</span><span class="mo" id="MathJax-Span-1277" style="font-family: STIXMathJax_Main;">,</span><span class="mo" id="MathJax-Span-1278" style="font-family: STIXMathJax_Main; padding-left: 0.188em;">−</span><span class="mn" id="MathJax-Span-1279" style="font-family: STIXMathJax_Main;">0.1</span><span class="mo" id="MathJax-Span-1280" style="font-family: STIXMathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.305em; border-left: 0px solid; width: 0px; height: 1.269em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mn>0.1</mn><mo>,</mo><mo>−</mo><mn>0.1</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-175">(0.1,-0.1)</script> for actions with index <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-176-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1281" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1000.46em, 2.666em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-1282"><span class="mn" id="MathJax-Span-1283" style="font-family: STIXMathJax_Main;">0</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.09em; border-left: 0px solid; width: 0px; height: 1.054em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-176">0</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-177-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1284" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1000.38em, 2.652em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-1285"><span class="mn" id="MathJax-Span-1286" style="font-family: STIXMathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.071em; border-left: 0px solid; width: 0px; height: 1.035em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-177">1</script> respectively, the main network will answer that action with index <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-178-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1287" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1000.46em, 2.666em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-1288"><span class="mn" id="MathJax-Span-1289" style="font-family: STIXMathJax_Main;">0</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.09em; border-left: 0px solid; width: 0px; height: 1.054em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-178">0</script> has the highest <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-179-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1290" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1291"><span class="mi" id="MathJax-Span-1292" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-179">Q</script>-value. Then we ask the target network, which has a different noise, what the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-180-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1293" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1294"><span class="mi" id="MathJax-Span-1295" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-180">Q</script>-value for the action with the chosen index (<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-181-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1296" style="width: 0.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.487em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.651em, 1000.46em, 2.666em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-1297"><span class="mn" id="MathJax-Span-1298" style="font-family: STIXMathJax_Main;">0</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.09em; border-left: 0px solid; width: 0px; height: 1.054em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-181">0</script> in this example) is. Let's assume the target network's noisy estimates are <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-182-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;0.05&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;0.3&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1299" style="width: 6.28em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.762em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.639em, 1004.71em, 2.829em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-1300"><span class="mo" id="MathJax-Span-1301" style="font-family: STIXMathJax_Main;">(</span><span class="mo" id="MathJax-Span-1302" style="font-family: STIXMathJax_Main;">−</span><span class="mn" id="MathJax-Span-1303" style="font-family: STIXMathJax_Main;">0.05</span><span class="mo" id="MathJax-Span-1304" style="font-family: STIXMathJax_Main;">,</span><span class="mn" id="MathJax-Span-1305" style="font-family: STIXMathJax_Main; padding-left: 0.188em;">0.3</span><span class="mo" id="MathJax-Span-1306" style="font-family: STIXMathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.305em; border-left: 0px solid; width: 0px; height: 1.285em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mo>−</mo><mn>0.05</mn><mo>,</mo><mn>0.3</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-182">(-0.05,0.3)</script> it will answer <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-183-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;0.05&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1307" style="width: 3.249em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.435em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.639em, 1002.37em, 2.693em, -1000em); top: -2.489em; left: 0em;"><span class="mrow" id="MathJax-Span-1308"><span class="mo" id="MathJax-Span-1309" style="font-family: STIXMathJax_Main;">−</span><span class="mn" id="MathJax-Span-1310" style="font-family: STIXMathJax_Main;">0.05</span></span><span style="display: inline-block; width: 0px; height: 2.489em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.126em; border-left: 0px solid; width: 0px; height: 1.105em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mn>0.05</mn></math></span></span><script type="math/tex" id="MathJax-Element-183">-0.05</script>.  </p>
<p>This solves the problem of overestimated <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-184-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1311" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1312"><span class="mi" id="MathJax-Span-1313" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-184">Q</script>-values because the two networks have different noise and the bias towards slightly larger noisy <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-185-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1314" style="width: 1.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.758em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.498em, 1000.71em, 2.641em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1315"><span class="mi" id="MathJax-Span-1316" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.272em; border-left: 0px solid; width: 0px; height: 1.224em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-185">Q</script>-values cancels.</p>
<p>One more thing:
If the game is over (<code>terminal=True</code>) because the agend lost or won, there is no next state and the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-186-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mtext&gt;target&lt;/mtext&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1317" style="width: 3.304em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.489em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.281em, 1002.49em, 2.577em, -1000em); top: -2.11em; left: 0em;"><span class="mrow" id="MathJax-Span-1318"><span class="msubsup" id="MathJax-Span-1319"><span style="display: inline-block; position: relative; width: 2.466em; height: 0px;"><span style="position: absolute; clip: rect(3.175em, 1000.73em, 4.319em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-1320" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑄</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.781em;"><span class="mtext" id="MathJax-Span-1321" style="font-size: 70.7%; font-family: STIXMathJax_Main;">target</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.11em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.473em; border-left: 0px solid; width: 0px; height: 1.425em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>Q</mi><mtext>target</mtext></msub></math></span></span><script type="math/tex" id="MathJax-Element-186">Q_\text{target}</script>-value is simply the reward <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-187-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1322" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.433em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.724em, 1000.42em, 2.489em, -1000em); top: -2.327em; left: 0em;"><span class="mrow" id="MathJax-Span-1323"><span class="mi" id="MathJax-Span-1324" style="font-family: STIXMathJax_Normal; font-style: italic;">𝑟</span></span><span style="display: inline-block; width: 0px; height: 2.327em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.071em; border-left: 0px solid; width: 0px; height: 0.725em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi></math></span></span><script type="math/tex" id="MathJax-Element-187">r</script>.</p>
<p>Look at the implementation in the cell below.</p>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt_container"><div class="prompt input_prompt"><bdi>In</bdi>&nbsp;[&nbsp;]:</div><div class="run_this_cell" title="Run this cell"><i class="fa-step-forward fa"></i></div></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit code here"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59961px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 760.6px; margin-bottom: -12px; border-right-width: 18px; min-height: 589px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-keyword">def</span> <span class="cm-def">learn</span>(<span class="cm-variable">session</span>, <span class="cm-variable">replay_memory</span>, <span class="cm-variable">main_dqn</span>, <span class="cm-variable">target_dqn</span>, <span class="cm-variable">batch_size</span>, <span class="cm-variable">gamma</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">    Args:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        session: A tensorflow sesson object</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        replay_memory: A ReplayMemory object</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        main_dqn: A DQN object</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        target_dqn: A DQN object</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        batch_size: Integer, Batch size</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        gamma: Float, discount factor for the Bellman equation</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">    Returns:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        loss: The loss of the minibatch, for tensorboard</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">    Draws a minibatch from the replay memory, calculates the </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">    target Q-value that the prediction Q-value is regressed to. </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">    Then a parameter update is performed on the main DQN.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">    """</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-comment"># Draw a minibatch from the replay memory</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-variable">states</span>, <span class="cm-variable">actions</span>, <span class="cm-variable">rewards</span>, <span class="cm-variable">new_states</span>, <span class="cm-variable">terminal_flags</span> <span class="cm-operator">=</span> <span class="cm-variable">replay_memory</span>.<span class="cm-property">get_minibatch</span>()    </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-comment"># The main network estimates which action is best (in the next </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-comment"># state s', new_states is passed!) </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-comment"># for every transition in the minibatch</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-variable">arg_q_max</span> <span class="cm-operator">=</span> <span class="cm-variable">session</span>.<span class="cm-property">run</span>(<span class="cm-variable">main_dqn</span>.<span class="cm-property">best_action</span>, <span class="cm-variable">feed_dict</span><span class="cm-operator">=</span>{<span class="cm-variable">main_dqn</span>.<span class="cm-property">input</span>:<span class="cm-variable">new_states</span>})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-comment"># The target network estimates the Q-values (in the next state s', new_states is passed!) </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-comment"># for every transition in the minibatch</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-variable">q_vals</span> <span class="cm-operator">=</span> <span class="cm-variable">session</span>.<span class="cm-property">run</span>(<span class="cm-variable">target_dqn</span>.<span class="cm-property">q_values</span>, <span class="cm-variable">feed_dict</span><span class="cm-operator">=</span>{<span class="cm-variable">target_dqn</span>.<span class="cm-property">input</span>:<span class="cm-variable">new_states</span>})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-variable">double_q</span> <span class="cm-operator">=</span> <span class="cm-variable">q_vals</span>[<span class="cm-builtin">range</span>(<span class="cm-variable">batch_size</span>), <span class="cm-variable">arg_q_max</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-comment"># Bellman equation. Multiplication with (1-terminal_flags) makes sure that </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-comment"># if the game is over, targetQ=rewards</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-variable">target_q</span> <span class="cm-operator">=</span> <span class="cm-variable">rewards</span> <span class="cm-operator">+</span> (<span class="cm-variable">gamma</span><span class="cm-operator">*</span><span class="cm-variable">double_q</span> <span class="cm-operator">*</span> (<span class="cm-number">1</span><span class="cm-operator">-</span><span class="cm-variable">terminal_flags</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-comment"># Gradient descend step to update the parameters of the main network</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-variable">loss</span>, <span class="cm-variable">_</span> <span class="cm-operator">=</span> <span class="cm-variable">session</span>.<span class="cm-property">run</span>([<span class="cm-variable">main_dqn</span>.<span class="cm-property">loss</span>, <span class="cm-variable">main_dqn</span>.<span class="cm-property">update</span>], </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                          <span class="cm-variable">feed_dict</span><span class="cm-operator">=</span>{<span class="cm-variable">main_dqn</span>.<span class="cm-property">input</span>:<span class="cm-variable">states</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                     <span class="cm-variable">main_dqn</span>.<span class="cm-property">target_q</span>:<span class="cm-variable">target_q</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                     <span class="cm-variable">main_dqn</span>.<span class="cm-property">action</span>:<span class="cm-variable">actions</span>})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-keyword">return</span> <span class="cm-variable">loss</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 589px;"></div><div class="CodeMirror-gutters" style="display: none; height: 607px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output"></div><div class="output"></div><div style="display: none;" class="btn btn-default output_collapsed" title="click to expand output">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit Markup Text here"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59961px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -12px; border-right-width: 18px; min-height: 45px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation">As I already mentioned, the parameters of the main network are periodically copied every 10,000 steps to the target network. This is implemented in the cell below.</span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 63px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><p>As
 I already mentioned, the parameters of the main network are 
periodically copied every 10,000 steps to the target network. This is 
implemented in the cell below.</p>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt_container"><div class="prompt input_prompt"><bdi>In</bdi>&nbsp;[&nbsp;]:</div><div class="run_this_cell" title="Run this cell"><i class="fa-step-forward fa"></i></div></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit code here"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59961px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 768.6px; margin-bottom: -12px; border-right-width: 18px; min-height: 487px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-keyword">class</span> <span class="cm-def">TargetNetworkUpdater</span>(<span class="cm-builtin">object</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-string">"""Copies the parameters of the main DQN to the target DQN"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-keyword">def</span> <span class="cm-def">__init__</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">main_dqn_vars</span>, <span class="cm-variable">target_dqn_vars</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        Args:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            main_dqn_vars: A list of tensorflow variables belonging to the main DQN network</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            target_dqn_vars: A list of tensorflow variables belonging to the target DQN network</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        """</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">main_dqn_vars</span> <span class="cm-operator">=</span> <span class="cm-variable">main_dqn_vars</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">target_dqn_vars</span> <span class="cm-operator">=</span> <span class="cm-variable">target_dqn_vars</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-keyword">def</span> <span class="cm-def">_update_target_vars</span>(<span class="cm-variable-2">self</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">update_ops</span> <span class="cm-operator">=</span> []</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">for</span> <span class="cm-variable">i</span>, <span class="cm-variable">var</span> <span class="cm-keyword">in</span> <span class="cm-builtin">enumerate</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">main_dqn_vars</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">copy_op</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">target_dqn_vars</span>[<span class="cm-variable">i</span>].<span class="cm-property">assign</span>(<span class="cm-variable">var</span>.<span class="cm-property">value</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">update_ops</span>.<span class="cm-property">append</span>(<span class="cm-variable">copy_op</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">return</span> <span class="cm-variable">update_ops</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-keyword">def</span> <span class="cm-def">__call__</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">sess</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        Args:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            sess: A Tensorflow session object</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        Assigns the values of the parameters of the main network to the </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        parameters of the target network</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        """</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">update_ops</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">_update_target_vars</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">for</span> <span class="cm-variable">copy_op</span> <span class="cm-keyword">in</span> <span class="cm-variable">update_ops</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">sess</span>.<span class="cm-property">run</span>(<span class="cm-variable">copy_op</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 487px;"></div><div class="CodeMirror-gutters" style="display: none; height: 505px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output"></div><div class="output"></div><div style="display: none;" class="btn btn-default output_collapsed" title="click to expand output">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit Markup Text here"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59961px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -12px; border-right-width: 18px; min-height: 28px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation">The function in the cell below creates a gif from a sequence of frames passed to it.</span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><p>The function in the cell below creates a gif from a sequence of frames passed to it.</p>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt_container"><div class="prompt input_prompt"><bdi>In</bdi>&nbsp;[&nbsp;]:</div><div class="run_this_cell" title="Run this cell"><i class="fa-step-forward fa"></i></div></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit code here"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59961px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 760.6px; margin-bottom: -12px; border-right-width: 18px; min-height: 266px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-keyword">def</span> <span class="cm-def">generate_gif</span>(<span class="cm-variable">frame_number</span>, <span class="cm-variable">frames_for_gif</span>, <span class="cm-variable">reward</span>, <span class="cm-variable">path</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        Args:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            frame_number: Integer, determining the number of the current frame</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            frames_for_gif: A sequence of (210, 160, 3) frames of an Atari game in RGB</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            reward: Integer, Total reward of the episode that es ouputted as a gif</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            path: String, path where gif is saved</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">    """</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-keyword">for</span> <span class="cm-variable">idx</span>, <span class="cm-variable">frame_idx</span> <span class="cm-keyword">in</span> <span class="cm-builtin">enumerate</span>(<span class="cm-variable">frames_for_gif</span>): </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">frames_for_gif</span>[<span class="cm-variable">idx</span>] <span class="cm-operator">=</span> <span class="cm-variable">resize</span>(<span class="cm-variable">frame_idx</span>, (<span class="cm-number">420</span>, <span class="cm-number">320</span>, <span class="cm-number">3</span>), </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                     <span class="cm-variable">preserve_range</span><span class="cm-operator">=</span><span class="cm-keyword">True</span>, <span class="cm-variable">order</span><span class="cm-operator">=</span><span class="cm-number">0</span>).<span class="cm-property">astype</span>(<span class="cm-variable">np</span>.<span class="cm-property">uint8</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-variable">imageio</span>.<span class="cm-property">mimsave</span>(<span class="cm-string">f'</span>{<span class="cm-variable">path</span>}{<span class="cm-string">"ATARI_frame_{0}_reward_{1}.gif"</span>.<span class="cm-property">format</span>(<span class="cm-variable">frame_number</span>, <span class="cm-variable">reward</span>)}<span class="cm-string">', </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-variable">frames_for_gif</span>, <span class="cm-variable">duration</span><span class="cm-operator">=</span><span class="cm-number">1</span><span class="cm-operator">/</span><span class="cm-number">30</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 266px;"></div><div class="CodeMirror-gutters" style="display: none; height: 284px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output"></div><div class="output"></div><div style="display: none;" class="btn btn-default output_collapsed" title="click to expand output">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit Markup Text here"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.60059px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -12px; border-right-width: 18px; min-height: 640px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation">The learning environment is provided by OpenAi's <span class="cm-comment">`gym`</span>. It is very important that you have the right version of the environments. <span class="cm-comment">`BreakoutDeterministic-v3`</span> for example has six actions whereas <span class="cm-comment">`BreakoutDeterministic-v4`</span> has a minimal set of four actions, which is what DeepMind used in <span class="cm-link">[xitari]</span><span class="cm-string cm-url">(https://github.com/deepmind/xitari/blob/master/games/supported/Breakout.cpp#L88-L91)</span>. Additional actions make the learning task harder for the agent which can alter the evaluation score significantly. If you want to find out the number of actions and their meaning, type <span class="cm-comment">`env.action_space.n`</span> and  <span class="cm-comment">`env.unwrapped.get_action_meanings()`</span>.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">There are two additional small adjustments we need to discuss:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">When a life is lost, we save <span class="cm-comment">`terminal_life_lost = True`</span> in the replay memory. Create a new notebook, make a Breakout environment, in a loop repeat random or no actions and print the reward and the number of lives the agent has. </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-comment">`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-comment">frame = env.reset()</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-comment">for i in range(1000):</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-comment">new_frame, reward, terminal, info = env.step(0)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-comment">print(reward, terminal, info['ale.lives'])</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-comment">`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">You will see, that there is no punishment (reward is 0) when a life is lost. It helps the agent tremendously avoiding losing a life if you consider loss of life as end of episode. However, we only do this in the replay memory as we do not want to reset the game once the first life is lost. Therefore two terminal states <span class="cm-comment">`terminal`</span> and <span class="cm-comment">`terminal_life_lost`</span> are needed, one to reset the game, the other for the replay memory. This adjustment helped the agent improve from an average reward slightly above 50 to approximately 140 in Breakout! </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Let's wrap the <span class="cm-comment">`gym`</span> environment in an <span class="cm-comment">`Atari`</span> class which takes care of stacking frames ontop of each other to create states, resetting the environment when an episode ended and checking if a life was lost after a step was taken. You find the implementation in the cell below.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">During evaluation, at the beginning of each episode, action 1 ('FIRE') is repeated for a random number of steps between 1 and <span class="cm-comment">`no_op_steps=10`</span>. This ensures, that the agent starts in a different situation every time and thus cannot simply learn a fixed sequence of actions. <span class="cm-link">[Mnih et al. 2015]</span><span class="cm-string cm-url">(https://www.nature.com/articles/nature14236/)</span> use a random number between 1 and 30 of 'NOOP'-actions (see page 10, Table 1). However, in Breakout, nothing happens if you don't fire first. Once there is a ball in the game, 'FIRE' does nothing. Therefore I started with a random number of 'FIRE'-actions. Furthermore, I limited the random number of initial 'FIRE' actions to 10. When experimenting with larger numbers, I found, that the first life was usually already lost when the agent starting moving. You might want to change this, in case you want to experiment with another environment.</span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 640px;"></div><div class="CodeMirror-gutters" style="display: none; height: 658px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><p>The learning environment is provided by OpenAi's <code>gym</code>. It is very important that you have the right version of the environments. <code>BreakoutDeterministic-v3</code> for example has six actions whereas <code>BreakoutDeterministic-v4</code> has a minimal set of four actions, which is what DeepMind used in <a href="https://github.com/deepmind/xitari/blob/master/games/supported/Breakout.cpp#L88-L91" target="_blank">xitari</a>.
 Additional actions make the learning task harder for the agent which 
can alter the evaluation score significantly. If you want to find out 
the number of actions and their meaning, type <code>env.action_space.n</code> and  <code>env.unwrapped.get_action_meanings()</code>.</p>
<p>There are two additional small adjustments we need to discuss:</p>
<p>When a life is lost, we save <code>terminal_life_lost = True</code> 
in the replay memory. Create a new notebook, make a Breakout 
environment, in a loop repeat random or no actions and print the reward 
and the number of lives the agent has. </p>
<p><code>frame = env.reset()
for i in range(1000):
    new_frame, reward, terminal, info = env.step(0)
    print(reward, terminal, info['ale.lives'])</code></p>
<p>You will see, that there is no punishment (reward is 0) when a life 
is lost. It helps the agent tremendously avoiding losing a life if you 
consider loss of life as end of episode. However, we only do this in the
 replay memory as we do not want to reset the game once the first life 
is lost. Therefore two terminal states <code>terminal</code> and <code>terminal_life_lost</code>
 are needed, one to reset the game, the other for the replay memory. 
This adjustment helped the agent improve from an average reward slightly
 above 50 to approximately 140 in Breakout! </p>
<p>Let's wrap the <code>gym</code> environment in an <code>Atari</code> 
class which takes care of stacking frames ontop of each other to create 
states, resetting the environment when an episode ended and checking if a
 life was lost after a step was taken. You find the implementation in 
the cell below.</p>
<p>During evaluation, at the beginning of each episode, action 1 ('FIRE') is repeated for a random number of steps between 1 and <code>no_op_steps=10</code>.
 This ensures, that the agent starts in a different situation every time
 and thus cannot simply learn a fixed sequence of actions. <a href="https://www.nature.com/articles/nature14236/" target="_blank">Mnih et al. 2015</a>
 use a random number between 1 and 30 of 'NOOP'-actions (see page 10, 
Table 1). However, in Breakout, nothing happens if you don't fire first.
 Once there is a ball in the game, 'FIRE' does nothing. Therefore I 
started with a random number of 'FIRE'-actions. Furthermore, I limited 
the random number of initial 'FIRE' actions to 10. When experimenting 
with larger numbers, I found, that the first life was usually already 
lost when the agent starting moving. You might want to change this, in 
case you want to experiment with another environment.</p>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt_container"><div class="prompt input_prompt"><bdi>In</bdi>&nbsp;[&nbsp;]:</div><div class="run_this_cell" title="Run this cell"><i class="fa-step-forward fa"></i></div></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit code here"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.60059px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 728.6px; margin-bottom: -12px; border-right-width: 18px; min-height: 878px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-keyword">class</span> <span class="cm-def">Atari</span>(<span class="cm-builtin">object</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-string">"""Wrapper for the environment provided by gym"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-keyword">def</span> <span class="cm-def">__init__</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">envName</span>, <span class="cm-variable">no_op_steps</span><span class="cm-operator">=</span><span class="cm-number">10</span>, <span class="cm-variable">agent_history_length</span><span class="cm-operator">=</span><span class="cm-number">4</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">env</span> <span class="cm-operator">=</span> <span class="cm-variable">gym</span>.<span class="cm-property">make</span>(<span class="cm-variable">envName</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">process_frame</span> <span class="cm-operator">=</span> <span class="cm-variable">FrameProcessor</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">state</span> <span class="cm-operator">=</span> <span class="cm-keyword">None</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">last_lives</span> <span class="cm-operator">=</span> <span class="cm-number">0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">no_op_steps</span> <span class="cm-operator">=</span> <span class="cm-variable">no_op_steps</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">agent_history_length</span> <span class="cm-operator">=</span> <span class="cm-variable">agent_history_length</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-keyword">def</span> <span class="cm-def">reset</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">sess</span>, <span class="cm-variable">evaluation</span><span class="cm-operator">=</span><span class="cm-keyword">False</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        Args:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            sess: A Tensorflow session object</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            evaluation: A boolean saying whether the agent is evaluating or training</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        Resets the environment and stacks four frames ontop of each other to </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        create the first state</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        """</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">frame</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">env</span>.<span class="cm-property">reset</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">last_lives</span> <span class="cm-operator">=</span> <span class="cm-number">0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">terminal_life_lost</span> <span class="cm-operator">=</span> <span class="cm-keyword">True</span> <span class="cm-comment"># Set to true so that the agent starts </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                  <span class="cm-comment"># with a 'FIRE' action when evaluating</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">if</span> <span class="cm-variable">evaluation</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-keyword">for</span> <span class="cm-variable">_</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-variable">random</span>.<span class="cm-property">randint</span>(<span class="cm-number">1</span>, <span class="cm-variable-2">self</span>.<span class="cm-property">no_op_steps</span>)):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                <span class="cm-variable">frame</span>, <span class="cm-variable">_</span>, <span class="cm-variable">_</span>, <span class="cm-variable">_</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">env</span>.<span class="cm-property">step</span>(<span class="cm-number">1</span>) <span class="cm-comment"># Action 'Fire'</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">processed_frame</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">process_frame</span>(<span class="cm-variable">sess</span>, <span class="cm-variable">frame</span>)   <span class="cm-comment"># (★★★)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">state</span> <span class="cm-operator">=</span> <span class="cm-variable">np</span>.<span class="cm-property">repeat</span>(<span class="cm-variable">processed_frame</span>, <span class="cm-variable-2">self</span>.<span class="cm-property">agent_history_length</span>, <span class="cm-variable">axis</span><span class="cm-operator">=</span><span class="cm-number">2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">return</span> <span class="cm-variable">terminal_life_lost</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-keyword">def</span> <span class="cm-def">step</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">sess</span>, <span class="cm-variable">action</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        Args:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            sess: A Tensorflow session object</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">            action: Integer, action the agent performs</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        Performs an action and observes the reward and terminal state from the environment</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-string">        """</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">new_frame</span>, <span class="cm-variable">reward</span>, <span class="cm-variable">terminal</span>, <span class="cm-variable">info</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">env</span>.<span class="cm-property">step</span>(<span class="cm-variable">action</span>)  <span class="cm-comment"># (5★)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">if</span> <span class="cm-variable">info</span>[<span class="cm-string">'ale.lives'</span>] <span class="cm-operator">&lt;</span> <span class="cm-variable-2">self</span>.<span class="cm-property">last_lives</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">terminal_life_lost</span> <span class="cm-operator">=</span> <span class="cm-keyword">True</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">else</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">terminal_life_lost</span> <span class="cm-operator">=</span> <span class="cm-variable">terminal</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">last_lives</span> <span class="cm-operator">=</span> <span class="cm-variable">info</span>[<span class="cm-string">'ale.lives'</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">processed_new_frame</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">process_frame</span>(<span class="cm-variable">sess</span>, <span class="cm-variable">new_frame</span>)   <span class="cm-comment"># (6★)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">new_state</span> <span class="cm-operator">=</span> <span class="cm-variable">np</span>.<span class="cm-property">append</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">state</span>[:, :, <span class="cm-number">1</span>:], <span class="cm-variable">processed_new_frame</span>, <span class="cm-variable">axis</span><span class="cm-operator">=</span><span class="cm-number">2</span>) <span class="cm-comment"># (6★)   </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable-2">self</span>.<span class="cm-property">state</span> <span class="cm-operator">=</span> <span class="cm-variable">new_state</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">return</span> <span class="cm-variable">processed_new_frame</span>, <span class="cm-variable">reward</span>, <span class="cm-variable">terminal</span>, <span class="cm-variable">terminal_life_lost</span>, <span class="cm-variable">new_frame</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    </span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 878px;"></div><div class="CodeMirror-gutters" style="display: none; height: 896px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output"></div><div class="output"></div><div style="display: none;" class="btn btn-default output_collapsed" title="click to expand output">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit Markup Text here"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.60059px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -12px; border-right-width: 18px; min-height: 113px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Mnih et al. 2013 and Mnih et al. 2015 clipped the rewards explaining that "Since the scale of scores varies greatly from game to game, we fixed all positive rewards to be 1 and all negative rewards to be -1, leaving 0 rewards unchanged. Clipping the rewards in this manner limits the scale of the error derivatives and makes it easier to use the same learning rate across multiple games. At the same time, it could affect the performance of our agent since it cannot differentiate between rewards of different magnitude." Clipping the rewards makes the training converge faster and improves the performance in the example of Breakout.</span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 131px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><p>Mnih
 et al. 2013 and Mnih et al. 2015 clipped the rewards explaining that 
"Since the scale of scores varies greatly from game to game, we fixed 
all positive rewards to be 1 and all negative rewards to be -1, leaving 0
 rewards unchanged. Clipping the rewards in this manner limits the scale
 of the error derivatives and makes it easier to use the same learning 
rate across multiple games. At the same time, it could affect the 
performance of our agent since it cannot differentiate between rewards 
of different magnitude." Clipping the rewards makes the training 
converge faster and improves the performance in the example of Breakout.</p>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt_container"><div class="prompt input_prompt"><bdi>In</bdi>&nbsp;[&nbsp;]:</div><div class="run_this_cell" title="Run this cell"><i class="fa-step-forward fa"></i></div></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit code here"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.60059px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 200.6px; margin-bottom: -12px; border-right-width: 18px; min-height: 130px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-keyword">def</span> <span class="cm-def">clip_reward</span>(<span class="cm-variable">reward</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-keyword">if</span> <span class="cm-variable">reward</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">return</span> <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-keyword">elif</span> <span class="cm-variable">reward</span> <span class="cm-operator">==</span> <span class="cm-number">0</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">return</span> <span class="cm-number">0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-keyword">else</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">return</span> <span class="cm-operator">-</span><span class="cm-number">1</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 130px;"></div><div class="CodeMirror-gutters" style="display: none; height: 148px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output"></div><div class="output"></div><div style="display: none;" class="btn btn-default output_collapsed" title="click to expand output">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit Markup Text here"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.60156px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -12px; border-right-width: 18px; min-height: 28px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation">In the cell below I declare some constants that define the learning behaviour of the agent:</span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><p>In the cell below I declare some constants that define the learning behaviour of the agent:</p>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt_container"><div class="prompt input_prompt"><bdi>In</bdi>&nbsp;[&nbsp;]:</div><div class="run_this_cell" title="Run this cell"><i class="fa-step-forward fa"></i></div></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit code here"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.60156px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 864.6px; margin-bottom: -12px; border-right-width: 18px; min-height: 691px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">tf</span>.<span class="cm-property">reset_default_graph</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-comment"># Control parameters</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">MAX_EPISODE_LENGTH</span> <span class="cm-operator">=</span> <span class="cm-number">18000</span>       <span class="cm-comment"># Equivalent of 5 minutes of gameplay at 60 frames per second</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">EVAL_FREQUENCY</span> <span class="cm-operator">=</span> <span class="cm-number">200000</span>          <span class="cm-comment"># Number of frames the agent sees between evaluations</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">EVAL_STEPS</span> <span class="cm-operator">=</span> <span class="cm-number">10000</span>               <span class="cm-comment"># Number of frames for one evaluation</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">NETW_UPDATE_FREQ</span> <span class="cm-operator">=</span> <span class="cm-number">10000</span>         <span class="cm-comment"># Number of chosen actions between updating the target network. </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                 <span class="cm-comment"># According to Mnih et al. 2015 this is measured in the number of </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                 <span class="cm-comment"># parameter updates (every four actions), however, in the </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                 <span class="cm-comment"># DeepMind code, it is clearly measured in the number</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                 <span class="cm-comment"># of actions the agent choses</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">DISCOUNT_FACTOR</span> <span class="cm-operator">=</span> <span class="cm-number">0.99</span>           <span class="cm-comment"># gamma in the Bellman equation</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">REPLAY_MEMORY_START_SIZE</span> <span class="cm-operator">=</span> <span class="cm-number">50000</span> <span class="cm-comment"># Number of completely random actions, </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                 <span class="cm-comment"># before the agent starts learning</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">MAX_FRAMES</span> <span class="cm-operator">=</span> <span class="cm-number">30000000</span>            <span class="cm-comment"># Total number of frames the agent sees </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">MEMORY_SIZE</span> <span class="cm-operator">=</span> <span class="cm-number">1000000</span>            <span class="cm-comment"># Number of transitions stored in the replay memory</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">NO_OP_STEPS</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>                 <span class="cm-comment"># Number of 'NOOP' or 'FIRE' actions at the beginning of an </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                 <span class="cm-comment"># evaluation episode</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">UPDATE_FREQ</span> <span class="cm-operator">=</span> <span class="cm-number">4</span>                  <span class="cm-comment"># Every four actions a gradient descend step is performed</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">HIDDEN</span> <span class="cm-operator">=</span> <span class="cm-number">1024</span>                    <span class="cm-comment"># Number of filters in the final convolutional layer. The output </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                 <span class="cm-comment"># has the shape (1,1,1024) which is split into two streams. Both </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                 <span class="cm-comment"># the advantage stream and value stream have the shape </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                 <span class="cm-comment"># (1,1,512). This is slightly different from the original </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                 <span class="cm-comment"># implementation but tests I did with the environment Pong </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                 <span class="cm-comment"># have shown that this way the score increases more quickly</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">LEARNING_RATE</span> <span class="cm-operator">=</span> <span class="cm-number">0.00001</span>          <span class="cm-comment"># Set to 0.00025 in Pong for quicker results. </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                 <span class="cm-comment"># Hessel et al. 2017 used 0.0000625</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">BS</span> <span class="cm-operator">=</span> <span class="cm-number">32</span>                          <span class="cm-comment"># Batch size</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">PATH</span> <span class="cm-operator">=</span> <span class="cm-string">"output/"</span>                 <span class="cm-comment"># Gifs and checkpoints will be saved here</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">SUMMARIES</span> <span class="cm-operator">=</span> <span class="cm-string">"summaries"</span>          <span class="cm-comment"># logdir for tensorboard</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">RUNID</span> <span class="cm-operator">=</span> <span class="cm-string">'run_1'</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">os</span>.<span class="cm-property">makedirs</span>(<span class="cm-variable">PATH</span>, <span class="cm-variable">exist_ok</span><span class="cm-operator">=</span><span class="cm-keyword">True</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">os</span>.<span class="cm-property">makedirs</span>(<span class="cm-variable">os</span>.<span class="cm-property">path</span>.<span class="cm-property">join</span>(<span class="cm-variable">SUMMARIES</span>, <span class="cm-variable">RUNID</span>), <span class="cm-variable">exist_ok</span><span class="cm-operator">=</span><span class="cm-keyword">True</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">SUMM_WRITER</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">summary</span>.<span class="cm-property">FileWriter</span>(<span class="cm-variable">os</span>.<span class="cm-property">path</span>.<span class="cm-property">join</span>(<span class="cm-variable">SUMMARIES</span>, <span class="cm-variable">RUNID</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">atari</span> <span class="cm-operator">=</span> <span class="cm-variable">Atari</span>(<span class="cm-variable">ENV_NAME</span>, <span class="cm-variable">NO_OP_STEPS</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-builtin">print</span>(<span class="cm-string">"The environment has the following {} actions: {}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">atari</span>.<span class="cm-property">env</span>.<span class="cm-property">action_space</span>.<span class="cm-property">n</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                                                <span class="cm-variable">atari</span>.<span class="cm-property">env</span>.<span class="cm-property">unwrapped</span>.<span class="cm-property">get_action_meanings</span>()))</span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 691px;"></div><div class="CodeMirror-gutters" style="display: none; height: 709px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output"></div><div class="output"></div><div style="display: none;" class="btn btn-default output_collapsed" title="click to expand output">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit Markup Text here"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59961px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -12px; border-right-width: 18px; min-height: 28px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Let's create the networks:</span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><p>Let's create the networks:</p>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt_container"><div class="prompt input_prompt"><bdi>In</bdi>&nbsp;[&nbsp;]:</div><div class="run_this_cell" title="Run this cell"><i class="fa-step-forward fa"></i></div></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit code here"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59961px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 616.6px; margin-bottom: -12px; border-right-width: 18px; min-height: 198px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-comment"># main DQN and target DQN networks:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-keyword">with</span> <span class="cm-variable">tf</span>.<span class="cm-property">variable_scope</span>(<span class="cm-string">'mainDQN'</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-variable">MAIN_DQN</span> <span class="cm-operator">=</span> <span class="cm-variable">DQN</span>(<span class="cm-variable">atari</span>.<span class="cm-property">env</span>.<span class="cm-property">action_space</span>.<span class="cm-property">n</span>, <span class="cm-variable">HIDDEN</span>, <span class="cm-variable">LEARNING_RATE</span>)   <span class="cm-comment"># (★★)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-keyword">with</span> <span class="cm-variable">tf</span>.<span class="cm-property">variable_scope</span>(<span class="cm-string">'targetDQN'</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-variable">TARGET_DQN</span> <span class="cm-operator">=</span> <span class="cm-variable">DQN</span>(<span class="cm-variable">atari</span>.<span class="cm-property">env</span>.<span class="cm-property">action_space</span>.<span class="cm-property">n</span>, <span class="cm-variable">HIDDEN</span>)               <span class="cm-comment"># (★★)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">init</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">global_variables_initializer</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">saver</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">train</span>.<span class="cm-property">Saver</span>()    </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">MAIN_DQN_VARS</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">trainable_variables</span>(<span class="cm-variable">scope</span><span class="cm-operator">=</span><span class="cm-string">'mainDQN'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">TARGET_DQN_VARS</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">trainable_variables</span>(<span class="cm-variable">scope</span><span class="cm-operator">=</span><span class="cm-string">'targetDQN'</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 198px;"></div><div class="CodeMirror-gutters" style="display: none; height: 216px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output"></div><div class="output"></div><div style="display: none;" class="btn btn-default output_collapsed" title="click to expand output">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit Markup Text here"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59961px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -12px; border-right-width: 18px; min-height: 64px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 19px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-header cm-header-3">### Tensorboard</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Setting up tensorboard summaries for the loss, the average reward, the evaluation score and the network parameters to observe the learning process:</span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 64px;"></div><div class="CodeMirror-gutters" style="display: none; height: 82px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><h3 id="Tensorboard">Tensorboard<a class="anchor-link" href="#Tensorboard">¶</a></h3>
<p>Setting up tensorboard summaries for the loss, the average reward, 
the evaluation score and the network parameters to observe the learning 
process:</p>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt_container"><div class="prompt input_prompt"><bdi>In</bdi>&nbsp;[&nbsp;]:</div><div class="run_this_cell" title="Run this cell"><i class="fa-step-forward fa"></i></div></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit code here"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59961px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 776.6px; margin-bottom: -12px; border-right-width: 18px; min-height: 385px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">LAYER_IDS</span> <span class="cm-operator">=</span> [<span class="cm-string">"conv1"</span>, <span class="cm-string">"conv2"</span>, <span class="cm-string">"conv3"</span>, <span class="cm-string">"conv4"</span>, <span class="cm-string">"denseAdvantage"</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">             <span class="cm-string">"denseAdvantageBias"</span>, <span class="cm-string">"denseValue"</span>, <span class="cm-string">"denseValueBias"</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-comment"># Scalar summaries for tensorboard: loss, average reward and evaluation score</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-keyword">with</span> <span class="cm-variable">tf</span>.<span class="cm-property">name_scope</span>(<span class="cm-string">'Performance'</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-variable">LOSS_PH</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">placeholder</span>(<span class="cm-variable">tf</span>.<span class="cm-property">float32</span>, <span class="cm-variable">shape</span><span class="cm-operator">=</span><span class="cm-keyword">None</span>, <span class="cm-variable">name</span><span class="cm-operator">=</span><span class="cm-string">'loss_summary'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-variable">LOSS_SUMMARY</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">summary</span>.<span class="cm-property">scalar</span>(<span class="cm-string">'loss'</span>, <span class="cm-variable">LOSS_PH</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-variable">REWARD_PH</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">placeholder</span>(<span class="cm-variable">tf</span>.<span class="cm-property">float32</span>, <span class="cm-variable">shape</span><span class="cm-operator">=</span><span class="cm-keyword">None</span>, <span class="cm-variable">name</span><span class="cm-operator">=</span><span class="cm-string">'reward_summary'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-variable">REWARD_SUMMARY</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">summary</span>.<span class="cm-property">scalar</span>(<span class="cm-string">'reward'</span>, <span class="cm-variable">REWARD_PH</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-variable">EVAL_SCORE_PH</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">placeholder</span>(<span class="cm-variable">tf</span>.<span class="cm-property">float32</span>, <span class="cm-variable">shape</span><span class="cm-operator">=</span><span class="cm-keyword">None</span>, <span class="cm-variable">name</span><span class="cm-operator">=</span><span class="cm-string">'evaluation_summary'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-variable">EVAL_SCORE_SUMMARY</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">summary</span>.<span class="cm-property">scalar</span>(<span class="cm-string">'evaluation_score'</span>, <span class="cm-variable">EVAL_SCORE_PH</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">PERFORMANCE_SUMMARIES</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">summary</span>.<span class="cm-property">merge</span>([<span class="cm-variable">LOSS_SUMMARY</span>, <span class="cm-variable">REWARD_SUMMARY</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-comment"># Histogramm summaries for tensorboard: parameters</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-keyword">with</span> <span class="cm-variable">tf</span>.<span class="cm-property">name_scope</span>(<span class="cm-string">'Parameters'</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-variable">ALL_PARAM_SUMMARIES</span> <span class="cm-operator">=</span> []</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-keyword">for</span> <span class="cm-variable">i</span>, <span class="cm-variable">Id</span> <span class="cm-keyword">in</span> <span class="cm-builtin">enumerate</span>(<span class="cm-variable">LAYER_IDS</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">with</span> <span class="cm-variable">tf</span>.<span class="cm-property">name_scope</span>(<span class="cm-string">'mainDQN/'</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">MAIN_DQN_KERNEL</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">summary</span>.<span class="cm-property">histogram</span>(<span class="cm-variable">Id</span>, <span class="cm-variable">tf</span>.<span class="cm-property">reshape</span>(<span class="cm-variable">MAIN_DQN_VARS</span>[<span class="cm-variable">i</span>], <span class="cm-variable">shape</span><span class="cm-operator">=</span>[<span class="cm-operator">-</span><span class="cm-number">1</span>]))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">ALL_PARAM_SUMMARIES</span>.<span class="cm-property">extend</span>([<span class="cm-variable">MAIN_DQN_KERNEL</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">PARAM_SUMMARIES</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">summary</span>.<span class="cm-property">merge</span>(<span class="cm-variable">ALL_PARAM_SUMMARIES</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 385px;"></div><div class="CodeMirror-gutters" style="display: none; height: 403px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output"></div><div class="output"></div><div style="display: none;" class="btn btn-default output_collapsed" title="click to expand output">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit Markup Text here"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59961px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -12px; border-right-width: 18px; min-height: 286px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 20px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-header cm-header-2">## 8. Putting everything together: DQN</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Now, we have everything we need to finally implement Algorithm 1 from <span class="cm-link">[Mnih et al. 2015]</span><span class="cm-string cm-url">(https://www.nature.com/articles/nature14236/)</span>. The stars will help you identify where each step is implemented.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-image cm-image-marker">!</span><span class="cm-image cm-image-alt-text cm-link">[]</span><span class="cm-string cm-url">(pictures/DQN2.png)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Go through the implementation in the cell below. You will find, that following every learning epoch of 200,000 frames (50,000 parameter updates), the agent is evaluated during 10,000 frames. Summaries are written to the logdir for tensorboard.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-strong">**I described the experiments I ran using this notebook </span><span class="cm-strong cm-link">[here]</span><span class="cm-string cm-url">(https://medium.com/@fabiograetz/tutorial-double-deep-q-learning-with-dueling-network-architectures-4c1b3fb7f756)</span><span class="cm-strong">. Feel free to play with the notebook, implement changes and experiment with different environments. If you are able to improve it or gained experience with another Atari game, please leave a commet </span><span class="cm-strong cm-link">[here]</span><span class="cm-string cm-url">(https://medium.com/@fabiograetz/tutorial-double-deep-q-learning-with-dueling-network-architectures-4c1b3fb7f756)</span><span class="cm-strong">, I'd love to know about it.**</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 286px;"></div><div class="CodeMirror-gutters" style="display: none; height: 304px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><h2 id="8.-Putting-everything-together:-DQN">8. Putting everything together: DQN<a class="anchor-link" href="#8.-Putting-everything-together:-DQN">¶</a></h2>
<p>Now, we have everything we need to finally implement Algorithm 1 from <a href="https://www.nature.com/articles/nature14236/" target="_blank">Mnih et al. 2015</a>. The stars will help you identify where each step is implemented.</p>
<p><img src="DQN%20-%20Jupyter%20Notebook_files/DQN2.png" alt=""></p>
<p>Go through the implementation in the cell below. You will find, that 
following every learning epoch of 200,000 frames (50,000 parameter 
updates), the agent is evaluated during 10,000 frames. Summaries are 
written to the logdir for tensorboard.</p>
<p><strong>I described the experiments I ran using this notebook <a href="https://medium.com/@fabiograetz/tutorial-double-deep-q-learning-with-dueling-network-architectures-4c1b3fb7f756" target="_blank">here</a>.
 Feel free to play with the notebook, implement changes and experiment 
with different environments. If you are able to improve it or gained 
experience with another Atari game, please leave a commet <a href="https://medium.com/@fabiograetz/tutorial-double-deep-q-learning-with-dueling-network-architectures-4c1b3fb7f756" target="_blank">here</a>, I'd love to know about it.</strong></p>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt_container"><div class="prompt input_prompt"><bdi>In</bdi>&nbsp;[&nbsp;]:</div><div class="run_this_cell" title="Run this cell"><i class="fa-step-forward fa"></i></div></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit code here"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59961px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 896.6px; margin-bottom: -12px; border-right-width: 18px; min-height: 2102px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-keyword">def</span> <span class="cm-def">train</span>():</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-string">"""Contains the training and evaluation loops"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-variable">my_replay_memory</span> <span class="cm-operator">=</span> <span class="cm-variable">ReplayMemory</span>(<span class="cm-variable">size</span><span class="cm-operator">=</span><span class="cm-variable">MEMORY_SIZE</span>, <span class="cm-variable">batch_size</span><span class="cm-operator">=</span><span class="cm-variable">BS</span>)   <span class="cm-comment"># (★)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-variable">update_networks</span> <span class="cm-operator">=</span> <span class="cm-variable">TargetNetworkUpdater</span>(<span class="cm-variable">MAIN_DQN_VARS</span>, <span class="cm-variable">TARGET_DQN_VARS</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-variable">explore_exploit_sched</span> <span class="cm-operator">=</span> <span class="cm-variable">ExplorationExploitationScheduler</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">MAIN_DQN</span>, <span class="cm-variable">atari</span>.<span class="cm-property">env</span>.<span class="cm-property">action_space</span>.<span class="cm-property">n</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">replay_memory_start_size</span><span class="cm-operator">=</span><span class="cm-variable">REPLAY_MEMORY_START_SIZE</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">max_frames</span><span class="cm-operator">=</span><span class="cm-variable">MAX_FRAMES</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-keyword">with</span> <span class="cm-variable">tf</span>.<span class="cm-property">Session</span>() <span class="cm-keyword">as</span> <span class="cm-variable">sess</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">sess</span>.<span class="cm-property">run</span>(<span class="cm-variable">init</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">frame_number</span> <span class="cm-operator">=</span> <span class="cm-number">0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">rewards</span> <span class="cm-operator">=</span> []</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">loss_list</span> <span class="cm-operator">=</span> []</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">while</span> <span class="cm-variable">frame_number</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">MAX_FRAMES</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-comment">########################</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-comment">####### Training #######</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-comment">########################</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">epoch_frame</span> <span class="cm-operator">=</span> <span class="cm-number">0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-keyword">while</span> <span class="cm-variable">epoch_frame</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">EVAL_FREQUENCY</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                <span class="cm-variable">terminal_life_lost</span> <span class="cm-operator">=</span> <span class="cm-variable">atari</span>.<span class="cm-property">reset</span>(<span class="cm-variable">sess</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                <span class="cm-variable">episode_reward_sum</span> <span class="cm-operator">=</span> <span class="cm-number">0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                <span class="cm-keyword">for</span> <span class="cm-variable">_</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-variable">MAX_EPISODE_LENGTH</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-comment"># (4★)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-variable">action</span> <span class="cm-operator">=</span> <span class="cm-variable">explore_exploit_sched</span>.<span class="cm-property">get_action</span>(<span class="cm-variable">sess</span>, <span class="cm-variable">frame_number</span>, <span class="cm-variable">atari</span>.<span class="cm-property">state</span>)   </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-comment"># (5★)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-variable">processed_new_frame</span>, <span class="cm-variable">reward</span>, <span class="cm-variable">terminal</span>, <span class="cm-variable">terminal_life_lost</span>, <span class="cm-variable">_</span> <span class="cm-operator">=</span> <span class="cm-variable">atari</span>.<span class="cm-property">step</span>(<span class="cm-variable">sess</span>, <span class="cm-variable">action</span>)  </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-variable">frame_number</span> <span class="cm-operator">+=</span> <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-variable">epoch_frame</span> <span class="cm-operator">+=</span> <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-variable">episode_reward_sum</span> <span class="cm-operator">+=</span> <span class="cm-variable">reward</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-comment"># Clip the reward</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-variable">clipped_reward</span> <span class="cm-operator">=</span> <span class="cm-variable">clip_reward</span>(<span class="cm-variable">reward</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-comment"># (7★) Store transition in the replay memory</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-variable">my_replay_memory</span>.<span class="cm-property">add_experience</span>(<span class="cm-variable">action</span><span class="cm-operator">=</span><span class="cm-variable">action</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                                    <span class="cm-variable">frame</span><span class="cm-operator">=</span><span class="cm-variable">processed_new_frame</span>[:, :, <span class="cm-number">0</span>],</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                                    <span class="cm-variable">reward</span><span class="cm-operator">=</span><span class="cm-variable">clipped_reward</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                                    <span class="cm-variable">terminal</span><span class="cm-operator">=</span><span class="cm-variable">terminal_life_lost</span>)   </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-keyword">if</span> <span class="cm-variable">frame_number</span> <span class="cm-operator">%</span> <span class="cm-variable">UPDATE_FREQ</span> <span class="cm-operator">==</span> <span class="cm-number">0</span> <span class="cm-keyword">and</span> <span class="cm-variable">frame_number</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">REPLAY_MEMORY_START_SIZE</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                        <span class="cm-variable">loss</span> <span class="cm-operator">=</span> <span class="cm-variable">learn</span>(<span class="cm-variable">sess</span>, <span class="cm-variable">my_replay_memory</span>, <span class="cm-variable">MAIN_DQN</span>, <span class="cm-variable">TARGET_DQN</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                     <span class="cm-variable">BS</span>, <span class="cm-variable">gamma</span> <span class="cm-operator">=</span> <span class="cm-variable">DISCOUNT_FACTOR</span>) <span class="cm-comment"># (8★)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                        <span class="cm-variable">loss_list</span>.<span class="cm-property">append</span>(<span class="cm-variable">loss</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-keyword">if</span> <span class="cm-variable">frame_number</span> <span class="cm-operator">%</span> <span class="cm-variable">NETW_UPDATE_FREQ</span> <span class="cm-operator">==</span> <span class="cm-number">0</span> <span class="cm-keyword">and</span> <span class="cm-variable">frame_number</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">REPLAY_MEMORY_START_SIZE</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                        <span class="cm-variable">update_networks</span>(<span class="cm-variable">sess</span>) <span class="cm-comment"># (9★)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-keyword">if</span> <span class="cm-variable">terminal</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                        <span class="cm-variable">terminal</span> <span class="cm-operator">=</span> <span class="cm-keyword">False</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                        <span class="cm-keyword">break</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                <span class="cm-variable">rewards</span>.<span class="cm-property">append</span>(<span class="cm-variable">episode_reward_sum</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                <span class="cm-comment"># Output the progress:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                <span class="cm-keyword">if</span> <span class="cm-builtin">len</span>(<span class="cm-variable">rewards</span>) <span class="cm-operator">%</span> <span class="cm-number">10</span> <span class="cm-operator">==</span> <span class="cm-number">0</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-comment"># Scalar summaries for tensorboard</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-keyword">if</span> <span class="cm-variable">frame_number</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">REPLAY_MEMORY_START_SIZE</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                        <span class="cm-variable">summ</span> <span class="cm-operator">=</span> <span class="cm-variable">sess</span>.<span class="cm-property">run</span>(<span class="cm-variable">PERFORMANCE_SUMMARIES</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                        <span class="cm-variable">feed_dict</span><span class="cm-operator">=</span>{<span class="cm-variable">LOSS_PH</span>:<span class="cm-variable">np</span>.<span class="cm-property">mean</span>(<span class="cm-variable">loss_list</span>), </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                                   <span class="cm-variable">REWARD_PH</span>:<span class="cm-variable">np</span>.<span class="cm-property">mean</span>(<span class="cm-variable">rewards</span>[<span class="cm-operator">-</span><span class="cm-number">100</span>:])})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                        </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                        <span class="cm-variable">SUMM_WRITER</span>.<span class="cm-property">add_summary</span>(<span class="cm-variable">summ</span>, <span class="cm-variable">frame_number</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                        <span class="cm-variable">loss_list</span> <span class="cm-operator">=</span> []</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-comment"># Histogramm summaries for tensorboard</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-variable">summ_param</span> <span class="cm-operator">=</span> <span class="cm-variable">sess</span>.<span class="cm-property">run</span>(<span class="cm-variable">PARAM_SUMMARIES</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-variable">SUMM_WRITER</span>.<span class="cm-property">add_summary</span>(<span class="cm-variable">summ_param</span>, <span class="cm-variable">frame_number</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-builtin">print</span>(<span class="cm-builtin">len</span>(<span class="cm-variable">rewards</span>), <span class="cm-variable">frame_number</span>, <span class="cm-variable">np</span>.<span class="cm-property">mean</span>(<span class="cm-variable">rewards</span>[<span class="cm-operator">-</span><span class="cm-number">100</span>:]))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-keyword">with</span> <span class="cm-builtin">open</span>(<span class="cm-string">'rewards.dat'</span>, <span class="cm-string">'a'</span>) <span class="cm-keyword">as</span> <span class="cm-variable">reward_file</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                        <span class="cm-builtin">print</span>(<span class="cm-builtin">len</span>(<span class="cm-variable">rewards</span>), <span class="cm-variable">frame_number</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                              <span class="cm-variable">np</span>.<span class="cm-property">mean</span>(<span class="cm-variable">rewards</span>[<span class="cm-operator">-</span><span class="cm-number">100</span>:]), <span class="cm-variable">file</span><span class="cm-operator">=</span><span class="cm-variable">reward_file</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-comment">########################</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-comment">###### Evaluation ######</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-comment">########################</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">terminal</span> <span class="cm-operator">=</span> <span class="cm-keyword">True</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">gif</span> <span class="cm-operator">=</span> <span class="cm-keyword">True</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">frames_for_gif</span> <span class="cm-operator">=</span> []</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">eval_rewards</span> <span class="cm-operator">=</span> []</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">evaluate_frame_number</span> <span class="cm-operator">=</span> <span class="cm-number">0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-keyword">for</span> <span class="cm-variable">_</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-variable">EVAL_STEPS</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                <span class="cm-keyword">if</span> <span class="cm-variable">terminal</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-variable">terminal_life_lost</span> <span class="cm-operator">=</span> <span class="cm-variable">atari</span>.<span class="cm-property">reset</span>(<span class="cm-variable">sess</span>, <span class="cm-variable">evaluation</span><span class="cm-operator">=</span><span class="cm-keyword">True</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-variable">episode_reward_sum</span> <span class="cm-operator">=</span> <span class="cm-number">0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-variable">terminal</span> <span class="cm-operator">=</span> <span class="cm-keyword">False</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">               </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-null cm-error">                </span><span class="cm-comment"># Fire (action 1), when a life was lost or the game just started, </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                <span class="cm-comment"># so that the agent does not stand around doing nothing. When playing </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                <span class="cm-comment"># with other environments, you might want to change this...</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                <span class="cm-variable">action</span> <span class="cm-operator">=</span> <span class="cm-number">1</span> <span class="cm-keyword">if</span> <span class="cm-variable">terminal_life_lost</span> <span class="cm-keyword">else</span> <span class="cm-variable">explore_exploit_sched</span>.<span class="cm-property">get_action</span>(<span class="cm-variable">sess</span>, <span class="cm-variable">frame_number</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                                                                       <span class="cm-variable">atari</span>.<span class="cm-property">state</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                                                                       <span class="cm-variable">evaluation</span><span class="cm-operator">=</span><span class="cm-keyword">True</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                <span class="cm-variable">processed_new_frame</span>, <span class="cm-variable">reward</span>, <span class="cm-variable">terminal</span>, <span class="cm-variable">terminal_life_lost</span>, <span class="cm-variable">new_frame</span> <span class="cm-operator">=</span> <span class="cm-variable">atari</span>.<span class="cm-property">step</span>(<span class="cm-variable">sess</span>, <span class="cm-variable">action</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                <span class="cm-variable">evaluate_frame_number</span> <span class="cm-operator">+=</span> <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                <span class="cm-variable">episode_reward_sum</span> <span class="cm-operator">+=</span> <span class="cm-variable">reward</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                <span class="cm-keyword">if</span> <span class="cm-variable">gif</span>: </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-variable">frames_for_gif</span>.<span class="cm-property">append</span>(<span class="cm-variable">new_frame</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                <span class="cm-keyword">if</span> <span class="cm-variable">terminal</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-variable">eval_rewards</span>.<span class="cm-property">append</span>(<span class="cm-variable">episode_reward_sum</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                    <span class="cm-variable">gif</span> <span class="cm-operator">=</span> <span class="cm-keyword">False</span> <span class="cm-comment"># Save only the first game of the evaluation as a gif</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                     </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-builtin">print</span>(<span class="cm-string">"Evaluation score:\n"</span>, <span class="cm-variable">np</span>.<span class="cm-property">mean</span>(<span class="cm-variable">eval_rewards</span>))       </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-keyword">try</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                <span class="cm-variable">generate_gif</span>(<span class="cm-variable">frame_number</span>, <span class="cm-variable">frames_for_gif</span>, <span class="cm-variable">eval_rewards</span>[<span class="cm-number">0</span>], <span class="cm-variable">PATH</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-keyword">except</span> <span class="cm-variable">IndexError</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                <span class="cm-builtin">print</span>(<span class="cm-string">"No evaluation game finished"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-comment">#Save the network parameters</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">saver</span>.<span class="cm-property">save</span>(<span class="cm-variable">sess</span>, <span class="cm-variable">PATH</span><span class="cm-operator">+</span><span class="cm-string">'/my_model'</span>, <span class="cm-variable">global_step</span><span class="cm-operator">=</span><span class="cm-variable">frame_number</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">frames_for_gif</span> <span class="cm-operator">=</span> []</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-comment"># Show the evaluation score in tensorboard</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">summ</span> <span class="cm-operator">=</span> <span class="cm-variable">sess</span>.<span class="cm-property">run</span>(<span class="cm-variable">EVAL_SCORE_SUMMARY</span>, <span class="cm-variable">feed_dict</span><span class="cm-operator">=</span>{<span class="cm-variable">EVAL_SCORE_PH</span>:<span class="cm-variable">np</span>.<span class="cm-property">mean</span>(<span class="cm-variable">eval_rewards</span>)})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">SUMM_WRITER</span>.<span class="cm-property">add_summary</span>(<span class="cm-variable">summ</span>, <span class="cm-variable">frame_number</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-keyword">with</span> <span class="cm-builtin">open</span>(<span class="cm-string">'rewardsEval.dat'</span>, <span class="cm-string">'a'</span>) <span class="cm-keyword">as</span> <span class="cm-variable">eval_reward_file</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                <span class="cm-builtin">print</span>(<span class="cm-variable">frame_number</span>, <span class="cm-variable">np</span>.<span class="cm-property">mean</span>(<span class="cm-variable">eval_rewards</span>), <span class="cm-variable">file</span><span class="cm-operator">=</span><span class="cm-variable">eval_reward_file</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 2102px;"></div><div class="CodeMirror-gutters" style="display: none; height: 2120px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output"></div><div class="output"></div><div style="display: none;" class="btn btn-default output_collapsed" title="click to expand output">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit Markup Text here"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59961px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -12px; border-right-width: 18px; min-height: 303px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 20px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-header cm-header-2">## 10. Train it yourself</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">If you want to train the network yourself, set <span class="cm-comment">`TRAIN`</span> to <span class="cm-comment">`True`</span> in the first cell of this notebook.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">Consider making your computer accessible remotely which I described in this blog post: <span class="cm-link">[Accessing your Deep Learning station remotely and setting up wake on lan]</span><span class="cm-string cm-url">(https://medium.com/@fabiograetz/accessing-your-deep-learning-station-remotely-and-setting-up-wake-on-lan-1e708c50fdd8)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">You can convert the notebook to a python script using <span class="cm-comment">`jupyter-nbconvert --to script DQN.ipynb`</span> and then run it in a tmux session which I described here: <span class="cm-link">[jupyter and tensorboard in tmux]</span><span class="cm-string cm-url">(https://medium.com/@fabiograetz/jupyter-and-tensorboard-in-tmux-5e5d202a4fb6)</span>.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">This has the advantage that you can detach from the tmux session and reattach to it remotely (from a laptop for example) in order to check on the agents progress. </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">If you want to use tensorboard to monitor the networks improvements type <span class="cm-comment">`tensorboard --logdir=summaries`</span> in a terminal in which the respective virtual environment is activated. Open a browser and go to <span class="cm-link">http://localhost:6006</span>. This works remotely as well.</span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 303px;"></div><div class="CodeMirror-gutters" style="display: none; height: 321px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><h2 id="10.-Train-it-yourself">10. Train it yourself<a class="anchor-link" href="#10.-Train-it-yourself">¶</a></h2>
<p>If you want to train the network yourself, set <code>TRAIN</code> to <code>True</code> in the first cell of this notebook.</p>
<p>Consider making your computer accessible remotely which I described in this blog post: <a href="https://medium.com/@fabiograetz/accessing-your-deep-learning-station-remotely-and-setting-up-wake-on-lan-1e708c50fdd8" target="_blank">Accessing your Deep Learning station remotely and setting up wake on lan</a></p>
<p>You can convert the notebook to a python script using <code>jupyter-nbconvert --to script DQN.ipynb</code> and then run it in a tmux session which I described here: <a href="https://medium.com/@fabiograetz/jupyter-and-tensorboard-in-tmux-5e5d202a4fb6" target="_blank">jupyter and tensorboard in tmux</a>.
This has the advantage that you can detach from the tmux session and 
reattach to it remotely (from a laptop for example) in order to check on
 the agents progress. </p>
<p>If you want to use tensorboard to monitor the networks improvements type <code>tensorboard --logdir=summaries</code> in a terminal in which the respective virtual environment is activated. Open a browser and go to <a href="http://localhost:6006/" target="_blank">http://localhost:6006</a>. This works remotely as well.</p>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt_container"><div class="prompt input_prompt"><bdi>In</bdi>&nbsp;[&nbsp;]:</div><div class="run_this_cell" title="Run this cell"><i class="fa-step-forward fa"></i></div></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit code here"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59961px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 96.6px; margin-bottom: -12px; border-right-width: 18px; min-height: 45px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-keyword">if</span> <span class="cm-variable">TRAIN</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-variable">train</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 63px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output"></div><div class="output"></div><div style="display: none;" class="btn btn-default output_collapsed" title="click to expand output">. . .</div></div></div><div class="cell text_cell unselected rendered" tabindex="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit Markup Text here"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59961px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: -12px; border-right-width: 18px; min-height: 31px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 20px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-header cm-header-2">## 9. Use a trained network</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div><div class="CodeMirror-gutters" style="display: none; height: 49px;"></div></div></div></div><div class="text_cell_render rendered_html" tabindex="-1"><h2 id="9.-Use-a-trained-network">9. Use a trained network<a class="anchor-link" href="#9.-Use-a-trained-network">¶</a></h2>
</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt_container"><div class="prompt input_prompt"><bdi>In</bdi>&nbsp;[&nbsp;]:</div><div class="run_this_cell" title="Run this cell"><i class="fa-step-forward fa"></i></div></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit code here"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59961px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 640.6px; margin-bottom: -12px; border-right-width: 18px; min-height: 79px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-variable">save_files_dict</span> <span class="cm-operator">=</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-string">'BreakoutDeterministic-v4'</span>:(<span class="cm-string">"trained/breakout/"</span>, <span class="cm-string">"my_model-15845555.meta"</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-string">'PongDeterministic-v4'</span>:(<span class="cm-string">"trained/pong/"</span>, <span class="cm-string">"my_model-3217770.meta"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 79px;"></div><div class="CodeMirror-gutters" style="display: none; height: 97px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output"></div><div class="output"></div><div style="display: none;" class="btn btn-default output_collapsed" title="click to expand output">. . .</div></div></div><div class="cell code_cell unselected rendered" tabindex="2"><div class="input"><div class="prompt_container"><div class="prompt input_prompt"><bdi>In</bdi>&nbsp;[&nbsp;]:</div><div class="run_this_cell" title="Run this cell"><i class="fa-step-forward fa"></i></div></div><div class="inner_cell"><div class="ctb_hideshow"><div class="celltoolbar"></div></div><div class="input_area" aria-label="Edit code here"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.60156px; left: 5.60001px;"><textarea style="position: absolute; bottom: -1em; padding: 0px; width: 1px; height: 1em; outline: currentcolor none medium;" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" wrap="off"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1" draggable="true"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 864.6px; margin-bottom: -12px; border-right-width: 18px; min-height: 589px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div style="position: relative; outline: currentcolor none medium;" role="presentation"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 5.60001px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span class="cm-keyword">if</span> <span class="cm-keyword">not</span> <span class="cm-variable">TRAIN</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-variable">gif_path</span> <span class="cm-operator">=</span> <span class="cm-string">"GIF/"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-variable">os</span>.<span class="cm-property">makedirs</span>(<span class="cm-variable">gif_path</span>, <span class="cm-variable">exist_ok</span><span class="cm-operator">=</span><span class="cm-keyword">True</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-variable">trained_path</span>, <span class="cm-variable">save_file</span> <span class="cm-operator">=</span> <span class="cm-variable">save_files_dict</span>[<span class="cm-variable">ENV_NAME</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-variable">explore_exploit_sched</span> <span class="cm-operator">=</span> <span class="cm-variable">ExplorationExploitationScheduler</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">MAIN_DQN</span>, <span class="cm-variable">atari</span>.<span class="cm-property">env</span>.<span class="cm-property">action_space</span>.<span class="cm-property">n</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">replay_memory_start_size</span><span class="cm-operator">=</span><span class="cm-variable">REPLAY_MEMORY_START_SIZE</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">max_frames</span><span class="cm-operator">=</span><span class="cm-variable">MAX_FRAMES</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">    <span class="cm-keyword">with</span> <span class="cm-variable">tf</span>.<span class="cm-property">Session</span>() <span class="cm-keyword">as</span> <span class="cm-variable">sess</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">saver</span> <span class="cm-operator">=</span> <span class="cm-variable">tf</span>.<span class="cm-property">train</span>.<span class="cm-property">import_meta_graph</span>(<span class="cm-variable">trained_path</span><span class="cm-operator">+</span><span class="cm-variable">save_file</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">saver</span>.<span class="cm-property">restore</span>(<span class="cm-variable">sess</span>,<span class="cm-variable">tf</span>.<span class="cm-property">train</span>.<span class="cm-property">latest_checkpoint</span>(<span class="cm-variable">trained_path</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">frames_for_gif</span> <span class="cm-operator">=</span> []</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">terminal_life_lost</span> <span class="cm-operator">=</span> <span class="cm-variable">atari</span>.<span class="cm-property">reset</span>(<span class="cm-variable">sess</span>, <span class="cm-variable">evaluation</span> <span class="cm-operator">=</span> <span class="cm-keyword">True</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">episode_reward_sum</span> <span class="cm-operator">=</span> <span class="cm-number">0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-keyword">while</span> <span class="cm-keyword">True</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">atari</span>.<span class="cm-property">env</span>.<span class="cm-property">render</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">action</span> <span class="cm-operator">=</span> <span class="cm-number">1</span> <span class="cm-keyword">if</span> <span class="cm-variable">terminal_life_lost</span> <span class="cm-keyword">else</span> <span class="cm-variable">explore_exploit_sched</span>.<span class="cm-property">get_action</span>(<span class="cm-variable">sess</span>, <span class="cm-number">0</span>, <span class="cm-variable">atari</span>.<span class="cm-property">state</span>,  </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                                                                                   <span class="cm-variable">evaluation</span> <span class="cm-operator">=</span> <span class="cm-keyword">True</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">processed_new_frame</span>, <span class="cm-variable">reward</span>, <span class="cm-variable">terminal</span>, <span class="cm-variable">terminal_life_lost</span>, <span class="cm-variable">new_frame</span> <span class="cm-operator">=</span> <span class="cm-variable">atari</span>.<span class="cm-property">step</span>(<span class="cm-variable">sess</span>, <span class="cm-variable">action</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">episode_reward_sum</span> <span class="cm-operator">+=</span> <span class="cm-variable">reward</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-variable">frames_for_gif</span>.<span class="cm-property">append</span>(<span class="cm-variable">new_frame</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">            <span class="cm-keyword">if</span> <span class="cm-variable">terminal</span> <span class="cm-operator">==</span> <span class="cm-keyword">True</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">                <span class="cm-keyword">break</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">atari</span>.<span class="cm-property">env</span>.<span class="cm-property">close</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-builtin">print</span>(<span class="cm-string">"The total reward is {}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">episode_reward_sum</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-builtin">print</span>(<span class="cm-string">"Creating gif..."</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-variable">generate_gif</span>(<span class="cm-number">0</span>, <span class="cm-variable">frames_for_gif</span>, <span class="cm-variable">episode_reward_sum</span>, <span class="cm-variable">gif_path</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation">        <span class="cm-builtin">print</span>(<span class="cm-string">"Gif created, check the folder {}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">gif_path</span>))</span></pre></div></div></div></div></div><div style="position: absolute; height: 18px; width: 1px; border-bottom: 0px solid transparent; top: 589px;"></div><div class="CodeMirror-gutters" style="display: none; height: 607px;"></div></div></div></div></div></div><div class="output_wrapper"><div class="out_prompt_overlay prompt" title="click to expand output; double click to hide output"></div><div class="output"></div><div style="display: none;" class="btn btn-default output_collapsed" title="click to expand output">. . .</div></div></div></div><div class="end_space"></div></div>
        <div id="tooltip" class="ipython_tooltip" style="display:none"><div class="tooltipbuttons"><a href="#" role="button" class="ui-button"><span class="ui-icon ui-icon-close">Close</span></a><a href="#" role="button" class="ui-button" id="expanbutton" title="Grow the tooltip vertically (press shift-tab twice)"><span class="ui-icon ui-icon-plus">Expand</span></a><a href="#" role="button" class="ui-button" title="show the current docstring in pager (press shift-tab 4 times)"><span class="ui-icon ui-icon-arrowstop-l-n">Open in Pager</span></a><a href="#" role="button" class="ui-button" title="Tooltip will linger for 10 seconds while you type" style="display: none;"><span class="ui-icon ui-icon-clock">Close</span></a></div><div class="pretooltiparrow"></div><div class="tooltiptext smalltooltip"></div></div>
    </div>
</div>



</div>



<div id="pager" class="ui-resizable">
    <div id="pager-contents">
        <div id="pager-container" class="container"></div>
    </div>
    <div id="pager-button-area"><a role="button" title="Open the pager in an external window" class="ui-button"><span class="ui-icon ui-icon-extlink"></span></a><a role="button" title="Close the pager" class="ui-button"><span class="ui-icon ui-icon-close"></span></a></div>
<div class="ui-resizable-handle ui-resizable-n" style="z-index: 90;"></div></div>






<script type="text/javascript">
    sys_info = {"notebook_version": "6.0.0", "notebook_path": "/home/konstantin/anaconda3/lib/python3.7/site-packages/notebook", "commit_source": "", "commit_hash": "", "sys_version": "3.7.3 (default, Mar 27 2019, 22:11:17) \n[GCC 7.3.0]", "sys_executable": "/home/konstantin/anaconda3/bin/python", "sys_platform": "linux", "platform": "Linux-5.0.0-32-generic-x86_64-with-debian-buster-sid", "os_name": "posix", "default_encoding": "UTF-8"};
</script>

<script src="DQN%20-%20Jupyter%20Notebook_files/encoding.js" charset="utf-8"></script>

<script src="DQN%20-%20Jupyter%20Notebook_files/main.js" type="text/javascript" charset="utf-8"></script>



<script type="text/javascript">
  function _remove_token_from_url() {
    if (window.location.search.length <= 1) {
      return;
    }
    var search_parameters = window.location.search.slice(1).split('&');
    for (var i = 0; i < search_parameters.length; i++) {
      if (search_parameters[i].split('=')[0] === 'token') {
        // remote token from search parameters
        search_parameters.splice(i, 1);
        var new_search = '';
        if (search_parameters.length) {
          new_search = '?' + search_parameters.join('&');
        }
        var new_url = window.location.origin + 
                      window.location.pathname + 
                      new_search + 
                      window.location.hash;
        window.history.replaceState({}, "", new_url);
        return;
      }
    }
  }
  _remove_token_from_url();
</script>


<div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px none; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; min-width: 0px; max-width: none; padding: 0px; border: 0px none; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-size-adjust: none; font-family: STIXMathJax_Size2, sans-serif;"></div></div></body></html>